# Railway Configuration for Metamorph API Server
# Uses multi-stage Dockerfile for optimized builds

[build]
builder = "dockerfile"
dockerfilePath = "Dockerfile"

[deploy]
healthcheckPath = "/api/health"
healthcheckTimeout = 30
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
# Single instance required for SQLite (no horizontal scaling)
numReplicas = 1

# Persistent volume for SQLite database
# Creates a volume named "metamorph-data" mounted at /data
# Data survives container restarts and deployments
[[mounts]]
source = "metamorph-data"
destination = "/data"

# Required environment variables (set in Railway dashboard):
# - ANTHROPIC_API_KEY: Your Anthropic API key for Claude access
# - PORT: Automatically set by Railway (default: 3001)
# - DATABASE_PATH: /data/metamorph.db (set in Dockerfile)
