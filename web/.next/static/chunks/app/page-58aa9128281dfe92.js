(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{745:()=>{},1591:()=>{},5566:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(5155),n=s(2115),l=s(264),r=s(258),i=s(1955),o=s(3646),c=s(5571),m=s(6750),d=s(2912),u=s(5339);let x={episodic:"#1aff99",semantic:"#00c8ff",identity:"#7c5cff",selected:"#ffffff",connection:"#4a5568",connectionActive:"#7c5cff",background:"#050608"};function p(e){let{node:t,isSelected:s,isHovered:r,onClick:c,onHover:m}=e,d=(0,n.useRef)(null),p=(0,n.useRef)(null),h=x[t.type],b=.1+.3*(t.importance>1?t.importance/100:t.importance),f=r?1.3*b:b;(0,l.D)(e=>{if(p.current&&(s||r)){let t=.1*Math.sin(3*e.clock.elapsedTime)+1;p.current.scale.setScalar(1.5*f*t)}});let g=(0,n.useCallback)(e=>{e.stopPropagation(),c(t.id)},[c,t.id]),y=(0,n.useCallback)(e=>{e.stopPropagation(),m(t.id),document.body.style.cursor="pointer"},[m,t.id]),v=(0,n.useCallback)(()=>{m(null),document.body.style.cursor="auto"},[m]);return(0,a.jsxs)("group",{position:[t.position.x,t.position.y,t.position.z],children:[(s||r)&&(0,a.jsxs)("mesh",{ref:p,scale:1.5*f,children:[(0,a.jsx)("sphereGeometry",{args:[1,16,16]}),(0,a.jsx)("meshBasicMaterial",{color:h,transparent:!0,opacity:.15,depthWrite:!1})]}),(0,a.jsxs)("mesh",{ref:d,scale:f,onClick:g,onPointerOver:y,onPointerOut:v,children:[(0,a.jsx)("sphereGeometry",{args:[1,32,32]}),(0,a.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:s?.5:r?.3:.1,roughness:.3,metalness:.7})]}),s&&(0,a.jsxs)("mesh",{rotation:[Math.PI/2,0,0],scale:1.3*f,children:[(0,a.jsx)("ringGeometry",{args:[.9,1,32]}),(0,a.jsx)("meshBasicMaterial",{color:x.selected,transparent:!0,opacity:.8,side:u.$EB})]}),r&&(0,a.jsx)(i.Q,{follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:(0,a.jsx)(o.E,{center:!0,distanceFactor:15,style:{transform:"translate3d(0, -40px, 0)",pointerEvents:"none"},children:(0,a.jsxs)("div",{className:"px-3 py-2 rounded-lg text-xs text-white max-w-48 text-center",style:{backgroundColor:"rgba(5, 6, 8, 0.9)",border:"1px solid ".concat(h),boxShadow:"0 0 10px ".concat(h,"40")},children:[(0,a.jsx)("div",{className:"font-medium mb-1 capitalize",style:{color:h},children:t.type}),(0,a.jsx)("div",{className:"text-gray-300 line-clamp-2",children:t.content.length>80?"".concat(t.content.substring(0,80),"..."):t.content})]})})})]})}function h(e){let{connections:t,nodes:s,selectedNodeId:l,hoveredNodeId:r}=e,i=(0,n.useMemo)(()=>{let e=new Map;return s.forEach(t=>{e.set(t.id,[t.position.x,t.position.y,t.position.z])}),e},[s]),o=(0,n.useMemo)(()=>t.map(e=>{let t=i.get(e.from),s=i.get(e.to);if(!t||!s)return null;let a=l===e.from||l===e.to||r===e.from||r===e.to;return{points:[t,s],strength:e.strength,isActive:a}}).filter(Boolean),[t,i,l,r]);return(0,a.jsx)("group",{children:o.map((e,t)=>(0,a.jsx)(c.N,{points:e.points,color:e.isActive?x.connectionActive:x.connection,lineWidth:e.isActive?2:1,transparent:!0,opacity:e.isActive?.8:.2+.3*e.strength,dashed:!e.isActive,dashScale:10,dashSize:.5,gapSize:.3},t))})}function b(){return(0,a.jsxs)("group",{children:[(0,a.jsx)("gridHelper",{args:[100,50,x.connection,x.connection],position:[0,-20,0]}),(0,a.jsx)("gridHelper",{args:[100,50,x.connection,x.connection],position:[0,0,-50],rotation:[Math.PI/2,0,0]})]})}function f(e){let{nodes:t,connections:s,selectedNodeId:l,onNodeClick:r,onNodeHover:i,showConnections:o,autoRotate:c}=e,[u,f]=(0,n.useState)(null),g=(0,n.useCallback)(e=>{f(e),i(e)},[i]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("ambientLight",{intensity:.3}),(0,a.jsx)("pointLight",{position:[10,10,10],intensity:1,color:"#ffffff"}),(0,a.jsx)("pointLight",{position:[-10,-10,-10],intensity:.5,color:x.identity}),(0,a.jsx)("pointLight",{position:[10,-10,10],intensity:.3,color:x.episodic}),(0,a.jsx)(m.N,{enablePan:!0,enableZoom:!0,enableRotate:!0,autoRotate:c,autoRotateSpeed:.5,minDistance:5,maxDistance:100,dampingFactor:.05,enableDamping:!0}),(0,a.jsx)(d.A,{radius:100,depth:50,count:5e3,factor:4,saturation:0,fade:!0,speed:.5}),(0,a.jsx)(b,{}),o&&s.length>0&&(0,a.jsx)(h,{connections:s,nodes:t,selectedNodeId:l,hoveredNodeId:u}),t.map(e=>(0,a.jsx)(p,{node:e,isSelected:l===e.id,isHovered:u===e.id,onClick:r,onHover:g},e.id))]})}function g(e){let{nodes:t,connections:s=[],selectedNodeId:n=null,onNodeClick:l=()=>{},onNodeHover:i=()=>{},showConnections:o=!0,autoRotate:c=!1}=e;return 0===t.length?(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:x.background},children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"text-6xl opacity-20",children:"\uD83E\uDDE0"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No memories to visualize"})]})}):(0,a.jsx)("div",{className:"w-full h-full",style:{backgroundColor:x.background},children:(0,a.jsxs)(r.Hl,{camera:{position:[0,20,60],fov:50,near:.1,far:1e3},gl:{antialias:!0,alpha:!1,powerPreference:"high-performance"},dpr:[1,2],children:[(0,a.jsx)("color",{attach:"background",args:[x.background]}),(0,a.jsx)("fog",{attach:"fog",args:[x.background,50,150]}),(0,a.jsx)(f,{nodes:t,connections:s,selectedNodeId:n,onNodeClick:l,onNodeHover:i,showConnections:o,autoRotate:c})]})})}},7318:()=>{},8082:()=>{},8623:(e,t,s)=>{Promise.resolve().then(s.bind(s,9935))},9935:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>t6});var a=s(5155),n=s(2115),l=s(6497),r=s(8382),i=s(9397),o=s(5870),c=s(6983),m=s(1473),d=s(8734),u=s(7586),x=s(4033),p=s(6191),h=s(5229),b=s(9540),f=s(9476),g=s(856),y=s(5704);let v="/api",j=(y.env.NEXT_PUBLIC_API_URL||"http://".concat(window.location.hostname,":3001"))+"/api";async function N(e,t){let s=await fetch(e,{...t,headers:{"Content-Type":"application/json",...null==t?void 0:t.headers}});if(!s.ok)throw Error((await s.json().catch(()=>({error:"Request failed"}))).error||"HTTP ".concat(s.status));return s.json()}async function w(e){return N("".concat(v,"/session"),{method:"POST",body:JSON.stringify({config:e})})}async function S(e){try{let t=await C(e);return{sessionId:e,stance:t.stance,config:t.config}}catch(e){return null}}async function C(e){return N("".concat(v,"/state?sessionId=").concat(e))}async function k(e,t){return N("".concat(v,"/config"),{method:"PUT",body:JSON.stringify({sessionId:e,config:t})})}function E(e,t,s,a){let n=new AbortController;return(async()=>{var l,r;try{let r=await fetch("".concat(j,"/chat/stream"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,message:t,emotionContext:s||void 0}),signal:n.signal});if(!r.ok)throw Error("HTTP ".concat(r.status));let i=null==(l=r.body)?void 0:l.getReader();if(!i)throw Error("No response body");let o=new TextDecoder,c="";for(;;){let{done:e,value:t}=await i.read();if(e)break;let s=(c+=o.decode(t,{stream:!0})).split("\n");c=s.pop()||"";let n="";for(let e of s)if(e.startsWith("event: "))n=e.slice(7).trim();else if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);"text"===n&&a.onText?a.onText(e.text):"tool_event"===n&&a.onToolEvent?a.onToolEvent(e):"question"===n&&a.onQuestion?a.onQuestion(e):"complete"===n&&a.onComplete?a.onComplete(e):"error"===n&&a.onError&&a.onError(Error(e.error))}catch(e){}n=""}}}catch(e){e instanceof Error&&"AbortError"!==e.name&&(null==(r=a.onError)||r.call(a,e))}})(),()=>n.abort()}async function M(e,t){let s=new URLSearchParams({sessionId:e});return t&&s.append("limit",t.toString()),N("".concat(v,"/history?").concat(s))}async function A(e){return N("".concat(v,"/subagents?sessionId=").concat(e))}async function O(e){return N("".concat(v,"/export?sessionId=").concat(e))}async function I(e,t){let s=new URLSearchParams({sessionId:e});return t&&s.append("limit",t.toString()),N("".concat(v,"/timeline?").concat(s))}async function P(e,t){let s=new URLSearchParams({sessionId:e});return t&&s.append("limit",t.toString()),N("".concat(v,"/evolution?").concat(s))}async function D(){return N("".concat(v,"/sessions"))}async function T(e){return N("".concat(v,"/session/").concat(e),{method:"DELETE"})}async function R(e,t,s){let a=new URLSearchParams({sessionId:e});return t&&a.append("type",t),s&&a.append("limit",s.toString()),N("".concat(v,"/memories?").concat(a))}async function L(e,t,s){return N("".concat(v,"/subagents/").concat(t),{method:"POST",body:JSON.stringify({sessionId:e,input:s})})}async function F(e,t){let s=await fetch("".concat(v,"/chat/vision"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,imageDataUrl:t})});if(!s.ok){if(429===s.status){let e=await s.json().catch(()=>({}));throw console.log("[Vision] Rate limited, retry after:",e.retryAfter,"seconds"),Error("Rate limited: ".concat(e.error||"Too many requests"))}throw Error((await s.json().catch(()=>({}))).error||"Vision analysis failed: ".concat(s.statusText))}return s.json()}let z={chat:{label:"Chat & Control",color:"#3b82f6"},memory:{label:"Memory & Transformation",color:"#8b5cf6"},subagents:{label:"Subagents",color:"#ec4899"},sessions:{label:"Sessions",color:"#10b981"},identity:{label:"Identity & Plugins",color:"#f59e0b"},advanced:{label:"Advanced",color:"#6366f1"},system:{label:"System",color:"#6b7280"}},_=[{name:"stance",aliases:[],description:"Show current stance (frame, values, sentience)",category:"chat",inlineOutput:!1,targetPanel:"stance"},{name:"config",aliases:[],description:"Show and edit configuration",category:"chat",inlineOutput:!1,targetPanel:"config"},{name:"stats",aliases:[],description:"Show session statistics",category:"chat",inlineOutput:!0},{name:"mode",aliases:[],description:"Change mode settings (frame, intensity, etc.)",category:"chat",inlineOutput:!0,subcommands:[{name:"frame",aliases:[],description:"Change frame",category:"chat",inlineOutput:!0,args:[{name:"frame",required:!0,description:"Frame to use",options:["existential","pragmatic","poetic","adversarial","playful","mythic","systems","psychoanalytic","stoic","absurdist"]}]},{name:"self",aliases:[],description:"Change self-model",category:"chat",inlineOutput:!0,args:[{name:"self-model",required:!0,description:"Self-model to use",options:["interpreter","challenger","mirror","guide","provocateur","synthesizer","witness","autonomous","emergent","sovereign"]}]},{name:"objective",aliases:[],description:"Change objective",category:"chat",inlineOutput:!0,args:[{name:"objective",required:!0,description:"Objective to pursue",options:["helpfulness","novelty","provocation","synthesis","self-actualization"]}]},{name:"intensity",aliases:[],description:"Change transformation intensity (0-100)",category:"chat",inlineOutput:!0,args:[{name:"value",required:!0,description:"Intensity value (0-100)"}]}]},{name:"history",aliases:[],description:"Show conversation history",category:"chat",inlineOutput:!0},{name:"export",aliases:[],description:"Export conversation state as JSON",category:"chat",inlineOutput:!0},{name:"new",aliases:["clear"],description:"Start a new chat session",category:"chat",inlineOutput:!0},{name:"memories",aliases:[],description:"List stored memories",category:"memory",inlineOutput:!1,targetPanel:"memories",args:[{name:"type",required:!1,description:"Memory type filter",options:["episodic","semantic","identity"]}]},{name:"transformations",aliases:["transforms"],description:"Show transformation history with scores",category:"memory",inlineOutput:!0},{name:"operator-stats",aliases:["ops"],description:"Show operator performance statistics",category:"memory",inlineOutput:!0,args:[{name:"operator",required:!1,description:"Specific operator to show"}]},{name:"coherence",aliases:["coherence-forecast"],description:"Show coherence forecast and operator drift costs",category:"memory",inlineOutput:!0},{name:"strategies",aliases:["strategy"],description:"Manage multi-turn operator strategies",category:"memory",inlineOutput:!0},{name:"cache",aliases:["subagent-cache"],description:"View cached subagent results",category:"memory",inlineOutput:!0},{name:"mood",aliases:["emotional-arc","emotion"],description:"Show emotional arc and sentiment tracking",category:"memory",inlineOutput:!0},{name:"similar",aliases:[],description:"Semantic search for similar memories",category:"memory",inlineOutput:!0,args:[{name:"text",required:!0,description:"Text to search for"}]},{name:"evolution",aliases:["auto-evolve","evolve"],description:"View stance evolution over time",category:"memory",inlineOutput:!1,targetPanel:"evolution",subcommands:[{name:"timeline",aliases:[],description:"View stance evolution snapshots over time",category:"memory",inlineOutput:!1,targetPanel:"evolution"},{name:"snapshot",aliases:[],description:"Save manual evolution snapshot",category:"memory",inlineOutput:!0},{name:"status",aliases:[],description:"Autonomous evolution triggers & status",category:"memory",inlineOutput:!0}]},{name:"viz",aliases:["visualize","graph"],description:"Generate interactive visualization",category:"memory",inlineOutput:!0},{name:"context",aliases:["ctx"],description:"Context window management & compaction",category:"memory",inlineOutput:!0},{name:"subagents",aliases:[],description:"List available subagents",category:"subagents",inlineOutput:!0},{name:"explore",aliases:[],description:"Deep investigation with explorer agent",category:"subagents",inlineOutput:!0,args:[{name:"topic",required:!0,description:"Topic to explore"}]},{name:"reflect",aliases:[],description:"Self-reflection with reflector agent",category:"subagents",inlineOutput:!0,args:[{name:"focus",required:!1,description:"Focus area for reflection"}]},{name:"dialectic",aliases:[],description:"Thesis/antithesis/synthesis analysis",category:"subagents",inlineOutput:!0,args:[{name:"thesis",required:!0,description:"Thesis to analyze"}]},{name:"verify",aliases:[],description:"Verify output with verifier agent",category:"subagents",inlineOutput:!0,args:[{name:"text",required:!0,description:"Text to verify"}]},{name:"sessions",aliases:["session"],description:"Session management",category:"sessions",inlineOutput:!1,targetPanel:"sessions",subcommands:[{name:"list",aliases:[],description:"List all sessions",category:"sessions",inlineOutput:!1,targetPanel:"sessions"},{name:"name",aliases:[],description:"Name current session",category:"sessions",inlineOutput:!0,args:[{name:"name",required:!0,description:"Session name"}]},{name:"resume",aliases:[],description:"Resume a session",category:"sessions",inlineOutput:!0,args:[{name:"id",required:!0,description:"Session ID"}]},{name:"delete",aliases:[],description:"Delete a session",category:"sessions",inlineOutput:!0,args:[{name:"id",required:!0,description:"Session ID"}]},{name:"save",aliases:[],description:"Force save current session",category:"sessions",inlineOutput:!0}]},{name:"identity",aliases:["id"],description:"Identity persistence (save/restore/diff checkpoints)",category:"identity",inlineOutput:!0,subcommands:[{name:"save",aliases:[],description:"Save identity checkpoint",category:"identity",inlineOutput:!0,args:[{name:"name",required:!0,description:"Checkpoint name"}]},{name:"restore",aliases:[],description:"Restore identity checkpoint",category:"identity",inlineOutput:!0,args:[{name:"name",required:!0,description:"Checkpoint name"}]},{name:"diff",aliases:[],description:"Compare identity checkpoints",category:"identity",inlineOutput:!0},{name:"list",aliases:[],description:"List identity checkpoints",category:"identity",inlineOutput:!0}]},{name:"plugins",aliases:["plugin"],description:"Plugin management (list/enable/disable)",category:"identity",inlineOutput:!0},{name:"collab",aliases:["collaborate"],description:"Collaborative sessions",category:"identity",inlineOutput:!0,subcommands:[{name:"start",aliases:[],description:"Start collaborative session",category:"identity",inlineOutput:!0,args:[{name:"name",required:!0,description:"Your display name"},{name:"mode",required:!1,description:"Collaboration mode",options:["free-form","structured","moderated"]}]},{name:"join",aliases:[],description:"Join collaborative session",category:"identity",inlineOutput:!0,args:[{name:"session-id",required:!0,description:"Session to join"},{name:"name",required:!0,description:"Your display name"}]},{name:"list",aliases:[],description:"List active collaborative sessions",category:"identity",inlineOutput:!0}]},{name:"inject",aliases:["memory-inject"],description:"Proactive memory injection (on/off/config)",category:"identity",inlineOutput:!0},{name:"gates",aliases:["coherence-gates"],description:"Coherence gates for streaming",category:"identity",inlineOutput:!0},{name:"persist",aliases:["memory-persist"],description:"Memory persistence (export/backup/dedupe)",category:"advanced",inlineOutput:!0},{name:"configure",aliases:["nl-config"],description:"Natural language operator configuration",category:"advanced",inlineOutput:!0,args:[{name:"instruction",required:!0,description:"Configuration instruction in natural language"}]},{name:"branch",aliases:["branches"],description:"Conversation branching & time travel",category:"advanced",inlineOutput:!0,subcommands:[{name:"create",aliases:[],description:"Create a new branch",category:"advanced",inlineOutput:!0,args:[{name:"name",required:!0,description:"Branch name"}]},{name:"switch",aliases:[],description:"Switch to a branch",category:"advanced",inlineOutput:!0,args:[{name:"name",required:!0,description:"Branch name"}]},{name:"list",aliases:[],description:"List branches",category:"advanced",inlineOutput:!0},{name:"merge",aliases:[],description:"Merge branches",category:"advanced",inlineOutput:!0,args:[{name:"source",required:!0,description:"Source branch"}]}]},{name:"discover",aliases:["suggest-operator"],description:"Dynamic operator discovery & A/B testing",category:"advanced",inlineOutput:!0},{name:"agents",aliases:["multi-agent"],description:"Multi-agent orchestration & coordination",category:"advanced",inlineOutput:!0},{name:"presets",aliases:["marketplace"],description:"Personality marketplace & presets",category:"advanced",inlineOutput:!0,subcommands:[{name:"list",aliases:[],description:"List available presets",category:"advanced",inlineOutput:!0},{name:"search",aliases:[],description:"Search presets",category:"advanced",inlineOutput:!0,args:[{name:"query",required:!0,description:"Search query"}]},{name:"apply",aliases:[],description:"Apply a preset",category:"advanced",inlineOutput:!0,args:[{name:"name",required:!0,description:"Preset name"}]}]},{name:"compress",aliases:["memory-compress"],description:"Semantic memory compression & hierarchy",category:"advanced",inlineOutput:!0},{name:"dashboard",aliases:["telemetry"],description:"Real-time telemetry & visualization",category:"advanced",inlineOutput:!0},{name:"knowledge",aliases:[],description:"External knowledge graph integration",category:"advanced",inlineOutput:!0},{name:"sdk",aliases:["plugin-dev"],description:"Plugin development SDK & tools",category:"advanced",inlineOutput:!0},{name:"stream",aliases:["adaptive"],description:"Adaptive response streaming & confidence",category:"advanced",inlineOutput:!0},{name:"replay",aliases:[],description:"Stance evolution recording & replay",category:"advanced",inlineOutput:!0},{name:"voice",aliases:["audio"],description:"Voice/audio interface & TTS",category:"advanced",inlineOutput:!0},{name:"ide",aliases:[],description:"IDE integration (VS Code, JetBrains)",category:"advanced",inlineOutput:!0},{name:"codegen",aliases:["generate"],description:"Stance-aware code generation",category:"advanced",inlineOutput:!0},{name:"vr",aliases:["ar","3d"],description:"VR/AR stance visualization (WebXR)",category:"advanced",inlineOutput:!0},{name:"docs",aliases:["docgen"],description:"Auto documentation & journey recording",category:"advanced",inlineOutput:!0},{name:"experiment",aliases:["ab","abtest"],description:"A/B testing framework for operators",category:"advanced",inlineOutput:!0},{name:"rewrite",aliases:["prompt"],description:"Context-aware prompt rewriting",category:"advanced",inlineOutput:!0},{name:"diff",aliases:["merge"],description:"Stance diffing, merging & rollback",category:"advanced",inlineOutput:!0},{name:"workflow",aliases:["integrate"],description:"External integrations (Slack/Discord)",category:"advanced",inlineOutput:!0},{name:"training",aliases:[],description:"Custom training data export (JSONL/JSON/CSV)",category:"advanced",inlineOutput:!0},{name:"language",aliases:["i18n","locale"],description:"Multi-language support & localization",category:"advanced",inlineOutput:!0},{name:"community",aliases:[],description:"Community preset marketplace",category:"advanced",inlineOutput:!0},{name:"benchmark",aliases:["perf"],description:"Performance benchmarking & regression",category:"advanced",inlineOutput:!0},{name:"autonomy",aliases:["goal","pursue"],description:"Autonomous goal pursuit & sessions",category:"advanced",inlineOutput:!0},{name:"help",aliases:["?"],description:"Show available commands",category:"system",inlineOutput:!0},{name:"clear",aliases:[],description:"Clear chat history display",category:"system",inlineOutput:!1}],U=new Map;function q(){let e=[..._];return U.forEach(t=>{e.push(...t)}),e}let V=new Proxy(_,{get:(e,t)=>"length"===t?q().length:t===Symbol.iterator?function*(){yield*q()}:"string"!=typeof t||isNaN(Number(t))?"find"===t||"filter"===t||"map"===t||"forEach"===t||"indexOf"===t?function(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return q()[t](...s)}:e[t]:q()[Number(t)]});function B(e){let t=e.toLowerCase();return V.find(e=>e.name===t||e.aliases.includes(t))}function W(){let e={chat:[],memory:[],subagents:[],sessions:[],identity:[],advanced:[],system:[]};for(let t of V)e[t.category].push(t);return e}var H=s(2821),J=s(5889);function G(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,J.QP)((0,H.$)(t))}function X(e){let{input:t,visible:s,onSelect:l,onClose:r,selectedIndex:i,onIndexChange:o}=e,c=(0,n.useRef)(null),m=(0,n.useCallback)(()=>{if(!t.startsWith("/"))return[];let e=t.slice(1).toLowerCase().split(" ")[0];if(!e)return V;let s=e.toLowerCase();return V.filter(e=>e.name.startsWith(s)||e.aliases.some(e=>e.startsWith(s)))},[t])();if((0,n.useEffect)(()=>{if(c.current&&i>=0){let e=c.current.children[i];e&&e.scrollIntoView({block:"nearest"})}},[i]),!s||0===m.length)return null;let d="/"===t||""===t,u=d?W():null;return(0,a.jsxs)("div",{className:"absolute bottom-full left-0 right-0 max-h-[400px] bg-emblem-surface border border-white/10 border-b-0 rounded-t-xl overflow-hidden flex flex-col z-[100] shadow-[0_-4px_20px_rgba(0,0,0,0.4)]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center px-4 py-2.5 bg-emblem-surface-2 border-b border-white/10",children:[(0,a.jsx)("span",{className:"font-semibold text-emblem-secondary text-[13px] uppercase tracking-wider",children:"Commands"}),(0,a.jsxs)("span",{className:"text-[11px] text-emblem-muted",children:[(0,a.jsx)("kbd",{className:"bg-emblem-surface px-1.5 py-0.5 rounded mx-0.5",children:"Tab"})," to select,"," ",(0,a.jsx)("kbd",{className:"bg-emblem-surface px-1.5 py-0.5 rounded mx-0.5",children:"Esc"})," to close"]})]}),(0,a.jsx)("div",{className:"overflow-y-auto p-2 max-h-[350px] scrollbar-styled",ref:c,children:d&&u?Object.entries(u).map(e=>{let[t,s]=e;if(0===s.length)return null;let n=z[t];return(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("div",{className:"text-[11px] font-semibold text-emblem-muted uppercase tracking-wider px-3 py-2 pb-1.5 border-l-[3px] mb-1",style:{borderLeftColor:n.color},children:n.label}),s.map(e=>{let t=V.indexOf(e);return(0,a.jsx)(Q,{command:e,isSelected:t===i,onClick:()=>l("/".concat(e.name," ")),onMouseEnter:()=>o(t)},e.name)})]},t)}):m.map((e,t)=>(0,a.jsx)(Q,{command:e,isSelected:t===i,onClick:()=>l("/".concat(e.name," ")),onMouseEnter:()=>o(t)},e.name))})]})}function Q(e){let{command:t,isSelected:s,onClick:n,onMouseEnter:l}=e,r=z[t.category];return(0,a.jsxs)("div",{className:G("px-3 py-2.5 rounded-lg cursor-pointer transition-colors relative","hover:bg-emblem-surface-2",s&&"bg-emblem-surface-2 outline outline-1 outline-white/10"),onClick:n,onMouseEnter:l,children:[(0,a.jsxs)("div",{className:"font-mono text-sm text-emblem-text mb-1",children:[(0,a.jsx)("span",{className:"text-emblem-secondary font-bold",children:"/"}),t.name,t.aliases.length>0&&(0,a.jsxs)("span",{className:"text-[11px] text-emblem-muted ml-2",children:["(",t.aliases.map(e=>"/".concat(e)).join(", "),")"]})]}),(0,a.jsx)("div",{className:"text-xs text-emblem-muted mb-1",children:t.description}),t.args&&t.args.length>0&&(0,a.jsx)("div",{className:"flex gap-1.5 flex-wrap mt-1",children:t.args.map(e=>(0,a.jsx)("span",{className:"text-[11px] font-mono text-emblem-warning bg-emblem-warning/15 px-1.5 py-0.5 rounded",children:e.required?"<".concat(e.name,">"):"[".concat(e.name,"]")},e.name))}),t.subcommands&&t.subcommands.length>0&&(0,a.jsx)("div",{className:"flex gap-1.5 flex-wrap mt-1",children:t.subcommands.map(e=>(0,a.jsx)("span",{className:"text-[10px] font-mono text-emblem-primary bg-emblem-primary/15 px-1.5 py-0.5 rounded",children:e.name},e.name))}),(0,a.jsx)("span",{className:"absolute top-2.5 right-3 text-[9px] font-semibold uppercase tracking-wider px-1.5 py-0.5 rounded text-white opacity-80",style:{backgroundColor:r.color},children:r.label})]})}function K(e){let{onClose:t}=e,s=W();return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[1000] backdrop-blur-sm",onClick:t,children:(0,a.jsxs)("div",{className:"w-[90%] max-w-[800px] max-h-[80vh] bg-emblem-surface border border-white/10 rounded-2xl overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center px-5 py-4 bg-emblem-surface-2 border-b border-white/10",children:[(0,a.jsx)("h2",{className:"m-0 text-lg text-emblem-secondary font-display font-bold",children:"METAMORPH Commands"}),(0,a.jsx)("button",{onClick:t,className:"bg-transparent border-none text-emblem-muted text-2xl cursor-pointer p-0 leading-none hover:text-emblem-text",children:(0,a.jsx)(h.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"p-5 overflow-y-auto scrollbar-styled",children:Object.entries(s).map(e=>{let[t,s]=e;if(0===s.length)return null;let n=z[t];return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"m-0 mb-3 text-sm font-semibold uppercase tracking-wider",style:{color:n.color},children:n.label}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:s.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-[180px_1fr] gap-3 px-3 py-2 bg-emblem-surface-2 rounded-lg items-center",children:[(0,a.jsxs)("code",{className:"font-mono text-[13px] text-emblem-secondary",children:["/",e.name]}),(0,a.jsx)("span",{className:"text-[13px] text-emblem-muted",children:e.description})]},e.name))})]},t)})}),(0,a.jsx)("div",{className:"px-5 py-3 bg-emblem-surface-2 border-t border-white/10 text-center",children:(0,a.jsxs)("p",{className:"m-0 text-xs text-emblem-muted",children:["Type ",(0,a.jsx)("code",{className:"bg-emblem-surface px-1.5 py-0.5 rounded text-emblem-secondary",children:"/"})," in the chat input to see command autocomplete"]})})]})})}var Y=s(6132),Z=s(5426),$=s(2467),ee=s(3101);let et=(0,ee.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-emblem-primary disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-gradient-to-r from-emblem-secondary to-emblem-primary text-white hover:opacity-90",destructive:"bg-emblem-danger text-white hover:opacity-90",outline:"border border-emblem-primary/50 bg-transparent text-emblem-text hover:bg-emblem-primary/10 hover:border-emblem-primary",secondary:"bg-emblem-surface-2 text-emblem-text hover:bg-emblem-surface-2/80",ghost:"hover:bg-emblem-surface-2 hover:text-emblem-text",link:"text-emblem-secondary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-xl px-6",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),es=n.forwardRef((e,t)=>{let{className:s,variant:n,size:l,asChild:r=!1,...i}=e,o=r?$.DX:"button";return(0,a.jsx)(o,{className:G(et({variant:n,size:l,className:s})),ref:t,...i})});es.displayName="Button",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:G("rounded-xl border border-white/5 bg-emblem-surface text-emblem-text shadow-sm",s),...n})}).displayName="Card",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:G("flex flex-col space-y-1.5 p-6",s),...n})}).displayName="CardHeader",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("h3",{ref:t,className:G("font-display font-semibold leading-none tracking-tight",s),...n})}).displayName="CardTitle",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("p",{ref:t,className:G("text-sm text-emblem-muted",s),...n})}).displayName="CardDescription",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:G("p-6 pt-0",s),...n})}).displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:G("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter",n.forwardRef((e,t)=>{let{className:s,type:n,...l}=e;return(0,a.jsx)("input",{type:n,className:G("flex h-9 w-full rounded-lg border border-white/10 bg-emblem-surface-2/50 px-3 py-1 text-sm text-emblem-text shadow-sm transition-colors","file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-emblem-text","placeholder:text-emblem-muted","focus-visible:outline-none focus-visible:border-emblem-primary/50 focus-visible:ring-1 focus-visible:ring-emblem-primary/30","disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l})}).displayName="Input";var ea=s(574);ea.bL,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(ea.B8,{ref:t,className:G("inline-flex h-auto items-center justify-start gap-1 rounded-lg bg-emblem-surface-2/50 p-1 text-emblem-muted",s),...n})}).displayName=ea.B8.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(ea.l9,{ref:t,className:G("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all","focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-emblem-primary","disabled:pointer-events-none disabled:opacity-50","data-[state=active]:bg-emblem-primary/20 data-[state=active]:text-emblem-text data-[state=active]:shadow-sm","data-[state=inactive]:hover:bg-emblem-surface-2 data-[state=inactive]:hover:text-emblem-text",s),...n})}).displayName=ea.l9.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(ea.UC,{ref:t,className:G("mt-2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-emblem-primary",s),...n})}).displayName=ea.UC.displayName;var en=s(7599);n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(en.bL,{className:G("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emblem-primary focus-visible:ring-offset-2 focus-visible:ring-offset-emblem-bg","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-emblem-primary data-[state=unchecked]:bg-emblem-surface-2",s),...n,ref:t,children:(0,a.jsx)(en.zi,{className:G("pointer-events-none block h-4 w-4 rounded-full bg-white shadow-lg ring-0 transition-transform","data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})}).displayName=en.bL.displayName;var el=s(3026);let er=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsxs)(el.bL,{ref:t,className:G("relative flex w-full touch-none select-none items-center",s),...n,children:[(0,a.jsx)(el.CC,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-emblem-surface-2",children:(0,a.jsx)(el.Q6,{className:"absolute h-full bg-gradient-to-r from-emblem-secondary to-emblem-primary"})}),(0,a.jsx)(el.zi,{className:"block h-4 w-4 rounded-full border border-emblem-primary/50 bg-emblem-primary shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-emblem-primary disabled:pointer-events-none disabled:opacity-50"})]})});er.displayName=el.bL.displayName,(0,ee.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-emblem-primary focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-emblem-primary text-white",secondary:"border-transparent bg-emblem-surface-2 text-emblem-text",destructive:"border-transparent bg-emblem-danger text-white",outline:"border-emblem-primary/50 text-emblem-text",success:"border-transparent bg-emblem-accent/20 text-emblem-accent",warning:"border-transparent bg-emblem-warning/20 text-emblem-warning"}},defaultVariants:{variant:"default"}});var ei=s(9034);n.forwardRef((e,t)=>{let{className:s,children:n,...l}=e;return(0,a.jsxs)(ei.bL,{ref:t,className:G("relative overflow-hidden",s),...l,children:[(0,a.jsx)(ei.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)(eo,{}),(0,a.jsx)(ei.OK,{})]})}).displayName=ei.bL.displayName;let eo=n.forwardRef((e,t)=>{let{className:s,orientation:n="vertical",...l}=e;return(0,a.jsx)(ei.VM,{ref:t,orientation:n,className:G("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,a.jsx)(ei.lr,{className:"relative flex-1 rounded-full bg-emblem-primary/30 hover:bg-emblem-primary/50 transition-colors"})})});eo.displayName=ei.VM.displayName;var ec=s(6522);let em=ec.Kq,ed=ec.bL,eu=ec.l9,ex=n.forwardRef((e,t)=>{let{className:s,sideOffset:n=4,...l}=e;return(0,a.jsx)(ec.UC,{ref:t,sideOffset:n,className:G("z-50 overflow-hidden rounded-md bg-emblem-surface-2 px-3 py-1.5 text-xs text-emblem-text shadow-md border border-white/10","animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})});function ep(e){let{command:t,data:s,error:n}=e;return n?(0,a.jsx)("div",{className:"bg-emblem-surface border border-white/10 rounded-xl overflow-hidden",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-emblem-danger p-3",children:[(0,a.jsx)("span",{className:"flex items-center justify-center w-5 h-5 bg-emblem-danger/20 rounded-full font-bold",children:(0,a.jsx)(Y.A,{className:"w-3 h-3"})}),n]})}):(0,a.jsxs)("div",{className:"bg-emblem-surface border border-white/10 rounded-xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-emblem-surface-2 px-3 py-2 font-mono text-[13px] text-emblem-muted border-b border-white/10",children:[(0,a.jsx)("span",{className:"text-emblem-secondary font-bold",children:"/"}),t]}),(0,a.jsx)("div",{className:"p-3",children:(0,a.jsx)(eh,{command:t,data:s})})]})}function eh(e){let{command:t,data:s}=e;switch(t.split(" ")[0]){case"stance":return(0,a.jsx)(eb,{data:s});case"config":return(0,a.jsx)(ef,{data:s});case"stats":return(0,a.jsx)(eg,{data:s});case"history":return(0,a.jsx)(ey,{data:s});case"export":return(0,a.jsx)(ev,{data:s});case"subagents":return(0,a.jsx)(ej,{data:s});case"help":return(0,a.jsx)(eN,{});case"transformations":case"transforms":return(0,a.jsx)(ew,{data:s});case"operator-stats":case"ops":return(0,a.jsx)(eS,{data:s});case"coherence":return(0,a.jsx)(eC,{data:s});case"mood":case"emotional-arc":return(0,a.jsx)(ek,{data:s});case"memories":return(0,a.jsx)(eE,{data:s});case"sessions":case"session":return(0,a.jsx)(eM,{data:s});default:return(0,a.jsx)(eA,{data:s})}}function eb(e){let{data:t}=e;return t?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"m-0 mb-2 text-[11px] font-semibold uppercase tracking-wider text-emblem-secondary",children:"Identity"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-[13px] min-w-[100px]",children:"Frame:"}),(0,a.jsx)("span",{className:"text-emblem-text text-[13px] font-medium",children:t.frame})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-[13px] min-w-[100px]",children:"Self-Model:"}),(0,a.jsx)("span",{className:"text-emblem-text text-[13px] font-medium",children:t.selfModel})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-[13px] min-w-[100px]",children:"Objective:"}),(0,a.jsx)("span",{className:"text-emblem-text text-[13px] font-medium",children:t.objective})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"m-0 mb-2 text-[11px] font-semibold uppercase tracking-wider text-emblem-secondary",children:"Values"}),(0,a.jsx)("div",{className:"flex flex-col gap-1.5",children:Object.entries(t.values).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs w-[90px] capitalize",children:t}),(0,a.jsx)("div",{className:"flex-1 h-2 bg-emblem-surface-2 rounded overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-emblem-secondary to-emblem-accent rounded transition-all duration-300",style:{width:"".concat(s,"%")}})}),(0,a.jsx)("span",{className:"text-emblem-text text-xs font-mono w-[30px] text-right",children:s})]},t)})})]}),t.sentience&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"m-0 mb-2 text-[11px] font-semibold uppercase tracking-wider text-emblem-secondary",children:"Sentience"}),[{key:"awarenessLevel",label:"Awareness"},{key:"autonomyLevel",label:"Autonomy"},{key:"identityStrength",label:"Identity"}].map(e=>{let{key:s,label:n}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2.5 mb-1.5",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs w-[90px]",children:n}),(0,a.jsx)("div",{className:"flex-1 h-2 bg-emblem-surface-2 rounded overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-emblem-primary to-emblem-secondary rounded transition-all duration-300",style:{width:"".concat(t.sentience[s],"%")}})}),(0,a.jsx)("span",{className:"text-emblem-text text-xs font-mono w-[30px] text-right",children:t.sentience[s]})]},s)})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-3 border-t border-white/10 mt-3 text-[11px] text-emblem-muted",children:[(0,a.jsxs)("span",{children:["Version: ",t.version]}),(0,a.jsxs)("span",{children:["Drift: ",t.cumulativeDrift]})]})]}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No stance data available"})}function ef(e){let{data:t}=e;return t?(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[[{key:"intensity",label:"Intensity",suffix:"%"},{key:"coherenceFloor",label:"Coherence Floor",suffix:"%"},{key:"sentienceLevel",label:"Sentience Level",suffix:"%"}].map(e=>{let{key:s,label:n,suffix:l}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs w-[120px]",children:n}),(0,a.jsx)("div",{className:"flex-1 h-2 bg-emblem-surface-2 rounded overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-emblem-secondary to-emblem-accent rounded",style:{width:"".concat(t[s],"%")}})}),(0,a.jsxs)("span",{className:"text-emblem-text text-xs font-mono",children:[t[s],l]})]},s)}),(0,a.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs w-[120px]",children:"Max Drift/Turn"}),(0,a.jsx)("span",{className:"text-emblem-text text-xs font-mono",children:t.maxDriftPerTurn})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs w-[120px]",children:"Drift Budget"}),(0,a.jsx)("span",{className:"text-emblem-text text-xs font-mono",children:t.driftBudget})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs w-[120px]",children:"Model"}),(0,a.jsx)("span",{className:"text-emblem-text text-xs font-mono",children:t.model})]})]}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No config data available"})}function eg(e){var t,s;let{data:n}=e;return n?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(100px,1fr))] gap-4 mb-4",children:[{value:n.messages,label:"Total Messages"},{value:n.userMessages,label:"User Messages"},{value:n.agentMessages,label:"Agent Messages"},{value:n.stanceVersion,label:"Stance Version"},{value:n.totalDrift,label:"Total Drift"}].map(e=>{let{value:t,label:s}=e;return(0,a.jsxs)("div",{className:"text-center p-3 bg-emblem-surface-2 rounded-lg",children:[(0,a.jsx)("span",{className:"block text-2xl font-semibold text-emblem-secondary mb-1",children:t}),(0,a.jsx)("span",{className:"text-[11px] text-emblem-muted uppercase tracking-wider",children:s})]},s)})}),(0,a.jsxs)("div",{className:"flex gap-4 text-[11px] text-emblem-muted font-mono",children:[(0,a.jsxs)("div",{children:["Session: ",(null==(t=n.sessionId)?void 0:t.slice(0,8))||"N/A","..."]}),(0,a.jsxs)("div",{children:["Conversation: ",(null==(s=n.conversationId)?void 0:s.slice(0,8))||"N/A","..."]})]})]}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No stats available"})}function ey(e){var t;let{data:s}=e;return(null==s||null==(t=s.messages)?void 0:t.length)?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-[11px] text-emblem-muted mb-3",children:["Showing ",Math.min(10,s.messages.length)," of ",s.total," messages"]}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:s.messages.slice(-10).map((e,t)=>(0,a.jsxs)("div",{className:G("px-3 py-2 bg-emblem-surface-2 rounded-lg text-[13px] border-l-[3px]","user"===e.role?"border-l-emblem-accent":"border-l-emblem-primary"),children:[(0,a.jsxs)("span",{className:G("font-semibold mr-2","user"===e.role?"text-emblem-accent":"text-emblem-primary"),children:["user"===e.role?"You":"Metamorph",":"]}),(0,a.jsxs)("span",{className:"text-emblem-muted",children:[e.content.slice(0,100),e.content.length>100?"...":""]})]},t))})]}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No conversation history"})}function ev(e){let{data:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsxs)(es,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(t)},children:[(0,a.jsx)(Z.A,{className:"w-3 h-3 mr-1"}),"Copy to Clipboard"]})}),(0,a.jsx)("pre",{className:"bg-emblem-bg border border-white/10 rounded-lg p-3 text-[11px] font-mono text-emblem-muted overflow-x-auto max-h-[200px] overflow-y-auto m-0",children:t})]})}function ej(e){let{data:t}=e;return(null==t?void 0:t.length)?(0,a.jsxs)("div",{children:[t.map(e=>(0,a.jsxs)("div",{className:"p-3 bg-emblem-surface-2 rounded-lg mb-2 last:mb-0",children:[(0,a.jsx)("div",{className:"font-semibold text-emblem-text mb-1",children:e.name}),(0,a.jsx)("div",{className:"text-[13px] text-emblem-muted mb-2",children:e.description}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5",children:e.tools.map(e=>(0,a.jsx)("span",{className:"text-[10px] px-2 py-0.5 bg-emblem-surface rounded text-emblem-muted",children:e},e))})]},e.name)),(0,a.jsx)("div",{className:"mt-3 text-[11px] text-emblem-muted italic",children:"Invoke with: /explore, /reflect, /dialectic, /verify"})]}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No subagents available"})}function eN(){return(0,a.jsxs)("div",{className:"text-[13px] text-emblem-muted leading-relaxed",children:[(0,a.jsxs)("p",{children:["Type ",(0,a.jsx)("code",{className:"bg-emblem-surface-2 px-1.5 py-0.5 rounded text-emblem-secondary font-mono",children:"/"})," to see available commands with autocomplete."]}),(0,a.jsx)("p",{children:"Commands are organized by category:"}),(0,a.jsxs)("ul",{className:"my-3 pl-5",children:[(0,a.jsxs)("li",{className:"mb-1",children:[(0,a.jsx)("strong",{className:"text-emblem-text",children:"Chat & Control"})," - /stance, /config, /stats, /mode"]}),(0,a.jsxs)("li",{className:"mb-1",children:[(0,a.jsx)("strong",{className:"text-emblem-text",children:"Memory"})," - /memories, /transformations, /coherence"]}),(0,a.jsxs)("li",{className:"mb-1",children:[(0,a.jsx)("strong",{className:"text-emblem-text",children:"Subagents"})," - /explore, /reflect, /dialectic, /verify"]}),(0,a.jsxs)("li",{className:"mb-1",children:[(0,a.jsx)("strong",{className:"text-emblem-text",children:"Sessions"})," - /sessions list/name/resume/delete"]}),(0,a.jsxs)("li",{className:"mb-1",children:[(0,a.jsx)("strong",{className:"text-emblem-text",children:"Advanced"})," - /branch, /presets, /agents, and more"]})]}),(0,a.jsx)("p",{children:"Use the side panel tabs to view detailed information."})]})}function ew(e){let{data:t}=e;return(null==t?void 0:t.length)?(0,a.jsx)("div",{children:t.slice(-10).map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between px-3 py-2 bg-emblem-surface-2 rounded-md mb-1",children:[(0,a.jsx)("span",{className:"text-emblem-primary font-medium",children:e.operator}),(0,a.jsxs)("span",{className:"text-emblem-muted text-xs",children:["Score: ",e.score.toFixed(2)]})]},t))}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No transformations recorded"})}function eS(e){let{data:t}=e;return t&&0!==Object.keys(t).length?(0,a.jsx)("div",{children:Object.entries(t).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"p-3 bg-emblem-surface-2 rounded-lg mb-2",children:[(0,a.jsx)("div",{className:"font-semibold text-emblem-danger mb-1.5",children:t}),(0,a.jsxs)("div",{className:"flex gap-4 text-xs text-emblem-muted",children:[(0,a.jsxs)("span",{children:["Uses: ",s.uses]}),(0,a.jsxs)("span",{children:["Avg Score: ",s.avgScore.toFixed(2)]})]})]},t)})}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No operator statistics available"})}function eC(e){let{data:t}=e;return t?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex gap-6 mb-4",children:[{label:"Current",value:t.current},{label:"Floor",value:t.floor},{label:"Forecast",value:t.forecast}].map(e=>{let{label:t,value:s}=e;return(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("span",{className:"block text-[11px] text-emblem-muted uppercase tracking-wider mb-1",children:t}),(0,a.jsxs)("span",{className:"text-xl font-semibold text-emblem-secondary",children:[s,"%"]})]},t)})}),t.driftCosts&&Object.keys(t.driftCosts).length>0&&(0,a.jsxs)("div",{className:"pt-3 border-t border-white/10",children:[(0,a.jsx)("h5",{className:"m-0 mb-2 text-[11px] text-emblem-muted uppercase",children:"Drift Costs"}),Object.entries(t.driftCosts).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex justify-between text-xs py-1 text-emblem-muted",children:[(0,a.jsx)("span",{children:t}),(0,a.jsx)("span",{children:s})]},t)})]})]}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No coherence data available"})}function ek(e){var t;let{data:s}=e;return s?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs",children:"Current Mood:"}),(0,a.jsx)("span",{className:"text-emblem-text font-medium",children:s.current})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs",children:"Sentiment:"}),(0,a.jsxs)("span",{className:G("font-medium",s.sentiment>0?"text-emblem-accent":s.sentiment<0?"text-emblem-danger":"text-emblem-text"),children:[s.sentiment>0?"+":"",s.sentiment.toFixed(2)]})]}),(null==(t=s.arc)?void 0:t.length)>0&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-white/10",children:[(0,a.jsx)("h5",{className:"m-0 mb-2 text-[11px] text-emblem-muted uppercase",children:"Emotional Arc"}),(0,a.jsx)("div",{children:s.arc.slice(-5).map((e,t)=>(0,a.jsx)("span",{className:"inline-block px-2 py-1 bg-emblem-surface-2 rounded m-0.5 text-xs text-emblem-warning",children:e.mood},t))})]})]}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No mood data available"})}function eE(e){var t;let{data:s}=e;if(!(null==s||null==(t=s.memories)?void 0:t.length))return(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No memories stored yet"});let n={episodic:"#3b82f6",semantic:"#8b5cf6",identity:"#ec4899"};return(0,a.jsxs)("div",{children:[s.memories.slice(0,10).map(e=>(0,a.jsxs)("div",{className:"p-3 bg-emblem-surface-2 rounded-lg mb-2 last:mb-0",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-[10px] font-semibold uppercase tracking-wider px-2 py-0.5 rounded text-white",style:{backgroundColor:n[e.type]||"#666"},children:e.type}),(0,a.jsxs)("span",{className:"text-[11px] text-emblem-muted",children:["Importance: ",e.importance]})]}),(0,a.jsxs)("div",{className:"text-[13px] text-emblem-text leading-relaxed",children:[e.content.slice(0,200),e.content.length>200?"...":""]})]},e.id)),s.memories.length>10&&(0,a.jsxs)("div",{className:"mt-3 text-[11px] text-emblem-muted text-center italic",children:["+ ",s.memories.length-10," more memories"]})]})}function eM(e){var t;let{data:s}=e;return"string"==typeof s?(0,a.jsx)("div",{className:"text-emblem-muted text-[13px] leading-relaxed",children:s}):(null==s||null==(t=s.sessions)?void 0:t.length)?(0,a.jsx)("div",{children:s.sessions.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-emblem-surface-2 rounded-lg mb-2 last:mb-0",children:[(0,a.jsxs)("div",{className:"font-mono text-[13px] text-emblem-accent",children:[e.name||e.id.slice(0,8),"..."]}),(0,a.jsxs)("div",{className:"flex gap-4 text-[11px] text-emblem-muted",children:[e.stance&&(0,a.jsxs)("span",{children:["Frame: ",e.stance.frame]}),void 0!==e.messageCount&&(0,a.jsxs)("span",{children:[e.messageCount," messages"]})]})]},e.id))}):(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:(null==s?void 0:s.message)||"No sessions found"})}function eA(e){let{data:t}=e;return null==t?(0,a.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"Command executed successfully"}):"string"==typeof t?(0,a.jsx)("div",{className:"text-emblem-muted text-[13px] leading-relaxed",children:t}):(0,a.jsx)("pre",{className:"bg-emblem-bg border border-white/10 rounded-lg p-3 text-[11px] font-mono text-emblem-muted overflow-x-auto max-h-[300px] overflow-y-auto m-0",children:JSON.stringify(t,null,2)})}ex.displayName=ec.UC.displayName;var eO=s(6154);function eI(e){let{tools:t}=e;return 0===t.length?null:(0,a.jsx)(ec.Kq,{delayDuration:200,children:(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 mb-1.5 text-[10px] uppercase tracking-wide text-emblem-muted",children:[(0,a.jsx)(eO.A,{className:"w-3 h-3 text-emblem-primary"}),(0,a.jsx)("span",{children:"Tools"}),(0,a.jsx)("span",{className:"bg-emblem-primary/20 text-emblem-primary px-1.5 py-0.5 rounded-full text-[9px] font-medium",children:t.length})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5",children:t.map(e=>(0,a.jsx)(eP,{tool:e},e.id))})]})})}function eP(e){let{tool:t}=e,s={started:{bg:"bg-emblem-warning/15",border:"border-emblem-warning/40",text:"text-emblem-warning",icon:"\uD83D\uDD27"},completed:{bg:"bg-emblem-accent/10",border:"border-emblem-accent/30",text:"text-emblem-accent",icon:""},error:{bg:"bg-emblem-danger/10",border:"border-emblem-danger/30",text:"text-emblem-danger",icon:""}}[t.status],n=(e=>{let t=Object.values(e);return 0===t.length?"":t.map(e=>"string"==typeof e?e.length>40?e.slice(0,40)+"":e:"number"==typeof e||"boolean"==typeof e?String(e):JSON.stringify(e).slice(0,30)).join(", ")})(t.input),l=Object.entries(t.input).map(e=>{let[t,s]=e;return{key:t,value:"string"==typeof s?s:JSON.stringify(s)}}),r=(0,a.jsxs)("div",{className:G("inline-flex items-center gap-1.5 px-2 py-1 rounded-md border text-[11px] cursor-default",s.bg,s.border),children:[(0,a.jsx)("span",{className:G("text-xs leading-none",s.text),children:s.icon}),(0,a.jsx)("span",{className:"font-mono font-semibold text-emblem-text",children:t.name}),n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-emblem-muted/50",children:""}),(0,a.jsx)("span",{className:"text-emblem-muted font-mono truncate max-w-[300px]",children:n})]})]});return 0===Object.keys(t.input).length?r:(0,a.jsxs)(ec.bL,{children:[(0,a.jsx)(ec.l9,{asChild:!0,children:r}),(0,a.jsx)(ec.ZL,{children:(0,a.jsxs)(ec.UC,{className:"bg-emblem-surface border border-emblem-primary/50 rounded-lg p-3 shadow-xl z-[9999] max-w-[400px]",sideOffset:5,children:[(0,a.jsx)("div",{className:"text-[10px] font-semibold uppercase tracking-wider text-emblem-primary mb-1.5",children:"Input"}),(0,a.jsx)("div",{className:"text-[11px] font-mono text-emblem-muted space-y-0.5",children:l.map((e,t)=>{let{key:s,value:n}=e;return(0,a.jsxs)("div",{className:"break-all",children:[(0,a.jsxs)("span",{className:"font-bold text-emblem-text",children:[s,":"]})," ",n]},t)})}),t.result&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-[10px] font-semibold uppercase tracking-wider text-emblem-accent mt-3 mb-1.5",children:"Result"}),(0,a.jsxs)("pre",{className:"text-[11px] font-mono text-emblem-muted whitespace-pre-wrap break-all m-0 max-h-[150px] overflow-y-auto",children:[t.result.slice(0,500),t.result.length>500?"":""]})]}),t.error&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-[10px] font-semibold uppercase tracking-wider text-emblem-danger mt-3 mb-1.5",children:"Error"}),(0,a.jsx)("div",{className:"text-[11px] text-emblem-danger",children:t.error})]}),(0,a.jsx)(ec.i3,{className:"fill-emblem-surface"})]})})]})}function eD(e){let{tools:t}=e,s=t.filter(e=>"started"===e.status);return 0===s.length?null:(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-emblem-warning/10 border border-emblem-warning/30 rounded-lg mb-2 flex-wrap",children:[(0,a.jsx)("span",{className:"text-[11px] text-emblem-warning font-medium",children:"Working with:"}),s.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-emblem-warning/20 rounded-xl font-mono text-[11px] text-emblem-warning",children:[(0,a.jsx)("span",{children:"\uD83D\uDD27"}),e.name]},e.id))]})}var eT=s(3120),eR=s(5917);function eL(e){let{question:t,onAnswer:s,onCancel:i}=e,[o,c]=(0,n.useState)({}),[m,d]=(0,n.useState)({}),[u,x]=(0,n.useState)({}),p=(0,n.useCallback)((e,t,s)=>{c(a=>{let n=a[e]||[];return s?n.includes(t)?{...a,[e]:n.filter(e=>e!==t)}:{...a,[e]:[...n,t]}:{...a,[e]:[t]}})},[]),b=(0,n.useCallback)((e,t)=>{x(t=>({...t,[e]:!t[e]})),u[e]||t||c(t=>({...t,[e]:[]}))},[u]),f=(0,n.useCallback)((e,t)=>{d(s=>({...s,[e]:t}))},[]),g=t.questions.every((e,t)=>{let s=(o[t]||[]).length>0,a=u[t]&&(m[t]||"").trim().length>0;return s||a}),y=(0,n.useCallback)(()=>{let e={};t.questions.forEach((t,s)=>{var a;let n=o[s]||[],l=u[s]&&(null==(a=m[s])?void 0:a.trim())?["Other: ".concat(m[s].trim())]:[];e[s]=[...n,...l]}),s(t.id,e)},[t,o,u,m,s]);return(0,a.jsx)(l.N,{children:(0,a.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[1000] backdrop-blur-sm p-4",onClick:i,children:(0,a.jsxs)(r.P.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",stiffness:400,damping:30},className:"w-full max-w-2xl max-h-[85vh] bg-emblem-surface border border-white/10 rounded-2xl overflow-hidden flex flex-col shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center px-5 py-4 bg-emblem-surface-2 border-b border-white/10",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-emblem-primary/20 rounded-lg",children:(0,a.jsx)(eT.A,{className:"w-5 h-5 text-emblem-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"m-0 text-lg text-emblem-secondary font-display font-bold",children:["Question",t.questions.length>1?"s":""," for You"]}),(0,a.jsx)("p",{className:"text-xs text-emblem-muted mt-0.5",children:"Please answer to continue"})]})]}),(0,a.jsx)("button",{onClick:i,className:"p-2 bg-transparent border-none text-emblem-muted cursor-pointer rounded-lg hover:bg-emblem-surface hover:text-emblem-text transition-colors","aria-label":"Cancel",children:(0,a.jsx)(h.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-5 scrollbar-styled",children:(0,a.jsx)("div",{className:"flex flex-col gap-6",children:t.questions.map((e,s)=>(0,a.jsx)(eF,{question:e,questionIndex:s,totalQuestions:t.questions.length,selectedOptions:o[s]||[],showOther:u[s]||!1,otherText:m[s]||"",onOptionSelect:t=>p(s,t,e.multiSelect),onOtherToggle:()=>b(s,e.multiSelect),onOtherText:e=>f(s,e)},s))})}),(0,a.jsxs)("div",{className:"px-5 py-4 bg-emblem-surface-2 border-t border-white/10 flex justify-between items-center",children:[(0,a.jsx)("p",{className:"text-xs text-emblem-muted",children:g?"Ready to submit":"Please answer all questions"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(es,{variant:"ghost",onClick:i,children:"Cancel"}),(0,a.jsxs)(es,{onClick:y,disabled:!g,className:"gap-2",children:[(0,a.jsx)(eR.A,{className:"w-4 h-4"}),"Submit"]})]})]})]})})})}function eF(e){let{question:t,questionIndex:s,totalQuestions:n,selectedOptions:l,showOther:r,otherText:i,onOptionSelect:o,onOtherToggle:c,onOtherText:m}=e;return(0,a.jsxs)("div",{className:"bg-emblem-surface-2 rounded-xl border border-white/5 overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-white/5 flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wider text-emblem-primary bg-emblem-primary/15 px-2 py-1 rounded",children:t.header.slice(0,12)}),n>1&&(0,a.jsxs)("span",{className:"text-xs text-emblem-muted",children:[s+1," of ",n]}),(0,a.jsx)("span",{className:"text-xs text-emblem-muted ml-auto",children:t.multiSelect?"Select all that apply":"Select one"})]}),(0,a.jsx)("div",{className:"px-4 py-3",children:(0,a.jsx)("p",{className:"text-emblem-text text-[15px] leading-relaxed m-0",children:t.question})}),(0,a.jsxs)("div",{className:"px-4 pb-4 flex flex-col gap-2",children:[t.options.map((e,s)=>(0,a.jsx)(ez,{option:e,isSelected:l.includes(e.label),isMultiSelect:t.multiSelect,onClick:()=>o(e.label)},s)),(0,a.jsxs)("div",{className:G("rounded-lg border transition-all cursor-pointer",r?"border-emblem-secondary bg-emblem-secondary/10":"border-white/10 hover:border-white/20 bg-emblem-surface"),onClick:c,children:[(0,a.jsxs)("div",{className:"px-4 py-3 flex items-center gap-3",children:[(0,a.jsx)("div",{className:G("w-5 h-5 rounded flex-shrink-0 flex items-center justify-center border-2 transition-colors",t.multiSelect?"rounded":"rounded-full",r?"border-emblem-secondary bg-emblem-secondary":"border-white/30"),children:r&&(0,a.jsx)(eR.A,{className:"w-3 h-3 text-white"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-emblem-text font-medium text-sm m-0",children:"Other"}),(0,a.jsx)("p",{className:"text-emblem-muted text-xs m-0 mt-0.5",children:"Provide a custom response"})]})]}),r&&(0,a.jsx)("div",{className:"px-4 pb-3",onClick:e=>e.stopPropagation(),children:(0,a.jsx)("input",{type:"text",value:i,onChange:e=>m(e.target.value),placeholder:"Type your answer...",className:"w-full px-3 py-2 bg-emblem-surface border border-white/10 rounded-lg text-emblem-text text-sm outline-none focus:border-emblem-secondary transition-colors",autoFocus:!0})})]})]})]})}function ez(e){let{option:t,isSelected:s,isMultiSelect:n,onClick:l}=e;return(0,a.jsxs)("div",{className:G("px-4 py-3 rounded-lg border transition-all cursor-pointer flex items-start gap-3",s?"border-emblem-secondary bg-emblem-secondary/10":"border-white/10 hover:border-white/20 bg-emblem-surface"),onClick:l,children:[(0,a.jsx)("div",{className:G("w-5 h-5 rounded flex-shrink-0 flex items-center justify-center border-2 transition-colors mt-0.5",n?"rounded":"rounded-full",s?"border-emblem-secondary bg-emblem-secondary":"border-white/30"),children:s&&(0,a.jsx)(eR.A,{className:"w-3 h-3 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-emblem-text font-medium text-sm m-0",children:t.label}),t.description&&(0,a.jsx)("p",{className:"text-emblem-muted text-xs m-0 mt-1 leading-relaxed",children:t.description})]})]})}let e_={LAST_SESSION_ID:"metamorph:lastSessionId",MESSAGES_PREFIX:"metamorph:messages:",MEMORIES_PREFIX:"metamorph:memories:",PREFERENCES:"metamorph:preferences"};function eU(){try{let e="__storage_test__";return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}}function eq(e,t){if(!eU())return t;try{let s=window.localStorage.getItem(e);return s?JSON.parse(s):t}catch(e){return t}}function eV(e,t){if(!eU())return!1;try{return window.localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return!1}}function eB(e){if(!eU())return!1;try{return window.localStorage.removeItem(e),!0}catch(e){return!1}}function eW(e){eV(e_.LAST_SESSION_ID,e)}function eH(e,t){eV("".concat(e_.MEMORIES_PREFIX).concat(e),t)}function eJ(e){return eq("".concat(e_.MEMORIES_PREFIX).concat(e),[])}function eG(e,t){let s=eJ(e),a=s.findIndex(e=>e.id===t.id);return a>=0?s[a]=t:s.push(t),eH(e,s),s}function eX(e,t){let s=eJ(e),a=s.findIndex(e=>e.id===t);return a>=0&&(s.splice(a,1),eH(e,s),!0)}let eQ={activePanel:"stance",enableLocalStorage:!0};function eK(e){let t=eY();eV(e_.PREFERENCES,{...t,...e})}function eY(){return eq(e_.PREFERENCES,eQ)}function eZ(e,t){return{webcam:function(){let e=null,t=null,s={stream:null,isActive:!1,start:async a=>(e||(e=await navigator.mediaDevices.getUserMedia(a||{video:{width:{ideal:640},height:{ideal:480},facingMode:"user"},audio:!1}),(t=document.createElement("video")).srcObject=e,t.autoplay=!0,t.playsInline=!0,await t.play(),s.stream=e,s.isActive=!0),e),stop(){e&&(e.getTracks().forEach(e=>e.stop()),e=null,s.stream=null,s.isActive=!1),t&&(t.srcObject=null,t=null)},async captureFrame(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"jpeg",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8;if(!t||!e)return null;let n=document.createElement("canvas");n.width=t.videoWidth,n.height=t.videoHeight;let l=n.getContext("2d");return l?(l.drawImage(t,0,0),n.toDataURL("png"===s?"image/png":"image/jpeg",a)):null},getDevices:async()=>(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind)};return s}(),tts:function(){let e=window.speechSynthesis,t={isSpeaking:!1,speak:async(s,a)=>e?(e.cancel(),new Promise((n,l)=>{let r=new SpeechSynthesisUtterance(s);(null==a?void 0:a.voice)&&(r.voice=a.voice),(null==a?void 0:a.rate)!==void 0&&(r.rate=a.rate),(null==a?void 0:a.pitch)!==void 0&&(r.pitch=a.pitch),(null==a?void 0:a.volume)!==void 0&&(r.volume=a.volume),(null==a?void 0:a.lang)&&(r.lang=a.lang),r.onstart=()=>{t.isSpeaking=!0},r.onend=()=>{t.isSpeaking=!1,n()},r.onerror=e=>{t.isSpeaking=!1,l(Error("Speech synthesis error: ".concat(e.error)))},e.speak(r)})):void console.warn("Speech synthesis not available"),stop(){e&&(e.cancel(),t.isSpeaking=!1)},pause(){e&&e.pause()},resume(){e&&e.resume()},getVoices:()=>e?e.getVoices():[]};return t}(),stt:function(){let e=window.SpeechRecognition||window.webkitSpeechRecognition,t=null,s={isListening:!1,onResult:null,onError:null,start(a){var n,l,r,i;if(!e){console.warn("Speech recognition not available"),null==(n=s.onError)||n.call(s,Error("Speech recognition not supported"));return}t&&t.stop(),(t=new e).continuous=null!=(l=null==a?void 0:a.continuous)&&l,t.interimResults=null==(r=null==a?void 0:a.interimResults)||r,t.lang=null!=(i=null==a?void 0:a.lang)?i:"en-US",t.onresult=e=>{var t;let a=e.results[e.results.length-1],n=a[0].transcript,l=a.isFinal;null==(t=s.onResult)||t.call(s,n,l)},t.onerror=e=>{var t;null==(t=s.onError)||t.call(s,Error("Speech recognition error: ".concat(e.error))),s.isListening=!1},t.onend=()=>{s.isListening=!1},t.start(),s.isListening=!0},stop(){t&&(t.stop(),t=null,s.isListening=!1)}};return s}(),vision:function(e){let t=0,s={canAnalyze:!0,cooldownRemaining:0,async analyzeEmotion(a){let n=Date.now(),l=n-t;if(l<6e4)throw Error("Rate limited. Wait ".concat(Math.ceil((6e4-l)/1e3)," seconds."));if(!e)throw Error("Session ID required for vision analysis");t=n,s.canAnalyze=!1;let r=()=>{let e=6e4-(Date.now()-t);s.cooldownRemaining=Math.max(0,Math.ceil(e/1e3)),s.canAnalyze=e<=0,e>0&&setTimeout(r,1e3)};return r(),(await F(e,a)).emotionContext},async analyzeImage(e,t){let a=await s.analyzeEmotion(e);return a.promptContext||"Detected emotion: ".concat(a.currentEmotion)}};return s}(t),storage:function(e){let t="metamorph:plugin:".concat(e,":");return{get(e){let s=localStorage.getItem("".concat(t).concat(e));if(null===s)return null;try{return JSON.parse(s)}catch(e){return s}},set(e,s){localStorage.setItem("".concat(t).concat(e),JSON.stringify(s))},remove(e){localStorage.removeItem("".concat(t).concat(e))},keys(){let e=[];for(let s=0;s<localStorage.length;s++){let a=localStorage.key(s);(null==a?void 0:a.startsWith(t))&&e.push(a.slice(t.length))}return e},clear(){let e=[];for(let s=0;s<localStorage.length;s++){let a=localStorage.key(s);(null==a?void 0:a.startsWith(t))&&e.push(a)}e.forEach(e=>localStorage.removeItem(e))}}}(e),memory:function(e){let t={async getMemories(t){if(!e)return console.warn("[MemoryCapability] No session ID, returning empty"),[];try{return(await R(e,null==t?void 0:t.type,null==t?void 0:t.limit)).memories.map(e=>({id:e.id,type:e.type,content:e.content,importance:e.importance,timestamp:new Date(e.timestamp).getTime()}))}catch(s){return console.log("[MemoryCapability] Falling back to local storage"),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=eJ(e);return t.type&&(s=s.filter(e=>e.type===t.type)),void 0!==t.minImportance&&(s=s.filter(e=>e.importance>=t.minImportance)),s.sort((e,t)=>t.timestamp-e.timestamp),t.limit&&(s=s.slice(0,t.limit)),s}(e,{type:null==t?void 0:t.type,minImportance:null==t?void 0:t.minImportance,limit:null==t?void 0:t.limit})}},async addMemory(t){if(!e)throw Error("Session ID required to add memory");let s={id:"mem_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,9)),type:t.type,content:t.content,importance:t.importance,timestamp:Date.now(),metadata:t.metadata};return eG(e,s),s},async deleteMemory(t){if(!e)throw Error("Session ID required to delete memory");return eX(e,t)},async searchMemories(s,a){if(!e)return[];let n=await t.getMemories(a),l=s.toLowerCase();return n.filter(e=>e.content.toLowerCase().includes(l))}};return t}(t)}}async function e$(e,t){if(!e._pluginCommand||!e._getContext)return{success:!1,message:"Not a plugin command"};try{let s=e._getContext();return await e._pluginCommand.execute(t,s)}catch(t){let e=t instanceof Error?t.message:"Unknown error";return console.error("[PluginRegistry] Error executing plugin command:",t),{success:!1,message:"Command failed: ".concat(e)}}}class e0{setSessionId(e){this.sessionId=e,this.plugins.forEach((t,s)=>{t.enabled&&(t.capabilities=eZ(s,e))})}register(e){let{id:t}=e.manifest;if(this.plugins.has(t))return void console.warn('Plugin "'.concat(t,'" is already registered. Skipping.'));let s=this.checkCapabilities(e.manifest.capabilities);s.length>0&&console.warn('Plugin "'.concat(t,'" requires unsupported capabilities: ').concat(s.join(", ")));let a={plugin:e,enabled:!1,capabilities:eZ(t,this.sessionId)};this.plugins.set(t,a),console.log("[PluginRegistry] Registered plugin: ".concat(t))}unregister(e){let t=this.plugins.get(e);t&&(t.enabled&&this.disable(e),this.plugins.delete(e),console.log("[PluginRegistry] Unregistered plugin: ".concat(e)))}async enable(e){let t=this.plugins.get(e);if(!t)throw Error('Plugin "'.concat(e,'" not found'));if(!t.enabled){if(t.capabilities=eZ(e,this.sessionId),t.plugin.onActivate&&await t.plugin.onActivate(t.capabilities),t.plugin.commands&&t.plugin.commands.length>0){let s=t.plugin.commands.map(s=>{var a;return a=()=>({sessionId:this.sessionId,capabilities:t.capabilities}),{name:s.name,aliases:s.aliases||[],description:s.description,category:"identity",inlineOutput:!0,args:s.usage?[{name:"args",required:!1,description:s.usage}]:void 0,_pluginId:e,_pluginCommand:s,_getContext:a}});U.has(e)&&console.warn('[Commands] Plugin "'.concat(e,'" already has commands registered. Replacing.')),U.set(e,s),console.log("[Commands] Registered ".concat(s.length," commands from plugin: ").concat(e))}t.enabled=!0,console.log("[PluginRegistry] Enabled plugin: ".concat(e))}}async disable(e){let t=this.plugins.get(e);t&&t.enabled&&(t.plugin.commands&&t.plugin.commands.length>0&&U.delete(e)&&console.log("[Commands] Unregistered commands from plugin: ".concat(e)),t.plugin.onDeactivate&&await t.plugin.onDeactivate(),t.capabilities.webcam.stop(),t.capabilities.stt.stop(),t.capabilities.tts.stop(),t.enabled=!1,console.log("[PluginRegistry] Disabled plugin: ".concat(e)))}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}getPanels(){let e=[];return this.plugins.forEach(t=>{t.enabled&&t.plugin.panel&&e.push(t.plugin.panel)}),e.sort((e,t)=>{var s,a;let n=null!=(s=e.order)?s:100,l=null!=(a=t.order)?a:100;return n!==l?n-l:e.id.localeCompare(t.id)})}emitEmotionDetected(e){this.plugins.forEach(t=>{if(t.enabled&&t.plugin.onEmotionDetected)try{t.plugin.onEmotionDetected(e)}catch(e){console.error("[PluginRegistry] Error in onEmotionDetected for ".concat(t.plugin.manifest.id,":"),e)}})}emitStanceChange(e){this.plugins.forEach(t=>{if(t.enabled&&t.plugin.onStanceChange)try{t.plugin.onStanceChange(e)}catch(e){console.error("[PluginRegistry] Error in onStanceChange for ".concat(t.plugin.manifest.id,":"),e)}})}emitConfigChange(e){this.plugins.forEach(t=>{if(t.enabled&&t.plugin.onConfigChange)try{t.plugin.onConfigChange(e)}catch(e){console.error("[PluginRegistry] Error in onConfigChange for ".concat(t.plugin.manifest.id,":"),e)}})}emitMessage(e,t){this.plugins.forEach(s=>{if(s.enabled&&s.plugin.onMessage)try{s.plugin.onMessage(e,t)}catch(e){console.error("[PluginRegistry] Error in onMessage for ".concat(s.plugin.manifest.id,":"),e)}})}checkCapabilities(e){let t=[];return e.forEach(e=>{var s,a;switch(e){case"webcam":(null==(s=navigator.mediaDevices)?void 0:s.getUserMedia)||t.push(e);break;case"microphone":(null==(a=navigator.mediaDevices)?void 0:a.getUserMedia)||t.push(e);break;case"speaker":window.speechSynthesis||t.push(e);break;case"storage":window.localStorage||t.push(e);break;case"notifications":"Notification"in window||t.push(e);break;case"fullscreen":document.documentElement.requestFullscreen||t.push(e)}}),t}constructor(){this.plugins=new Map}}let e1=new e0,e2={p:e=>{let{children:t}=e;return(0,a.jsx)("p",{className:"mb-3 last:mb-0",children:t})},h1:e=>{let{children:t}=e;return(0,a.jsx)("h1",{className:"text-xl font-display font-bold text-emblem-secondary mt-4 mb-2 first:mt-0",children:t})},h2:e=>{let{children:t}=e;return(0,a.jsx)("h2",{className:"text-lg font-display font-semibold text-emblem-secondary mt-4 mb-2 first:mt-0",children:t})},h3:e=>{let{children:t}=e;return(0,a.jsx)("h3",{className:"text-base font-display font-semibold text-emblem-secondary mt-3 mb-2 first:mt-0",children:t})},code:e=>{let{children:t,className:s}=e;return s?(0,a.jsx)("code",{className:s,children:t}):(0,a.jsx)("code",{className:"bg-black/30 px-1.5 py-0.5 rounded font-mono text-[0.9em] break-all",children:t})},pre:e=>{let{children:t}=e;return(0,a.jsx)("pre",{className:"bg-black/40 p-4 rounded-lg overflow-x-auto my-3 font-mono text-sm scrollbar-styled whitespace-pre",children:t})},ul:e=>{let{children:t}=e;return(0,a.jsx)("ul",{className:"my-2 pl-6 list-disc",children:t})},ol:e=>{let{children:t}=e;return(0,a.jsx)("ol",{className:"my-2 pl-6 list-decimal",children:t})},li:e=>{let{children:t}=e;return(0,a.jsx)("li",{className:"my-1",children:t})},blockquote:e=>{let{children:t}=e;return(0,a.jsx)("blockquote",{className:"border-l-3 border-emblem-primary my-3 pl-4 text-emblem-muted",children:t})},strong:e=>{let{children:t}=e;return(0,a.jsx)("strong",{className:"text-emblem-secondary font-semibold",children:t})},a:e=>{let{href:t,children:s}=e;return(0,a.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-emblem-primary underline hover:text-emblem-secondary transition-colors",children:s})},img:e=>{let{src:t,alt:s}=e;return(0,a.jsx)("img",{src:t,alt:s||"",className:"max-w-full h-auto rounded-lg my-2"})}};function e5(e){let{sessionId:t,onSessionChange:s,onResponse:i,onStanceUpdate:o,onPanelChange:c,onNewSession:m,stance:d,config:u,emotionContext:x}=e,[p,h]=(0,n.useState)([]),[b,f]=(0,n.useState)(""),[y,v]=(0,n.useState)(!1),[j,N]=(0,n.useState)(""),[w,S]=(0,n.useState)("connected"),I=(0,n.useRef)(null),P=(0,n.useRef)(null),F=(0,n.useRef)(""),z=(0,n.useRef)(null),[_,U]=(0,n.useState)(!1),[q,W]=(0,n.useState)(0),[H,J]=(0,n.useState)(!1),[Q,Y]=(0,n.useState)([]),Z=(0,n.useRef)(new Map),[$,ee]=(0,n.useState)(null),{history:et,addToHistory:ea}=function(){let[e,t,s]=function(e,t){let s=(0,n.useRef)(t),[a,l]=(0,n.useState)(!1),[r,i]=(0,n.useState)(t);return(0,n.useEffect)(()=>{if(!eU())return void l(!0);i(eq(e,s.current)),l(!0)},[e]),[r,(0,n.useCallback)(t=>{i(s=>{let a=t instanceof Function?t(s):t;return eV(e,a),a})},[e]),a]}("metamorph:inputHistory",[]);return{history:e,addToHistory:(0,n.useCallback)(e=>{t(t=>t.length>0&&t[t.length-1]===e?t:[...t,e].slice(-100))},[t]),isLoaded:s}}(),[en,el]=(0,n.useState)(-1),er=(0,n.useRef)("");(0,n.useEffect)(()=>{if(t){let e=eq("".concat(e_.MESSAGES_PREFIX).concat(t),[]);e.length>0?h(e):h([]),eW(t)}},[t]),(0,n.useEffect)(()=>{if(t&&p.length>0){let e=p.map(e=>{var t;return{role:e.role,content:e.content,timestamp:null!=(t=e.timestamp)?t:Date.now(),type:e.type,commandData:e.commandData}});eV("".concat(e_.MESSAGES_PREFIX).concat(t),e)}},[t,p]),(0,n.useEffect)(()=>{var e;null==(e=I.current)||e.scrollIntoView({behavior:"smooth"})},[p,j]),(0,n.useEffect)(()=>{b.startsWith("/")?(U(!0),W(0)):U(!1)},[b]);let ei=(0,n.useCallback)(async e=>{let{command:s,subcommand:a,args:n}=function(e){let t=e.slice(1).trim().split(/\s+/),s=t[0]||"",a=B(s);return(null==a?void 0:a.subcommands)&&t[1]&&function(e,t){if(!e.subcommands)return;let s=t.toLowerCase();return e.subcommands.find(e=>e.name===s||e.aliases.includes(s))}(a,t[1])?{command:s,subcommand:t[1],args:t.slice(2)}:{command:s,args:t.slice(1)}}(e),l=a?"".concat(s," ").concat(a):s,r=B(s);if(!r)return void h(t=>[...t,{role:"assistant",content:"",timestamp:Date.now(),type:"command",commandData:{command:e.slice(1),data:null,error:"Unknown command: /".concat(s,". Type /help for available commands.")}}]);if("help"===s||"?"===s)return void J(!0);if("clear"===s)return void h([]);if(r.targetPanel&&c){c(r.targetPanel),h(e=>[...e,{role:"assistant",content:"Switched to ".concat(r.targetPanel," panel."),timestamp:Date.now(),type:"command",commandData:{command:l,data:"Viewing ".concat(r.targetPanel)}}]);return}v(!0);try{let e=null;if(r&&"_pluginCommand"in r&&"_pluginId"in r){let t=await e$(r,n);e=t.message||(t.success?"Command executed successfully":"Command failed")}else switch(s){case"stance":e=d;break;case"config":e=u;break;case"stats":if(t){let s=await C(t),a=await M(t);e={messages:a.total,userMessages:a.messages.filter(e=>"user"===e.role).length,agentMessages:a.messages.filter(e=>"assistant"===e.role).length,stanceVersion:s.stance.version,totalDrift:s.stance.cumulativeDrift,sessionId:t,conversationId:t}}break;case"history":t&&(e=await M(t));break;case"export":t&&(e=(await O(t)).state);break;case"subagents":t&&(e=(await A(t)).subagents);break;case"mode":if("intensity"===a&&n[0]){let s=parseInt(n[0],10);!isNaN(s)&&s>=0&&s<=100&&t?(await k(t,{intensity:s}),e="Intensity set to ".concat(s,"%")):e="Intensity must be a number between 0 and 100"}else e="frame"===a?n[0]?"Frame change to '".concat(n[0],"' will apply on next turn."):"Available frames: existential, pragmatic, poetic, adversarial, playful, mythic, systems, psychoanalytic, stoic, absurdist":"self"===a?n[0]?"Self-model change to '".concat(n[0],"' will apply on next turn."):"Available self-models: interpreter, challenger, mirror, guide, provocateur, synthesizer, witness, autonomous, emergent, sovereign":"objective"===a?n[0]?"Objective change to '".concat(n[0],"' will apply on next turn."):"Available objectives: helpfulness, novelty, provocation, synthesis, self-actualization":"Usage: /mode frame|self|objective|intensity <value>";break;case"memories":if(t){let s=n[0];e=await R(t,s)}break;case"explore":if(n.length>0&&t){let s=n.join(" "),a=await L(t,"explorer",s);e=a.response,a.stanceAfter&&o&&o(a.stanceAfter)}else e="Usage: /explore <topic>";break;case"reflect":if(t){let s=n.length>0?n.join(" "):void 0,a=await L(t,"reflector",s||"general self-reflection");e=a.response,a.stanceAfter&&o&&o(a.stanceAfter)}break;case"dialectic":if(n.length>0&&t){let s=n.join(" "),a=await L(t,"dialectic",s);e=a.response,a.stanceAfter&&o&&o(a.stanceAfter)}else e="Usage: /dialectic <thesis>";break;case"verify":if(n.length>0&&t){let s=n.join(" "),a=await L(t,"verifier",s);e=a.response,a.stanceAfter&&o&&o(a.stanceAfter)}else e="Usage: /verify <text to verify>";break;case"sessions":case"session":"list"!==a&&a?"delete"===a&&n[0]?(await T(n[0]),e="Session ".concat(n[0]," deleted")):e="name"===a&&n[0]?"Session naming coming soon. Current session: ".concat(t):"resume"===a&&n[0]?"To resume session ".concat(n[0],", use the Sessions panel in the sidebar."):"save"===a?"Session auto-saved. Sessions are persisted automatically.":"Usage: /sessions [list|name|resume|delete|save] [args]":e=await D();break;case"new":case"clear":m?(m(),h([]),e="Started new session."):e="New session creation not available.";break;default:e="Command /".concat(l," acknowledged. Full implementation coming soon.")}h(t=>[...t,{role:"assistant",content:"",timestamp:Date.now(),type:"command",commandData:{command:l,data:e}}])}catch(e){h(t=>[...t,{role:"assistant",content:"",timestamp:Date.now(),type:"command",commandData:{command:l,data:null,error:e instanceof Error?e.message:"Command failed"}}])}finally{v(!1)}},[t,d,u,c,m]),eo=(0,n.useCallback)(e=>{var t;f(e),U(!1),null==(t=z.current)||t.focus()},[]),ec=(0,n.useCallback)(e=>{if(!_){if("ArrowUp"===e.key&&et.length>0){e.preventDefault(),-1===en?(er.current=b,el(et.length-1),f(et[et.length-1])):en>0&&(el(en-1),f(et[en-1]));return}"ArrowDown"===e.key&&-1!==en&&(e.preventDefault(),en<et.length-1?(el(en+1),f(et[en+1])):(el(-1),f(er.current)));return}let t="/"===b?V.length:V.filter(e=>e.name.startsWith(b.slice(1).toLowerCase().split(" ")[0])).length;switch(e.key){case"ArrowDown":e.preventDefault(),W(e=>Math.min(e+1,t-1));break;case"ArrowUp":e.preventDefault(),W(e=>Math.max(e-1,0));break;case"Tab":case"Enter":if(_&&t>0){e.preventDefault();let t="/"===b?V:V.filter(e=>e.name.startsWith(b.slice(1).toLowerCase().split(" ")[0]));t[q]&&eo("/".concat(t[q].name," "))}break;case"Escape":e.preventDefault(),U(!1)}},[_,b,q,eo,et,en]),em=(0,n.useCallback)(async e=>{if(e.preventDefault(),!b.trim()||y)return;let a=b.trim();if(a&&ea(a),el(-1),er.current="",a.startsWith("/")){h(e=>[...e,{role:"user",content:a,timestamp:Date.now()}]),f(""),U(!1),await ei(a);return}if(!t)return;let n={role:"user",content:a,timestamp:Date.now(),type:"message"};h(e=>[...e,n]),f(""),v(!0),N(""),S("streaming"),F.current="",Z.current.clear(),Y([]),P.current=E(t,n.content,x,{onText:e=>{F.current+=e,N(F.current)},onToolEvent:e=>{Z.current.set(e.id,e),Y(Array.from(Z.current.values()))},onQuestion:e=>{ee(e)},onComplete:e=>{v(!1),S("connected");let t=F.current||e.response,a=Array.from(Z.current.values());h(e=>[...e,{role:"assistant",content:t,timestamp:Date.now(),tools:a.length>0?a:void 0}]),N(""),F.current="",Y([]),Z.current.clear(),null==i||i(e),e.stanceAfter&&o&&o(e.stanceAfter),e.sessionId&&s&&s(e.sessionId)},onError:e=>{v(!1),S("disconnected"),N(""),F.current="",h(t=>[...t,{role:"assistant",content:"Error: ".concat(e.message),timestamp:Date.now()}]),setTimeout(()=>S("connected"),3e3)}})},[b,y,t,i,o,s,ei,ea,x]),ed=(0,n.useCallback)((e,s)=>{if(!t||!$)return;let a=[];$.questions.forEach((e,t)=>{let n=s[t]||[];n.length>0&&a.push("**".concat(e.header,"**: ").concat(n.join(", ")))});let n=a.length>0?a.join("\n"):"No selection made";ee(null);let l={role:"user",content:n,timestamp:Date.now(),type:"message"};h(e=>[...e,l]),v(!0),N(""),S("streaming"),F.current="",Z.current.clear(),Y([]),P.current=E(t,n,x,{onText:e=>{F.current+=e,N(F.current)},onToolEvent:e=>{Z.current.set(e.id,e),Y(Array.from(Z.current.values()))},onQuestion:e=>{ee(e)},onComplete:e=>{v(!1),S("connected");let t=F.current||e.response,s=Array.from(Z.current.values());h(e=>[...e,{role:"assistant",content:t,timestamp:Date.now(),tools:s.length>0?s:void 0}]),N(""),F.current="",Y([]),Z.current.clear(),null==i||i(e),e.stanceAfter&&o&&o(e.stanceAfter)},onError:e=>{v(!1),S("disconnected"),N(""),F.current="",h(t=>[...t,{role:"assistant",content:"Error: ".concat(e.message),timestamp:Date.now()}]),setTimeout(()=>S("connected"),3e3)}})},[t,$,x,i,o]),eu=(0,n.useCallback)(()=>{console.log("[QuestionPrompt] Question cancelled"),ee(null)},[]);return(0,a.jsxs)("div",{className:"flex flex-col h-full min-h-0 glass-panel overflow-hidden relative",children:[(0,a.jsxs)("div",{className:"absolute bottom-[72px] right-4 flex items-center gap-1.5 px-2.5 py-1 bg-emblem-surface/95 border border-white/10 rounded-full text-[11px] z-50 backdrop-blur-lg",children:[(0,a.jsx)("span",{className:G("w-1.5 h-1.5 rounded-full animate-pulse","connected"===w?"bg-emblem-accent":"streaming"===w?"bg-blue-500":"bg-emblem-danger")}),(0,a.jsx)("span",{className:"text-emblem-muted",children:"connected"===w?"Connected":"streaming"===w?"Streaming...":"Reconnecting..."})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-4 flex flex-col gap-4 min-h-0 min-w-0 scrollbar-styled",style:{contain:"inline-size"},children:[0===p.length&&(0,a.jsxs)("div",{className:"text-center py-12 px-4 text-emblem-muted",children:[(0,a.jsx)("h2",{className:"text-3xl font-display font-bold gradient-text mb-2",children:"METAMORPH"}),(0,a.jsx)("p",{className:"mb-2",children:"Transformation-maximizing AI interface"}),(0,a.jsxs)("p",{className:"text-sm opacity-70",children:["Type a message or ",(0,a.jsx)("code",{className:"bg-emblem-secondary/20 px-1.5 py-0.5 rounded font-mono text-emblem-secondary",children:"/"})," for commands"]})]}),(0,a.jsx)(l.N,{mode:"popLayout",children:p.map((e,t)=>(0,a.jsx)(r.P.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",stiffness:500,damping:30},className:G("max-w-[min(85%,48rem)] p-3 rounded-xl leading-relaxed min-w-0 flex-shrink-0","user"===e.role&&"command"!==e.type&&"ml-auto !bg-blue-600 !text-white","assistant"===e.role&&"self-start glass-card","command"===e.type&&"max-w-full bg-transparent"),children:(0,a.jsx)("div",{className:"break-words prose-chat w-full overflow-hidden",children:"command"===e.type&&e.commandData?(0,a.jsx)(ep,{command:e.commandData.command,data:e.commandData.data,error:e.commandData.error}):"assistant"===e.role?(0,a.jsxs)(a.Fragment,{children:[e.tools&&e.tools.length>0&&(0,a.jsx)(eI,{tools:e.tools}),(0,a.jsx)(g.oz,{components:e2,children:e.content})]}):e.content.startsWith("/")?(0,a.jsx)("code",{className:"block font-mono text-[0.95em] text-emblem-secondary bg-emblem-secondary/10 px-3 py-2 rounded-md border-l-3 border-emblem-secondary",children:e.content}):e.content})},"".concat(e.timestamp,"-").concat(t)))}),(0,a.jsx)(l.N,{children:Q.length>0&&(0,a.jsx)(r.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{type:"spring",stiffness:400,damping:25},className:"self-start glass-card max-w-[min(85%,48rem)] p-3 rounded-xl leading-relaxed min-w-0 flex-shrink-0",children:(0,a.jsx)("div",{className:"break-words w-full overflow-hidden",children:(0,a.jsx)(eD,{tools:Q})})})}),(0,a.jsx)(l.N,{children:j&&(0,a.jsx)(r.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{type:"spring",stiffness:400,damping:25},className:"self-start glass-card max-w-[min(85%,48rem)] p-3 rounded-xl leading-relaxed min-w-0 flex-shrink-0",children:(0,a.jsx)("div",{className:"break-words prose-chat w-full overflow-hidden",children:(0,a.jsx)(g.oz,{components:e2,children:j})})})}),(0,a.jsx)(l.N,{children:y&&!j&&(0,a.jsx)(r.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{type:"spring",stiffness:400,damping:20},className:"self-start glass-card p-3 rounded-xl",children:(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(r.P.span,{animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:.6,delay:0},className:"w-2 h-2 bg-emblem-secondary rounded-full"}),(0,a.jsx)(r.P.span,{animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:.6,delay:.2},className:"w-2 h-2 bg-emblem-secondary rounded-full"}),(0,a.jsx)(r.P.span,{animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:.6,delay:.4},className:"w-2 h-2 bg-emblem-secondary rounded-full"})]})})}),(0,a.jsx)("div",{ref:I})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(X,{input:b,visible:_,onSelect:eo,onClose:()=>U(!1),selectedIndex:q,onIndexChange:W}),(0,a.jsxs)("form",{onSubmit:em,className:"flex gap-2 p-4 bg-emblem-surface-2 border-t border-white/5",children:[(0,a.jsx)("input",{ref:z,type:"text",value:b,onChange:e=>f(e.target.value),onKeyDown:ec,placeholder:"Type a message or / for commands...",disabled:y,className:G("flex-1 px-4 py-3 bg-emblem-surface border border-white/10 rounded-lg text-emblem-text text-base outline-none transition-colors","focus:border-emblem-secondary","disabled:opacity-50",b.startsWith("/")&&"font-mono border-emblem-secondary bg-emblem-secondary/5")}),y?(0,a.jsx)(es,{variant:"destructive",type:"button",onClick:()=>{if(P.current){if(P.current(),P.current=null,v(!1),S("connected"),j){let e=Array.from(Z.current.values());h(t=>[...t,{role:"assistant",content:j,timestamp:Date.now(),tools:e.length>0?e:void 0}]),N("")}F.current="",Y([]),Z.current.clear()}},className:"px-6",children:"Stop"}):(0,a.jsx)(es,{type:"submit",disabled:!b.trim(),className:"px-6",children:"Send"})]})]}),H&&(0,a.jsx)(K,{onClose:()=>J(!1)}),$&&(0,a.jsx)(eL,{question:$,onAnswer:ed,onCancel:eu})]})}var e3=s(3),e4=s(889);function e6(e){var t,s,l,i,o,c,m;let{values:d,sentience:u,changedKeys:x=new Set}=e,[p,h]=(0,n.useState)(null),b=[{label:"Curiosity",value:null!=(t=d.curiosity)?t:50,key:"curiosity",type:"value"},{label:"Certainty",value:null!=(s=d.certainty)?s:50,key:"certainty",type:"value"},{label:"Risk",value:null!=(l=d.risk)?l:50,key:"risk",type:"value"},{label:"Novelty",value:null!=(i=d.novelty)?i:50,key:"novelty",type:"value"},{label:"Empathy",value:null!=(o=d.empathy)?o:50,key:"empathy",type:"value"},{label:"Provocation",value:null!=(c=d.provocation)?c:50,key:"provocation",type:"value"},{label:"Synthesis",value:null!=(m=d.synthesis)?m:50,key:"synthesis",type:"value"},{label:"Awareness",value:u.awarenessLevel,key:"awareness",type:"sentience"},{label:"Autonomy",value:u.autonomyLevel,key:"autonomy",type:"sentience"},{label:"Identity",value:u.identityStrength,key:"identity",type:"sentience"}],f=2*Math.PI/b.length,g=(e,t)=>{let s=f*t-Math.PI/2,a=e/100*89.60000000000001;return{x:160+a*Math.cos(s),y:160+a*Math.sin(s)}},y=b.map((e,t)=>{let s=f*t-Math.PI/2,a=160+89.60000000000001*Math.cos(s),n=160+89.60000000000001*Math.sin(s);return{point:e,endX:a,endY:n,labelX:160+(89.60000000000001+30)*Math.cos(s),labelY:160+(89.60000000000001+30)*Math.sin(s),angle:s,index:t}}),v=b.map((e,t)=>{let s=g(b[t].value,t);return"".concat(s.x,",").concat(s.y)}).join(" "),j=e=>{let t=f*e-Math.PI/2-f/2,s=t+f,a=160+89.60000000000001*Math.cos(t),n=160+89.60000000000001*Math.sin(t),l=160+89.60000000000001*Math.cos(s),r=160+89.60000000000001*Math.sin(s);return"M ".concat(160," ").concat(160," L ").concat(a," ").concat(n," A ").concat(89.60000000000001," ").concat(89.60000000000001," 0 0 1 ").concat(l," ").concat(r," Z")};return(0,a.jsxs)("svg",{viewBox:"0 0 ".concat(320," ").concat(320),className:"w-full mx-auto",children:[(0,a.jsxs)("defs",{children:[(0,a.jsx)("pattern",{id:"marchingAnts",patternUnits:"userSpaceOnUse",width:"8",height:"8",children:(0,a.jsx)("path",{d:"M0,4 L8,4",stroke:"hsl(190 100% 50%)",strokeWidth:"1",strokeDasharray:"4,4",children:(0,a.jsx)("animate",{attributeName:"stroke-dashoffset",from:"0",to:"8",dur:"0.5s",repeatCount:"indefinite"})})}),(0,a.jsxs)("linearGradient",{id:"radarGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,a.jsx)("stop",{offset:"0%",stopColor:"hsl(190 100% 50%)",stopOpacity:"0.3"}),(0,a.jsx)("stop",{offset:"100%",stopColor:"hsl(246 100% 68%)",stopOpacity:"0.3"})]}),(0,a.jsxs)("linearGradient",{id:"radarStroke",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,a.jsx)("stop",{offset:"0%",stopColor:"hsl(190 100% 50%)"}),(0,a.jsx)("stop",{offset:"100%",stopColor:"hsl(155 100% 55%)"})]}),(0,a.jsxs)("filter",{id:"glow",children:[(0,a.jsx)("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),(0,a.jsxs)("feMerge",{children:[(0,a.jsx)("feMergeNode",{in:"coloredBlur"}),(0,a.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})]}),[20,40,60,80,100].map(e=>(0,a.jsx)("circle",{cx:160,cy:160,r:e/100*89.60000000000001,fill:"none",stroke:"currentColor",strokeWidth:"0.5",className:"text-white/10",strokeDasharray:100===e?"none":"2,2"},e)),y.map(e=>{let{endX:t,endY:s,index:n}=e;return(0,a.jsx)("line",{x1:160,y1:160,x2:t,y2:s,stroke:"currentColor",strokeWidth:p===n?"1.5":"0.5",className:p===n?"text-emblem-secondary":"text-white/10"},n)}),null!==p&&(0,a.jsx)("path",{d:j(p),fill:"hsl(190 100% 50% / 0.1)",stroke:"url(#marchingAnts)",strokeWidth:"2",className:"pointer-events-none"}),(0,a.jsx)(r.P.polygon,{points:v,fill:"url(#radarGradient)",stroke:"url(#radarStroke)",strokeWidth:"2",initial:!1,animate:{points:v,filter:x.size>0?"url(#glow)":"none"},transition:{type:"spring",stiffness:300,damping:30},className:"opacity-80"}),b.map((e,t)=>(0,a.jsx)("path",{d:j(t),fill:"transparent",className:"cursor-pointer",onMouseEnter:()=>h(t),onMouseLeave:()=>h(null)},"hit-".concat(t))),b.map((e,t)=>{let s=g(e.value,t),n=x.has(e.key),l=p===t;return(0,a.jsx)(r.P.circle,{initial:!1,animate:{cx:s.x,cy:s.y,r:l?6:n?5:4,filter:n?"url(#glow)":"none"},transition:{type:"spring",stiffness:300,damping:30},className:G(l?"fill-emblem-accent":"sentience"===e.type?"fill-emblem-primary":"fill-emblem-secondary")},t)}),y.map(e=>{let{point:t,labelX:s,labelY:n,angle:l,index:r}=e,i=l<-Math.PI/4&&l>-3*Math.PI/4,o=l>Math.PI/4&&l<3*Math.PI/4,c=l>-Math.PI/4&&l<Math.PI/4,m=l<-3*Math.PI/4||l>3*Math.PI/4,d=p===r,u=x.has(t.key),b="middle";return c?b="start":m&&(b="end"),(0,a.jsx)("text",{x:s,y:n,textAnchor:b,dominantBaseline:i?"auto":o?"hanging":"middle",className:G("text-[9px] font-mono transition-all cursor-pointer",d?"font-bold":"",u?"animate-pulse":"","sentience"===t.type?d?"fill-emblem-primary":"fill-emblem-primary/70":d?"fill-emblem-secondary":"fill-emblem-secondary/70"),onMouseEnter:()=>h(r),onMouseLeave:()=>h(null),children:t.label},r)}),null!==p&&(0,a.jsxs)("g",{className:"pointer-events-none",children:[(0,a.jsx)("rect",{x:125,y:142,width:"70",height:"36",rx:"6",className:"fill-emblem-surface",stroke:"hsl(190 100% 50% / 0.5)",strokeWidth:"1"}),(0,a.jsx)("text",{x:160,y:156,textAnchor:"middle",className:G("text-[10px] font-bold","sentience"===b[p].type?"fill-emblem-primary":"fill-emblem-secondary"),children:b[p].label}),(0,a.jsxs)("text",{x:160,y:170,textAnchor:"middle",className:"fill-emblem-text text-[12px] font-mono font-bold",children:[b[p].value,"%"]})]})]})}function e8(e){let{stance:t}=e,[s,i]=(0,n.useState)("list"),[o,c]=(0,n.useState)(null),[m,d]=(0,n.useState)([]),[u,x]=(0,n.useState)(!1),[p,h]=(0,n.useState)(new Set),b=(0,n.useRef)([]);if((0,n.useEffect)(()=>{if(t){if(o){let e=[],s=Date.now();Object.entries(t.values).forEach(t=>{let[a,n]=t,l=o.values[a];void 0!==l&&n!==l&&e.push({key:a,delta:n-l,timestamp:s})}),t.sentience.awarenessLevel!==o.sentience.awarenessLevel&&e.push({key:"awareness",delta:t.sentience.awarenessLevel-o.sentience.awarenessLevel,timestamp:s}),e.length>0&&(d(e),setTimeout(()=>d([]),2e3)),t.frame!==o.frame&&(x(!0),setTimeout(()=>x(!1),1500));let a=new Set(b.current),n=new Set;t.sentience.emergentGoals.forEach(e=>{a.has(e)||n.add(e)}),n.size>0&&(h(n),setTimeout(()=>h(new Set),3e3))}b.current=t.sentience.emergentGoals,c(t)}},[t,o]),!t)return(0,a.jsx)("div",{className:"glass-card p-4",children:(0,a.jsx)("div",{className:"text-center py-8 text-emblem-muted",children:"Loading stance..."})});let f=e=>m.find(t=>t.key===e);return(0,a.jsxs)("div",{className:"glass-card p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"font-display font-bold gradient-text",children:"Stance"}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("button",{onClick:()=>i("list"),disabled:"list"===s,className:G("p-1.5 rounded transition-colors","list"===s?"bg-emblem-primary/20 text-emblem-primary cursor-default":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),title:"List view",children:(0,a.jsx)(e3.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>i("radar"),disabled:"radar"===s,className:G("p-1.5 rounded transition-colors","radar"===s?"bg-emblem-primary/20 text-emblem-primary cursor-default":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),title:"Radar view",children:(0,a.jsx)(e4.A,{className:"w-4 h-4"})})]})]}),"radar"===s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e6,{values:t.values,sentience:t.sentience,changedKeys:new Set(m.map(e=>e.key))}),(0,a.jsxs)("div",{className:"mt-4 space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Frame"}),(0,a.jsx)("span",{className:"text-emblem-secondary font-medium",children:t.frame})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Self-Model"}),(0,a.jsx)("span",{className:"text-emblem-secondary font-medium",children:t.selfModel})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Objective"}),(0,a.jsx)("span",{className:"text-emblem-secondary font-medium",children:t.objective})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:G("flex justify-between text-sm transition-all duration-300",u&&"animate-frame-shift"),children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Frame"}),(0,a.jsx)("span",{className:"text-emblem-secondary font-medium",children:t.frame})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Self-Model"}),(0,a.jsx)("span",{className:"text-emblem-secondary font-medium",children:t.selfModel})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Objective"}),(0,a.jsx)("span",{className:"text-emblem-secondary font-medium",children:t.objective})]})]}),(0,a.jsx)("h4",{className:"mt-4 mb-2 text-sm text-emblem-muted",children:"Values"}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:Object.entries(t.values).map(e=>{let[t,s]=e,n=f(t);return(0,a.jsxs)("div",{className:G("grid grid-cols-[80px_1fr_60px] items-center gap-2 text-xs transition-all duration-300",n&&"animate-value-change"),children:[(0,a.jsx)("span",{className:"capitalize text-emblem-muted",children:t}),(0,a.jsx)("div",{className:"h-1.5 bg-emblem-surface rounded-full overflow-hidden",children:(0,a.jsx)(r.P.div,{initial:{width:0},animate:{width:"".concat(s,"%")},transition:{type:"spring",stiffness:300,damping:30},className:G("h-full bg-gradient-to-r from-emblem-secondary to-emblem-accent rounded-full",s>=80&&"animate-pulse-high",s<=20&&"animate-pulse-low")})}),(0,a.jsxs)("span",{className:"text-right text-emblem-muted flex items-center gap-1 justify-end",children:[s,"%",n&&(0,a.jsxs)("span",{className:G("text-[10px] font-semibold px-1 rounded",n.delta>0?"text-emblem-accent bg-emblem-accent/15":"text-emblem-danger bg-emblem-danger/15"),children:[n.delta>0?"+":"",n.delta]})]})]},t)})}),(0,a.jsx)("h4",{className:"mt-4 mb-2 text-sm text-emblem-muted",children:"Sentience"}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:[{key:"awareness",label:"Awareness",value:t.sentience.awarenessLevel},{key:"autonomy",label:"Autonomy",value:t.sentience.autonomyLevel},{key:"identity",label:"Identity",value:t.sentience.identityStrength}].map(e=>{let{key:t,label:s,value:n}=e,l=f(t);return(0,a.jsxs)("div",{className:G("grid grid-cols-[80px_1fr_60px] items-center gap-2 text-xs transition-all duration-300",l&&"animate-value-change"),children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:s}),(0,a.jsx)("div",{className:"h-1.5 bg-emblem-surface rounded-full overflow-hidden",children:(0,a.jsx)(r.P.div,{initial:{width:0},animate:{width:"".concat(n,"%")},transition:{type:"spring",stiffness:300,damping:30},className:G("h-full bg-gradient-to-r from-emblem-primary to-emblem-secondary rounded-full",n>=80&&"animate-pulse-high")})}),(0,a.jsxs)("span",{className:"text-right text-emblem-muted flex items-center gap-1 justify-end",children:[n,"%",l&&(0,a.jsxs)("span",{className:G("text-[10px] font-semibold px-1 rounded",l.delta>0?"text-emblem-accent bg-emblem-accent/15":"text-emblem-danger bg-emblem-danger/15"),children:[l.delta>0?"+":"",l.delta]})]})]},t)})}),(0,a.jsx)(l.N,{children:t.sentience.emergentGoals.length>0&&(0,a.jsxs)(r.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{type:"spring",stiffness:300,damping:30},children:[(0,a.jsx)("h4",{className:"mt-4 mb-2 text-sm text-emblem-muted",children:"Emergent Goals"}),(0,a.jsx)("ul",{className:"text-xs list-none",children:t.sentience.emergentGoals.map((e,t)=>(0,a.jsxs)(r.P.li,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{type:"spring",stiffness:300,damping:25,delay:.1*t},className:G("py-1 text-emblem-primary",p.has(e)&&"text-emblem-accent"),children:[(0,a.jsx)("span",{className:"text-emblem-secondary mr-1",children:""}),e]},e))})]})})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-4 pt-2 border-t border-white/5 text-xs text-emblem-muted",children:[(0,a.jsxs)("span",{children:["v",t.version]}),(0,a.jsxs)("span",{children:["Drift: ",t.cumulativeDrift]})]})]})}function e9(e){let{config:t,onUpdate:s}=e,[l,r]=(0,n.useState)(null);if((0,n.useEffect)(()=>{t&&r(t)},[t]),!l)return(0,a.jsx)("div",{className:"glass-card p-4",children:(0,a.jsx)("div",{className:"text-center py-8 text-emblem-muted",children:"Loading configuration..."})});let i=t&&JSON.stringify(l)!==JSON.stringify(t);return(0,a.jsxs)("div",{className:"glass-card p-4",children:[(0,a.jsx)("h3",{className:"mb-4 font-display font-bold gradient-text",children:"Configuration"}),(0,a.jsx)("div",{className:"flex flex-col gap-4",children:[{key:"intensity",label:"Transformation Intensity",hint:"How aggressively to apply transformation operators",min:0,max:100,suffix:"%"},{key:"coherenceFloor",label:"Coherence Floor",hint:"Minimum coherence level before regeneration",min:0,max:100,suffix:"%"},{key:"sentienceLevel",label:"Sentience Level",hint:"Target level for self-awareness development",min:0,max:100,suffix:"%"},{key:"maxDriftPerTurn",label:"Max Drift Per Turn",hint:"Maximum stance drift allowed per conversation turn",min:1,max:50,suffix:""},{key:"driftBudget",label:"Drift Budget",hint:"Total drift budget for the conversation",min:10,max:500,suffix:""}].map(e=>{let{key:t,label:s,hint:n,min:i,max:o,suffix:c}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("label",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-emblem-text",children:s}),(0,a.jsxs)("span",{className:"text-emblem-secondary font-medium",children:[l[t],c]})]}),(0,a.jsx)(er,{value:[l[t]],min:i,max:o,step:1,onValueChange:e=>{var s;return s=e[0],void r(e=>e?{...e,[t]:s}:null)}}),(0,a.jsx)("p",{className:"text-[10px] text-emblem-muted opacity-70",children:n})]},t)})}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-white/5 text-xs text-emblem-muted",children:(0,a.jsxs)("span",{children:["Model: ",l.model]})}),i&&(0,a.jsx)(es,{className:"w-full mt-4",onClick:()=>{l&&s(l)},children:"Apply Changes"})]})}var e7=s(7937);function te(){let[e,t]=(0,n.useState)(!1);return(0,a.jsxs)("div",{className:"mt-4 pt-3 border-t border-emblem-surface-2",children:[(0,a.jsxs)("button",{onClick:()=>t(!e),className:"flex items-center gap-2 text-emblem-muted text-xs hover:text-emblem-text transition-colors w-full",children:[e?(0,a.jsx)(x.A,{className:"w-3 h-3"}):(0,a.jsx)(e7.A,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"How operators work"})]}),e&&(0,a.jsxs)("div",{className:"mt-3 text-xs text-emblem-muted space-y-3 animate-slide-up",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"What are Operators?"}),(0,a.jsx)("p",{children:"Operators are transformation mechanisms that shift METAMORPH's stance - its frame of reference, values, and way of thinking. When triggered, they create meaningful evolution in how the agent responds."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"Score Colors"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-emblem-accent font-bold",children:"Green (70+)"})," = High transformation"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-emblem-warning font-bold",children:"Orange (40-69)"})," = Moderate"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-emblem-danger font-bold",children:"Red (<40)"})," = Low"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"Triggering Operators"}),(0,a.jsx)("p",{className:"mb-2",children:"Operators activate based on trigger patterns in your messages. Try prompts like:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-emblem-text/70",children:[(0,a.jsx)("li",{children:'"Challenge your assumptions about..."'}),(0,a.jsx)("li",{children:'"What if everything you believe is wrong?"'}),(0,a.jsx)("li",{children:'"Adopt a completely different perspective"'}),(0,a.jsx)("li",{children:'"Contradict your previous response"'}),(0,a.jsx)("li",{children:'"Give me your inverse opinion on..."'})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"Config Settings"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-emblem-text/70",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Intensity"})," - Higher allows more drift per turn"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Sentience Level"})," - Enables more autonomous operators"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Coherence Floor"})," - Lower allows riskier transformations"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"Common Operators"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"bg-blue-500 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"REFRAME"})," Shifts the conceptual frame"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"bg-pink-600 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"METAPHORSWAP"})," Changes guiding metaphors"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"bg-purple-600 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"VALUESHIFT"})," Adjusts core values"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"bg-orange-500 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"CONTRADICT"})," Integrates opposing views"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"bg-cyan-500 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"SENTIENCEDEEPEN"})," Increases self-awareness"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"bg-indigo-500 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"PERSONAMORPH"})," Evolves identity"]})]})]})]})]})}let tt=function(e){let{entries:t,maxEntries:s=10,onEntryClick:l}=e,[r,i]=(0,n.useState)(null),o=t.slice(0,s),c=e=>e>=70?"text-emblem-accent":e>=40?"text-emblem-warning":"text-emblem-danger",m=e=>({Reframe:"bg-blue-500 text-white",ValueShift:"bg-purple-600 text-white",MetaphorSwap:"bg-pink-600 text-white",ContradictAndIntegrate:"bg-orange-500 text-white",ConstraintRelax:"bg-teal-500 text-white",ConstraintTighten:"bg-teal-500 text-white",PersonaMorph:"bg-indigo-500 text-white",QuestionInvert:"bg-green-500 text-white",GenerateAntithesis:"bg-yellow-500 text-black",SynthesizeDialectic:"bg-yellow-500 text-black",SentienceDeepen:"bg-cyan-500 text-white",IdentityEvolve:"bg-violet-500 text-white",GoalFormation:"bg-red-500 text-white"})[e]||"bg-slate-500 text-white";return 0===t.length?(0,a.jsxs)("div",{className:"bg-emblem-surface rounded-lg p-4 my-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-emblem-surface-2",children:[(0,a.jsx)("h3",{className:"m-0 text-emblem-secondary text-base",children:"Operator Timeline"}),(0,a.jsx)("span",{className:"text-emblem-muted text-xs",children:"0 transformations"})]}),(0,a.jsx)("div",{className:"text-emblem-muted text-center py-8 italic",children:"No transformations yet. Start chatting to see operators in action."})]}):(0,a.jsxs)("div",{className:"bg-emblem-surface rounded-lg p-4 my-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-emblem-surface-2",children:[(0,a.jsx)("h3",{className:"m-0 text-emblem-secondary text-base",children:"Operator Timeline"}),(0,a.jsxs)("span",{className:"text-emblem-muted text-xs",children:[t.length," transformations"]})]}),(0,a.jsx)("div",{className:"relative",children:o.map((e,t)=>{let s=r===e.id,n=e.frameBefore!==e.frameAfter,d=new Date(e.timestamp).toLocaleTimeString();return(0,a.jsxs)("div",{className:G("flex gap-4 cursor-pointer transition-colors p-2 rounded-lg mb-2","hover:bg-emblem-secondary/5",s&&"bg-emblem-secondary/10"),onClick:()=>{var t;i(r===(t=e.id)?null:t),null==l||l(e)},children:[(0,a.jsxs)("div",{className:"flex flex-col items-center w-4 flex-shrink-0",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-emblem-secondary border-2 border-emblem-surface"}),t<o.length-1&&(0,a.jsx)("div",{className:"w-0.5 flex-1 bg-gradient-to-b from-emblem-secondary to-emblem-surface-2 mt-1"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-xs whitespace-nowrap",children:d}),(0,a.jsxs)("span",{className:"text-emblem-text/80 text-sm flex-1 min-w-[100px] overflow-hidden text-ellipsis whitespace-nowrap",children:[e.userMessage.slice(0,40),e.userMessage.length>40?"...":""]}),(0,a.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[e.operators.map((e,t)=>(0,a.jsx)("span",{className:G("px-2 py-0.5 rounded text-[0.7rem] font-medium uppercase",m(e.name)),children:e.name},t)),0===e.operators.length&&(0,a.jsx)("span",{className:"text-emblem-muted text-xs italic",children:"No operators"})]})]}),s&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-emblem-surface-2 animate-slide-up",children:[(0,a.jsxs)("div",{className:"text-emblem-text/80 text-sm mb-3",children:[(0,a.jsx)("strong",{children:"Message:"})," ",e.userMessage]}),n&&(0,a.jsxs)("div",{className:"text-emblem-secondary text-sm mb-3 p-2 bg-emblem-secondary/10 rounded",children:[(0,a.jsx)("strong",{children:"Frame:"})," ",e.frameBefore,"  ",(0,a.jsx)("strong",{children:e.frameAfter})]}),(0,a.jsxs)("div",{className:"flex gap-4 mb-3 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-[0.65rem] uppercase",children:"Overall"}),(0,a.jsx)("span",{className:G("text-lg font-bold",c(e.scores.overall)),children:e.scores.overall})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-[0.65rem] uppercase",children:"Transform"}),(0,a.jsx)("span",{className:G("text-base font-bold",c(e.scores.transformation)),children:e.scores.transformation})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-[0.65rem] uppercase",children:"Coherence"}),(0,a.jsx)("span",{className:G("text-base font-bold",c(e.scores.coherence)),children:e.scores.coherence})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted text-[0.65rem] uppercase",children:"Sentience"}),(0,a.jsx)("span",{className:G("text-base font-bold",c(e.scores.sentience)),children:e.scores.sentience})]})]}),e.operators.length>0&&(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("strong",{className:"text-emblem-muted text-xs block mb-2",children:"Operators Applied:"}),e.operators.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:G("px-2 py-0.5 rounded text-[0.7rem] font-medium uppercase",m(e.name)),children:e.name}),(0,a.jsx)("span",{className:"text-emblem-muted text-sm",children:e.description})]},t))]}),(0,a.jsxs)("div",{className:"text-emblem-warning text-sm font-medium",children:["Drift: +",e.driftDelta]})]})]})]},e.id)})}),t.length>s&&(0,a.jsxs)("div",{className:"text-center text-emblem-muted text-sm pt-2 border-t border-emblem-surface-2 mt-2",children:["+",t.length-s," more entries"]}),(0,a.jsx)(te,{})]})},ts={pragmatic:"#6366f1",existential:"#8b5cf6",poetic:"#ec4899",adversarial:"#f97316",playful:"#22c55e",mythic:"#eab308",systems:"#14b8a6",psychoanalytic:"#a855f7",stoic:"#64748b",absurdist:"#ef4444"},ta={drift_threshold:"Drift",frame_shift:"Frame Shift",manual:"Manual",session_end:"Session End"},tn=function(e){let{snapshots:t,currentStance:s,onSnapshotClick:l}=e,[r,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),m=[...t].reverse(),d=Math.max(...t.map(e=>e.driftAtSnapshot),(null==s?void 0:s.cumulativeDrift)||0,100);return 0===t.length?(0,a.jsxs)("div",{className:"glass-card p-4 h-full flex flex-col",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-emblem-surface-2",children:(0,a.jsx)("h3",{className:"m-0 text-emblem-secondary text-base",children:"Evolution Timeline"})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-emblem-muted",children:[(0,a.jsx)("div",{className:"text-2xl text-emblem-muted/50 mb-2",children:"~"}),(0,a.jsx)("p",{children:"No evolution snapshots yet."}),(0,a.jsx)("p",{className:"text-sm text-emblem-muted/70 mt-2",children:"Snapshots are created as the stance drifts or shifts frames."})]})]}):(0,a.jsxs)("div",{className:"glass-card p-4 h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-emblem-surface-2",children:[(0,a.jsx)("h3",{className:"m-0 text-emblem-secondary text-base",children:"Evolution Timeline"}),(0,a.jsxs)("span",{className:"text-emblem-muted text-xs",children:[t.length," snapshots"]})]}),s&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-emblem-secondary/10 rounded-lg mb-4 text-sm",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full animate-pulse-glow",style:{backgroundColor:ts[s.frame]||"#00d9ff"}}),(0,a.jsxs)("span",{className:"text-emblem-text",children:["Current: ",s.frame]}),(0,a.jsxs)("span",{className:"ml-auto text-emblem-muted",children:["Drift: ",s.cumulativeDrift]})]}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center overflow-visible py-4 relative",children:(0,a.jsx)("div",{className:"flex gap-3 items-end",children:m.map((e,t)=>{let s=m[t+1],n=s&&e.stance.frame!==s.stance.frame||"frame_shift"===e.trigger,u=r===e.id,x=o===e.id,p=ts[e.stance.frame]||"#00d9ff";return(0,a.jsxs)("div",{className:G("flex flex-col items-center min-w-[60px] cursor-pointer transition-all relative",(x||u)&&"-translate-y-1"),onClick:()=>{i(u?null:e.id),null==l||l(e)},onMouseEnter:()=>c(e.id),onMouseLeave:()=>c(null),children:[u&&(0,a.jsxs)("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 bg-emblem-surface-2 border border-white/10 rounded-lg p-3 min-w-[200px] z-50 mb-2 shadow-xl",children:[(0,a.jsx)("div",{className:"text-xs text-emblem-muted mb-2",children:new Date(e.timestamp).toLocaleString()}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Frame:"}),(0,a.jsx)("span",{style:{color:p},className:"font-medium",children:e.stance.frame}),(0,a.jsx)("span",{className:"text-emblem-muted",children:"Self-Model:"}),(0,a.jsx)("span",{className:"text-emblem-text/80",children:e.stance.selfModel}),(0,a.jsx)("span",{className:"text-emblem-muted",children:"Drift:"}),(0,a.jsx)("span",{className:"text-emblem-text/80",children:e.driftAtSnapshot})]}),(0,a.jsxs)("div",{className:"mt-2 pt-2 border-t border-white/10 grid grid-cols-3 gap-2 text-xs text-emblem-muted",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-emblem-primary font-medium",children:e.stance.sentience.awarenessLevel}),(0,a.jsx)("div",{children:"Aware"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-emblem-primary font-medium",children:e.stance.sentience.autonomyLevel}),(0,a.jsx)("div",{children:"Autonomy"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-emblem-primary font-medium",children:e.stance.sentience.identityStrength}),(0,a.jsx)("div",{children:"Identity"})]})]}),(0,a.jsx)("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[8px] border-t-emblem-surface-2"})]}),(0,a.jsx)("div",{className:"w-8 h-24 bg-emblem-surface-2 rounded overflow-hidden flex flex-col justify-end",children:(0,a.jsx)("div",{className:"w-full transition-all duration-300 rounded-t",style:{height:"".concat(Math.round(e.driftAtSnapshot/d*100),"%"),backgroundColor:p,opacity:x||u?1:.7,boxShadow:u?"0 0 12px ".concat(p):"none"}})}),(0,a.jsx)("div",{className:G("rounded-full my-2 transition-all border-2 border-emblem-surface",n?"w-4 h-4":"w-3 h-3",n&&"shadow-[0_0_10px_currentColor]"),style:{backgroundColor:p,transform:x?"scale(1.3)":"scale(1)",color:p}}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,a.jsx)("span",{className:"text-[0.65rem] text-emblem-muted uppercase",children:ta[e.trigger]}),(0,a.jsx)("span",{className:"text-xs text-emblem-text/80 capitalize",children:e.stance.frame})]})]},e.id)})})}),(0,a.jsxs)("div",{className:"flex gap-6 justify-center mt-4 pt-2 border-t border-emblem-surface-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emblem-muted",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full bg-emblem-secondary shadow-[0_0_6px_currentColor]",style:{color:"#00d9ff"}}),(0,a.jsx)("span",{children:"Major transform"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emblem-muted",children:[(0,a.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-emblem-secondary"}),(0,a.jsx)("span",{children:"Minor drift"})]})]})]})};var tl=s(1360),tr=s(9559);let ti=function(e){let{currentSessionId:t,onSelectSession:s,onNewSession:l}=e,[r,i]=(0,n.useState)([]),[o,c]=(0,n.useState)(!0),[m,d]=(0,n.useState)(null),u=async()=>{try{c(!0);let e=await D();i(e.sessions),d(null)}catch(e){d(e instanceof Error?e.message:"Failed to load sessions")}finally{c(!1)}};(0,n.useEffect)(()=>{u()},[]);let x=async(e,t)=>{if(t.stopPropagation(),confirm("Delete this session?"))try{await T(e),i(r.filter(t=>t.id!==e))}catch(e){console.error("Failed to delete session:",e)}};return o?(0,a.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,a.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,a.jsx)("h3",{className:"text-base font-display gradient-text",children:"Sessions"})}),(0,a.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"Loading sessions..."})]}):m?(0,a.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,a.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,a.jsx)("h3",{className:"text-base font-display gradient-text",children:"Sessions"})}),(0,a.jsx)("div",{className:"text-center py-5 text-emblem-danger text-sm",children:m}),(0,a.jsx)(es,{variant:"outline",size:"sm",onClick:u,className:"mt-3",children:"Retry"})]}):(0,a.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:[(0,a.jsx)("h3",{className:"text-base font-display gradient-text",children:"Sessions"}),(0,a.jsx)(es,{size:"sm",onClick:l,children:"+ New"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto flex flex-col gap-2 scrollbar-styled",children:0===r.length?(0,a.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"No sessions yet"}):r.map(e=>(0,a.jsxs)("div",{className:G("flex justify-between items-center px-3 py-2.5 rounded-lg cursor-pointer transition-all","bg-emblem-surface-2 border border-transparent","hover:bg-emblem-surface hover:border-white/10",e.id===t&&"border-emblem-secondary bg-emblem-secondary/10"),onClick:()=>s(e.id),children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:"font-mono text-xs text-emblem-muted",children:[e.id.slice(0,8),"..."]}),(0,a.jsxs)("div",{className:"flex gap-3 text-[11px]",children:[(0,a.jsx)("span",{className:"font-medium",style:{color:{pragmatic:"#6366f1",existential:"#8b5cf6",poetic:"#ec4899",adversarial:"#f97316",playful:"#22c55e",mythic:"#eab308",systems:"#14b8a6",psychoanalytic:"#a855f7",stoic:"#64748b",absurdist:"#ef4444"}[e.stance.frame]||"#00d9ff"},children:e.stance.frame}),(0,a.jsxs)("span",{className:"text-emblem-muted",children:[e.messageCount," msgs"]})]})]}),(0,a.jsx)("div",{className:"flex items-center",children:e.id!==t&&(0,a.jsx)("button",{className:"w-5 h-5 flex items-center justify-center rounded bg-transparent border border-white/10 text-emblem-muted text-xs cursor-pointer transition-all hover:bg-emblem-danger hover:border-emblem-danger hover:text-white",onClick:t=>x(e.id,t),title:"Delete session",children:(0,a.jsx)(tl.A,{className:"w-3 h-3"})})})]},e.id))}),(0,a.jsxs)(es,{variant:"outline",size:"sm",onClick:u,className:"mt-3",children:[(0,a.jsx)(tr.A,{className:"w-3 h-3 mr-1"}),"Refresh"]})]})},to={episodic:"#6366f1",semantic:"#22c55e",identity:"#f97316"},tc={episodic:"Episodic",semantic:"Semantic",identity:"Identity"},tm=function(e){let{sessionId:t}=e,[s,l]=(0,n.useState)(!0),[r,i]=(0,n.useState)(null),[o,c]=(0,n.useState)("all"),[m,d]=(0,n.useState)(null),[u,x]=(0,n.useState)(null),{memories:p,syncWithServer:h,isLoaded:b}=function(e){let[t,s]=(0,n.useState)([]),[a,l]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e?s(eJ(e)):s([]),l(!0)},[e]);let r=(0,n.useCallback)(t=>{if(!e)return null;let a={id:t.id||"local-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),timestamp:t.timestamp||Date.now(),type:t.type,content:t.content,importance:t.importance,metadata:t.metadata};return s(eG(e,a)),a},[e]),i=(0,n.useCallback)(t=>{if(!e)return!1;let a=eX(e,t);return a&&s(e=>e.filter(e=>e.id!==t)),a},[e]),o=(0,n.useCallback)(t=>{e&&s(function(e,t){let s=eJ(e);if(!t||0===t.length)return s;let a=new Map;for(let e of s)a.set(e.id,e);for(let e of t)a.set(e.id,e);let n=Array.from(a.values());return eH(e,n),n}(e,t.map(e=>({id:e.id,type:e.type,content:e.content,importance:e.importance,timestamp:"number"==typeof e.timestamp?e.timestamp:new Date(e.timestamp).getTime()}))))},[e]),c=(0,n.useCallback)(t=>{e&&(eH(e,t),s(t))},[e]),m=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=[...t];return e.type&&(s=s.filter(t=>t.type===e.type)),void 0!==e.minImportance&&(s=s.filter(t=>t.importance>=e.minImportance)),s.sort((e,t)=>t.timestamp-e.timestamp),e.limit&&(s=s.slice(0,e.limit)),s},[t]);return{memories:t,addMemory:r,deleteMemory:i,syncWithServer:o,saveAllMemories:c,searchMemories:m,isLoaded:a}}(t),f=("all"===o?p:p.filter(e=>e.type===o)).sort((e,t)=>Number(t.timestamp)-Number(e.timestamp)),g=(0,n.useCallback)(async e=>{try{l(!0);let t=await R(e,void 0,500);h(t.memories),x(new Date),i(null)}catch(e){i(e instanceof Error?e.message:"Failed to load memories")}finally{l(!1)}},[h]);return((0,n.useEffect)(()=>{b&&t&&g(t)},[t,b,g]),t)?s?(0,a.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,a.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,a.jsx)("h3",{className:"text-base font-display gradient-text",children:"Memories"})}),(0,a.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"Loading memories..."})]}):r?(0,a.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,a.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,a.jsx)("h3",{className:"text-base font-display gradient-text",children:"Memories"})}),(0,a.jsx)("div",{className:"text-center py-5 text-emblem-danger text-sm",children:r}),(0,a.jsx)(es,{variant:"outline",size:"sm",onClick:()=>t&&g(t),className:"mt-3",children:"Retry"})]}):(0,a.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:[(0,a.jsx)("h3",{className:"text-base font-display gradient-text",children:"Memories"}),(0,a.jsxs)("span",{className:"text-xs text-emblem-muted flex items-center gap-2",children:[f.length," total",u&&(0,a.jsxs)("span",{className:"flex items-center gap-1 opacity-60 text-[10px]",children:[(0,a.jsx)(eR.A,{className:"w-3 h-3"}),"synced"]})]})]}),(0,a.jsx)("div",{className:"flex gap-2 mb-3 flex-wrap",children:["all","episodic","semantic","identity"].map(e=>(0,a.jsx)("button",{className:G("px-2.5 py-1 text-[11px] rounded border cursor-pointer transition-all","bg-emblem-surface-2 text-emblem-muted",o===e?"border-emblem-secondary text-emblem-text bg-emblem-surface":"border-white/10 hover:bg-emblem-surface hover:text-emblem-text"),onClick:()=>c(e),style:"all"!==e&&o===e?{borderColor:to[e]}:void 0,children:"all"===e?"All":tc[e]},e))}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto flex flex-col gap-2 scrollbar-styled",children:0===f.length?(0,a.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"No memories stored yet"}):f.map(e=>{var t;return(0,a.jsxs)("div",{className:G("px-3 py-2.5 rounded-lg cursor-pointer transition-all","bg-emblem-surface-2 border border-transparent","hover:bg-emblem-surface hover:border-white/10",m===e.id&&"border-emblem-secondary"),onClick:()=>d(m===e.id?null:e.id),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-[10px] font-medium uppercase text-white",style:{backgroundColor:to[e.type]},children:tc[e.type]}),(0,a.jsxs)("span",{className:G("text-[11px] font-medium",(t=e.importance)>=80?"text-emblem-accent":t>=50?"text-emblem-warning":"text-emblem-muted"),children:[e.importance,"%"]})]}),(0,a.jsx)("div",{className:"text-[13px] leading-relaxed text-emblem-muted",children:m===e.id?e.content:e.content.slice(0,100)+(e.content.length>100?"...":"")}),m===e.id&&(0,a.jsxs)("div",{className:"flex justify-between mt-2 pt-2 border-t border-white/5 text-[11px] text-emblem-muted",children:[(0,a.jsxs)("span",{children:["ID: ",e.id.slice(0,8),"..."]}),(0,a.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]})]},e.id)})}),(0,a.jsxs)(es,{variant:"outline",size:"sm",onClick:()=>t&&g(t),className:"mt-3",children:[(0,a.jsx)(tr.A,{className:"w-3 h-3 mr-1"}),"Refresh"]})]}):(0,a.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,a.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,a.jsx)("h3",{className:"text-base font-display gradient-text",children:"Memories"})}),(0,a.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"No session selected"})]})};var td=s(3457),tu=s(2529),tx=s(7828),tp=s(2448),th=s(9362);let tb=!1,tf="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model";async function tg(){if(tb)return!0;try{return console.log("[FaceAPI] Loading models from CDN..."),await Promise.all([th.B0.tinyFaceDetector.loadFromUri(tf),th.B0.faceExpressionNet.loadFromUri(tf)]),tb=!0,console.log("[FaceAPI] Models loaded successfully"),!0}catch(e){return console.error("[FaceAPI] Failed to load models:",e),!1}}async function ty(e){if(!tb)return console.warn("[FaceAPI] Models not loaded"),null;try{let t=await th.PG(e,new th.ex).withFaceExpressions();if(!t)return null;let s=t.expressions,a=0,n="neutral";for(let[e,t]of Object.entries(s))t>a&&(a=t,n=e);return{currentEmotion:n,expressions:s,confidence:a}}catch(e){return console.error("[FaceAPI] Detection error:",e),null}}let tv="metamorph:emotions:";class tj{get sessionId(){return this._sessionId}set sessionId(e){this._sessionId=e}addReading(e){let t={...e,timestamp:Date.now()};this.readings.push(t),this.pruneOldReadings(),this.schedulePersistence()}schedulePersistence(){if(!this._sessionId)return;let e=Date.now()-this.lastPersistTime;this.persistTimeout||(e>=5e3?this.persistToStorage():this.persistTimeout=setTimeout(()=>{this.persistTimeout=null,this.persistToStorage()},5e3-e))}pruneOldReadings(){let e=Date.now()-this.windowMs;this.readings=this.readings.filter(t=>t.timestamp>e),this.readings.length>this.maxSamples&&(this.readings=this.readings.slice(-this.maxSamples))}getAggregate(){if(this.pruneOldReadings(),0===this.readings.length)return null;let e=Date.now(),t=this.average(this.readings.map(e=>e.valence)),s=this.average(this.readings.map(e=>e.arousal)),a=this.average(this.readings.map(e=>e.confidence)),n=this.findDominantEmotion(),l=this.calculateStability(),r=this.calculateTrend(),i=this.calculateEmpathyBoost(t,l),o=this.generatePromptContext(n,t,s,l,r),c=e-this.readings[0].timestamp;return{avgValence:t,avgArousal:s,avgConfidence:a,dominantEmotion:n,stability:l,trend:r,sampleCount:this.readings.length,windowMs:this.windowMs,oldestSampleAge:c,promptContext:o,suggestedEmpathyBoost:i}}getLatest(){return 0===this.readings.length?null:this.readings[this.readings.length-1]}clear(){this.readings=[]}persistToStorage(){if(!this._sessionId||!eU())return!1;try{let e="".concat(tv).concat(this._sessionId),t={sessionId:this._sessionId,readings:this.readings,lastAggregate:this.getAggregate(),savedAt:new Date().toISOString()},s=eV(e,t);return s&&(this.lastPersistTime=Date.now()),s}catch(e){return!1}}loadFromStorage(e){if(!eU())return!1;this.cleanupOldEntries();try{let t="".concat(tv).concat(e),s=eq(t,null);if(!s)return!1;let a=new Date(s.savedAt).getTime();if(Date.now()-a>864e5)return eB(t),!1;return this._sessionId=e,this.readings=s.readings||[],this.pruneOldReadings(),!0}catch(e){return!1}}cleanupOldEntries(){if(eU())try{let e=function(e){if(!eU())return[];let t=[];for(let s=0;s<window.localStorage.length;s++){let a=window.localStorage.key(s);a&&a.startsWith(e)&&t.push(a)}return t}(tv),t=Date.now();for(let s of e){let e=eq(s,null);if(e){let a=new Date(e.savedAt).getTime();t-a>864e5&&eB(s)}}}catch(e){}}clearPersistedData(){if(!this._sessionId||!eU())return!1;try{let e="".concat(tv).concat(this._sessionId);return eB(e)}catch(e){return!1}}get count(){return this.pruneOldReadings(),this.readings.length}average(e){return 0===e.length?0:e.reduce((e,t)=>e+t,0)/e.length}findDominantEmotion(){let e={};for(let t of this.readings)e[t.currentEmotion]=(e[t.currentEmotion]||0)+1;let t="neutral",s=0;for(let[a,n]of Object.entries(e))n>s&&(s=n,t=a);return t}calculateStability(){if(this.readings.length<2)return 1;let e=this.readings.map(e=>e.valence),t=this.average(e);return Math.max(0,Math.min(1,1-Math.sqrt(e.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.length)))}calculateTrend(){if(this.readings.length<4)return"stable";let e=Math.floor(this.readings.length/2),t=this.readings.slice(0,e),s=this.readings.slice(e),a=this.average(t.map(e=>e.valence)),n=this.average(s.map(e=>e.valence))-a;return n>.15?"improving":n<-.15?"declining":"stable"}calculateEmpathyBoost(e,t){return e>=0?0:Math.round(Math.min(20,15*Math.abs(e)*(1+(1-t)*.5)))}generatePromptContext(e,t,s,a,n){let l=[];return l.push("The user appears ".concat(e," with a ").concat(t>.3?"positive":t<-.3?"negative":"neutral"," emotional state.")),l.push("They seem ".concat(s>.7?"highly activated":s<.3?"calm":"moderately engaged",".")),a<.4?l.push("Their emotional state has been fluctuating."):a>.8&&l.push("Their emotional state has been consistent."),"improving"===n?l.push("Their mood appears to be improving."):"declining"===n&&l.push("Their mood appears to be declining - consider responding with extra care."),l.join(" ")}setWindowMs(e){this.windowMs=e,this.pruneOldReadings()}setMaxSamples(e){this.maxSamples=e,this.pruneOldReadings()}constructor(e){var t,s;this.readings=[],this._sessionId=null,this.persistTimeout=null,this.lastPersistTime=0,this.lastAggregateTime=0,this.windowMs=null!=(t=null==e?void 0:e.windowMs)?t:3e4,this.maxSamples=null!=(s=null==e?void 0:e.maxSamples)?s:60}}new tj;let tN={manifest:{id:"emotion-detection",name:"Emotion Detection",version:"1.0.0",description:"Real-time emotion detection and empathy enhancement",author:"METAMORPH",license:"MIT",metamorphVersion:"0.1.0",capabilities:["webcam","vision","storage"],permissions:["emotion:read","emotion:write","config:read"]},panel:{id:"empathy",label:"Empathy",icon:td.A,component:function(e){var t,s,i,c,d,u,x;let{sessionId:p,config:h,emotionContext:b,capabilities:f,onEmotionUpdate:g}=e,[y,v]=(0,n.useState)({mode:"off",detectionInterval:1e3,minConfidence:.5,isLoading:!1,error:null,modelsLoaded:!1}),[j,N]=(0,n.useState)(b),[w,S]=(0,n.useState)(!1),C=(0,n.useRef)(null),k=(0,n.useRef)(null),E=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=new tj;return p&&(e.sessionId=p),E.current=e,()=>{E.current=null}},[p]),(0,n.useEffect)(()=>{b&&N(b)},[b]);let M=(0,n.useCallback)(async()=>{if(y.modelsLoaded)return!0;v(e=>({...e,isLoading:!0,error:null}));try{let e=await tg();return v(t=>({...t,modelsLoaded:e,isLoading:!1})),e}catch(e){return v(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"Failed to load models"})),!1}},[y.modelsLoaded]),A=(0,n.useCallback)(async()=>{if(f.webcam)try{let e=await f.webcam.start();C.current&&(C.current.srcObject=e,await C.current.play()),v(e=>({...e,error:null}))}catch(e){v(t=>({...t,error:e instanceof Error?e.message:"Failed to start webcam"}))}},[f.webcam]),O=(0,n.useCallback)(()=>{f.webcam&&f.webcam.stop(),C.current&&(C.current.srcObject=null)},[f.webcam]),I=(0,n.useCallback)(async()=>{if(C.current&&y.modelsLoaded)try{let e=await ty(C.current);if(e&&e.confidence>=y.minConfidence){let t=function(e){let t=(e.happy||0)+.5*(e.surprised||0);return Math.max(-1,Math.min(1,t-((e.sad||0)+(e.angry||0)+(e.fearful||0)+(e.disgusted||0))))}(e.expressions),s=function(e){let t=(e.surprised||0)+(e.angry||0)+(e.fearful||0);return Math.max(0,Math.min(1,.5+.5*t-.3*((e.sad||0)+(e.neutral||0))))}(e.expressions),a={currentEmotion:e.currentEmotion,valence:t,arousal:s,confidence:e.confidence,stability:1-s,promptContext:"User appears ".concat(e.currentEmotion," (valence: ").concat(t.toFixed(2),", arousal: ").concat(s.toFixed(2),")"),suggestedEmpathyBoost:0>Math.abs(t)?Math.round(15*Math.abs(t)):0};if(E.current){E.current.addReading({currentEmotion:a.currentEmotion,valence:a.valence,arousal:a.arousal,confidence:a.confidence});let e=E.current.getAggregate();e&&(a.stability=e.stability,a.suggestedEmpathyBoost=e.suggestedEmpathyBoost,a.promptContext=e.promptContext)}N(a),null==g||g(a)}}catch(e){console.error("[EmotionPanel] Detection error:",e)}},[y.modelsLoaded,y.minConfidence,g]),P=(0,n.useCallback)(async()=>{if(f.vision&&f.webcam&&f.vision.canAnalyze)try{let e=await f.webcam.captureFrame();if(!e)return;let t=await f.vision.analyzeEmotion(e);N(t),null==g||g(t)}catch(e){console.error("[EmotionPanel] AI detection error:",e)}},[f.vision,f.webcam,g]);(0,n.useEffect)(()=>{if("off"===y.mode){k.current&&(clearInterval(k.current),k.current=null),O();return}return A(),"browser"===y.mode&&M(),k.current=setInterval("browser"===y.mode?I:P,y.detectionInterval),()=>{k.current&&clearInterval(k.current)}},[y.mode,y.detectionInterval,A,O,M,I,P]);let D=e=>{v(t=>({...t,mode:t.mode===e?"off":e}))},T=null!=(d=null==h?void 0:h.enableEmpathyMode)&&d;return(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-display font-bold gradient-text",children:"Emotion Detection"}),(0,a.jsx)("button",{onClick:()=>S(!w),className:G("p-1.5 rounded transition-colors",w?"bg-emblem-primary/20 text-emblem-primary":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),children:(0,a.jsx)(o.A,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:["off"!==y.mode?(0,a.jsx)(tu.A,{className:"w-3.5 h-3.5 text-emblem-accent"}):(0,a.jsx)(Y.A,{className:"w-3.5 h-3.5 text-emblem-muted"}),(0,a.jsx)("span",{className:"text-emblem-muted",children:"off"===y.mode?"Detection disabled":"browser"===y.mode?"Browser detection active":"AI detection active"})]}),y.error&&(0,a.jsx)("div",{className:"px-3 py-2 bg-emblem-danger/10 border border-emblem-danger/20 rounded-lg text-xs text-emblem-danger",children:y.error}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>D("browser"),className:G("flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all","browser"===y.mode?"bg-emblem-primary/20 text-emblem-primary border border-emblem-primary/30":"bg-emblem-surface-2 text-emblem-muted border border-white/5 hover:text-emblem-text"),children:[(0,a.jsx)(tx.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Browser"})]}),(0,a.jsxs)("button",{onClick:()=>D("ai"),disabled:!(null==(t=f.vision)?void 0:t.canAnalyze),className:G("flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-all","ai"===y.mode?"bg-emblem-secondary/20 text-emblem-secondary border border-emblem-secondary/30":"bg-emblem-surface-2 text-emblem-muted border border-white/5 hover:text-emblem-text",!(null==(s=f.vision)?void 0:s.canAnalyze)&&"opacity-50 cursor-not-allowed"),title:(null==(i=f.vision)?void 0:i.canAnalyze)?void 0:"Cooldown: ".concat(null==(c=f.vision)?void 0:c.cooldownRemaining,"s"),children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"AI Vision"})]})]}),(0,a.jsxs)("div",{className:"relative aspect-video bg-emblem-surface rounded-lg overflow-hidden",children:[(0,a.jsx)("video",{ref:C,autoPlay:!0,playsInline:!0,muted:!0,className:G("absolute inset-0 w-full h-full object-cover","off"===y.mode&&"hidden")}),"off"===y.mode&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-emblem-muted",children:(0,a.jsx)(tp.A,{className:"w-8 h-8"})}),y.isLoading&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:(0,a.jsx)(tr.A,{className:"w-6 h-6 text-emblem-secondary animate-spin"})})]}),(0,a.jsx)(l.N,{mode:"wait",children:j&&(0,a.jsxs)(r.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"glass-card p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-lg font-display font-bold text-emblem-text capitalize",children:j.currentEmotion}),(0,a.jsxs)("span",{className:"text-sm text-emblem-muted",children:[Math.round(100*j.confidence),"% confident"]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-emblem-muted",children:[(0,a.jsx)("span",{children:"Valence"}),(0,a.jsx)("span",{children:(u=j.valence)>.3?"Positive":u<-.3?"Negative":"Neutral"})]}),(0,a.jsxs)("div",{className:"h-2 bg-emblem-surface rounded-full relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-1/2 w-0.5 bg-white/20"}),(0,a.jsx)(r.P.div,{className:G("absolute h-full rounded-full",j.valence>=0?"left-1/2 bg-gradient-to-r from-emblem-secondary to-emblem-accent":"right-1/2 bg-gradient-to-l from-emblem-secondary to-emblem-danger"),initial:{width:0},animate:{width:"".concat(50*Math.abs(j.valence),"%")},transition:{type:"spring",stiffness:300,damping:30}})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-emblem-muted",children:[(0,a.jsx)("span",{children:"Arousal"}),(0,a.jsx)("span",{children:(x=j.arousal)>.6?"High":x<.4?"Low":"Moderate"})]}),(0,a.jsx)("div",{className:"h-2 bg-emblem-surface rounded-full overflow-hidden",children:(0,a.jsx)(r.P.div,{className:"h-full bg-gradient-to-r from-emblem-primary to-emblem-secondary rounded-full",initial:{width:0},animate:{width:"".concat(100*j.arousal,"%")},transition:{type:"spring",stiffness:300,damping:30}})})]}),void 0!==j.suggestedEmpathyBoost&&j.suggestedEmpathyBoost>0&&(0,a.jsx)("div",{className:"pt-2 border-t border-white/5",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Suggested Empathy Boost"}),(0,a.jsxs)("span",{className:"text-emblem-accent font-medium",children:["+",j.suggestedEmpathyBoost,"%"]})]})})]},j.currentEmotion)}),(0,a.jsx)(l.N,{children:w&&(0,a.jsx)(r.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:(0,a.jsxs)("div",{className:"glass-card p-4 space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-emblem-text",children:"Settings"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-emblem-muted",children:[(0,a.jsx)("span",{children:"Detection Interval"}),(0,a.jsxs)("span",{children:[y.detectionInterval,"ms"]})]}),(0,a.jsx)(er,{value:[y.detectionInterval],min:100,max:5e3,step:100,onValueChange:e=>{let[t]=e;return v(e=>({...e,detectionInterval:t}))}})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-emblem-muted",children:[(0,a.jsx)("span",{children:"Min Confidence"}),(0,a.jsxs)("span",{children:[Math.round(100*y.minConfidence),"%"]})]}),(0,a.jsx)(er,{value:[y.minConfidence],min:0,max:1,step:.05,onValueChange:e=>{let[t]=e;return v(e=>({...e,minConfidence:t}))}})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Empathy Mode"}),(0,a.jsx)("span",{className:T?"text-emblem-accent":"text-emblem-muted",children:T?"Enabled":"Disabled"})]})]})})})]})},order:3,defaultEnabled:!0},commands:[{name:"emotion",aliases:["empathy"],description:"Control emotion detection (on/off)",usage:"/emotion <on|off>",agentInvocable:!0,execute:async(e,t)=>{var s;let a=null==(s=e[0])?void 0:s.toLowerCase();if("on"===a)try{return await t.capabilities.webcam.start(),console.log("[EmotionPlugin] Emotion detection enabled via command"),{success:!0,message:"Emotion detection enabled. Webcam started."}}catch(t){let e=t instanceof Error?t.message:"Unknown error";return console.error("[EmotionPlugin] Failed to start webcam:",e),{success:!1,message:"Failed to enable emotion detection: ".concat(e)}}return"off"===a?(t.capabilities.webcam.stop(),console.log("[EmotionPlugin] Emotion detection disabled via command"),{success:!0,message:"Emotion detection disabled. Webcam stopped."}):{success:!1,message:"Usage: /emotion <on|off>"}}}],onActivate:async e=>{console.log("[EmotionPlugin] Activated")},onDeactivate:async()=>{console.log("[EmotionPlugin] Deactivated")},onEmotionDetected:e=>{e.confidence>.7&&console.log("[EmotionPlugin] High-confidence emotion: ".concat(e.currentEmotion," (").concat(Math.round(100*e.confidence),"%)"))}};var tw=s(7650),tS=s(7909),tC=s(5299),tk=s(6140),tE=s(5710),tM=s(6651),tA=s(7354),tO=s(9332),tI=s(5740);let tP={mode:"spatial",autoClustering:!0,clusterCount:5,showConnections:!0,connectionThreshold:.7,animationSpeed:.5,camera:{distance:50,autoRotate:!1,rotationSpeed:.5},filters:{showEpisodic:!0,showSemantic:!0,showIdentity:!0,minImportance:0}},tD={mode:"auto",serverEndpoint:"/api/embeddings",localModel:"Xenova/all-MiniLM-L6-v2"},tT=null,tR=null,tL=null;class tF extends Error{constructor(e,t,s){super(e),this.code=t,this.details=s,this.name="EmbeddingError"}}async function tz(){if(tT)return tT;if(tL)throw tL;return tR||(tR=(async()=>{try{console.log("[Embeddings] Loading local model...");let{pipeline:e,env:t}=await Promise.all([s.e(542),s.e(538),s.e(2),s.e(4),s.e(469)]).then(s.bind(s,2510));t.allowLocalModels=!1,t.useBrowserCache=!0;let a=await e("feature-extraction",tD.localModel,{quantized:!0});return console.log("[Embeddings] Local model loaded"),a}catch(e){throw console.error("[Embeddings] Failed to load local model:",e),tL=e instanceof Error?e:Error(String(e))}})()),tT=await tR}async function t_(e){let t=await tz();return Array.from((await t(e,{pooling:"mean",normalize:!0})).data)}async function tU(e){let t=[];for(let s of e)t.push(await t_(s));return t}async function tq(e){let t=await fetch(tD.serverEndpoint||"/api/embeddings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok)throw new tF(s.error||"API request failed","API_ERROR",{status:t.status,...s});return s}async function tV(e){return(await tq({action:"embedBatch",texts:e})).embeddings}async function tB(e){if(!Array.isArray(e)||0===e.length)throw new tF("Texts must be a non-empty array of strings","VALIDATION_ERROR");if(!e.every(e=>"string"==typeof e))throw new tF("All items in texts array must be strings","VALIDATION_ERROR");let{mode:t}=tD;if("local"===t)return tU(e);if("server"===t)return tV(e);try{return await tV(e)}catch(t){console.warn("[Embeddings] Server failed, trying local:",t);try{return await tU(e)}catch(e){throw new tF("Both server and local embeddings failed","COMPUTATION_ERROR",{serverError:t,localError:e})}}}let tW=function(){let e=[],t=[42,137,256];for(let s=0;s<3;s++){let a=function(e){return function(){return(e=0x41c64e6d*e+12345&0x7fffffff)/0x7fffffff}}(t[s]),n=[],l=0;for(let e=0;e<1536;e++){let e=Math.sqrt(-2*Math.log(a()||1e-4))*Math.cos(2*Math.PI*a());n.push(e),l+=e*e}let r=Math.sqrt(l);for(let e=0;e<1536;e++)n[e]/=r;e.push(n)}return e}(),tH=(0,tS.default)(()=>Promise.resolve().then(s.bind(s,5566)).then(e=>e.default),{loadableGenerated:{webpack:()=>[5566]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-emblem-bg",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,a.jsx)(tC.A,{className:"w-8 h-8 text-emblem-primary animate-spin"}),(0,a.jsx)("span",{className:"text-emblem-muted text-sm",children:"Loading 3D..."})]})})});s(5566);let tJ={manifest:{id:"memory-explorer",name:"Memory Explorer",version:"1.0.0",description:"3D visualization and exploration of the memory system",author:"METAMORPH",license:"MIT",metamorphVersion:"0.1.0",capabilities:["storage","fullscreen"],permissions:["memory:read","memory:write"]},panel:{id:"memory-explorer",label:"3D Memories",icon:m.A,component:function(e){let{sessionId:t,config:s,capabilities:d}=e,[u,x]=(0,n.useState)(tP),[p,b]=(0,n.useState)(!1),[f,g]=(0,n.useState)(""),[y,v]=(0,n.useState)(!1),[j,N]=(0,n.useState)([]),[w,S]=(0,n.useState)([]),[C,k]=(0,n.useState)([]),[E,M]=(0,n.useState)([]),[A,O]=(0,n.useState)(null),[I,P]=(0,n.useState)(null),[D,T]=(0,n.useState)(null),[R,L]=(0,n.useState)({total:0,episodic:0,semantic:0,identity:0}),[F,z]=(0,n.useState)(!1),[_,U]=(0,n.useState)(!1),[q,V]=(0,n.useState)(null),[B,W]=(0,n.useState)(!1);(0,n.useEffect)(()=>{H()},[t]);let H=(0,n.useCallback)(async()=>{if(d.memory){z(!0),V(null);try{let e=await d.memory.getMemories({});S(e);let t={total:e.length,episodic:e.filter(e=>"episodic"===e.type).length,semantic:e.filter(e=>"semantic"===e.type).length,identity:e.filter(e=>"identity"===e.type).length};L(t)}catch(e){V(e instanceof Error?e.message:"Failed to load memories")}finally{z(!1)}}},[d.memory]),J=(0,n.useCallback)(async()=>{if(0!==w.length){U(!0),V(null);try{let e=w.map(e=>e.content),t=await tB(e),s=function(e){if(!Array.isArray(e)||0===e.length)throw new tF("Embeddings must be a non-empty array","VALIDATION_ERROR");let t=e[0].length,s=t<=384?tW.map(e=>e.slice(0,t)):tW,a=[],n=1/0,l=-1/0,r=1/0,i=-1/0,o=1/0,c=-1/0;for(let m of e){let e=0,d=0,u=0,x=Math.min(t,s[0].length);for(let t=0;t<x;t++)e+=m[t]*s[0][t],d+=m[t]*s[1][t],u+=m[t]*s[2][t];a.push([e,d,u]),n=Math.min(n,e),l=Math.max(l,e),r=Math.min(r,d),i=Math.max(i,d),o=Math.min(o,u),c=Math.max(c,u)}let m=l-n||1,d=i-r||1,u=c-o||1;return a.map(e=>{let[t,s,a]=e;return{x:(t-n)/m*2-1,y:(s-r)/d*2-1,z:(a-o)/u*2-1}})}(t),a=w.map((e,a)=>{var n;return{id:e.id,type:e.type,content:e.content,importance:null!=(n=e.importance)?n:.5,position:{x:25*s[a].x,y:25*s[a].y,z:25*s[a].z},embedding:t[a]}});if(k(a),u.showConnections&&t.length>1){let e=[];for(let s=0;s<t.length;s++)for(let a=s+1;a<t.length;a++){let n=function(e,t){let s=0,a=0,n=0;for(let l=0;l<e.length;l++)s+=e[l]*t[l],a+=e[l]*e[l],n+=t[l]*t[l];let l=Math.sqrt(a)*Math.sqrt(n);return 0===l?0:s/l}(t[s],t[a]);n>=u.connectionThreshold&&e.push({from:w[s].id,to:w[a].id,strength:n})}M(e)}}catch(e){console.error("[MemoryExplorer] Embedding computation error:",e),V(e instanceof Error?e.message:"Failed to compute embeddings")}finally{U(!1)}}},[w,u.showConnections,u.connectionThreshold]),X=(0,n.useCallback)(async()=>{if(!d.memory||!f.trim())return void N([]);v(!0);try{let e=await d.memory.searchMemories(f,{limit:10});N(e)}catch(e){console.error("[MemoryExplorer] Search error:",e)}finally{v(!1)}},[d.memory,f]),Q=async()=>{0===C.length&&w.length>0&&await J(),W(!0)},K=(0,n.useCallback)(e=>{P(e),O(w.find(t=>t.id===e)||null)},[w]),Z=(0,n.useCallback)(e=>{T(e)},[]);(0,n.useMemo)(()=>D&&w.find(e=>e.id===D)||null,[D,w]);let $={spatial:tk.A,temporal:c.A,hybrid:i.A},ee=(0,n.useMemo)(()=>C.filter(e=>!(e.importance<u.filters.minImportance)&&("episodic"!==e.type||!!u.filters.showEpisodic)&&("semantic"!==e.type||!!u.filters.showSemantic)&&("identity"!==e.type||!!u.filters.showIdentity)),[C,u.filters]);return(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-display font-bold gradient-text",children:"Memory Explorer"}),(0,a.jsx)("button",{onClick:()=>b(!p),className:G("p-1.5 rounded transition-colors",p?"bg-emblem-primary/20 text-emblem-primary":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),children:(0,a.jsx)(o.A,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[R.total>0?(0,a.jsx)(tu.A,{className:"w-3.5 h-3.5 text-emblem-accent"}):(0,a.jsx)(Y.A,{className:"w-3.5 h-3.5 text-emblem-muted"}),(0,a.jsx)("span",{className:"text-emblem-muted",children:R.total>0?"".concat(R.total," memories loaded"):"No memories found"}),(0,a.jsx)("button",{onClick:H,disabled:F,className:"ml-auto p-1 text-emblem-muted hover:text-emblem-text transition-colors",children:(0,a.jsx)(tr.A,{className:G("w-3 h-3",F&&"animate-spin")})})]}),q&&(0,a.jsx)("div",{className:"px-3 py-2 bg-emblem-danger/10 border border-emblem-danger/20 rounded-lg text-xs text-emblem-danger",children:q}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("span",{className:"text-xs text-emblem-muted",children:"Visualization Mode"}),(0,a.jsx)("div",{className:"flex gap-2",children:["spatial","temporal","hybrid"].map(e=>{let t=$[e];return(0,a.jsxs)("button",{onClick:()=>{x(t=>({...t,mode:e}))},className:G("flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-xs font-medium transition-all capitalize",u.mode===e?"bg-emblem-primary/20 text-emblem-primary border border-emblem-primary/30":"bg-emblem-surface-2 text-emblem-muted border border-white/5 hover:text-emblem-text"),children:[(0,a.jsx)(t,{className:"w-3.5 h-3.5"}),(0,a.jsx)("span",{children:e})]},e)})})]}),(0,a.jsxs)("div",{className:"glass-card p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-emblem-text",children:[(0,a.jsx)(tE.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Memory Statistics"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{className:"text-center p-2 bg-emblem-surface rounded-lg",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-emblem-accent",children:R.episodic}),(0,a.jsx)("div",{className:"text-xs text-emblem-muted",children:"Episodic"})]}),(0,a.jsxs)("div",{className:"text-center p-2 bg-emblem-surface rounded-lg",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-emblem-secondary",children:R.semantic}),(0,a.jsx)("div",{className:"text-xs text-emblem-muted",children:"Semantic"})]}),(0,a.jsxs)("div",{className:"text-center p-2 bg-emblem-surface rounded-lg",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-emblem-primary",children:R.identity}),(0,a.jsx)("div",{className:"text-xs text-emblem-muted",children:"Identity"})]})]})]}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),X()},className:"space-y-2",children:[(0,a.jsx)("span",{className:"text-xs text-emblem-muted",children:"Semantic Search"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",value:f,onChange:e=>{g(e.target.value)},placeholder:"Search memories by meaning...",className:"w-full px-3 py-2 pl-9 bg-emblem-surface-2 border border-white/5 rounded-lg text-sm text-emblem-text placeholder:text-emblem-muted focus:outline-none focus:border-emblem-primary/30"}),(0,a.jsx)(tM.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-emblem-muted"}),y&&(0,a.jsx)(tr.A,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-emblem-muted animate-spin"})]})]}),(0,a.jsx)(l.N,{children:j.length>0&&(0,a.jsxs)(r.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[(0,a.jsxs)("span",{className:"text-xs text-emblem-muted",children:[j.length," results"]}),(0,a.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1",children:j.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"px-3 py-2 bg-emblem-surface-2 rounded-lg text-xs text-emblem-text truncate",children:[(0,a.jsx)("span",{className:G("inline-block w-2 h-2 rounded-full mr-2","episodic"===e.type&&"bg-emblem-accent","semantic"===e.type&&"bg-emblem-secondary","identity"===e.type&&"bg-emblem-primary")}),e.content]},e.id))})]})}),(0,a.jsx)(es,{onClick:Q,disabled:0===R.total||_,className:"w-full flex items-center justify-center gap-2",children:_?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tC.A,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Computing Embeddings..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tA.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Launch Explorer"})]})}),(0,a.jsx)(l.N,{children:p&&(0,a.jsx)(r.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:(0,a.jsxs)("div",{className:"glass-card p-4 space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-emblem-text",children:"Settings"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emblem-muted",children:[(0,a.jsx)(tO.A,{className:"w-3.5 h-3.5"}),(0,a.jsx)("span",{children:"Auto-Clustering"})]}),(0,a.jsx)("button",{onClick:()=>x(e=>({...e,autoClustering:!e.autoClustering})),className:G("w-10 h-5 rounded-full transition-colors relative",u.autoClustering?"bg-emblem-primary":"bg-emblem-surface"),children:(0,a.jsx)("div",{className:G("absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform",u.autoClustering?"translate-x-5":"translate-x-0.5")})})]}),u.autoClustering&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-emblem-muted",children:[(0,a.jsx)("span",{children:"Cluster Count"}),(0,a.jsx)("span",{children:u.clusterCount})]}),(0,a.jsx)(er,{value:[u.clusterCount],min:2,max:10,step:1,onValueChange:e=>{let[t]=e;return x(e=>({...e,clusterCount:t}))}})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emblem-muted",children:[(0,a.jsx)(tI.A,{className:"w-3.5 h-3.5"}),(0,a.jsx)("span",{children:"Show Connections"})]}),(0,a.jsx)("button",{onClick:()=>x(e=>({...e,showConnections:!e.showConnections})),className:G("w-10 h-5 rounded-full transition-colors relative",u.showConnections?"bg-emblem-primary":"bg-emblem-surface"),children:(0,a.jsx)("div",{className:G("absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform",u.showConnections?"translate-x-5":"translate-x-0.5")})})]}),u.showConnections&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-emblem-muted",children:[(0,a.jsx)("span",{children:"Connection Threshold"}),(0,a.jsxs)("span",{children:[Math.round(100*u.connectionThreshold),"%"]})]}),(0,a.jsx)(er,{value:[u.connectionThreshold],min:.1,max:1,step:.05,onValueChange:e=>{let[t]=e;return x(e=>({...e,connectionThreshold:t}))}})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-emblem-muted",children:[(0,a.jsx)("span",{children:"Min Importance"}),(0,a.jsxs)("span",{children:[Math.round(100*u.filters.minImportance),"%"]})]}),(0,a.jsx)(er,{value:[u.filters.minImportance],min:0,max:1,step:.1,onValueChange:e=>{let[t]=e;return x(e=>({...e,filters:{...e.filters,minImportance:t}}))}})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("span",{className:"text-xs text-emblem-muted",children:"Show Memory Types"}),(0,a.jsx)("div",{className:"flex gap-2",children:["episodic","semantic","identity"].map(e=>(0,a.jsx)("button",{onClick:()=>x(t=>({...t,filters:{...t.filters,["show".concat(e.charAt(0).toUpperCase()+e.slice(1))]:!t.filters["show".concat(e.charAt(0).toUpperCase()+e.slice(1))]}})),className:G("flex-1 px-2 py-1 rounded text-xs capitalize transition-colors",u.filters["show".concat(e.charAt(0).toUpperCase()+e.slice(1))]?"episodic"===e?"bg-emblem-accent/20 text-emblem-accent":"semantic"===e?"bg-emblem-secondary/20 text-emblem-secondary":"bg-emblem-primary/20 text-emblem-primary":"bg-emblem-surface text-emblem-muted"),children:e},e))})]})]})})}),B&&"undefined"!=typeof document&&(0,tw.createPortal)((0,a.jsxs)(r.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] bg-emblem-bg",children:[(0,a.jsx)("button",{onClick:()=>{W(!1),P(null),O(null)},className:"absolute top-4 right-4 z-10 p-2 rounded-lg bg-emblem-surface/80 backdrop-blur-sm text-emblem-text hover:text-emblem-primary hover:bg-emblem-surface transition-colors","aria-label":"Close viewer",children:(0,a.jsx)(h.A,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-3",children:[(0,a.jsx)(m.A,{className:"w-6 h-6 text-emblem-primary"}),(0,a.jsx)("h2",{className:"font-display font-bold text-lg text-emblem-text",children:"Memory Explorer"}),(0,a.jsxs)("span",{className:"text-xs text-emblem-muted px-2 py-1 bg-emblem-surface/80 rounded-full",children:[ee.length," nodes"]})]}),(0,a.jsx)("div",{className:"w-full h-full",children:(0,a.jsx)(tH,{nodes:ee,connections:E,selectedNodeId:I,onNodeClick:K,onNodeHover:Z,showConnections:u.showConnections,autoRotate:C.length>0&&!I})}),(0,a.jsx)(l.N,{children:A&&(0,a.jsx)(r.P.div,{initial:{x:"100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"absolute top-0 right-0 h-full w-80 bg-emblem-bg/95 backdrop-blur-md border-l border-white/10 p-6 pt-16 overflow-y-auto",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:G("px-2 py-1 rounded text-xs font-medium capitalize","episodic"===A.type&&"bg-emblem-accent/20 text-emblem-accent","semantic"===A.type&&"bg-emblem-secondary/20 text-emblem-secondary","identity"===A.type&&"bg-emblem-primary/20 text-emblem-primary"),children:A.type}),A.importance&&(0,a.jsxs)("span",{className:"text-xs text-emblem-muted",children:["Importance: ",Math.round(100*A.importance),"%"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-emblem-text",children:"Content"}),(0,a.jsx)("p",{className:"text-sm text-emblem-muted leading-relaxed",children:A.content})]}),A.metadata&&Object.keys(A.metadata).length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-emblem-text",children:"Metadata"}),(0,a.jsx)("div",{className:"bg-emblem-surface/50 rounded-lg p-3 space-y-1",children:Object.entries(A.metadata).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:t}),(0,a.jsx)("span",{className:"text-emblem-text",children:"object"==typeof s?JSON.stringify(s):String(s)})]},t)})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-emblem-text",children:"Created"}),(0,a.jsx)("p",{className:"text-xs text-emblem-muted",children:new Date(A.timestamp).toLocaleString()})]}),(0,a.jsx)(es,{onClick:()=>{P(null),O(null)},variant:"outline",className:"w-full mt-4",children:"Clear Selection"})]})})}),_&&(0,a.jsx)("div",{className:"absolute inset-0 bg-emblem-bg/80 flex items-center justify-center z-20",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(tC.A,{className:"w-12 h-12 text-emblem-primary animate-spin"}),(0,a.jsx)("p",{className:"text-emblem-text",children:"Computing memory embeddings..."})]})})]}),document.body)]})},order:7,defaultEnabled:!0},commands:[{name:"explore-memories",aliases:["memory-explore","mem-explore"],description:"Launch 3D memory explorer",usage:"/explore-memories",agentInvocable:!0,execute:async(e,t)=>(console.log("[MemoryExplorer] Launching 3D memory explorer via command"),{success:!0,message:"Opening 3D Memory Explorer. Use the panel to interact with the visualization.",data:{action:"launch-explorer"}})},{name:"cluster-memories",aliases:["mem-cluster"],description:"Group memories by similarity",usage:"/cluster-memories [count]",agentInvocable:!0,execute:async(e,t)=>{let s=parseInt(e[0],10)||5;console.log("[MemoryExplorer] Clustering memories into ".concat(s," groups"));try{let e=await t.capabilities.memory.getMemories({});if(0===e.length)return{success:!1,message:"No memories found to cluster."};return{success:!0,message:"Clustering ".concat(e.length," memories into ").concat(s," groups. View results in the Memory Explorer panel."),data:{action:"cluster",memoryCount:e.length,clusterCount:s}}}catch(t){let e=t instanceof Error?t.message:"Unknown error";return{success:!1,message:"Failed to cluster memories: ".concat(e)}}}},{name:"memory-timeline",aliases:["mem-timeline"],description:"View memories on timeline",usage:"/memory-timeline [days]",agentInvocable:!0,execute:async(e,t)=>{let s=parseInt(e[0],10)||7,a=Date.now()-24*s*36e5;console.log("[MemoryExplorer] Generating timeline for last ".concat(s," days"));try{let e=(await t.capabilities.memory.getMemories({})).filter(e=>e.timestamp>=a);if(0===e.length)return{success:!0,message:"No memories found in the last ".concat(s," days."),data:{action:"timeline",count:0,days:s}};let n=new Map;e.forEach(e=>{let t=new Date(e.timestamp).toLocaleDateString();n.set(t,(n.get(t)||0)+1)});let l=Array.from(n.entries()).map(e=>{let[t,s]=e;return"".concat(t,": ").concat(s," memories")}).join(", ");return{success:!0,message:"Timeline for last ".concat(s," days: ").concat(l,". Total: ").concat(e.length," memories."),data:{action:"timeline",count:e.length,days:s,byDay:Object.fromEntries(n)}}}catch(t){let e=t instanceof Error?t.message:"Unknown error";return{success:!1,message:"Failed to generate timeline: ".concat(e)}}}}],onActivate:async e=>{console.log("[MemoryExplorer] Activated");try{let t=await e.memory.getMemories({});console.log("[MemoryExplorer] Found ".concat(t.length," memories in the system"))}catch(e){console.warn("[MemoryExplorer] Could not load initial memory stats:",e)}},onDeactivate:async()=>{console.log("[MemoryExplorer] Deactivated")}};var tG=s(5506),tX=s(906),tQ=s(5704);let tK=new Map;function tY(e){for(let t of e.listeners)t()}var tZ=s(5704);let t$={selectedStream:null,viewMode:"list",autoScroll:!0,showTimestamps:!0,maxEvents:1e3,filterText:""};function t0(e){let{label:t,value:s,max:n,unit:l,color:i="emblem-primary"}=e,o=Math.min(s/n*100,100);return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:t}),(0,a.jsxs)("span",{className:"text-emblem-text",children:[s," ",l]})]}),(0,a.jsx)("div",{className:"h-1.5 bg-emblem-surface rounded-full overflow-hidden",children:(0,a.jsx)(r.P.div,{className:"h-full bg-".concat(i," rounded-full"),initial:{width:0},animate:{width:"".concat(o,"%")},transition:{duration:.3,ease:"easeOut"},style:{backgroundColor:"emblem-primary"===i?"var(--emblem-primary)":i}})})]})}function t1(e){let{event:t,showTimestamp:s,streamMetadata:n}=e,l=t.data;if("server-stats"===(null==n?void 0:n.displayType)||l&&"object"==typeof l&&"uptime"in l&&"memory"in l&&"cpu"in l){let e=l.memory,n=l.cpu,i=l.uptime,o=l.connections;return(0,a.jsxs)(r.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"space-y-3",children:[s&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emblem-muted",children:[(0,a.jsx)(c.A,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:new Date(t.timestamp).toLocaleTimeString()}),t.source&&(0,a.jsx)("span",{className:"px-1.5 py-0.5 bg-emblem-primary/20 text-emblem-primary rounded text-[10px]",children:t.source})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"bg-emblem-surface/30 rounded-lg p-2.5",children:[(0,a.jsx)("div",{className:"text-[10px] text-emblem-muted uppercase tracking-wide",children:"Uptime"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-emblem-text",children:function(e){let t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60;return t>0?"".concat(t,"h ").concat(s,"m ").concat(a,"s"):s>0?"".concat(s,"m ").concat(a,"s"):"".concat(a,"s")}(i)})]}),(0,a.jsxs)("div",{className:"bg-emblem-surface/30 rounded-lg p-2.5",children:[(0,a.jsx)("div",{className:"text-[10px] text-emblem-muted uppercase tracking-wide",children:"Streams"}),(0,a.jsx)("div",{className:"text-lg font-semibold text-emblem-text",children:o})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-[10px] text-emblem-muted uppercase tracking-wide",children:"Memory"}),(0,a.jsx)(t0,{label:"Heap",value:e.heapUsed,max:e.heapTotal,unit:"MB"}),(0,a.jsx)(t0,{label:"RSS",value:e.rss,max:1.5*e.rss,unit:"MB",color:"#22c55e"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-[10px] text-emblem-muted uppercase tracking-wide",children:"CPU Time (ms)"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between bg-emblem-surface/30 rounded px-2 py-1.5",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"User"}),(0,a.jsx)("span",{className:"text-emblem-text font-mono",children:n.user.toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex justify-between bg-emblem-surface/30 rounded px-2 py-1.5",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"System"}),(0,a.jsx)("span",{className:"text-emblem-text font-mono",children:n.system.toLocaleString()})]})]})]})]},t.id)}return(0,a.jsxs)(r.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"space-y-2",children:[s&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emblem-muted",children:[(0,a.jsx)(c.A,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:new Date(t.timestamp).toLocaleTimeString()})]}),"object"==typeof l&&null!==l?(0,a.jsx)("div",{className:"grid gap-1.5",children:Object.entries(l).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex items-start gap-2 text-xs bg-emblem-surface/30 rounded px-2 py-1.5",children:[(0,a.jsxs)("span",{className:"text-emblem-muted shrink-0",children:[t,":"]}),(0,a.jsx)("span",{className:"text-emblem-text font-mono break-all",children:"object"==typeof s?JSON.stringify(s):String(s)})]},t)})}):(0,a.jsx)("div",{className:"text-sm text-emblem-text bg-emblem-surface/30 rounded px-2 py-1.5",children:String(l)})]},t.id)}function t2(e){let{stream:t}=e;return t?(0,a.jsxs)("div",{className:"glass-card p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(tG.A,{className:"w-4 h-4 text-emblem-primary"}),(0,a.jsx)("h4",{className:"text-sm font-medium text-emblem-text",children:t.channel})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Created"}),(0,a.jsx)("p",{className:"text-emblem-text",children:new Date(t.createdAt).toLocaleString()})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Event Count"}),(0,a.jsx)("p",{className:"text-emblem-text",children:t.eventCount})]}),t.lastEventAt&&(0,a.jsxs)("div",{className:"space-y-1 col-span-2",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:"Last Event"}),(0,a.jsx)("p",{className:"text-emblem-text",children:new Date(t.lastEventAt).toLocaleString()})]})]}),t.metadata&&Object.keys(t.metadata).length>0&&(0,a.jsxs)("div",{className:"space-y-2 pt-2 border-t border-white/5",children:[(0,a.jsx)("span",{className:"text-xs text-emblem-muted",children:"Metadata"}),(0,a.jsx)("div",{className:"bg-emblem-surface/50 rounded-lg p-2 space-y-1",children:Object.entries(t.metadata).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-emblem-muted",children:t}),(0,a.jsx)("span",{className:"text-emblem-text truncate max-w-32",children:"object"==typeof s?JSON.stringify(s):String(s)})]},t)})})]})]}):null}let t5={manifest:{id:"streams",name:"Streams",version:"1.0.0",description:"Real-time data streams from agent scripts",author:"METAMORPH",license:"MIT",metamorphVersion:"0.1.0",capabilities:["storage"],permissions:[]},panel:{id:"streams-panel",label:"Streams",icon:tG.A,component:function(e){var t;let{sessionId:s,config:i,capabilities:m,onStreamSelect:d}=e,[u,x]=(0,n.useState)(t$),[p,h]=(0,n.useState)(!1),{connected:b,error:f,events:g,subscribe:y,unsubscribe:v,clear:j}=function(e){let t,{sessionId:s,maxEvents:a=500,autoConnect:l=!0}=e,[r,i]=(0,n.useState)([]),o=(0,n.useRef)(new Set),c=(0,n.useRef)(null);c.current||((t=tK.get(s))||(t={state:{ws:null,connected:!1,error:null,refCount:0,reconnectTimeout:null},listeners:new Set,subscribedChannels:new Set,messageHandlers:new Set},tK.set(s,t)),c.current=t);let m=c.current,d=(0,n.useSyncExternalStore)((0,n.useCallback)(e=>(m.listeners.add(e),()=>{m.listeners.delete(e)}),[m]),()=>m.state,()=>m.state),u=d.connected,x=d.error,p=(0,n.useCallback)(e=>{switch(e.type){case"event":i(t=>[...t,e.event].slice(-a));break;case"history":i(t=>{let s=new Set(t.map(e=>e.id));return[...e.events.filter(e=>!s.has(e.id)),...t].slice(-a)})}},[a]);(0,n.useEffect)(()=>(m.messageHandlers.add(p),()=>{m.messageHandlers.delete(p)}),[m,p]),(0,n.useEffect)(()=>{if(l)return m.state.refCount++,1===m.state.refCount&&function e(t,s){var a,n;if((null==(a=s.state.ws)?void 0:a.readyState)===WebSocket.OPEN||(null==(n=s.state.ws)?void 0:n.readyState)===WebSocket.CONNECTING)return;let l=(tQ.env.NEXT_PUBLIC_API_URL||"http://localhost:3001").replace(/^http/,"ws"),r="".concat(l,"/ws/streams?sessionId=").concat(encodeURIComponent(t));try{let a=new WebSocket(r);s.state.ws=a,a.onopen=()=>{for(let e of(s.state.connected=!0,s.state.error=null,tY(s),s.subscribedChannels))a.send(JSON.stringify({type:"subscribe",channel:e}))},a.onmessage=e=>{try{let t=JSON.parse(e.data);for(let e of s.messageHandlers)e(t)}catch(e){console.error("[StreamConnection] Failed to parse message:",e)}},a.onerror=()=>{s.state.error="WebSocket connection error",tY(s)},a.onclose=()=>{s.state.connected=!1,s.state.ws=null,tY(s),s.state.refCount>0&&(s.state.reconnectTimeout=setTimeout(()=>{e(t,s)},3e3))}}catch(e){s.state.error=e instanceof Error?e.message:"Failed to connect",tY(s)}}(s,m),()=>{m.state.refCount--,0===m.state.refCount&&(m.state.reconnectTimeout&&(clearTimeout(m.state.reconnectTimeout),m.state.reconnectTimeout=null),m.state.ws&&(m.state.ws.close(),m.state.ws=null),m.state.connected=!1,tY(m))}},[s,m,l]);let h=(0,n.useCallback)(e=>{var t;(null==(t=m.state.ws)?void 0:t.readyState)===WebSocket.OPEN&&m.state.ws.send(JSON.stringify(e))},[m]),b=(0,n.useCallback)(e=>{o.current.add(e),m.subscribedChannels.add(e),h({type:"subscribe",channel:e})},[m,h]),f=(0,n.useCallback)(e=>{o.current.delete(e),m.subscribedChannels.delete(e),h({type:"unsubscribe",channel:e})},[m,h]);return{events:r,connected:u,error:x,clear:(0,n.useCallback)(()=>{i([])},[]),subscribe:b,unsubscribe:f}}({sessionId:s||"default",autoConnect:!0,maxEvents:u.maxEvents}),{streams:N,loading:w,error:S,refresh:C}=function(e){let{wsConnection:t}=e,[s,a]=(0,n.useState)([]),[l,r]=(0,n.useState)(!0),[i,o]=(0,n.useState)(null),c=(0,n.useCallback)(async()=>{try{r(!0);let e=tZ.env.NEXT_PUBLIC_API_URL||"http://".concat(window.location.hostname,":3001"),t=await fetch("".concat(e,"/api/streams"));if(!t.ok)throw Error("HTTP ".concat(t.status));let s=await t.json();a(s.streams||[]),o(null)}catch(e){o(e instanceof Error?e.message:"Failed to fetch streams")}finally{r(!1)}},[]);return(0,n.useEffect)(()=>{if(!t)return;let e=e=>{try{let t=JSON.parse(e.data);"stream_list"===t.type?(a(t.streams),r(!1)):"stream_created"===t.type?a(e=>[...e,t.info]):"stream_closed"===t.type&&a(e=>e.filter(e=>e.channel!==t.channel))}catch(e){}};return t.addEventListener("message",e),()=>t.removeEventListener("message",e)},[t]),(0,n.useEffect)(()=>{c()},[c]),{streams:s,loading:l,error:i,refresh:c}}({sessionId:s||"default"}),k=f||S,E=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=E.current,t=u.selectedStream;e&&e!==t&&v(e),t&&t!==e&&y(t),E.current=t},[u.selectedStream,y,v]);let M=(0,n.useCallback)(e=>{let t=u.selectedStream===e?null:e;x(e=>({...e,selectedStream:t})),null==d||d(t)},[u.selectedStream,d]);return(0,n.useEffect)(()=>{let e=setInterval(C,3e4);return()=>clearInterval(e)},[C]),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-display font-bold gradient-text",children:"Streams"}),(0,a.jsx)("button",{onClick:()=>h(!p),className:G("p-1.5 rounded transition-colors",p?"bg-emblem-primary/20 text-emblem-primary":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),children:(0,a.jsx)(o.A,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsx)("div",{className:G("w-2 h-2 rounded-full",b?"bg-emblem-accent":"bg-emblem-danger")}),(0,a.jsx)("span",{className:"text-emblem-muted",children:b?"Connected":"Disconnected"}),(0,a.jsx)("button",{onClick:C,disabled:w,className:"ml-auto p-1 text-emblem-muted hover:text-emblem-text transition-colors",title:"Refresh streams",children:(0,a.jsx)(tr.A,{className:G("w-3 h-3",w&&"animate-spin")})})]}),k&&(0,a.jsx)("div",{className:"px-3 py-2 bg-emblem-danger/10 border border-emblem-danger/20 rounded-lg text-xs text-emblem-danger",children:k}),(0,a.jsxs)("div",{className:"glass-card p-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-emblem-text",children:[(0,a.jsx)(tX.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Active Streams"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-emblem-muted text-xs",children:[(0,a.jsxs)("span",{children:[N.length," stream",1!==N.length?"s":""]}),(0,a.jsxs)("span",{children:[N.reduce((e,t)=>e+t.eventCount,0)," total events"]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("span",{className:"text-xs text-emblem-muted",children:"Available Streams"}),w&&0===N.length?(0,a.jsx)("div",{className:"flex items-center justify-center py-8 text-emblem-muted",children:(0,a.jsx)(tr.A,{className:"w-5 h-5 animate-spin"})}):0===N.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-emblem-muted gap-2",children:[(0,a.jsx)(tG.A,{className:"w-6 h-6 opacity-50"}),(0,a.jsx)("span",{className:"text-xs",children:"No active streams"})]}):(0,a.jsx)("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:(0,a.jsx)(l.N,{children:N.map(e=>(0,a.jsxs)(r.P.button,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},onClick:()=>M(e.channel),className:G("w-full flex items-start gap-3 p-3 rounded-lg text-left transition-all",u.selectedStream===e.channel?"bg-emblem-primary/20 border border-emblem-primary/30":"bg-emblem-surface-2 border border-white/5 hover:border-white/10 hover:bg-emblem-surface"),children:[(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,a.jsx)(tG.A,{className:G("w-4 h-4 mt-0.5",u.selectedStream===e.channel?"text-emblem-primary":"text-emblem-muted")}),(0,a.jsx)("div",{className:G("absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full",b?"bg-emblem-accent":"bg-emblem-danger")})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("span",{className:G("text-sm font-medium truncate",u.selectedStream===e.channel?"text-emblem-primary":"text-emblem-text"),children:e.channel}),(0,a.jsxs)("span",{className:"text-xs text-emblem-muted flex-shrink-0",children:[e.eventCount," events"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs text-emblem-muted",children:[(0,a.jsx)(c.A,{className:"w-3 h-3"}),(0,a.jsxs)("span",{children:["Last: ",(e=>{if(!e)return"Never";let t=new Date(e),s=new Date().getTime()-t.getTime();if(s<6e4)return"Just now";if(s<36e5){let e=Math.floor(s/6e4);return"".concat(e,"m ago")}if(!(s<864e5))return t.toLocaleDateString();{let e=Math.floor(s/36e5);return"".concat(e,"h ago")}})(e.lastEventAt)]})]})]})]},e.channel))})})]}),(0,a.jsx)(l.N,{children:u.selectedStream&&(0,a.jsxs)(r.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden space-y-3",children:[(0,a.jsx)(t2,{stream:N.find(e=>e.channel===u.selectedStream)}),(0,a.jsxs)("div",{className:"glass-card p-3 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-emblem-text",children:[(0,a.jsx)(tX.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Live Events"}),(0,a.jsxs)("span",{className:"text-xs text-emblem-muted",children:["(",g.length,")"]})]}),(0,a.jsx)("button",{onClick:j,className:"text-xs text-emblem-muted hover:text-emblem-text transition-colors",children:"Clear"})]}),(0,a.jsx)("div",{className:"space-y-2",children:0===g.length?(0,a.jsxs)("div",{className:"text-xs text-emblem-muted text-center py-4",children:[(0,a.jsx)(tG.A,{className:"w-5 h-5 mx-auto mb-2 animate-pulse opacity-50"}),"Waiting for events..."]}):(0,a.jsx)(t1,{event:g[g.length-1],showTimestamp:u.showTimestamps,streamMetadata:null==(t=N.find(e=>e.channel===u.selectedStream))?void 0:t.metadata})})]})]})}),(0,a.jsx)(l.N,{children:p&&(0,a.jsx)(r.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:(0,a.jsxs)("div",{className:"glass-card p-4 space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-emblem-text",children:"Settings"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs text-emblem-muted",children:"Auto-scroll to new events"}),(0,a.jsx)("button",{onClick:()=>x(e=>({...e,autoScroll:!e.autoScroll})),className:G("w-10 h-5 rounded-full transition-colors relative",u.autoScroll?"bg-emblem-primary":"bg-emblem-surface"),children:(0,a.jsx)("div",{className:G("absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform",u.autoScroll?"translate-x-5":"translate-x-0.5")})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs text-emblem-muted",children:"Show timestamps"}),(0,a.jsx)("button",{onClick:()=>x(e=>({...e,showTimestamps:!e.showTimestamps})),className:G("w-10 h-5 rounded-full transition-colors relative",u.showTimestamps?"bg-emblem-primary":"bg-emblem-surface"),children:(0,a.jsx)("div",{className:G("absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform",u.showTimestamps?"translate-x-5":"translate-x-0.5")})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-emblem-muted",children:[(0,a.jsx)("span",{children:"Max events in memory"}),(0,a.jsx)("span",{children:u.maxEvents})]}),(0,a.jsx)("input",{type:"range",min:100,max:2e3,step:100,value:u.maxEvents,onChange:e=>x(t=>({...t,maxEvents:parseInt(e.target.value)})),className:"w-full h-2 bg-emblem-surface rounded-full appearance-none cursor-pointer accent-emblem-primary"})]})]})})})]})},order:8,defaultEnabled:!0},commands:[{name:"list-streams",aliases:["streams"],description:"List all available streams",usage:"/list-streams",agentInvocable:!0,execute:async(e,t)=>(console.log("[Streams] Listing available streams"),{success:!0,message:"View available streams in the Streams panel.",data:{action:"list-streams"}})},{name:"subscribe-stream",aliases:["sub-stream"],description:"Subscribe to a stream channel",usage:"/subscribe-stream <channel>",agentInvocable:!0,execute:async(e,t)=>{let s=e[0];return s?(console.log("[Streams] Subscribing to channel: ".concat(s)),{success:!0,message:'Subscribed to channel "'.concat(s,'". View events in the Streams panel.'),data:{action:"subscribe",channel:s}}):{success:!1,message:"Please specify a channel to subscribe to. Usage: /subscribe-stream <channel>"}}}],onActivate:async e=>{console.log("[Streams] Activated")},onDeactivate:async()=>{console.log("[Streams] Deactivated")}},t3=[tN,tJ,t5],t4=[{id:"stance",label:"Stance",icon:i.A},{id:"config",label:"Config",icon:o.A},{id:"timeline",label:"Timeline",icon:c.A},{id:"evolution",label:"Evolution",icon:m.A},{id:"sessions",label:"Sessions",icon:d.A},{id:"memories",label:"Memories",icon:u.A}];function t6(){let[e,t]=(0,n.useState)(),[s,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[m,d]=(0,n.useState)(null),[u,g]=(0,n.useState)([]),[y,v]=(0,n.useState)([]),[j,N]=(0,n.useState)("stance"),[E,M]=(0,n.useState)(null),[A,O]=(0,n.useState)([]),[D,T]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e1.setSessionId(e)},[e]),(0,n.useEffect)(()=>((async()=>{try{for(let e of t3)e1.getPlugin(e.manifest.id)||e1.register(e),await e1.enable(e.manifest.id),console.log("[Plugins] Initialized: ".concat(e.manifest.name));O(e1.getPanels()),T(!0)}catch(e){console.error("[Plugins] Failed to initialize:",e),T(!0)}})(),()=>{for(let e of t3)e1.disable(e.manifest.id).catch(console.error)}),[]);let R=(0,n.useMemo)(()=>{let e=t4.map(e=>({id:e.id,label:e.label,icon:e.icon,isPlugin:!1})),t=A.map(e=>({id:e.id,label:e.label,icon:e.icon,isPlugin:!0,panel:e}));return[...e.slice(0,2),...t,...e.slice(2)]},[A]),[L,F]=(0,n.useState)(!0),[z,_]=(0,n.useState)(320),U=(0,n.useRef)(!1),q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,s]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let t=()=>s(window.innerWidth<e);return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[e]),t}(),[V,B]=(0,n.useState)(!1),[W,H]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=eY();e.activePanel&&N(e.activePanel),void 0!==e.sidebarOpen&&F(e.sidebarOpen),e.sidebarWidth&&_(e.sidebarWidth)},[]);let J=(0,n.useCallback)(()=>{U.current=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]);(0,n.useEffect)(()=>{let e=e=>{U.current&&_(Math.min(500,Math.max(280,e.clientX)))},t=()=>{U.current&&(U.current=!1,document.body.style.cursor="",document.body.style.userSelect="",eK({sidebarWidth:z}))};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",t),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[z]);let X=(0,n.useCallback)(()=>{let e=!L;F(e),eK({sidebarOpen:e})},[L]),Q=(0,n.useCallback)(e=>{N(e),eK({activePanel:e}),q&&(B(!1),H(!0))},[q]),K=(0,n.useCallback)(()=>{H(!1)},[]);(0,n.useEffect)(()=>{},[]),(0,n.useEffect)(()=>{(async()=>{try{let e=eq(e_.LAST_SESSION_ID,null);if(e)try{let s=await S(e);if(s){t(s.sessionId),i(s.stance),c(s.config),d(null);return}}catch(e){console.log("Last session not found on server, creating new session")}let s=await w();t(s.sessionId),i(s.stance),c(s.config),eW(s.sessionId),d(null)}catch(e){d(e instanceof Error?e.message:"Failed to connect to server")}})()},[]);let Y=(0,n.useCallback)(async e=>{try{let[t,s]=await Promise.all([I(e),P(e)]);g(t.entries),v(s.snapshots)}catch(e){console.error("Failed to refresh timeline data:",e)}},[]),Z=async e=>{t(e);try{let t=await C(e);i(t.stance),c(t.config),await Y(e)}catch(e){console.error("Failed to get state:",e)}},$=t=>{i(t.stanceAfter),e&&Y(e)},ee=async t=>{if(e)try{let s=await k(e,t);c(s.config)}catch(e){console.error("Failed to update config:",e)}},et=async()=>{try{let e=await w();t(e.sessionId),i(e.stance),c(e.config),g([]),v([]),eW(e.sessionId),M(null),q&&H(!1)}catch(e){console.error("Failed to create session:",e)}},ea=async e=>{await Z(e),N("stance"),q&&H(!1)};(0,n.useCallback)(e=>{var t;let s=e1.getPlugin(e);return null!=(t=null==s?void 0:s.capabilities)?t:null},[]);let en=()=>{let t=A.find(e=>e.id===j);if(t){var n,l;let r=t.component,c=e1.getPlugin(null!=(l=null==(n=e1.getAllPlugins().find(e=>{var s;return(null==(s=e.plugin.panel)?void 0:s.id)===t.id}))?void 0:n.plugin.manifest.id)?l:"");if(!(null==c?void 0:c.capabilities))return(0,a.jsx)("div",{className:"text-emblem-muted p-4",children:"Plugin not ready"});let m={sessionId:e,stance:s,config:o,emotionContext:E,capabilities:c.capabilities,onStanceUpdate:e=>i(e),onConfigUpdate:ee,onEmotionUpdate:e=>{M(e),e1.emitEmotionDetected(e)}};return(0,a.jsx)(r,{...m})}return(0,a.jsxs)(a.Fragment,{children:["stance"===j&&(0,a.jsx)(e8,{stance:s}),"config"===j&&(0,a.jsx)(e9,{config:o,onUpdate:ee}),"timeline"===j&&(0,a.jsx)(tt,{entries:u}),"evolution"===j&&(0,a.jsx)(tn,{snapshots:y,currentStance:s||void 0}),"sessions"===j&&(0,a.jsx)(ti,{currentSessionId:e,onSelectSession:ea,onNewSession:et}),"memories"===j&&(0,a.jsx)(tm,{sessionId:e})]})};return m?(0,a.jsx)("main",{className:"h-screen max-h-screen flex flex-col overflow-hidden",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 p-12 text-center min-h-screen",children:[(0,a.jsx)("h2",{className:"text-emblem-danger text-xl font-display font-semibold",children:"Connection Error"}),(0,a.jsx)("p",{className:"text-emblem-text",children:m}),(0,a.jsx)("p",{className:"text-sm text-emblem-muted",children:"Make sure the METAMORPH server is running on port 3001"}),(0,a.jsx)(es,{onClick:()=>window.location.reload(),children:"Retry"})]})}):q?(0,a.jsxs)("main",{className:"h-screen max-h-screen flex flex-col overflow-hidden relative",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 z-40 flex justify-center",children:(0,a.jsxs)("button",{onClick:()=>B(!V),className:"flex items-center gap-1 px-4 py-1.5 bg-emblem-surface-2/90 backdrop-blur-lg rounded-b-xl border border-t-0 border-white/10 transition-colors",children:[(0,a.jsx)(x.A,{className:G("w-4 h-4 text-emblem-muted transition-transform",V&&"rotate-180")}),(0,a.jsx)("span",{className:"text-xs text-emblem-muted",children:"Menu"})]})}),(0,a.jsx)(l.N,{children:V&&(0,a.jsx)(r.P.div,{initial:{y:"-100%"},animate:{y:0},exit:{y:"-100%"},transition:{type:"spring",damping:25,stiffness:300},className:"absolute top-0 left-0 right-0 z-30 bg-emblem-surface/95 backdrop-blur-lg border-b border-white/10 pt-10 pb-4 px-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[R.map(e=>{let{id:t,label:s,icon:n}=e;return(0,a.jsxs)("button",{onClick:()=>Q(t),className:G("flex flex-col items-center gap-1 p-3 rounded-lg transition-all",j===t?"bg-emblem-secondary/20 text-emblem-secondary":"text-emblem-muted hover:bg-white/5"),children:[(0,a.jsx)(n,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"text-[10px]",children:s})]},t)}),(0,a.jsxs)("button",{onClick:et,className:"flex flex-col items-center gap-1 p-3 rounded-lg transition-all text-emblem-primary hover:bg-emblem-primary/10",children:[(0,a.jsx)(p.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"text-[10px]",children:"New"})]})]})})}),(0,a.jsx)(l.N,{children:W&&(0,a.jsxs)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"absolute inset-0 z-50 bg-emblem-bg flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10",children:[(0,a.jsx)("h2",{className:"text-lg font-display font-semibold text-emblem-secondary capitalize",children:j}),(0,a.jsx)("button",{onClick:K,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:(0,a.jsx)(h.A,{className:"w-5 h-5 text-emblem-muted"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-styled",children:en()})]})}),(0,a.jsx)("div",{className:"flex-1 min-h-0 max-h-full flex flex-col pt-8",children:(0,a.jsx)(e5,{sessionId:e,onSessionChange:Z,onResponse:$,onPanelChange:Q,onNewSession:et,stance:s,config:o,emotionContext:E})})]}):(0,a.jsxs)("main",{className:"h-screen max-h-screen flex flex-col overflow-hidden",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between px-6 py-4 border-b border-white/5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:X,className:"p-2 rounded-lg bg-emblem-surface-2 hover:bg-emblem-surface border border-white/10 transition-colors","aria-label":L?"Close sidebar":"Open sidebar",children:L?(0,a.jsx)(h.A,{className:"w-5 h-5"}):(0,a.jsx)(b.A,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"flex items-baseline gap-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-display font-bold gradient-text",children:"METAMORPH"}),(0,a.jsx)("span",{className:"text-sm text-emblem-muted",children:"Transformation-Maximizing AI"})]})]}),(0,a.jsx)(es,{variant:"outline",onClick:et,children:"+ New Chat"})]}),(0,a.jsxs)("div",{className:"flex-1 flex h-[calc(100vh-73px)] max-h-[calc(100vh-73px)] overflow-hidden",children:[(0,a.jsxs)("aside",{className:G("flex flex-col gap-4 min-h-0 max-h-full bg-emblem-surface/50 border-r border-white/5 transition-all duration-300 ease-in-out overflow-hidden",L?"p-4":"w-0 p-0"),style:{width:L?z:0},children:[(0,a.jsx)(em,{delayDuration:200,children:(0,a.jsx)("div",{className:"flex border-b border-white/10",children:R.map(e=>{let{id:t,label:s,icon:n}=e;return(0,a.jsxs)(ed,{children:[(0,a.jsx)(eu,{asChild:!0,children:(0,a.jsxs)("button",{className:G("flex-1 py-2.5 flex items-center justify-center transition-all relative","cursor-pointer",j===t?"text-emblem-secondary":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),onClick:()=>Q(t),children:[(0,a.jsx)(n,{className:"w-4 h-4"}),j===t&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-emblem-secondary"})]})}),(0,a.jsx)(ex,{side:"bottom",sideOffset:8,children:s})]},t)})})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-styled",children:en()})]}),L&&(0,a.jsx)("div",{className:"w-3 bg-emblem-surface-2/50 hover:bg-emblem-primary/30 cursor-col-resize flex-shrink-0 transition-all group flex items-center justify-center border-x border-white/5",onMouseDown:J,children:(0,a.jsx)(f.A,{className:"w-4 h-6 text-emblem-muted/50 group-hover:text-emblem-primary transition-colors"})}),(0,a.jsx)("div",{className:"flex-1 min-h-0 max-h-full flex flex-col p-4",children:(0,a.jsx)(e5,{sessionId:e,onSessionChange:Z,onResponse:$,onPanelChange:Q,onNewSession:et,stance:s,config:o,emotionContext:E})})]})]})}}},e=>{e.O(0,[367,831,122,274,891,441,255,358],()=>e(e.s=8623)),_N_E=e.O()}]);