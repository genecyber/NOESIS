(()=>{var a={};a.id=974,a.ids=[974],a.modules={104:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(9754),e=c(9117),f=c(6595),g=c(2324),h=c(9326),i=c(8928),j=c(175),k=c(12),l=c(4290),m=c(2696),n=c(2802),o=c(7533),p=c(5229),q=c(2822),r=c(261),s=c(6453),t=c(2474),u=c(6713),v=c(1356),w=c(2685),x=c(6225),y=c(3446),z=c(2762),A=c(5742),B=c(6439),C=c(1170),D=c.n(C),E=c(2506),F=c(1203),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,7742)),"/Users/shannoncode/repo/NOESIS/web/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(c.bind(c,6953)),"/Users/shannoncode/repo/NOESIS/web/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,1170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,7028,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,2768,23)),"next/dist/client/components/builtin/unauthorized.js"]}],I=["/Users/shannoncode/repo/NOESIS/web/app/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(9902).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}},189:function(a,b,c){"use strict";var d=(this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}})(c(1421)),e=c(4709);function f(a,b){var c={};return a&&"string"==typeof a&&(0,d.default)(a,function(a,d){a&&d&&(c[(0,e.camelCase)(a,b)]=d)}),c}f.default=f,a.exports=f},261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},1348:(a,b)=>{"use strict";function c(a){return a.split("/").map(a=>encodeURIComponent(a)).join("/")}Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"encodeURIPath",{enumerable:!0,get:function(){return c}})},1421:function(a,b,c){"use strict";var d=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(a,b){let c=null;if(!a||"string"!=typeof a)return c;let d=(0,e.default)(a),f="function"==typeof b;return d.forEach(a=>{if("declaration"!==a.type)return;let{property:d,value:e}=a;f?b(d,e,a):e&&((c=c||{})[d]=e)}),c};let e=d(c(8613))},1486:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,4160,23)),Promise.resolve().then(c.t.bind(c,1603,23)),Promise.resolve().then(c.t.bind(c,8495,23)),Promise.resolve().then(c.t.bind(c,5170,23)),Promise.resolve().then(c.t.bind(c,7526,23)),Promise.resolve().then(c.t.bind(c,8922,23)),Promise.resolve().then(c.t.bind(c,9234,23)),Promise.resolve().then(c.t.bind(c,2263,23)),Promise.resolve().then(c.bind(c,2146))},1630:a=>{"use strict";a.exports=require("http")},2402:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"PreloadChunks",{enumerable:!0,get:function(){return h}});let d=c(1124),e=c(3312),f=c(9294),g=c(1348);function h(a){let{moduleIds:b}=a,c=f.workAsyncStorage.getStore();if(void 0===c)return null;let h=[];if(c.reactLoadableManifest&&b){let a=c.reactLoadableManifest;for(let c of b){if(!a[c])continue;let b=a[c].files;h.push(...b)}}return 0===h.length?null:(0,d.jsx)(d.Fragment,{children:h.map(a=>{let b=c.assetPrefix+"/_next/"+(0,g.encodeURIPath)(a);return a.endsWith(".css")?(0,d.jsx)("link",{precedence:"dynamic",href:b,rel:"stylesheet",as:"style"},a):((0,e.preload)(b,{as:"script",fetchPriority:"low"}),null)})})}},2704:()=>{},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3043:(a,b,c)=>{"use strict";c.d(b,{ServiceWorkerRegistration:()=>e});var d=c(7954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call ServiceWorkerRegistration() from the server but ServiceWorkerRegistration is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/shannoncode/repo/NOESIS/web/app/sw-register.tsx","ServiceWorkerRegistration");(0,d.registerClientReference)(function(){throw Error("Attempted to call triggerSync() from the server but triggerSync is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/shannoncode/repo/NOESIS/web/app/sw-register.tsx","triggerSync"),(0,d.registerClientReference)(function(){throw Error("Attempted to call requestBackgroundSync() from the server but requestBackgroundSync is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/shannoncode/repo/NOESIS/web/app/sw-register.tsx","requestBackgroundSync")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3540:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"default",{enumerable:!0,get:function(){return e}});let d=c(5288)._(c(3972));function e(a,b){var c;let e={};"function"==typeof a&&(e.loader=a);let f={...e,...b};return(0,d.default)({...f,modules:null==(c=f.loadableGenerated)?void 0:c.modules})}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)},3972:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"default",{enumerable:!0,get:function(){return j}});let d=c(1124),e=c(8301),f=c(4207),g=c(2402);function h(a){return{default:a&&"default"in a?a.default:a}}let i={loader:()=>Promise.resolve(h(()=>null)),loading:null,ssr:!0},j=function(a){let b={...i,...a},c=(0,e.lazy)(()=>b.loader().then(h)),j=b.loading;function k(a){let h=j?(0,d.jsx)(j,{isLoading:!0,pastDelay:!0,error:null}):null,i=!b.ssr||!!b.loading,k=i?e.Suspense:e.Fragment,l=b.ssr?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.PreloadChunks,{moduleIds:b.modules}),(0,d.jsx)(c,{...a})]}):(0,d.jsx)(f.BailoutToCSR,{reason:"next/dynamic",children:(0,d.jsx)(c,{...a})});return(0,d.jsx)(k,{...i?{fallback:h}:{},children:l})}return k.displayName="LoadableComponent",k}},4075:a=>{"use strict";a.exports=require("zlib")},4207:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"BailoutToCSR",{enumerable:!0,get:function(){return e}});let d=c(4339);function e(a){let{reason:b,children:c}=a;throw Object.defineProperty(new d.BailoutToCSRError(b),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}},4216:a=>{"use strict";a.exports=import("@xenova/transformers")},4472:(a,b,c)=>{"use strict";let d;c.r(b),c.d(b,{FetchError:()=>h,Headers:()=>w,Request:()=>J,Response:()=>D,default:()=>Q});let e=Symbol("buffer"),f=Symbol("type");class g{constructor(){this[f]="";let a=arguments[0],b=arguments[1],c=[];if(a){let b=Number(a.length);for(let d=0;d<b;d++){let b,f=a[d];b=f instanceof Buffer?f:ArrayBuffer.isView(f)?Buffer.from(f.buffer,f.byteOffset,f.byteLength):f instanceof ArrayBuffer?Buffer.from(f):f instanceof g?f[e]:Buffer.from("string"==typeof f?f:String(f)),c.push(b)}}this[e]=Buffer.concat(c);let d=b&&void 0!==b.type&&String(b.type).toLowerCase();d&&!/[^\u0020-\u007E]/.test(d)&&(this[f]=d)}get size(){return this[e].length}get type(){return this[f]}slice(){let a,b=this.size,c=arguments[0],d=arguments[1];a=void 0===c?0:c<0?Math.max(b+c,0):Math.min(c,b);let f=Math.max((void 0===d?b:d<0?Math.max(b+d,0):Math.min(d,b))-a,0),h=this[e].slice(a,a+f),i=new g([],{type:arguments[2]});return i[e]=h,i}}function h(a,b,c){Error.call(this,a),this.message=a,this.type=b,c&&(this.code=this.errno=c.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(g.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(g.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),h.prototype=Object.create(Error.prototype),h.prototype.constructor=h,h.prototype.name="FetchError";let i=c(7910),j=c(7910).PassThrough;try{d=Object(function(){var a=Error("Cannot find module 'encoding'");throw a.code="MODULE_NOT_FOUND",a}())}catch(a){}let k=Symbol("Body internals");function l(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=c.size,e=c.timeout;null==a?a=null:"string"==typeof a||n(a)||a instanceof g||Buffer.isBuffer(a)||"[object ArrayBuffer]"===Object.prototype.toString.call(a)||a instanceof i||(a=String(a)),this[k]={body:a,disturbed:!1,error:null},this.size=void 0===d?0:d,this.timeout=void 0===e?0:e,a instanceof i&&a.on("error",function(a){b[k].error=new h(`Invalid response body while trying to fetch ${b.url}: ${a.message}`,"system",a)})}function m(){var a=this;if(this[k].disturbed)return l.Promise.reject(TypeError(`body used already for: ${this.url}`));if(this[k].disturbed=!0,this[k].error)return l.Promise.reject(this[k].error);if(null===this.body)return l.Promise.resolve(Buffer.alloc(0));if("string"==typeof this.body)return l.Promise.resolve(Buffer.from(this.body));if(this.body instanceof g)return l.Promise.resolve(this.body[e]);if(Buffer.isBuffer(this.body))return l.Promise.resolve(this.body);if("[object ArrayBuffer]"===Object.prototype.toString.call(this.body))return l.Promise.resolve(Buffer.from(this.body));if(!(this.body instanceof i))return l.Promise.resolve(Buffer.alloc(0));let b=[],c=0,d=!1;return new l.Promise(function(e,f){let g;a.timeout&&(g=setTimeout(function(){d=!0,f(new h(`Response timeout while trying to fetch ${a.url} (over ${a.timeout}ms)`,"body-timeout"))},a.timeout)),a.body.on("error",function(b){f(new h(`Invalid response body while trying to fetch ${a.url}: ${b.message}`,"system",b))}),a.body.on("data",function(e){if(!d&&null!==e){if(a.size&&c+e.length>a.size){d=!0,f(new h(`content size at ${a.url} over limit: ${a.size}`,"max-size"));return}c+=e.length,b.push(e)}}),a.body.on("end",function(){if(!d){clearTimeout(g);try{e(Buffer.concat(b))}catch(b){f(new h(`Could not create Buffer from response body for ${a.url}: ${b.message}`,"system",b))}}})})}function n(a){return"object"==typeof a&&"function"==typeof a.append&&"function"==typeof a.delete&&"function"==typeof a.get&&"function"==typeof a.getAll&&"function"==typeof a.has&&"function"==typeof a.set&&("URLSearchParams"===a.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(a)||"function"==typeof a.sort)}function o(a){let b,c,d=a.body;if(a.bodyUsed)throw Error("cannot clone body after it is used");return d instanceof i&&"function"!=typeof d.getBoundary&&(b=new j,c=new j,d.pipe(b),d.pipe(c),a[k].body=b,d=c),d}function p(a){let b=a.body;if(null===b)return 0;if("string"==typeof b)return Buffer.byteLength(b);if(n(b))return Buffer.byteLength(String(b));if(b instanceof g)return b.size;if(Buffer.isBuffer(b))return b.length;else if("[object ArrayBuffer]"===Object.prototype.toString.call(b))return b.byteLength;else if(!b||"function"!=typeof b.getLengthSync)return null;else return b._lengthRetrievers&&0==b._lengthRetrievers.length||b.hasKnownLength&&b.hasKnownLength()?b.getLengthSync():null}l.prototype={get body(){return this[k].body},get bodyUsed(){return this[k].disturbed},arrayBuffer(){return m.call(this).then(function(a){return a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)})},blob(){let a=this.headers&&this.headers.get("content-type")||"";return m.call(this).then(function(b){return Object.assign(new g([],{type:a.toLowerCase()}),{[e]:b})})},json(){var a=this;return m.call(this).then(function(b){try{return JSON.parse(b.toString())}catch(b){return l.Promise.reject(new h(`invalid json response body at ${a.url} reason: ${b.message}`,"invalid-json"))}})},text(){return m.call(this).then(function(a){return a.toString()})},buffer(){return m.call(this)},textConverted(){var a=this;return m.call(this).then(function(b){return function(a,b){let c,e;if("function"!=typeof d)throw Error("The package `encoding` must be installed to use the textConverted() function");let f=b.get("content-type"),g="utf-8";return f&&(c=/charset=([^;]*)/i.exec(f)),e=a.slice(0,1024).toString(),!c&&e&&(c=/<meta.+?charset=(['"])(.+?)\1/i.exec(e)),!c&&e&&(c=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(e))&&(c=/charset=(.*)/i.exec(c.pop())),!c&&e&&(c=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(e)),c&&("gb2312"===(g=c.pop())||"gbk"===g)&&(g="gb18030"),d(a,"UTF-8",g).toString()}(b,a.headers)})}},Object.defineProperties(l.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),l.mixIn=function(a){for(let b of Object.getOwnPropertyNames(l.prototype))if(!(b in a)){let c=Object.getOwnPropertyDescriptor(l.prototype,b);Object.defineProperty(a,b,c)}},l.Promise=global.Promise;let q=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,r=/[^\t\x20-\x7e\x80-\xff]/;function s(a){if(a=`${a}`,q.test(a))throw TypeError(`${a} is not a legal HTTP header name`)}function t(a){if(a=`${a}`,r.test(a))throw TypeError(`${a} is not a legal HTTP header value`)}function u(a,b){for(let c in b=b.toLowerCase(),a)if(c.toLowerCase()===b)return c}let v=Symbol("map");class w{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[v]=Object.create(null),a instanceof w){let b=a.raw();for(let a of Object.keys(b))for(let c of b[a])this.append(a,c);return}if(null==a);else if("object"==typeof a){let b=a[Symbol.iterator];if(null!=b){if("function"!=typeof b)throw TypeError("Header pairs must be iterable");let c=[];for(let b of a){if("object"!=typeof b||"function"!=typeof b[Symbol.iterator])throw TypeError("Each header pair must be iterable");c.push(Array.from(b))}for(let a of c){if(2!==a.length)throw TypeError("Each header pair must be a name/value tuple");this.append(a[0],a[1])}}else for(let b of Object.keys(a)){let c=a[b];this.append(b,c)}}else throw TypeError("Provided initializer must be an object")}get(a){s(a=`${a}`);let b=u(this[v],a);return void 0===b?null:this[v][b].join(", ")}forEach(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,c=x(this),d=0;for(;d<c.length;){var e=c[d];let f=e[0],g=e[1];a.call(b,g,f,this),c=x(this),d++}}set(a,b){a=`${a}`,b=`${b}`,s(a),t(b);let c=u(this[v],a);this[v][void 0!==c?c:a]=[b]}append(a,b){a=`${a}`,b=`${b}`,s(a),t(b);let c=u(this[v],a);void 0!==c?this[v][c].push(b):this[v][a]=[b]}has(a){return s(a=`${a}`),void 0!==u(this[v],a)}delete(a){s(a=`${a}`);let b=u(this[v],a);void 0!==b&&delete this[v][b]}raw(){return this[v]}keys(){return z(this,"key")}values(){return z(this,"value")}[Symbol.iterator](){return z(this,"key+value")}}function x(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(a[v]).sort().map("key"===b?function(a){return a.toLowerCase()}:"value"===b?function(b){return a[v][b].join(", ")}:function(b){return[b.toLowerCase(),a[v][b].join(", ")]})}w.prototype.entries=w.prototype[Symbol.iterator],Object.defineProperty(w.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(w.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});let y=Symbol("internal");function z(a,b){let c=Object.create(A);return c[y]={target:a,kind:b,index:0},c}let A=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==A)throw TypeError("Value of `this` is not a HeadersIterator");var a=this[y];let b=a.target,c=a.kind,d=a.index,e=x(b,c);return d>=e.length?{value:void 0,done:!0}:(this[y].index=d+1,{value:e[d],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(A,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});let B=c(1630).STATUS_CODES,C=Symbol("Response internals");class D{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l.call(this,a,b);let c=b.status||200;this[C]={url:b.url,status:c,statusText:b.statusText||B[c],headers:new w(b.headers)}}get url(){return this[C].url}get status(){return this[C].status}get ok(){return this[C].status>=200&&this[C].status<300}get statusText(){return this[C].statusText}get headers(){return this[C].headers}clone(){return new D(o(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok})}}l.mixIn(D.prototype),Object.defineProperties(D.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(D.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});var E=c(9551);let F=E.format,G=E.parse,H=Symbol("Request internals");function I(a){return"object"==typeof a&&"object"==typeof a[H]}class J{constructor(a){let b,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};I(a)?b=G(a.url):(b=a&&a.href?G(a.href):G(`${a}`),a={});let d=c.method||a.method||"GET";if(d=d.toUpperCase(),(null!=c.body||I(a)&&null!==a.body)&&("GET"===d||"HEAD"===d))throw TypeError("Request with GET/HEAD method cannot have body");let e=null!=c.body?c.body:I(a)&&null!==a.body?o(a):null;l.call(this,e,{timeout:c.timeout||a.timeout||0,size:c.size||a.size||0});let f=new w(c.headers||a.headers||{});if(null!=c.body){let a=function(a){let b=a.body;if(null===b)return null;if("string"==typeof b)return"text/plain;charset=UTF-8";if(n(b))return"application/x-www-form-urlencoded;charset=UTF-8";if(b instanceof g)return b.type||null;if(Buffer.isBuffer(b))return null;else if("[object ArrayBuffer]"===Object.prototype.toString.call(b))return null;else if("function"==typeof b.getBoundary)return`multipart/form-data;boundary=${b.getBoundary()}`;else return null}(this);null===a||f.has("Content-Type")||f.append("Content-Type",a)}this[H]={method:d,redirect:c.redirect||a.redirect||"follow",headers:f,parsedURL:b},this.follow=void 0!==c.follow?c.follow:void 0!==a.follow?a.follow:20,this.compress=void 0!==c.compress?c.compress:void 0===a.compress||a.compress,this.counter=c.counter||a.counter||0,this.agent=c.agent||a.agent}get method(){return this[H].method}get url(){return F(this[H].parsedURL)}get headers(){return this[H].headers}get redirect(){return this[H].redirect}clone(){return new J(this)}}l.mixIn(J.prototype),Object.defineProperty(J.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(J.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0}});let K=c(1630),L=c(5591),M=c(7910).PassThrough,N=c(9551).resolve,O=c(4075);function P(a,b){if(!P.Promise)throw Error("native promise missing, set fetch.Promise to your favorite alternative");return l.Promise=P.Promise,new P.Promise(function(c,d){let f,i=new J(a,b),j=function(a){let b=a[H].parsedURL,c=new w(a[H].headers);if(c.has("Accept")||c.set("Accept","*/*"),!b.protocol||!b.hostname)throw TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(b.protocol))throw TypeError("Only HTTP(S) protocols are supported");let d=null;if(null==a.body&&/^(POST|PUT)$/i.test(a.method)&&(d="0"),null!=a.body){let b=p(a);"number"==typeof b&&(d=String(b))}return d&&c.set("Content-Length",d),c.has("User-Agent")||c.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),a.compress&&c.set("Accept-Encoding","gzip,deflate"),c.has("Connection")||a.agent||c.set("Connection","close"),Object.assign({},b,{method:a.method,headers:function(a){let b=Object.assign({__proto__:null},a[v]),c=u(a[v],"Host");return void 0!==c&&(b[c]=b[c][0]),b}(c),agent:a.agent})}(i),k=(0,("https:"===j.protocol?L:K).request)(j);function l(){k.abort(),clearTimeout(f)}i.timeout&&k.once("socket",function(a){f=setTimeout(function(){d(new h(`network timeout at: ${i.url}`,"request-timeout")),l()},i.timeout)}),k.on("error",function(a){d(new h(`request to ${i.url} failed, reason: ${a.message}`,"system",a)),l()}),k.on("response",function(a){clearTimeout(f);let b=function(a){let b=new w;for(let c of Object.keys(a))if(!q.test(c))if(Array.isArray(a[c]))for(let d of a[c])r.test(d)||(void 0===b[v][c]?b[v][c]=[d]:b[v][c].push(d));else r.test(a[c])||(b[v][c]=[a[c]]);return b}(a.headers);if(P.isRedirect(a.statusCode)){let e=b.get("Location"),f=null===e?null:N(i.url,e);switch(i.redirect){case"error":d(new h(`redirect mode is set to error: ${i.url}`,"no-redirect")),l();return;case"manual":null!==f&&b.set("Location",f);break;case"follow":if(null===f)break;if(i.counter>=i.follow){d(new h(`maximum redirect reached at: ${i.url}`,"max-redirect")),l();return}let g={headers:new w(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:i.body};if(303!==a.statusCode&&i.body&&null===p(i)){d(new h("Cannot follow redirect with body being a readable stream","unsupported-redirect")),l();return}(303===a.statusCode||(301===a.statusCode||302===a.statusCode)&&"POST"===i.method)&&(g.method="GET",g.body=void 0,g.headers.delete("content-length")),c(P(new J(f,g))),l();return}}let e=a.pipe(new M),g={url:i.url,status:a.statusCode,statusText:a.statusMessage,headers:b,size:i.size,timeout:i.timeout},j=b.get("Content-Encoding");if(!i.compress||"HEAD"===i.method||null===j||204===a.statusCode||304===a.statusCode)return void c(new D(e,g));let k={flush:O.Z_SYNC_FLUSH,finishFlush:O.Z_SYNC_FLUSH};return"gzip"==j||"x-gzip"==j?void c(new D(e=e.pipe(O.createGunzip(k)),g)):"deflate"==j||"x-deflate"==j?void a.pipe(new M).once("data",function(a){c(new D(e=(15&a[0])==8?e.pipe(O.createInflate()):e.pipe(O.createInflateRaw()),g))}):void c(new D(e,g))});let m=i.body;null===m?k.end():"string"==typeof m?(k.write(m),k.end()):n(m)?(k.write(Buffer.from(String(m))),k.end()):m instanceof g?(k.write(m[e]),k.end()):Buffer.isBuffer(m)?(k.write(m),k.end()):"[object ArrayBuffer]"===Object.prototype.toString.call(m)?(k.write(Buffer.from(m)),k.end()):m.pipe(k)})}P.isRedirect=function(a){return 301===a||302===a||303===a||307===a||308===a},P.default=P,P.Promise=global.Promise;let Q=P},4709:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.camelCase=void 0;var c=/^--[a-zA-Z0-9_-]+$/,d=/-([a-z])/g,e=/^[^-]+$/,f=/^-(webkit|moz|ms|o|khtml)-/,g=/^-(ms)-/,h=function(a,b){return b.toUpperCase()},i=function(a,b){return"".concat(b,"-")};b.camelCase=function(a,b){var j;return(void 0===b&&(b={}),!(j=a)||e.test(j)||c.test(j))?a:(a=a.toLowerCase(),(a=b.reactCompat?a.replace(g,i):a.replace(f,i)).replace(d,h))}},5178:(a,b,c)=>{Promise.resolve().then(c.bind(c,3043))},5511:a=>{"use strict";a.exports=require("crypto")},5591:a=>{"use strict";a.exports=require("https")},5745:(a,b,c)=>{Promise.resolve().then(c.bind(c,7836))},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},6953:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>n,metadata:()=>l,viewport:()=>m});var d=c(5338),e=c(7253),f=c.n(e),g=c(4288),h=c.n(g),i=c(4443),j=c.n(i);c(2704);var k=c(3043);let l={title:"METAMORPH",description:"Transformation-maximizing AI interface",manifest:"/manifest.json",appleWebApp:{capable:!0,statusBarStyle:"black-translucent",title:"METAMORPH"},formatDetection:{telephone:!1}},m={themeColor:"#6D5CFF",width:"device-width",initialScale:1,maximumScale:1,userScalable:!1};function n({children:a}){return(0,d.jsxs)("html",{lang:"en",children:[(0,d.jsxs)("head",{children:[(0,d.jsx)("link",{rel:"apple-touch-icon",href:"/icon.svg"}),(0,d.jsx)("link",{rel:"icon",type:"image/svg+xml",href:"/icon.svg"}),(0,d.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"})]}),(0,d.jsxs)("body",{className:`${f().variable} ${h().variable} ${j().variable} font-sans antialiased`,children:[a,(0,d.jsx)(k.ServiceWorkerRegistration,{})]})]})}},7742:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(7954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/shannoncode/repo/NOESIS/web/app/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/shannoncode/repo/NOESIS/web/app/page.tsx","default")},7836:(a,b,c)=>{"use strict";let d;c.r(b),c.d(b,{default:()=>Cy});var e,f,g,h,i,j={};c.r(j),c.d(j,{boolean:()=>f9,booleanish:()=>ga,commaOrSpaceSeparated:()=>gf,commaSeparated:()=>ge,number:()=>gc,overloadedBoolean:()=>gb,spaceSeparated:()=>gd});var k={};c.r(k),c.d(k,{attentionMarkers:()=>ia,contentInitial:()=>h4,disable:()=>ib,document:()=>h3,flow:()=>h6,flowInitial:()=>h5,insideSpan:()=>h9,string:()=>h7,text:()=>h8});var l=c(1124),m=c(8301),n=c.t(m,2);let o=(0,m.createContext)({});function p(a){let b=(0,m.useRef)(null);return null===b.current&&(b.current=a()),b.current}let q="undefined"!=typeof window,r=q?m.useLayoutEffect:m.useEffect,s=(0,m.createContext)(null);function t(a){return"object"==typeof a&&null!==a}function u(a){return t(a)&&"offsetHeight"in a}let v=(0,m.createContext)({transformPagePoint:a=>a,isStatic:!1,reducedMotion:"never"});function w(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}class x extends m.Component{getSnapshotBeforeUpdate(a){let b=this.props.childRef.current;if(b&&a.isPresent&&!this.props.isPresent){let a=b.offsetParent,c=u(a)&&a.offsetWidth||0,d=this.props.sizeRef.current;d.height=b.offsetHeight||0,d.width=b.offsetWidth||0,d.top=b.offsetTop,d.left=b.offsetLeft,d.right=c-d.width-d.left}return null}componentDidUpdate(){}render(){return this.props.children}}function y({children:a,isPresent:b,anchorX:c,root:d}){let e=(0,m.useId)(),f=(0,m.useRef)(null),g=(0,m.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=(0,m.useContext)(v),i=function(...a){return m.useCallback(function(...a){return b=>{let c=!1,d=a.map(a=>{let d=w(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():w(a[b],null)}}}}(...a),a)}(f,a.props?.ref??a?.ref);return(0,m.useInsertionEffect)(()=>{let{width:a,height:i,top:j,left:k,right:l}=g.current;if(b||!f.current||!a||!i)return;let m="left"===c?`left: ${k}`:`right: ${l}`;f.current.dataset.motionPopId=e;let n=document.createElement("style");h&&(n.nonce=h);let o=d??document.head;return o.appendChild(n),n.sheet&&n.sheet.insertRule(`
          [data-motion-pop-id="${e}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${i}px !important;
            ${m}px !important;
            top: ${j}px !important;
          }
        `),()=>{o.contains(n)&&o.removeChild(n)}},[b]),(0,l.jsx)(x,{isPresent:b,childRef:f,sizeRef:g,children:m.cloneElement(a,{ref:i})})}let z=({children:a,initial:b,isPresent:c,onExitComplete:d,custom:e,presenceAffectsLayout:f,mode:g,anchorX:h,root:i})=>{let j=p(A),k=(0,m.useId)(),n=!0,o=(0,m.useMemo)(()=>(n=!1,{id:k,initial:b,isPresent:c,custom:e,onExitComplete:a=>{for(let b of(j.set(a,!0),j.values()))if(!b)return;d&&d()},register:a=>(j.set(a,!1),()=>j.delete(a))}),[c,j,d]);return f&&n&&(o={...o}),(0,m.useMemo)(()=>{j.forEach((a,b)=>j.set(b,!1))},[c]),m.useEffect(()=>{c||j.size||!d||d()},[c]),"popLayout"===g&&(a=(0,l.jsx)(y,{isPresent:c,anchorX:h,root:i,children:a})),(0,l.jsx)(s.Provider,{value:o,children:a})};function A(){return new Map}function B(a=!0){let b=(0,m.useContext)(s);if(null===b)return[!0,null];let{isPresent:c,onExitComplete:d,register:e}=b,f=(0,m.useId)(),g=(0,m.useCallback)(()=>a&&d&&d(f),[f,d,a]);return!c&&d?[!1,g]:[!0]}let C=a=>a.key||"";function D(a){let b=[];return m.Children.forEach(a,a=>{(0,m.isValidElement)(a)&&b.push(a)}),b}let E=({children:a,custom:b,initial:c=!0,onExitComplete:d,presenceAffectsLayout:e=!0,mode:f="sync",propagate:g=!1,anchorX:h="left",root:i})=>{let[j,k]=B(g),n=(0,m.useMemo)(()=>D(a),[a]),q=g&&!j?[]:n.map(C),s=(0,m.useRef)(!0),t=(0,m.useRef)(n),u=p(()=>new Map),v=(0,m.useRef)(new Set),[w,x]=(0,m.useState)(n),[y,A]=(0,m.useState)(n);r(()=>{s.current=!1,t.current=n;for(let a=0;a<y.length;a++){let b=C(y[a]);q.includes(b)?(u.delete(b),v.current.delete(b)):!0!==u.get(b)&&u.set(b,!1)}},[y,q.length,q.join("-")]);let E=[];if(n!==w){let a=[...n];for(let b=0;b<y.length;b++){let c=y[b],d=C(c);q.includes(d)||(a.splice(b,0,c),E.push(c))}return"wait"===f&&E.length&&(a=E),A(D(a)),x(n),null}let{forceRender:F}=(0,m.useContext)(o);return(0,l.jsx)(l.Fragment,{children:y.map(a=>{let m=C(a),o=(!g||!!j)&&(n===y||q.includes(m));return(0,l.jsx)(z,{isPresent:o,initial:(!s.current||!!c)&&void 0,custom:b,presenceAffectsLayout:e,mode:f,root:i,onExitComplete:o?void 0:()=>{if(v.current.has(m)||(v.current.add(m),!u.has(m)))return;u.set(m,!0);let a=!0;u.forEach(b=>{b||(a=!1)}),a&&(F?.(),A(t.current),g&&k?.(),d&&d())},anchorX:h,children:a},m)})})},F=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],G=new Set(F),H=(a,b,c)=>c>b?b:c<a?a:c,I={test:a=>"number"==typeof a,parse:parseFloat,transform:a=>a},J={...I,transform:a=>H(0,1,a)},K={...I,default:1},L=a=>Math.round(1e5*a)/1e5,M=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,N=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,O=(a,b)=>c=>!!("string"==typeof c&&N.test(c)&&c.startsWith(a)||b&&null!=c&&Object.prototype.hasOwnProperty.call(c,b)),P=(a,b,c)=>d=>{if("string"!=typeof d)return d;let[e,f,g,h]=d.match(M);return{[a]:parseFloat(e),[b]:parseFloat(f),[c]:parseFloat(g),alpha:void 0!==h?parseFloat(h):1}},Q={...I,transform:a=>Math.round(H(0,255,a))},R={test:O("rgb","red"),parse:P("red","green","blue"),transform:({red:a,green:b,blue:c,alpha:d=1})=>"rgba("+Q.transform(a)+", "+Q.transform(b)+", "+Q.transform(c)+", "+L(J.transform(d))+")"},S={test:O("#"),parse:function(a){let b="",c="",d="",e="";return a.length>5?(b=a.substring(1,3),c=a.substring(3,5),d=a.substring(5,7),e=a.substring(7,9)):(b=a.substring(1,2),c=a.substring(2,3),d=a.substring(3,4),e=a.substring(4,5),b+=b,c+=c,d+=d,e+=e),{red:parseInt(b,16),green:parseInt(c,16),blue:parseInt(d,16),alpha:e?parseInt(e,16)/255:1}},transform:R.transform},T=a=>({test:b=>"string"==typeof b&&b.endsWith(a)&&1===b.split(" ").length,parse:parseFloat,transform:b=>`${b}${a}`}),U=T("deg"),V=T("%"),W=T("px"),X=T("vh"),Y=T("vw"),Z={...V,parse:a=>V.parse(a)/100,transform:a=>V.transform(100*a)},$={test:O("hsl","hue"),parse:P("hue","saturation","lightness"),transform:({hue:a,saturation:b,lightness:c,alpha:d=1})=>"hsla("+Math.round(a)+", "+V.transform(L(b))+", "+V.transform(L(c))+", "+L(J.transform(d))+")"},_={test:a=>R.test(a)||S.test(a)||$.test(a),parse:a=>R.test(a)?R.parse(a):$.test(a)?$.parse(a):S.parse(a),transform:a=>"string"==typeof a?a:a.hasOwnProperty("red")?R.transform(a):$.transform(a),getAnimatableNone:a=>{let b=_.parse(a);return b.alpha=0,_.transform(b)}},aa=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,ab="number",ac="color",ad=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ae(a){let b=a.toString(),c=[],d={color:[],number:[],var:[]},e=[],f=0,g=b.replace(ad,a=>(_.test(a)?(d.color.push(f),e.push(ac),c.push(_.parse(a))):a.startsWith("var(")?(d.var.push(f),e.push("var"),c.push(a)):(d.number.push(f),e.push(ab),c.push(parseFloat(a))),++f,"${}")).split("${}");return{values:c,split:g,indexes:d,types:e}}function af(a){return ae(a).values}function ag(a){let{split:b,types:c}=ae(a),d=b.length;return a=>{let e="";for(let f=0;f<d;f++)if(e+=b[f],void 0!==a[f]){let b=c[f];b===ab?e+=L(a[f]):b===ac?e+=_.transform(a[f]):e+=a[f]}return e}}let ah=a=>"number"==typeof a?0:_.test(a)?_.getAnimatableNone(a):a,ai={test:function(a){return isNaN(a)&&"string"==typeof a&&(a.match(M)?.length||0)+(a.match(aa)?.length||0)>0},parse:af,createTransformer:ag,getAnimatableNone:function(a){let b=af(a);return ag(a)(b.map(ah))}},aj=new Set(["brightness","contrast","saturate","opacity"]);function ak(a){let[b,c]=a.slice(0,-1).split("(");if("drop-shadow"===b)return a;let[d]=c.match(M)||[];if(!d)return a;let e=c.replace(d,""),f=+!!aj.has(b);return d!==c&&(f*=100),b+"("+f+e+")"}let al=/\b([a-z-]*)\(.*?\)/gu,am={...ai,getAnimatableNone:a=>{let b=a.match(al);return b?b.map(ak).join(" "):a}},an={...I,transform:Math.round},ao={borderWidth:W,borderTopWidth:W,borderRightWidth:W,borderBottomWidth:W,borderLeftWidth:W,borderRadius:W,radius:W,borderTopLeftRadius:W,borderTopRightRadius:W,borderBottomRightRadius:W,borderBottomLeftRadius:W,width:W,maxWidth:W,height:W,maxHeight:W,top:W,right:W,bottom:W,left:W,inset:W,insetBlock:W,insetBlockStart:W,insetBlockEnd:W,insetInline:W,insetInlineStart:W,insetInlineEnd:W,padding:W,paddingTop:W,paddingRight:W,paddingBottom:W,paddingLeft:W,paddingBlock:W,paddingBlockStart:W,paddingBlockEnd:W,paddingInline:W,paddingInlineStart:W,paddingInlineEnd:W,margin:W,marginTop:W,marginRight:W,marginBottom:W,marginLeft:W,marginBlock:W,marginBlockStart:W,marginBlockEnd:W,marginInline:W,marginInlineStart:W,marginInlineEnd:W,backgroundPositionX:W,backgroundPositionY:W,rotate:U,rotateX:U,rotateY:U,rotateZ:U,scale:K,scaleX:K,scaleY:K,scaleZ:K,skew:U,skewX:U,skewY:U,distance:W,translateX:W,translateY:W,translateZ:W,x:W,y:W,z:W,perspective:W,transformPerspective:W,opacity:J,originX:Z,originY:Z,originZ:W,zIndex:an,fillOpacity:J,strokeOpacity:J,numOctaves:an},ap={...ao,color:_,backgroundColor:_,outlineColor:_,fill:_,stroke:_,borderColor:_,borderTopColor:_,borderRightColor:_,borderBottomColor:_,borderLeftColor:_,filter:am,WebkitFilter:am},aq=a=>ap[a],ar=()=>({translate:0,scale:1,origin:0,originPoint:0}),as=()=>({x:ar(),y:ar()}),at=()=>({min:0,max:0}),au=()=>({x:at(),y:at()}),av=a=>!!(a&&a.getVelocity),aw=new Set(["width","height","top","left","right","bottom",...F]),ax=a=>b=>b.test(a),ay=[I,W,V,U,Y,X,{test:a=>"auto"===a,parse:a=>a}],az=a=>ay.find(ax(a)),aA=()=>{},aB=()=>{},aC=a=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(a),aD=a=>b=>"string"==typeof b&&b.startsWith(a),aE=aD("--"),aF=aD("var(--"),aG=a=>!!aF(a)&&aH.test(a.split("/*")[0].trim()),aH=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function aI(a){return"string"==typeof a&&a.split("/*")[0].includes("var(--")}let aJ=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u,aK=a=>180*a/Math.PI,aL=a=>aN(aK(Math.atan2(a[1],a[0]))),aM={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:a=>(Math.abs(a[0])+Math.abs(a[3]))/2,rotate:aL,rotateZ:aL,skewX:a=>aK(Math.atan(a[1])),skewY:a=>aK(Math.atan(a[2])),skew:a=>(Math.abs(a[1])+Math.abs(a[2]))/2},aN=a=>((a%=360)<0&&(a+=360),a),aO=a=>Math.sqrt(a[0]*a[0]+a[1]*a[1]),aP=a=>Math.sqrt(a[4]*a[4]+a[5]*a[5]),aQ={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:aO,scaleY:aP,scale:a=>(aO(a)+aP(a))/2,rotateX:a=>aN(aK(Math.atan2(a[6],a[5]))),rotateY:a=>aN(aK(Math.atan2(-a[2],a[0]))),rotateZ:aL,rotate:aL,skewX:a=>aK(Math.atan(a[4])),skewY:a=>aK(Math.atan(a[1])),skew:a=>(Math.abs(a[1])+Math.abs(a[4]))/2};function aR(a){return+!!a.includes("scale")}function aS(a,b){let c,d;if(!a||"none"===a)return aR(b);let e=a.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);if(e)c=aQ,d=e;else{let b=a.match(/^matrix\(([-\d.e\s,]+)\)$/u);c=aM,d=b}if(!d)return aR(b);let f=c[b],g=d[1].split(",").map(aT);return"function"==typeof f?f(g):g[f]}function aT(a){return parseFloat(a.trim())}let aU=a=>a===I||a===W,aV=new Set(["x","y","z"]),aW=F.filter(a=>!aV.has(a)),aX={width:({x:a},{paddingLeft:b="0",paddingRight:c="0"})=>a.max-a.min-parseFloat(b)-parseFloat(c),height:({y:a},{paddingTop:b="0",paddingBottom:c="0"})=>a.max-a.min-parseFloat(b)-parseFloat(c),top:(a,{top:b})=>parseFloat(b),left:(a,{left:b})=>parseFloat(b),bottom:({y:a},{top:b})=>parseFloat(b)+(a.max-a.min),right:({x:a},{left:b})=>parseFloat(b)+(a.max-a.min),x:(a,{transform:b})=>aS(b,"x"),y:(a,{transform:b})=>aS(b,"y")};aX.translateX=aX.x,aX.translateY=aX.y;let aY=a=>a,aZ={},a$=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],a_={value:null,addProjectionMetrics:null};function a0(a,b){let c=!1,d=!0,e={delta:0,timestamp:0,isProcessing:!1},f=()=>c=!0,g=a$.reduce((a,c)=>(a[c]=function(a,b){let c=new Set,d=new Set,e=!1,f=!1,g=new WeakSet,h={delta:0,timestamp:0,isProcessing:!1},i=0;function j(b){g.has(b)&&(k.schedule(b),a()),i++,b(h)}let k={schedule:(a,b=!1,f=!1)=>{let h=f&&e?c:d;return b&&g.add(a),h.has(a)||h.add(a),a},cancel:a=>{d.delete(a),g.delete(a)},process:a=>{if(h=a,e){f=!0;return}e=!0,[c,d]=[d,c],c.forEach(j),b&&a_.value&&a_.value.frameloop[b].push(i),i=0,c.clear(),e=!1,f&&(f=!1,k.process(a))}};return k}(f,b?c:void 0),a),{}),{setup:h,read:i,resolveKeyframes:j,preUpdate:k,update:l,preRender:m,render:n,postRender:o}=g,p=()=>{let f=aZ.useManualTiming?e.timestamp:performance.now();c=!1,aZ.useManualTiming||(e.delta=d?1e3/60:Math.max(Math.min(f-e.timestamp,40),1)),e.timestamp=f,e.isProcessing=!0,h.process(e),i.process(e),j.process(e),k.process(e),l.process(e),m.process(e),n.process(e),o.process(e),e.isProcessing=!1,c&&b&&(d=!1,a(p))};return{schedule:a$.reduce((b,f)=>{let h=g[f];return b[f]=(b,f=!1,g=!1)=>(!c&&(c=!0,d=!0,e.isProcessing||a(p)),h.schedule(b,f,g)),b},{}),cancel:a=>{for(let b=0;b<a$.length;b++)g[a$[b]].cancel(a)},state:e,steps:g}}let{schedule:a1,cancel:a2,state:a3,steps:a4}=a0("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:aY,!0),a5=new Set,a6=!1,a7=!1,a8=!1;function a9(){if(a7){let a=Array.from(a5).filter(a=>a.needsMeasurement),b=new Set(a.map(a=>a.element)),c=new Map;b.forEach(a=>{let b=function(a){let b=[];return aW.forEach(c=>{let d=a.getValue(c);void 0!==d&&(b.push([c,d.get()]),d.set(+!!c.startsWith("scale")))}),b}(a);b.length&&(c.set(a,b),a.render())}),a.forEach(a=>a.measureInitialState()),b.forEach(a=>{a.render();let b=c.get(a);b&&b.forEach(([b,c])=>{a.getValue(b)?.set(c)})}),a.forEach(a=>a.measureEndState()),a.forEach(a=>{void 0!==a.suspendedScrollY&&window.scrollTo(0,a.suspendedScrollY)})}a7=!1,a6=!1,a5.forEach(a=>a.complete(a8)),a5.clear()}function ba(){a5.forEach(a=>{a.readKeyframes(),a.needsMeasurement&&(a7=!0)})}class bb{constructor(a,b,c,d,e,f=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...a],this.onComplete=b,this.name=c,this.motionValue=d,this.element=e,this.isAsync=f}scheduleResolve(){this.state="scheduled",this.isAsync?(a5.add(this),a6||(a6=!0,a1.read(ba),a1.resolveKeyframes(a9))):(this.readKeyframes(),this.complete())}readKeyframes(){let{unresolvedKeyframes:a,name:b,element:c,motionValue:d}=this;if(null===a[0]){let e=d?.get(),f=a[a.length-1];if(void 0!==e)a[0]=e;else if(c&&b){let d=c.readValue(b,f);null!=d&&(a[0]=d)}void 0===a[0]&&(a[0]=f),d&&void 0===e&&d.set(a[0])}for(let b=1;b<a.length;b++)a[b]??(a[b]=a[b-1])}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(a=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,a),a5.delete(this)}cancel(){"scheduled"===this.state&&(a5.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}let bc=a=>/^0[^.\s]+$/u.test(a);function bd(a,b){let c=aq(a);return c!==am&&(c=ai),c.getAnimatableNone?c.getAnimatableNone(b):void 0}let be=new Set(["auto","none","0"]);class bf extends bb{constructor(a,b,c,d,e){super(a,b,c,d,e,!0)}readKeyframes(){let{unresolvedKeyframes:a,element:b,name:c}=this;if(!b||!b.current)return;super.readKeyframes();for(let c=0;c<a.length;c++){let d=a[c];if("string"==typeof d&&aG(d=d.trim())){let e=function a(b,c,d=1){aB(d<=4,`Max CSS variable fallback depth detected in property "${b}". This may indicate a circular fallback dependency.`,"max-css-var-depth");let[e,f]=function(a){let b=aJ.exec(a);if(!b)return[,];let[,c,d,e]=b;return[`--${c??d}`,e]}(b);if(!e)return;let g=window.getComputedStyle(c).getPropertyValue(e);if(g){let a=g.trim();return aC(a)?parseFloat(a):a}return aG(f)?a(f,c,d+1):f}(d,b.current);void 0!==e&&(a[c]=e),c===a.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!aw.has(c)||2!==a.length)return;let[d,e]=a,f=az(d),g=az(e);if(aI(d)!==aI(e)&&aX[c]){this.needsMeasurement=!0;return}if(f!==g)if(aU(f)&&aU(g))for(let b=0;b<a.length;b++){let c=a[b];"string"==typeof c&&(a[b]=parseFloat(c))}else aX[c]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){let{unresolvedKeyframes:a,name:b}=this,c=[];for(let b=0;b<a.length;b++){var d;(null===a[b]||("number"==typeof(d=a[b])?0===d:null===d||"none"===d||"0"===d||bc(d)))&&c.push(b)}c.length&&function(a,b,c){let d,e=0;for(;e<a.length&&!d;){let b=a[e];"string"==typeof b&&!be.has(b)&&ae(b).values.length&&(d=a[e]),e++}if(d&&c)for(let e of b)a[e]=bd(c,d)}(a,c,b)}measureInitialState(){let{element:a,unresolvedKeyframes:b,name:c}=this;if(!a||!a.current)return;"height"===c&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=aX[c](a.measureViewportBox(),window.getComputedStyle(a.current)),b[0]=this.measuredOrigin;let d=b[b.length-1];void 0!==d&&a.getValue(c,d).jump(d,!1)}measureEndState(){let{element:a,name:b,unresolvedKeyframes:c}=this;if(!a||!a.current)return;let d=a.getValue(b);d&&d.jump(this.measuredOrigin,!1);let e=c.length-1,f=c[e];c[e]=aX[b](a.measureViewportBox(),window.getComputedStyle(a.current)),null!==f&&void 0===this.finalKeyframe&&(this.finalKeyframe=f),this.removedTransforms?.length&&this.removedTransforms.forEach(([b,c])=>{a.getValue(b).set(c)}),this.resolveNoneKeyframes()}}function bg(a,b){-1===a.indexOf(b)&&a.push(b)}function bh(a,b){let c=a.indexOf(b);c>-1&&a.splice(c,1)}class bi{constructor(){this.subscriptions=[]}add(a){return bg(this.subscriptions,a),()=>bh(this.subscriptions,a)}notify(a,b,c){let d=this.subscriptions.length;if(d)if(1===d)this.subscriptions[0](a,b,c);else for(let e=0;e<d;e++){let d=this.subscriptions[e];d&&d(a,b,c)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}let{schedule:bj}=a0(queueMicrotask,!1);function bk(){d=void 0}let bl={now:()=>(void 0===d&&bl.set(a3.isProcessing||aZ.useManualTiming?a3.timestamp:performance.now()),d),set:a=>{d=a,queueMicrotask(bk)}},bm={current:void 0};class bn{constructor(a,b={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{let b=bl.now();if(this.updatedAt!==b&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(let a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(a),this.owner=b.owner}setCurrent(a){this.current=a,this.updatedAt=bl.now(),null===this.canTrackVelocity&&void 0!==a&&(this.canTrackVelocity=!isNaN(parseFloat(this.current)))}setPrevFrameValue(a=this.current){this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt}onChange(a){return this.on("change",a)}on(a,b){this.events[a]||(this.events[a]=new bi);let c=this.events[a].add(b);return"change"===a?()=>{c(),a1.read(()=>{this.events.change.getSize()||this.stop()})}:c}clearListeners(){for(let a in this.events)this.events[a].clear()}attach(a,b){this.passiveEffect=a,this.stopPassiveEffect=b}set(a){this.passiveEffect?this.passiveEffect(a,this.updateAndNotify):this.updateAndNotify(a)}setWithVelocity(a,b,c){this.set(b),this.prev=void 0,this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt-c}jump(a,b=!0){this.updateAndNotify(a),this.prev=a,this.prevUpdatedAt=this.prevFrameValue=void 0,b&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(a){this.dependents||(this.dependents=new Set),this.dependents.add(a)}removeDependent(a){this.dependents&&this.dependents.delete(a)}get(){return bm.current&&bm.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){var a;let b=bl.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||b-this.updatedAt>30)return 0;let c=Math.min(this.updatedAt-this.prevUpdatedAt,30);return a=parseFloat(this.current)-parseFloat(this.prevFrameValue),c?1e3/c*a:0}start(a){return this.stop(),new Promise(b=>{this.hasAnimated=!0,this.animation=a(b),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function bo(a,b){return new bn(a,b)}let bp=[...ay,_,ai],bq={current:null},br={current:!1},bs="undefined"!=typeof window,bt=new WeakMap;function bu(a){return null!==a&&"object"==typeof a&&"function"==typeof a.start}function bv(a){return"string"==typeof a||Array.isArray(a)}let bw=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],bx=["initial",...bw];function by(a){return bu(a.animate)||bx.some(b=>bv(a[b]))}function bz(a){return!!(by(a)||a.variants)}function bA(a){let b=[{},{}];return a?.values.forEach((a,c)=>{b[0][c]=a.get(),b[1][c]=a.getVelocity()}),b}function bB(a,b,c,d){if("function"==typeof b){let[e,f]=bA(d);b=b(void 0!==c?c:a.custom,e,f)}if("string"==typeof b&&(b=a.variants&&a.variants[b]),"function"==typeof b){let[e,f]=bA(d);b=b(void 0!==c?c:a.custom,e,f)}return b}let bC=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],bD={};class bE{scrapeMotionValuesFromProps(a,b,c){return{}}constructor({parent:a,props:b,presenceContext:c,reducedMotionConfig:d,blockInitialAnimation:e,visualState:f},g={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=bb,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{let a=bl.now();this.renderScheduledAt<a&&(this.renderScheduledAt=a,a1.render(this.render,!1,!0))};let{latestValues:h,renderState:i}=f;this.latestValues=h,this.baseTarget={...h},this.initialValues=b.initial?{...h}:{},this.renderState=i,this.parent=a,this.props=b,this.presenceContext=c,this.depth=a?a.depth+1:0,this.reducedMotionConfig=d,this.options=g,this.blockInitialAnimation=!!e,this.isControllingVariants=by(b),this.isVariantNode=bz(b),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(a&&a.current);let{willChange:j,...k}=this.scrapeMotionValuesFromProps(b,{},this);for(let a in k){let b=k[a];void 0!==h[a]&&av(b)&&b.set(h[a])}}mount(a){this.current=a,bt.set(a,this),this.projection&&!this.projection.instance&&this.projection.mount(a),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,b)=>this.bindToMotionValue(b,a)),"never"===this.reducedMotionConfig?this.shouldReduceMotion=!1:"always"===this.reducedMotionConfig?this.shouldReduceMotion=!0:(br.current||function(){if(br.current=!0,bs)if(window.matchMedia){let a=window.matchMedia("(prefers-reduced-motion)"),b=()=>bq.current=a.matches;a.addEventListener("change",b),b()}else bq.current=!1}(),this.shouldReduceMotion=bq.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){for(let a in this.projection&&this.projection.unmount(),a2(this.notifyUpdate),a2(this.render),this.valueSubscriptions.forEach(a=>a()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this),this.events)this.events[a].clear();for(let a in this.features){let b=this.features[a];b&&(b.unmount(),b.isMounted=!1)}this.current=null}addChild(a){this.children.add(a),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(a)}removeChild(a){this.children.delete(a),this.enteringChildren&&this.enteringChildren.delete(a)}bindToMotionValue(a,b){let c;this.valueSubscriptions.has(a)&&this.valueSubscriptions.get(a)();let d=G.has(a);d&&this.onBindTransform&&this.onBindTransform();let e=b.on("change",b=>{this.latestValues[a]=b,this.props.onUpdate&&a1.preRender(this.notifyUpdate),d&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});"undefined"!=typeof window&&window.MotionCheckAppearSync&&(c=window.MotionCheckAppearSync(this,a,b)),this.valueSubscriptions.set(a,()=>{e(),c&&c(),b.owner&&b.stop()})}sortNodePosition(a){return this.current&&this.sortInstanceNodePosition&&this.type===a.type?this.sortInstanceNodePosition(this.current,a.current):0}updateFeatures(){let a="animation";for(a in bD){let b=bD[a];if(!b)continue;let{isEnabled:c,Feature:d}=b;if(!this.features[a]&&d&&c(this.props)&&(this.features[a]=new d(this)),this.features[a]){let b=this.features[a];b.isMounted?b.update():(b.mount(),b.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):au()}getStaticValue(a){return this.latestValues[a]}setStaticValue(a,b){this.latestValues[a]=b}update(a,b){(a.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=a,this.prevPresenceContext=this.presenceContext,this.presenceContext=b;for(let b=0;b<bC.length;b++){let c=bC[b];this.propEventSubscriptions[c]&&(this.propEventSubscriptions[c](),delete this.propEventSubscriptions[c]);let d=a["on"+c];d&&(this.propEventSubscriptions[c]=this.on(c,d))}this.prevMotionValues=function(a,b,c){for(let d in b){let e=b[d],f=c[d];if(av(e))a.addValue(d,e);else if(av(f))a.addValue(d,bo(e,{owner:a}));else if(f!==e)if(a.hasValue(d)){let b=a.getValue(d);!0===b.liveStyle?b.jump(e):b.hasAnimated||b.set(e)}else{let b=a.getStaticValue(d);a.addValue(d,bo(void 0!==b?b:e,{owner:a}))}}for(let d in c)void 0===b[d]&&a.removeValue(d);return b}(this,this.scrapeMotionValuesFromProps(a,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(a){return this.props.variants?this.props.variants[a]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(a){let b=this.getClosestVariantNode();if(b)return b.variantChildren&&b.variantChildren.add(a),()=>b.variantChildren.delete(a)}addValue(a,b){let c=this.values.get(a);b!==c&&(c&&this.removeValue(a),this.bindToMotionValue(a,b),this.values.set(a,b),this.latestValues[a]=b.get())}removeValue(a){this.values.delete(a);let b=this.valueSubscriptions.get(a);b&&(b(),this.valueSubscriptions.delete(a)),delete this.latestValues[a],this.removeValueFromRenderState(a,this.renderState)}hasValue(a){return this.values.has(a)}getValue(a,b){if(this.props.values&&this.props.values[a])return this.props.values[a];let c=this.values.get(a);return void 0===c&&void 0!==b&&(c=bo(null===b?void 0:b,{owner:this}),this.addValue(a,c)),c}readValue(a,b){let c=void 0===this.latestValues[a]&&this.current?this.getBaseTargetFromProps(this.props,a)??this.readValueFromInstance(this.current,a,this.options):this.latestValues[a];if(null!=c){if("string"==typeof c&&(aC(c)||bc(c)))c=parseFloat(c);else{let d;d=c,!bp.find(ax(d))&&ai.test(b)&&(c=bd(a,b))}this.setBaseTarget(a,av(c)?c.get():c)}return av(c)?c.get():c}setBaseTarget(a,b){this.baseTarget[a]=b}getBaseTarget(a){let b,{initial:c}=this.props;if("string"==typeof c||"object"==typeof c){let d=bB(this.props,c,this.presenceContext?.custom);d&&(b=d[a])}if(c&&void 0!==b)return b;let d=this.getBaseTargetFromProps(this.props,a);return void 0===d||av(d)?void 0!==this.initialValues[a]&&void 0===b?void 0:this.baseTarget[a]:d}on(a,b){return this.events[a]||(this.events[a]=new bi),this.events[a].add(b)}notify(a,...b){this.events[a]&&this.events[a].notify(...b)}scheduleRenderMicrotask(){bj.render(this.render)}}class bF extends bE{constructor(){super(...arguments),this.KeyframeResolver=bf}sortInstanceNodePosition(a,b){return 2&a.compareDocumentPosition(b)?1:-1}getBaseTargetFromProps(a,b){let c=a.style;return c?c[b]:void 0}removeValueFromRenderState(a,{vars:b,style:c}){delete b[a],delete c[a]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);let{children:a}=this.props;av(a)&&(this.childSubscription=a.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}function bG(a){return a.replace(/([A-Z])/g,a=>`-${a.toLowerCase()}`)}let bH=(a,b)=>b&&"number"==typeof a?b.transform(a):a,bI={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},bJ=F.length;function bK(a,b,c){let{style:d,vars:e,transformOrigin:f}=a,g=!1,h=!1;for(let a in b){let c=b[a];if(G.has(a)){g=!0;continue}if(aE(a)){e[a]=c;continue}{let b=bH(c,ao[a]);a.startsWith("origin")?(h=!0,f[a]=b):d[a]=b}}if(!b.transform&&(g||c?d.transform=function(a,b,c){let d="",e=!0;for(let f=0;f<bJ;f++){let g=F[f],h=a[g];if(void 0===h)continue;let i=!0;if(!(i="number"==typeof h?h===+!!g.startsWith("scale"):0===parseFloat(h))||c){let a=bH(h,ao[g]);if(!i){e=!1;let b=bI[g]||g;d+=`${b}(${a}) `}c&&(b[g]=a)}}return d=d.trim(),c?d=c(b,e?"":d):e&&(d="none"),d}(b,a.transform,c):d.transform&&(d.transform="none")),h){let{originX:a="50%",originY:b="50%",originZ:c=0}=f;d.transformOrigin=`${a} ${b} ${c}`}}let bL={offset:"stroke-dashoffset",array:"stroke-dasharray"},bM={offset:"strokeDashoffset",array:"strokeDasharray"},bN=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function bO(a,{attrX:b,attrY:c,attrScale:d,pathLength:e,pathSpacing:f=1,pathOffset:g=0,...h},i,j,k){if(bK(a,h,j),i){a.style.viewBox&&(a.attrs.viewBox=a.style.viewBox);return}a.attrs=a.style,a.style={};let{attrs:l,style:m}=a;for(let a of(l.transform&&(m.transform=l.transform,delete l.transform),(m.transform||l.transformOrigin)&&(m.transformOrigin=l.transformOrigin??"50% 50%",delete l.transformOrigin),m.transform&&(m.transformBox=k?.transformBox??"fill-box",delete l.transformBox),bN))void 0!==l[a]&&(m[a]=l[a],delete l[a]);void 0!==b&&(l.x=b),void 0!==c&&(l.y=c),void 0!==d&&(l.scale=d),void 0!==e&&function(a,b,c=1,d=0,e=!0){a.pathLength=1;let f=e?bL:bM;a[f.offset]=W.transform(-d);let g=W.transform(b),h=W.transform(c);a[f.array]=`${g} ${h}`}(l,e,f,g,!1)}let bP=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),bQ=a=>"string"==typeof a&&"svg"===a.toLowerCase();function bR(a,{style:b,vars:c},d,e){let f,g=a.style;for(f in b)g[f]=b[f];for(f in e?.applyProjectionStyles(g,d),c)g.setProperty(f,c[f])}function bS(a,b){return b.max===b.min?0:a/(b.max-b.min)*100}let bT={correct:(a,b)=>{if(!b.target)return a;if("string"==typeof a)if(!W.test(a))return a;else a=parseFloat(a);let c=bS(a,b.target.x),d=bS(a,b.target.y);return`${c}% ${d}%`}},bU=(a,b,c)=>a+(b-a)*c,bV={borderRadius:{...bT,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:bT,borderTopRightRadius:bT,borderBottomLeftRadius:bT,borderBottomRightRadius:bT,boxShadow:{correct:(a,{treeScale:b,projectionDelta:c})=>{let d=ai.parse(a);if(d.length>5)return a;let e=ai.createTransformer(a),f=+("number"!=typeof d[0]),g=c.x.scale*b.x,h=c.y.scale*b.y;d[0+f]/=g,d[1+f]/=h;let i=bU(g,h,.5);return"number"==typeof d[2+f]&&(d[2+f]/=i),"number"==typeof d[3+f]&&(d[3+f]/=i),e(d)}}};function bW(a,{layout:b,layoutId:c}){return G.has(a)||a.startsWith("origin")||(b||void 0!==c)&&(!!bV[a]||"opacity"===a)}function bX(a,b,c){let d=a.style,e=b?.style,f={};if(!d)return f;for(let b in d)(av(d[b])||e&&av(e[b])||bW(b,a)||c?.getValue(b)?.liveStyle!==void 0)&&(f[b]=d[b]);return f}function bY(a,b,c){let d=bX(a,b,c);for(let c in a)(av(a[c])||av(b[c]))&&(d[-1!==F.indexOf(c)?"attr"+c.charAt(0).toUpperCase()+c.substring(1):c]=a[c]);return d}class bZ extends bF{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=au}getBaseTargetFromProps(a,b){return a[b]}readValueFromInstance(a,b){if(G.has(b)){let a=aq(b);return a&&a.default||0}return b=bP.has(b)?b:bG(b),a.getAttribute(b)}scrapeMotionValuesFromProps(a,b,c){return bY(a,b,c)}build(a,b,c){bO(a,b,this.isSVGTag,c.transformTemplate,c.style)}renderInstance(a,b,c,d){for(let c in bR(a,b,void 0,d),b.attrs)a.setAttribute(bP.has(c)?c:bG(c),b.attrs[c])}mount(a){this.isSVGTag=bQ(a.tagName),super.mount(a)}}function b$({top:a,left:b,right:c,bottom:d}){return{x:{min:b,max:c},y:{min:a,max:d}}}function b_(a){return void 0===a||1===a}function b0({scale:a,scaleX:b,scaleY:c}){return!b_(a)||!b_(b)||!b_(c)}function b1(a){return b0(a)||b2(a)||a.z||a.rotate||a.rotateX||a.rotateY||a.skewX||a.skewY}function b2(a){var b,c;return(b=a.x)&&"0%"!==b||(c=a.y)&&"0%"!==c}function b3(a,b,c,d,e){return void 0!==e&&(a=d+e*(a-d)),d+c*(a-d)+b}function b4(a,b=0,c=1,d,e){a.min=b3(a.min,b,c,d,e),a.max=b3(a.max,b,c,d,e)}function b5(a,{x:b,y:c}){b4(a.x,b.translate,b.scale,b.originPoint),b4(a.y,c.translate,c.scale,c.originPoint)}function b6(a,b){a.min=a.min+b,a.max=a.max+b}function b7(a,b,c,d,e=.5){let f=bU(a.min,a.max,e);b4(a,b,c,f,d)}function b8(a,b){b7(a.x,b.x,b.scaleX,b.scale,b.originX),b7(a.y,b.y,b.scaleY,b.scale,b.originY)}function b9(a,b){return b$(function(a,b){if(!b)return a;let c=b({x:a.left,y:a.top}),d=b({x:a.right,y:a.bottom});return{top:c.y,left:c.x,bottom:d.y,right:d.x}}(a.getBoundingClientRect(),b))}class ca extends bF{constructor(){super(...arguments),this.type="html",this.renderInstance=bR}readValueFromInstance(a,b){if(G.has(b))return this.projection?.isProjecting?aR(b):((a,b)=>{let{transform:c="none"}=getComputedStyle(a);return aS(c,b)})(a,b);{let c=window.getComputedStyle(a),d=(aE(b)?c.getPropertyValue(b):c[b])||0;return"string"==typeof d?d.trim():d}}measureInstanceViewportBox(a,{transformPagePoint:b}){return b9(a,b)}build(a,b,c){bK(a,b,c.transformTemplate)}scrapeMotionValuesFromProps(a,b,c){return bX(a,b,c)}}let cb=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function cc(a){if("string"!=typeof a||a.includes("-"));else if(cb.indexOf(a)>-1||/[A-Z]/u.test(a))return!0;return!1}let cd=(0,m.createContext)({strict:!1}),ce=(0,m.createContext)({});function cf(a){return Array.isArray(a)?a.join(" "):a}let cg=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ch(a,b,c){for(let d in b)av(b[d])||bW(d,c)||(a[d]=b[d])}let ci=()=>({...cg(),attrs:{}}),cj=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ck(a){return a.startsWith("while")||a.startsWith("drag")&&"draggable"!==a||a.startsWith("layout")||a.startsWith("onTap")||a.startsWith("onPan")||a.startsWith("onLayout")||cj.has(a)}let cl=a=>!ck(a);try{!function(a){"function"==typeof a&&(cl=b=>b.startsWith("on")?!ck(b):a(b))}(require("@emotion/is-prop-valid").default)}catch{}function cm(a){return av(a)?a.get():a}let cn=a=>(b,c)=>{let d=(0,m.useContext)(ce),e=(0,m.useContext)(s),f=()=>(function({scrapeMotionValuesFromProps:a,createRenderState:b},c,d,e){return{latestValues:function(a,b,c,d){let e={},f=d(a,{});for(let a in f)e[a]=cm(f[a]);let{initial:g,animate:h}=a,i=by(a),j=bz(a);b&&j&&!i&&!1!==a.inherit&&(void 0===g&&(g=b.initial),void 0===h&&(h=b.animate));let k=!!c&&!1===c.initial,l=(k=k||!1===g)?h:g;if(l&&"boolean"!=typeof l&&!bu(l)){let b=Array.isArray(l)?l:[l];for(let c=0;c<b.length;c++){let d=bB(a,b[c]);if(d){let{transitionEnd:a,transition:b,...c}=d;for(let a in c){let b=c[a];if(Array.isArray(b)){let a=k?b.length-1:0;b=b[a]}null!==b&&(e[a]=b)}for(let b in a)e[b]=a[b]}}}return e}(c,d,e,a),renderState:b()}})(a,b,d,e);return c?f():p(f)},co=cn({scrapeMotionValuesFromProps:bX,createRenderState:cg}),cp=cn({scrapeMotionValuesFromProps:bY,createRenderState:ci}),cq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},cr=!1;function cs(){return!function(){if(cr)return;let a={};for(let b in cq)a[b]={isEnabled:a=>cq[b].some(b=>!!a[b])};bD=a,cr=!0}(),bD}let ct=Symbol.for("motionComponentSymbol"),cu="data-"+bG("framerAppearId"),cv=(0,m.createContext)({});function cw(a){return a&&"object"==typeof a&&Object.prototype.hasOwnProperty.call(a,"current")}function cx(a,{forwardMotionProps:b=!1,type:c}={},d,e){d&&function(a){let b=cs();for(let c in a)b[c]={...b[c],...a[c]};bD=b}(d);let f=c?"svg"===c:cc(a),g=f?cp:co;function h(c,d){let h,i={...(0,m.useContext)(v),...c,layoutId:function({layoutId:a}){let b=(0,m.useContext)(o).id;return b&&void 0!==a?b+"-"+a:a}(c)},{isStatic:j}=i,k=function(a){let{initial:b,animate:c}=function(a,b){if(by(a)){let{initial:b,animate:c}=a;return{initial:!1===b||bv(b)?b:void 0,animate:bv(c)?c:void 0}}return!1!==a.inherit?b:{}}(a,(0,m.useContext)(ce));return(0,m.useMemo)(()=>({initial:b,animate:c}),[cf(b),cf(c)])}(c),n=g(c,j);if(!j&&q){(0,m.useContext)(cd).strict;let b=function(a){let{drag:b,layout:c}=cs();if(!b&&!c)return{};let d={...b,...c};return{MeasureLayout:b?.isEnabled(a)||c?.isEnabled(a)?d.MeasureLayout:void 0,ProjectionNode:d.ProjectionNode}}(i);h=b.MeasureLayout,k.visualElement=function(a,b,c,d,e,f){let{visualElement:g}=(0,m.useContext)(ce),h=(0,m.useContext)(cd),i=(0,m.useContext)(s),j=(0,m.useContext)(v).reducedMotion,k=(0,m.useRef)(null);d=d||h.renderer,!k.current&&d&&(k.current=d(a,{visualState:b,parent:g,props:c,presenceContext:i,blockInitialAnimation:!!i&&!1===i.initial,reducedMotionConfig:j,isSVG:f}));let l=k.current,n=(0,m.useContext)(cv);l&&!l.projection&&e&&("html"===l.type||"svg"===l.type)&&function(a,b,c,d){let{layoutId:e,layout:f,drag:g,dragConstraints:h,layoutScroll:i,layoutRoot:j,layoutCrossfade:k}=b;a.projection=new c(a.latestValues,b["data-framer-portal-id"]?void 0:function a(b){if(b)return!1!==b.options.allowProjection?b.projection:a(b.parent)}(a.parent)),a.projection.setOptions({layoutId:e,layout:f,alwaysMeasureLayout:!!g||h&&cw(h),visualElement:a,animationType:"string"==typeof f?f:"both",initialPromotionConfig:d,crossfade:k,layoutScroll:i,layoutRoot:j})}(k.current,c,e,n);let o=(0,m.useRef)(!1);(0,m.useInsertionEffect)(()=>{l&&o.current&&l.update(c,i)});let p=c[cu],q=(0,m.useRef)(!!p&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return r(()=>{l&&(o.current=!0,window.MotionIsMounted=!0,l.updateFeatures(),l.scheduleRenderMicrotask(),q.current&&l.animationState&&l.animationState.animateChanges())}),l}(a,n,i,e,b.ProjectionNode,f)}return(0,l.jsxs)(ce.Provider,{value:k,children:[h&&k.visualElement?(0,l.jsx)(h,{visualElement:k.visualElement,...i}):null,function(a,b,c,{latestValues:d},e,f=!1,g){let h=(g??cc(a)?function(a,b,c,d){let e=(0,m.useMemo)(()=>{let c=ci();return bO(c,b,bQ(d),a.transformTemplate,a.style),{...c.attrs,style:{...c.style}}},[b]);if(a.style){let b={};ch(b,a.style,a),e.style={...b,...e.style}}return e}:function(a,b){let c={},d=function(a,b){let c=a.style||{},d={};return ch(d,c,a),Object.assign(d,function({transformTemplate:a},b){return(0,m.useMemo)(()=>{let c=cg();return bK(c,b,a),Object.assign({},c.vars,c.style)},[b])}(a,b)),d}(a,b);return a.drag&&!1!==a.dragListener&&(c.draggable=!1,d.userSelect=d.WebkitUserSelect=d.WebkitTouchCallout="none",d.touchAction=!0===a.drag?"none":`pan-${"x"===a.drag?"y":"x"}`),void 0===a.tabIndex&&(a.onTap||a.onTapStart||a.whileTap)&&(c.tabIndex=0),c.style=d,c})(b,d,e,a),i=function(a,b,c){let d={};for(let e in a)("values"!==e||"object"!=typeof a.values)&&(cl(e)||!0===c&&ck(e)||!b&&!ck(e)||a.draggable&&e.startsWith("onDrag"))&&(d[e]=a[e]);return d}(b,"string"==typeof a,f),j=a!==m.Fragment?{...i,...h,ref:c}:{},{children:k}=b,l=(0,m.useMemo)(()=>av(k)?k.get():k,[k]);return(0,m.createElement)(a,{...j,children:l})}(a,c,function(a,b,c){let d=(0,m.useRef)(c);(0,m.useInsertionEffect)(()=>{d.current=c});let e=(0,m.useRef)(null);return(0,m.useCallback)(c=>{c&&a.onMount?.(c),b&&(c?b.mount(c):b.unmount());let f=d.current;if("function"==typeof f)if(c){let a=f(c);"function"==typeof a&&(e.current=a)}else e.current?(e.current(),e.current=null):f(c);else f&&(f.current=c)},[b])}(n,k.visualElement,d),n,j,b,f)]})}h.displayName=`motion.${"string"==typeof a?a:`create(${a.displayName??a.name??""})`}`;let i=(0,m.forwardRef)(h);return i[ct]=a,i}class cy{constructor(a){this.isMounted=!1,this.node=a}update(){}}function cz(a,b,c){let d=a.getProps();return bB(d,b,void 0!==c?c:d.custom,a)}function cA(a,b){return a?.[b]??a?.default??a}let cB=a=>Array.isArray(a);function cC(a,b){let c=a.getValue("willChange");if(av(c)&&c.add)return c.add(b);if(!c&&aZ.WillChange){let c=new aZ.WillChange("auto");a.addValue("willChange",c),c.add(b)}}let cD=a=>1e3*a,cE=(a,b)=>c=>b(a(c)),cF=(...a)=>a.reduce(cE),cG={layout:0,mainThread:0,waapi:0};function cH(a,b,c){return(c<0&&(c+=1),c>1&&(c-=1),c<1/6)?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}function cI(a,b){return c=>c>0?b:a}let cJ=(a,b,c)=>{let d=a*a,e=c*(b*b-d)+d;return e<0?0:Math.sqrt(e)},cK=[S,R,$];function cL(a){let b=cK.find(b=>b.test(a));if(aA(!!b,`'${a}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!b)return!1;let c=b.parse(a);return b===$&&(c=function({hue:a,saturation:b,lightness:c,alpha:d}){a/=360,c/=100;let e=0,f=0,g=0;if(b/=100){let d=c<.5?c*(1+b):c+b-c*b,h=2*c-d;e=cH(h,d,a+1/3),f=cH(h,d,a),g=cH(h,d,a-1/3)}else e=f=g=c;return{red:Math.round(255*e),green:Math.round(255*f),blue:Math.round(255*g),alpha:d}}(c)),c}let cM=(a,b)=>{let c=cL(a),d=cL(b);if(!c||!d)return cI(a,b);let e={...c};return a=>(e.red=cJ(c.red,d.red,a),e.green=cJ(c.green,d.green,a),e.blue=cJ(c.blue,d.blue,a),e.alpha=bU(c.alpha,d.alpha,a),R.transform(e))},cN=new Set(["none","hidden"]);function cO(a,b){return c=>bU(a,b,c)}function cP(a){return"number"==typeof a?cO:"string"==typeof a?aG(a)?cI:_.test(a)?cM:cS:Array.isArray(a)?cQ:"object"==typeof a?_.test(a)?cM:cR:cI}function cQ(a,b){let c=[...a],d=c.length,e=a.map((a,c)=>cP(a)(a,b[c]));return a=>{for(let b=0;b<d;b++)c[b]=e[b](a);return c}}function cR(a,b){let c={...a,...b},d={};for(let e in c)void 0!==a[e]&&void 0!==b[e]&&(d[e]=cP(a[e])(a[e],b[e]));return a=>{for(let b in d)c[b]=d[b](a);return c}}let cS=(a,b)=>{let c=ai.createTransformer(b),d=ae(a),e=ae(b);return d.indexes.var.length===e.indexes.var.length&&d.indexes.color.length===e.indexes.color.length&&d.indexes.number.length>=e.indexes.number.length?cN.has(a)&&!e.values.length||cN.has(b)&&!d.values.length?function(a,b){return cN.has(a)?c=>c<=0?a:b:c=>c>=1?b:a}(a,b):cF(cQ(function(a,b){let c=[],d={color:0,var:0,number:0};for(let e=0;e<b.values.length;e++){let f=b.types[e],g=a.indexes[f][d[f]],h=a.values[g]??0;c[e]=h,d[f]++}return c}(d,e),e.values),c):(aA(!0,`Complex values '${a}' and '${b}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),cI(a,b))};function cT(a,b,c){return"number"==typeof a&&"number"==typeof b&&"number"==typeof c?bU(a,b,c):cP(a)(a,b)}let cU=a=>{let b=({timestamp:b})=>a(b);return{start:(a=!0)=>a1.update(b,a),stop:()=>a2(b),now:()=>a3.isProcessing?a3.timestamp:bl.now()}},cV=(a,b,c=10)=>{let d="",e=Math.max(Math.round(b/c),2);for(let b=0;b<e;b++)d+=Math.round(1e4*a(b/(e-1)))/1e4+", ";return`linear(${d.substring(0,d.length-2)})`};function cW(a){let b=0,c=a.next(b);for(;!c.done&&b<2e4;)b+=50,c=a.next(b);return b>=2e4?1/0:b}function cX(a,b,c){var d,e;let f=Math.max(b-5,0);return d=c-a(f),(e=b-f)?1e3/e*d:0}let cY={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1};function cZ(a,b){return a*Math.sqrt(1-b*b)}let c$=["duration","bounce"],c_=["stiffness","damping","mass"];function c0(a,b){return b.some(b=>void 0!==a[b])}function c1(a=cY.visualDuration,b=cY.bounce){let c,d="object"!=typeof a?{visualDuration:a,keyframes:[0,1],bounce:b}:a,{restSpeed:e,restDelta:f}=d,g=d.keyframes[0],h=d.keyframes[d.keyframes.length-1],i={done:!1,value:g},{stiffness:j,damping:k,mass:l,duration:m,velocity:n,isResolvedFromDuration:o}=function(a){let b={velocity:cY.velocity,stiffness:cY.stiffness,damping:cY.damping,mass:cY.mass,isResolvedFromDuration:!1,...a};if(!c0(a,c_)&&c0(a,c$))if(a.visualDuration){let c=2*Math.PI/(1.2*a.visualDuration),d=c*c,e=2*H(.05,1,1-(a.bounce||0))*Math.sqrt(d);b={...b,mass:cY.mass,stiffness:d,damping:e}}else{let c=function({duration:a=cY.duration,bounce:b=cY.bounce,velocity:c=cY.velocity,mass:d=cY.mass}){let e,f;aA(a<=cD(cY.maxDuration),"Spring duration must be 10 seconds or less","spring-duration-limit");let g=1-b;g=H(cY.minDamping,cY.maxDamping,g),a=H(cY.minDuration,cY.maxDuration,a/1e3),g<1?(e=b=>{let d=b*g,e=d*a;return .001-(d-c)/cZ(b,g)*Math.exp(-e)},f=b=>{let d=b*g*a,f=Math.pow(g,2)*Math.pow(b,2)*a,h=Math.exp(-d),i=cZ(Math.pow(b,2),g);return(d*c+c-f)*h*(-e(b)+.001>0?-1:1)/i}):(e=b=>-.001+Math.exp(-b*a)*((b-c)*a+1),f=b=>a*a*(c-b)*Math.exp(-b*a));let h=function(a,b,c){let d=c;for(let c=1;c<12;c++)d-=a(d)/b(d);return d}(e,f,5/a);if(a=cD(a),isNaN(h))return{stiffness:cY.stiffness,damping:cY.damping,duration:a};{let b=Math.pow(h,2)*d;return{stiffness:b,damping:2*g*Math.sqrt(d*b),duration:a}}}(a);(b={...b,...c,mass:cY.mass}).isResolvedFromDuration=!0}return b}({...d,velocity:-((d.velocity||0)/1e3)}),p=n||0,q=k/(2*Math.sqrt(j*l)),r=h-g,s=Math.sqrt(j/l)/1e3,t=5>Math.abs(r);if(e||(e=t?cY.restSpeed.granular:cY.restSpeed.default),f||(f=t?cY.restDelta.granular:cY.restDelta.default),q<1){let a=cZ(s,q);c=b=>h-Math.exp(-q*s*b)*((p+q*s*r)/a*Math.sin(a*b)+r*Math.cos(a*b))}else if(1===q)c=a=>h-Math.exp(-s*a)*(r+(p+s*r)*a);else{let a=s*Math.sqrt(q*q-1);c=b=>{let c=Math.exp(-q*s*b),d=Math.min(a*b,300);return h-c*((p+q*s*r)*Math.sinh(d)+a*r*Math.cosh(d))/a}}let u={calculatedDuration:o&&m||null,next:a=>{let b=c(a);if(o)i.done=a>=m;else{let d=0===a?p:0;q<1&&(d=0===a?cD(p):cX(c,a,b));let g=Math.abs(h-b)<=f;i.done=Math.abs(d)<=e&&g}return i.value=i.done?h:b,i},toString:()=>{let a=Math.min(cW(u),2e4),b=cV(b=>u.next(a*b).value,a,30);return a+"ms "+b},toTransition:()=>{}};return u}function c2({keyframes:a,velocity:b=0,power:c=.8,timeConstant:d=325,bounceDamping:e=10,bounceStiffness:f=500,modifyTarget:g,min:h,max:i,restDelta:j=.5,restSpeed:k}){let l,m,n=a[0],o={done:!1,value:n},p=c*b,q=n+p,r=void 0===g?q:g(q);r!==q&&(p=r-n);let s=a=>-p*Math.exp(-a/d),t=a=>r+s(a),u=a=>{let b=s(a),c=t(a);o.done=Math.abs(b)<=j,o.value=o.done?r:c},v=a=>{let b;if(b=o.value,void 0!==h&&b<h||void 0!==i&&b>i){var c;l=a,m=c1({keyframes:[o.value,(c=o.value,void 0===h?i:void 0===i||Math.abs(h-c)<Math.abs(i-c)?h:i)],velocity:cX(t,a,o.value),damping:e,stiffness:f,restDelta:j,restSpeed:k})}};return v(0),{calculatedDuration:null,next:a=>{let b=!1;return(m||void 0!==l||(b=!0,u(a),v(a)),void 0!==l&&a>=l)?m.next(a-l):(b||u(a),o)}}}c1.applyToOptions=a=>{let b=function(a,b=100,c){let d=c({...a,keyframes:[0,b]}),e=Math.min(cW(d),2e4);return{type:"keyframes",ease:a=>d.next(e*a).value/b,duration:e/1e3}}(a,100,c1);return a.ease=b.ease,a.duration=cD(b.duration),a.type="keyframes",a};let c3=(a,b,c)=>(((1-3*c+3*b)*a+(3*c-6*b))*a+3*b)*a;function c4(a,b,c,d){return a===b&&c===d?aY:e=>0===e||1===e?e:c3(function(a,b,c,d,e){let f,g,h=0;do(f=c3(g=b+(c-b)/2,d,e)-a)>0?c=g:b=g;while(Math.abs(f)>1e-7&&++h<12);return g}(e,0,1,a,c),b,d)}let c5=c4(.42,0,1,1),c6=c4(0,0,.58,1),c7=c4(.42,0,.58,1),c8=a=>b=>b<=.5?a(2*b)/2:(2-a(2*(1-b)))/2,c9=a=>b=>1-a(1-b),da=c4(.33,1.53,.69,.99),db=c9(da),dc=c8(db),dd=a=>(a*=2)<1?.5*db(a):.5*(2-Math.pow(2,-10*(a-1))),de=a=>1-Math.sin(Math.acos(a)),df=c9(de),dg=c8(de),dh=a=>Array.isArray(a)&&"number"==typeof a[0],di={linear:aY,easeIn:c5,easeInOut:c7,easeOut:c6,circIn:de,circInOut:dg,circOut:df,backIn:db,backInOut:dc,backOut:da,anticipate:dd},dj=a=>{if(dh(a)){aB(4===a.length,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");let[b,c,d,e]=a;return c4(b,c,d,e)}return"string"==typeof a?(aB(void 0!==di[a],`Invalid easing type '${a}'`,"invalid-easing-type"),di[a]):a},dk=(a,b,c)=>{let d=b-a;return 0===d?1:(c-a)/d};function dl({duration:a=300,keyframes:b,times:c,ease:d="easeInOut"}){var e;let f=Array.isArray(d)&&"number"!=typeof d[0]?d.map(dj):dj(d),g={done:!1,value:b[0]},h=function(a,b,{clamp:c=!0,ease:d,mixer:e}={}){let f=a.length;if(aB(f===b.length,"Both input and output ranges must be the same length","range-length"),1===f)return()=>b[0];if(2===f&&b[0]===b[1])return()=>b[1];let g=a[0]===a[1];a[0]>a[f-1]&&(a=[...a].reverse(),b=[...b].reverse());let h=function(a,b,c){let d=[],e=c||aZ.mix||cT,f=a.length-1;for(let c=0;c<f;c++){let f=e(a[c],a[c+1]);b&&(f=cF(Array.isArray(b)?b[c]||aY:b,f)),d.push(f)}return d}(b,d,e),i=h.length,j=c=>{if(g&&c<a[0])return b[0];let d=0;if(i>1)for(;d<a.length-2&&!(c<a[d+1]);d++);let e=dk(a[d],a[d+1],c);return h[d](e)};return c?b=>j(H(a[0],a[f-1],b)):j}((e=c&&c.length===b.length?c:function(a){let b=[0];return!function(a,b){let c=a[a.length-1];for(let d=1;d<=b;d++){let e=dk(0,b,d);a.push(bU(c,1,e))}}(b,a.length-1),b}(b),e.map(b=>b*a)),b,{ease:Array.isArray(f)?f:b.map(()=>f||c7).splice(0,b.length-1)});return{calculatedDuration:a,next:b=>(g.value=h(b),g.done=b>=a,g)}}let dm=a=>null!==a;function dn(a,{repeat:b,repeatType:c="loop"},d,e=1){let f=a.filter(dm),g=e<0||b&&"loop"!==c&&b%2==1?0:f.length-1;return g&&void 0!==d?d:f[g]}let dp={decay:c2,inertia:c2,tween:dl,keyframes:dl,spring:c1};function dq(a){"string"==typeof a.type&&(a.type=dp[a.type])}class dr{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(a=>{this.resolve=a})}notifyFinished(){this.resolve()}then(a,b){return this.finished.then(a,b)}}let ds=a=>a/100;class dt extends dr{constructor(a){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{let{motionValue:a}=this.options;a&&a.updatedAt!==bl.now()&&this.tick(bl.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},cG.mainThread++,this.options=a,this.initAnimation(),this.play(),!1===a.autoplay&&this.pause()}initAnimation(){let{options:a}=this;dq(a);let{type:b=dl,repeat:c=0,repeatDelay:d=0,repeatType:e,velocity:f=0}=a,{keyframes:g}=a,h=b||dl;h!==dl&&"number"!=typeof g[0]&&(this.mixKeyframes=cF(ds,cT(g[0],g[1])),g=[0,100]);let i=h({...a,keyframes:g});"mirror"===e&&(this.mirroredGenerator=h({...a,keyframes:[...g].reverse(),velocity:-f})),null===i.calculatedDuration&&(i.calculatedDuration=cW(i));let{calculatedDuration:j}=i;this.calculatedDuration=j,this.resolvedDuration=j+d,this.totalDuration=this.resolvedDuration*(c+1)-d,this.generator=i}updateTime(a){let b=Math.round(a-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=b}tick(a,b=!1){let{generator:c,totalDuration:d,mixKeyframes:e,mirroredGenerator:f,resolvedDuration:g,calculatedDuration:h}=this;if(null===this.startTime)return c.next(0);let{delay:i=0,keyframes:j,repeat:k,repeatType:l,repeatDelay:m,type:n,onUpdate:o,finalKeyframe:p}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,a):this.speed<0&&(this.startTime=Math.min(a-d/this.speed,this.startTime)),b?this.currentTime=a:this.updateTime(a);let q=this.currentTime-i*(this.playbackSpeed>=0?1:-1),r=this.playbackSpeed>=0?q<0:q>d;this.currentTime=Math.max(q,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=d);let s=this.currentTime,t=c;if(k){let a=Math.min(this.currentTime,d)/g,b=Math.floor(a),c=a%1;!c&&a>=1&&(c=1),1===c&&b--,(b=Math.min(b,k+1))%2&&("reverse"===l?(c=1-c,m&&(c-=m/g)):"mirror"===l&&(t=f)),s=H(0,1,c)*g}let u=r?{done:!1,value:j[0]}:t.next(s);e&&(u.value=e(u.value));let{done:v}=u;r||null===h||(v=this.playbackSpeed>=0?this.currentTime>=d:this.currentTime<=0);let w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&v);return w&&n!==c2&&(u.value=dn(j,this.options,p,this.speed)),o&&o(u.value),w&&this.finish(),u}then(a,b){return this.finished.then(a,b)}get duration(){return this.calculatedDuration/1e3}get iterationDuration(){let{delay:a=0}=this.options||{};return this.duration+a/1e3}get time(){return this.currentTime/1e3}set time(a){a=cD(a),this.currentTime=a,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=a:this.driver&&(this.startTime=this.driver.now()-a/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(a){this.updateTime(bl.now());let b=this.playbackSpeed!==a;this.playbackSpeed=a,b&&(this.time=this.currentTime/1e3)}play(){if(this.isStopped)return;let{driver:a=cU,startTime:b}=this.options;this.driver||(this.driver=a(a=>this.tick(a))),this.options.onPlay?.();let c=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=c):null!==this.holdTime?this.startTime=c-this.holdTime:this.startTime||(this.startTime=b??c),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(bl.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,cG.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(a){return this.startTime=0,this.tick(a,!0)}attachTimeline(a){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),a.observe(this)}}function du(a){let b;return()=>(void 0===b&&(b=a()),b)}let dv=du(()=>void 0!==window.ScrollTimeline),dw={},dx=function(a,b){let c=du(a);return()=>dw[b]??c()}(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(a){return!1}return!0},"linearEasing"),dy=([a,b,c,d])=>`cubic-bezier(${a}, ${b}, ${c}, ${d})`,dz={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:dy([0,.65,.55,1]),circOut:dy([.55,0,1,.45]),backIn:dy([.31,.01,.66,-.59]),backOut:dy([.33,1.53,.69,.99])};function dA(a){return"function"==typeof a&&"applyToOptions"in a}class dB extends dr{constructor(a){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!a)return;let{element:b,name:c,keyframes:d,pseudoElement:e,allowFlatten:f=!1,finalKeyframe:g,onComplete:h}=a;this.isPseudoElement=!!e,this.allowFlatten=f,this.options=a,aB("string"!=typeof a.type,'Mini animate() doesn\'t support "type" as a string.',"mini-spring");let i=function({type:a,...b}){return dA(a)&&dx()?a.applyToOptions(b):(b.duration??(b.duration=300),b.ease??(b.ease="easeOut"),b)}(a);this.animation=function(a,b,c,{delay:d=0,duration:e=300,repeat:f=0,repeatType:g="loop",ease:h="easeOut",times:i}={},j){let k={[b]:c};i&&(k.offset=i);let l=function a(b,c){if(b)return"function"==typeof b?dx()?cV(b,c):"ease-out":dh(b)?dy(b):Array.isArray(b)?b.map(b=>a(b,c)||dz.easeOut):dz[b]}(h,e);Array.isArray(l)&&(k.easing=l),a_.value&&cG.waapi++;let m={delay:d,duration:e,easing:Array.isArray(l)?"linear":l,fill:"both",iterations:f+1,direction:"reverse"===g?"alternate":"normal"};j&&(m.pseudoElement=j);let n=a.animate(k,m);return a_.value&&n.finished.finally(()=>{cG.waapi--}),n}(b,c,d,i,e),!1===i.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!e){let a=dn(d,this.options,g,this.speed);this.updateMotionValue?this.updateMotionValue(a):function(a,b,c){b.startsWith("--")?a.style.setProperty(b,c):a.style[b]=c}(b,c,a),this.animation.cancel()}h?.(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(a){}}stop(){if(this.isStopped)return;this.isStopped=!0;let{state:a}=this;"idle"!==a&&"finished"!==a&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){return Number(this.animation.effect?.getComputedTiming?.().duration||0)/1e3}get iterationDuration(){let{delay:a=0}=this.options||{};return this.duration+a/1e3}get time(){return(Number(this.animation.currentTime)||0)/1e3}set time(a){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=cD(a)}get speed(){return this.animation.playbackRate}set speed(a){a<0&&(this.finishedTime=null),this.animation.playbackRate=a}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(a){this.manualStartTime=this.animation.startTime=a}attachTimeline({timeline:a,observe:b}){return(this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,a&&dv())?(this.animation.timeline=a,aY):b(this)}}let dC={anticipate:dd,backInOut:dc,circInOut:dg};class dD extends dB{constructor(a){!function(a){"string"==typeof a.ease&&a.ease in dC&&(a.ease=dC[a.ease])}(a),dq(a),super(a),void 0!==a.startTime&&(this.startTime=a.startTime),this.options=a}updateMotionValue(a){let{motionValue:b,onUpdate:c,onComplete:d,element:e,...f}=this.options;if(!b)return;if(void 0!==a)return void b.set(a);let g=new dt({...f,autoplay:!1}),h=Math.max(10,bl.now()-this.startTime),i=H(0,10,h-10);b.setWithVelocity(g.sample(Math.max(0,h-i)).value,g.sample(h).value,i),g.stop()}}let dE=(a,b)=>"zIndex"!==b&&!!("number"==typeof a||Array.isArray(a)||"string"==typeof a&&(ai.test(a)||"0"===a)&&!a.startsWith("url("));function dF(a){a.duration=0,a.type="keyframes"}let dG=new Set(["opacity","clipPath","filter","transform"]),dH=du(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class dI extends dr{constructor({autoplay:a=!0,delay:b=0,type:c="keyframes",repeat:d=0,repeatDelay:e=0,repeatType:f="loop",keyframes:g,name:h,motionValue:i,element:j,...k}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=bl.now();let l={autoplay:a,delay:b,type:c,repeat:d,repeatDelay:e,repeatType:f,name:h,motionValue:i,element:j,...k},m=j?.KeyframeResolver||bb;this.keyframeResolver=new m(g,(a,b,c)=>this.onKeyframesResolved(a,b,l,!c),h,i,j),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(a,b,c,d){this.keyframeResolver=void 0;let{name:e,type:f,velocity:g,delay:h,isHandoff:i,onUpdate:j}=c;this.resolvedAt=bl.now(),!function(a,b,c,d){let e=a[0];if(null===e)return!1;if("display"===b||"visibility"===b)return!0;let f=a[a.length-1],g=dE(e,b),h=dE(f,b);return aA(g===h,`You are trying to animate ${b} from "${e}" to "${f}". "${g?f:e}" is not an animatable value.`,"value-not-animatable"),!!g&&!!h&&(function(a){let b=a[0];if(1===a.length)return!0;for(let c=0;c<a.length;c++)if(a[c]!==b)return!0}(a)||("spring"===c||dA(c))&&d)}(a,e,f,g)&&((aZ.instantAnimations||!h)&&j?.(dn(a,c,b)),a[0]=a[a.length-1],dF(c),c.repeat=0);let k={startTime:d?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:b,...c,keyframes:a},l=!i&&function(a){let{motionValue:b,name:c,repeatDelay:d,repeatType:e,damping:f,type:g}=a;if(!(b?.owner?.current instanceof HTMLElement))return!1;let{onUpdate:h,transformTemplate:i}=b.owner.getProps();return dH()&&c&&dG.has(c)&&("transform"!==c||!i)&&!h&&!d&&"mirror"!==e&&0!==f&&"inertia"!==g}(k),m=k.motionValue?.owner?.current,n=l?new dD({...k,element:m}):new dt(k);n.finished.then(()=>{this.notifyFinished()}).catch(aY),this.pendingTimeline&&(this.stopTimeline=n.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=n}get finished(){return this._animation?this.animation.finished:this._finished}then(a,b){return this.finished.finally(a).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),a8=!0,ba(),a9(),a8=!1),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(a){this.animation.time=a}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(a){this.animation.speed=a}get startTime(){return this.animation.startTime}attachTimeline(a){return this._animation?this.stopTimeline=this.animation.attachTimeline(a):this.pendingTimeline=a,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}let dJ={type:"spring",stiffness:500,damping:25,restSpeed:10},dK={type:"keyframes",duration:.8},dL={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},dM=a=>null!==a,dN=(a,b,c,d={},e,f)=>g=>{let h=cA(d,a)||{},i=h.delay||d.delay||0,{elapsed:j=0}=d;j-=cD(i);let k={keyframes:Array.isArray(c)?c:[null,c],ease:"easeOut",velocity:b.getVelocity(),...h,delay:-j,onUpdate:a=>{b.set(a),h.onUpdate&&h.onUpdate(a)},onComplete:()=>{g(),h.onComplete&&h.onComplete()},name:a,motionValue:b,element:f?void 0:e};!function({when:a,delay:b,delayChildren:c,staggerChildren:d,staggerDirection:e,repeat:f,repeatType:g,repeatDelay:h,from:i,elapsed:j,...k}){return!!Object.keys(k).length}(h)&&Object.assign(k,((a,{keyframes:b})=>b.length>2?dK:G.has(a)?a.startsWith("scale")?{type:"spring",stiffness:550,damping:0===b[1]?2*Math.sqrt(550):30,restSpeed:10}:dJ:dL)(a,k)),k.duration&&(k.duration=cD(k.duration)),k.repeatDelay&&(k.repeatDelay=cD(k.repeatDelay)),void 0!==k.from&&(k.keyframes[0]=k.from);let l=!1;if(!1!==k.type&&(0!==k.duration||k.repeatDelay)||(dF(k),0===k.delay&&(l=!0)),(aZ.instantAnimations||aZ.skipAnimations)&&(l=!0,dF(k),k.delay=0),k.allowFlatten=!h.type&&!h.ease,l&&!f&&void 0!==b.get()){let a=function(a,{repeat:b,repeatType:c="loop"},d){let e=a.filter(dM),f=b&&"loop"!==c&&b%2==1?0:e.length-1;return e[f]}(k.keyframes,h);if(void 0!==a)return void a1.update(()=>{k.onUpdate(a),k.onComplete()})}return h.isSync?new dt(k):new dI(k)};function dO(a,b,{delay:c=0,transitionOverride:d,type:e}={}){let{transition:f=a.getDefaultTransition(),transitionEnd:g,...h}=b;d&&(f=d);let i=[],j=e&&a.animationState&&a.animationState.getState()[e];for(let b in h){let d=a.getValue(b,a.latestValues[b]??null),e=h[b];if(void 0===e||j&&function({protectedKeys:a,needsAnimating:b},c){let d=a.hasOwnProperty(c)&&!0!==b[c];return b[c]=!1,d}(j,b))continue;let g={delay:c,...cA(f||{},b)},k=d.get();if(void 0!==k&&!d.isAnimating&&!Array.isArray(e)&&e===k&&!g.velocity)continue;let l=!1;if(window.MotionHandoffAnimation){let c=a.props[cu];if(c){let a=window.MotionHandoffAnimation(c,b,a1);null!==a&&(g.startTime=a,l=!0)}}cC(a,b),d.start(dN(b,d,e,a.shouldReduceMotion&&aw.has(b)?{type:!1}:g,a,l));let m=d.animation;m&&i.push(m)}return g&&Promise.all(i).then(()=>{a1.update(()=>{g&&function(a,b){let{transitionEnd:c={},transition:d={},...e}=cz(a,b)||{};for(let b in e={...e,...c}){var f;let c=cB(f=e[b])?f[f.length-1]||0:f;a.hasValue(b)?a.getValue(b).set(c):a.addValue(b,bo(c))}}(a,g)})}),i}function dP(a,b,c,d=0,e=1){let f=Array.from(a).sort((a,b)=>a.sortNodePosition(b)).indexOf(b),g=a.size,h=(g-1)*d;return"function"==typeof c?c(f,g):1===e?f*d:h-f*d}function dQ(a,b,c={}){let d=cz(a,b,"exit"===c.type?a.presenceContext?.custom:void 0),{transition:e=a.getDefaultTransition()||{}}=d||{};c.transitionOverride&&(e=c.transitionOverride);let f=d?()=>Promise.all(dO(a,d,c)):()=>Promise.resolve(),g=a.variantChildren&&a.variantChildren.size?(d=0)=>{let{delayChildren:f=0,staggerChildren:g,staggerDirection:h}=e;return function(a,b,c=0,d=0,e=0,f=1,g){let h=[];for(let i of a.variantChildren)i.notify("AnimationStart",b),h.push(dQ(i,b,{...g,delay:c+("function"==typeof d?0:d)+dP(a.variantChildren,i,d,e,f)}).then(()=>i.notify("AnimationComplete",b)));return Promise.all(h)}(a,b,d,f,g,h,c)}:()=>Promise.resolve(),{when:h}=e;if(!h)return Promise.all([f(),g(c.delay)]);{let[a,b]="beforeChildren"===h?[f,g]:[g,f];return a().then(()=>b())}}let dR=bx.length;function dS(a,b){if(!Array.isArray(b))return!1;let c=b.length;if(c!==a.length)return!1;for(let d=0;d<c;d++)if(b[d]!==a[d])return!1;return!0}let dT=[...bw].reverse(),dU=bw.length;function dV(a=!1){return{isActive:a,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function dW(){return{animate:dV(!0),whileInView:dV(),whileHover:dV(),whileTap:dV(),whileDrag:dV(),whileFocus:dV(),exit:dV()}}class dX extends cy{constructor(a){super(a),a.animationState||(a.animationState=function(a){let b=b=>Promise.all(b.map(({animation:b,options:c})=>(function(a,b,c={}){let d;if(a.notify("AnimationStart",b),Array.isArray(b))d=Promise.all(b.map(b=>dQ(a,b,c)));else if("string"==typeof b)d=dQ(a,b,c);else{let e="function"==typeof b?cz(a,b,c.custom):b;d=Promise.all(dO(a,e,c))}return d.then(()=>{a.notify("AnimationComplete",b)})})(a,b,c))),c=dW(),d=!0,e=b=>(c,d)=>{let e=cz(a,d,"exit"===b?a.presenceContext?.custom:void 0);if(e){let{transition:a,transitionEnd:b,...d}=e;c={...c,...d,...b}}return c};function f(f){let{props:g}=a,h=function a(b){if(!b)return;if(!b.isControllingVariants){let c=b.parent&&a(b.parent)||{};return void 0!==b.props.initial&&(c.initial=b.props.initial),c}let c={};for(let a=0;a<dR;a++){let d=bx[a],e=b.props[d];(bv(e)||!1===e)&&(c[d]=e)}return c}(a.parent)||{},i=[],j=new Set,k={},l=1/0;for(let b=0;b<dU;b++){var m,n;let o=dT[b],p=c[o],q=void 0!==g[o]?g[o]:h[o],r=bv(q),s=o===f?p.isActive:null;!1===s&&(l=b);let t=q===h[o]&&q!==g[o]&&r;if(t&&d&&a.manuallyAnimateOnMount&&(t=!1),p.protectedKeys={...k},!p.isActive&&null===s||!q&&!p.prevProp||bu(q)||"boolean"==typeof q)continue;let u=(m=p.prevProp,"string"==typeof(n=q)?n!==m:!!Array.isArray(n)&&!dS(n,m)),v=u||o===f&&p.isActive&&!t&&r||b>l&&r,w=!1,x=Array.isArray(q)?q:[q],y=x.reduce(e(o),{});!1===s&&(y={});let{prevResolvedValues:z={}}=p,A={...z,...y},B=b=>{v=!0,j.has(b)&&(w=!0,j.delete(b)),p.needsAnimating[b]=!0;let c=a.getValue(b);c&&(c.liveStyle=!1)};for(let a in A){let b=y[a],c=z[a];if(!k.hasOwnProperty(a))(cB(b)&&cB(c)?dS(b,c):b===c)?void 0!==b&&j.has(a)?B(a):p.protectedKeys[a]=!0:null!=b?B(a):j.add(a)}p.prevProp=q,p.prevResolvedValues=y,p.isActive&&(k={...k,...y}),d&&a.blockInitialAnimation&&(v=!1);let C=t&&u,D=!C||w;v&&D&&i.push(...x.map(b=>{let c={type:o};if("string"==typeof b&&d&&!C&&a.manuallyAnimateOnMount&&a.parent){let{parent:d}=a,e=cz(d,b);if(d.enteringChildren&&e){let{delayChildren:b}=e.transition||{};c.delay=dP(d.enteringChildren,a,b)}}return{animation:b,options:c}}))}if(j.size){let b={};if("boolean"!=typeof g.initial){let c=cz(a,Array.isArray(g.initial)?g.initial[0]:g.initial);c&&c.transition&&(b.transition=c.transition)}j.forEach(c=>{let d=a.getBaseTarget(c),e=a.getValue(c);e&&(e.liveStyle=!0),b[c]=d??null}),i.push({animation:b})}let o=!!i.length;return d&&(!1===g.initial||g.initial===g.animate)&&!a.manuallyAnimateOnMount&&(o=!1),d=!1,o?b(i):Promise.resolve()}return{animateChanges:f,setActive:function(b,d){if(c[b].isActive===d)return Promise.resolve();a.variantChildren?.forEach(a=>a.animationState?.setActive(b,d)),c[b].isActive=d;let e=f(b);for(let a in c)c[a].protectedKeys={};return e},setAnimateFunction:function(c){b=c(a)},getState:()=>c,reset:()=>{c=dW()}}}(a))}updateAnimationControlsSubscription(){let{animate:a}=this.node.getProps();bu(a)&&(this.unmountControls=a.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){let{animate:a}=this.node.getProps(),{animate:b}=this.node.prevProps||{};a!==b&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let dY=0;class dZ extends cy{constructor(){super(...arguments),this.id=dY++}update(){if(!this.node.presenceContext)return;let{isPresent:a,onExitComplete:b}=this.node.presenceContext,{isPresent:c}=this.node.prevPresenceContext||{};if(!this.node.animationState||a===c)return;let d=this.node.animationState.setActive("exit",!a);b&&!a&&d.then(()=>{b(this.id)})}mount(){let{register:a,onExitComplete:b}=this.node.presenceContext||{};b&&b(this.id),a&&(this.unmount=a(this.id))}unmount(){}}let d$={x:!1,y:!1};function d_(a){return[a("x"),a("y")]}function d0(a){return a.max-a.min}function d1(a,b,c,d=.5){a.origin=d,a.originPoint=bU(b.min,b.max,a.origin),a.scale=d0(c)/d0(b),a.translate=bU(c.min,c.max,a.origin)-a.originPoint,(a.scale>=.9999&&a.scale<=1.0001||isNaN(a.scale))&&(a.scale=1),(a.translate>=-.01&&a.translate<=.01||isNaN(a.translate))&&(a.translate=0)}function d2(a,b,c,d){d1(a.x,b.x,c.x,d?d.originX:void 0),d1(a.y,b.y,c.y,d?d.originY:void 0)}function d3(a,b,c){a.min=c.min+b.min,a.max=a.min+d0(b)}function d4(a,b,c){a.min=b.min-c.min,a.max=a.min+d0(b)}function d5(a,b,c){d4(a.x,b.x,c.x),d4(a.y,b.y,c.y)}let d6=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function d7(a){return d6.has(a.tagName)||!0===a.isContentEditable}function d8(a,b,c,d={passive:!0}){return a.addEventListener(b,c,d),()=>a.removeEventListener(b,c)}let d9=a=>"mouse"===a.pointerType?"number"!=typeof a.button||a.button<=0:!1!==a.isPrimary;function ea(a){return{point:{x:a.pageX,y:a.pageY}}}function eb(a,b,c,d){return d8(a,b,a=>d9(a)&&c(a,ea(a)),d)}let ec=({current:a})=>a?a.ownerDocument.defaultView:null,ed=(a,b)=>Math.abs(a-b),ee=new Set(["auto","scroll"]);class ef{constructor(a,b,{transformPagePoint:c,contextWindow:d=window,dragSnapToOrigin:e=!1,distanceThreshold:f=3,element:g}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=a=>{this.handleScroll(a.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let a=ei(this.lastMoveEventInfo,this.history),b=null!==this.startEvent,c=function(a,b){return Math.sqrt(ed(a.x,b.x)**2+ed(a.y,b.y)**2)}(a.offset,{x:0,y:0})>=this.distanceThreshold;if(!b&&!c)return;let{point:d}=a,{timestamp:e}=a3;this.history.push({...d,timestamp:e});let{onStart:f,onMove:g}=this.handlers;b||(f&&f(this.lastMoveEvent,a),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,a)},this.handlePointerMove=(a,b)=>{this.lastMoveEvent=a,this.lastMoveEventInfo=eg(b,this.transformPagePoint),a1.update(this.updatePoint,!0)},this.handlePointerUp=(a,b)=>{this.end();let{onEnd:c,onSessionEnd:d,resumeAnimation:e}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&e&&e(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let f=ei("pointercancel"===a.type?this.lastMoveEventInfo:eg(b,this.transformPagePoint),this.history);this.startEvent&&c&&c(a,f),d&&d(a,f)},!d9(a))return;this.dragSnapToOrigin=e,this.handlers=b,this.transformPagePoint=c,this.distanceThreshold=f,this.contextWindow=d||window;let h=eg(ea(a),this.transformPagePoint),{point:i}=h,{timestamp:j}=a3;this.history=[{...i,timestamp:j}];let{onSessionStart:k}=b;k&&k(a,ei(h,this.history)),this.removeListeners=cF(eb(this.contextWindow,"pointermove",this.handlePointerMove),eb(this.contextWindow,"pointerup",this.handlePointerUp),eb(this.contextWindow,"pointercancel",this.handlePointerUp)),g&&this.startScrollTracking(g)}startScrollTracking(a){let b=a.parentElement;for(;b;){let a=getComputedStyle(b);(ee.has(a.overflowX)||ee.has(a.overflowY))&&this.scrollPositions.set(b,{x:b.scrollLeft,y:b.scrollTop}),b=b.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(a){let b=this.scrollPositions.get(a);if(!b)return;let c=a===window,d=c?{x:window.scrollX,y:window.scrollY}:{x:a.scrollLeft,y:a.scrollTop},e={x:d.x-b.x,y:d.y-b.y};(0!==e.x||0!==e.y)&&(c?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=e.x,this.lastMoveEventInfo.point.y+=e.y):this.history.length>0&&(this.history[0].x-=e.x,this.history[0].y-=e.y),this.scrollPositions.set(a,d),a1.update(this.updatePoint,!0))}updateHandlers(a){this.handlers=a}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),a2(this.updatePoint)}}function eg(a,b){return b?{point:b(a.point)}:a}function eh(a,b){return{x:a.x-b.x,y:a.y-b.y}}function ei({point:a},b){return{point:a,delta:eh(a,ej(b)),offset:eh(a,b[0]),velocity:function(a,b){if(a.length<2)return{x:0,y:0};let c=a.length-1,d=null,e=ej(a);for(;c>=0&&(d=a[c],!(e.timestamp-d.timestamp>cD(.1)));)c--;if(!d)return{x:0,y:0};let f=(e.timestamp-d.timestamp)/1e3;if(0===f)return{x:0,y:0};let g={x:(e.x-d.x)/f,y:(e.y-d.y)/f};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}(b,.1)}}function ej(a){return a[a.length-1]}function ek(a,b,c){return{min:void 0!==b?a.min+b:void 0,max:void 0!==c?a.max+c-(a.max-a.min):void 0}}function el(a,b){let c=b.min-a.min,d=b.max-a.max;return b.max-b.min<a.max-a.min&&([c,d]=[d,c]),{min:c,max:d}}function em(a,b,c){return{min:en(a,b),max:en(a,c)}}function en(a,b){return"number"==typeof a?a:a[b]||0}let eo=new WeakMap;class ep{constructor(a){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=au(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=a}start(a,{snapToCursor:b=!1,distanceThreshold:c}={}){let{presenceContext:d}=this.visualElement;if(d&&!1===d.isPresent)return;let e=a=>{b?(this.stopAnimation(),this.snapToCursor(ea(a).point)):this.pauseAnimation()},f=(a,b)=>{this.stopAnimation();let{drag:c,dragPropagation:d,onDragStart:e}=this.getProps();if(c&&!d&&(this.openDragLock&&this.openDragLock(),this.openDragLock=function(a){if("x"===a||"y"===a)if(d$[a])return null;else return d$[a]=!0,()=>{d$[a]=!1};return d$.x||d$.y?null:(d$.x=d$.y=!0,()=>{d$.x=d$.y=!1})}(c),!this.openDragLock))return;this.latestPointerEvent=a,this.latestPanInfo=b,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),d_(a=>{let b=this.getAxisMotionValue(a).get()||0;if(V.test(b)){let{projection:c}=this.visualElement;if(c&&c.layout){let d=c.layout.layoutBox[a];d&&(b=d0(d)*(parseFloat(b)/100))}}this.originPoint[a]=b}),e&&a1.postRender(()=>e(a,b)),cC(this.visualElement,"transform");let{animationState:f}=this.visualElement;f&&f.setActive("whileDrag",!0)},g=(a,b)=>{this.latestPointerEvent=a,this.latestPanInfo=b;let{dragPropagation:c,dragDirectionLock:d,onDirectionLock:e,onDrag:f}=this.getProps();if(!c&&!this.openDragLock)return;let{offset:g}=b;if(d&&null===this.currentDirection){this.currentDirection=function(a,b=10){let c=null;return Math.abs(a.y)>b?c="y":Math.abs(a.x)>b&&(c="x"),c}(g),null!==this.currentDirection&&e&&e(this.currentDirection);return}this.updateAxis("x",b.point,g),this.updateAxis("y",b.point,g),this.visualElement.render(),f&&f(a,b)},h=(a,b)=>{this.latestPointerEvent=a,this.latestPanInfo=b,this.stop(a,b),this.latestPointerEvent=null,this.latestPanInfo=null},i=()=>d_(a=>"paused"===this.getAnimationState(a)&&this.getAxisMotionValue(a).animation?.play()),{dragSnapToOrigin:j}=this.getProps();this.panSession=new ef(a,{onSessionStart:e,onStart:f,onMove:g,onSessionEnd:h,resumeAnimation:i},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:j,distanceThreshold:c,contextWindow:ec(this.visualElement),element:this.visualElement.current})}stop(a,b){let c=a||this.latestPointerEvent,d=b||this.latestPanInfo,e=this.isDragging;if(this.cancel(),!e||!d||!c)return;let{velocity:f}=d;this.startAnimation(f);let{onDragEnd:g}=this.getProps();g&&a1.postRender(()=>g(c,d))}cancel(){this.isDragging=!1;let{projection:a,animationState:b}=this.visualElement;a&&(a.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;let{dragPropagation:c}=this.getProps();!c&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),b&&b.setActive("whileDrag",!1)}updateAxis(a,b,c){let{drag:d}=this.getProps();if(!c||!eq(a,d,this.currentDirection))return;let e=this.getAxisMotionValue(a),f=this.originPoint[a]+c[a];this.constraints&&this.constraints[a]&&(f=function(a,{min:b,max:c},d){return void 0!==b&&a<b?a=d?bU(b,a,d.min):Math.max(a,b):void 0!==c&&a>c&&(a=d?bU(c,a,d.max):Math.min(a,c)),a}(f,this.constraints[a],this.elastic[a])),e.set(f)}resolveConstraints(){let{dragConstraints:a,dragElastic:b}=this.getProps(),c=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,d=this.constraints;a&&cw(a)?this.constraints||(this.constraints=this.resolveRefConstraints()):a&&c?this.constraints=function(a,{top:b,left:c,bottom:d,right:e}){return{x:ek(a.x,c,e),y:ek(a.y,b,d)}}(c.layoutBox,a):this.constraints=!1,this.elastic=function(a=.35){return!1===a?a=0:!0===a&&(a=.35),{x:em(a,"left","right"),y:em(a,"top","bottom")}}(b),d!==this.constraints&&c&&this.constraints&&!this.hasMutatedConstraints&&d_(a=>{!1!==this.constraints&&this.getAxisMotionValue(a)&&(this.constraints[a]=function(a,b){let c={};return void 0!==b.min&&(c.min=b.min-a.min),void 0!==b.max&&(c.max=b.max-a.min),c}(c.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){var a;let{dragConstraints:b,onMeasureDragConstraints:c}=this.getProps();if(!b||!cw(b))return!1;let d=b.current;aB(null!==d,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");let{projection:e}=this.visualElement;if(!e||!e.layout)return!1;let f=function(a,b,c){let d=b9(a,c),{scroll:e}=b;return e&&(b6(d.x,e.offset.x),b6(d.y,e.offset.y)),d}(d,e.root,this.visualElement.getTransformPagePoint()),g=(a=e.layout.layoutBox,{x:el(a.x,f.x),y:el(a.y,f.y)});if(c){let a=c(function({x:a,y:b}){return{top:b.min,right:a.max,bottom:b.max,left:a.min}}(g));this.hasMutatedConstraints=!!a,a&&(g=b$(a))}return g}startAnimation(a){let{drag:b,dragMomentum:c,dragElastic:d,dragTransition:e,dragSnapToOrigin:f,onDragTransitionEnd:g}=this.getProps(),h=this.constraints||{};return Promise.all(d_(g=>{if(!eq(g,b,this.currentDirection))return;let i=h&&h[g]||{};f&&(i={min:0,max:0});let j={type:"inertia",velocity:c?a[g]:0,bounceStiffness:d?200:1e6,bounceDamping:d?40:1e7,timeConstant:750,restDelta:1,restSpeed:10,...e,...i};return this.startAxisValueAnimation(g,j)})).then(g)}startAxisValueAnimation(a,b){let c=this.getAxisMotionValue(a);return cC(this.visualElement,a),c.start(dN(a,c,0,b,this.visualElement,!1))}stopAnimation(){d_(a=>this.getAxisMotionValue(a).stop())}pauseAnimation(){d_(a=>this.getAxisMotionValue(a).animation?.pause())}getAnimationState(a){return this.getAxisMotionValue(a).animation?.state}getAxisMotionValue(a){let b=`_drag${a.toUpperCase()}`,c=this.visualElement.getProps();return c[b]||this.visualElement.getValue(a,(c.initial?c.initial[a]:void 0)||0)}snapToCursor(a){d_(b=>{let{drag:c}=this.getProps();if(!eq(b,c,this.currentDirection))return;let{projection:d}=this.visualElement,e=this.getAxisMotionValue(b);if(d&&d.layout){let{min:c,max:f}=d.layout.layoutBox[b],g=e.get()||0;e.set(a[b]-bU(c,f,.5)+g)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;let{drag:a,dragConstraints:b}=this.getProps(),{projection:c}=this.visualElement;if(!cw(b)||!c||!this.constraints)return;this.stopAnimation();let d={x:0,y:0};d_(a=>{let b=this.getAxisMotionValue(a);if(b&&!1!==this.constraints){let c=b.get();d[a]=function(a,b){let c=.5,d=d0(a),e=d0(b);return e>d?c=dk(b.min,b.max-d,a.min):d>e&&(c=dk(a.min,a.max-e,b.min)),H(0,1,c)}({min:c,max:c},this.constraints[a])}});let{transformTemplate:e}=this.visualElement.getProps();this.visualElement.current.style.transform=e?e({},""):"none",c.root&&c.root.updateScroll(),c.updateLayout(),this.resolveConstraints(),d_(b=>{if(!eq(b,a,null))return;let c=this.getAxisMotionValue(b),{min:e,max:f}=this.constraints[b];c.set(bU(e,f,d[b]))})}addListeners(){if(!this.visualElement.current)return;eo.set(this.visualElement,this);let a=eb(this.visualElement.current,"pointerdown",a=>{let{drag:b,dragListener:c=!0}=this.getProps();b&&c&&!d7(a.target)&&this.start(a)}),b=()=>{let{dragConstraints:a}=this.getProps();cw(a)&&a.current&&(this.constraints=this.resolveRefConstraints())},{projection:c}=this.visualElement,d=c.addEventListener("measure",b);c&&!c.layout&&(c.root&&c.root.updateScroll(),c.updateLayout()),a1.read(b);let e=d8(window,"resize",()=>this.scalePositionWithinConstraints()),f=c.addEventListener("didUpdate",({delta:a,hasLayoutChanged:b})=>{this.isDragging&&b&&(d_(b=>{let c=this.getAxisMotionValue(b);c&&(this.originPoint[b]+=a[b].translate,c.set(c.get()+a[b].translate))}),this.visualElement.render())});return()=>{e(),a(),d(),f&&f()}}getProps(){let a=this.visualElement.getProps(),{drag:b=!1,dragDirectionLock:c=!1,dragPropagation:d=!1,dragConstraints:e=!1,dragElastic:f=.35,dragMomentum:g=!0}=a;return{...a,drag:b,dragDirectionLock:c,dragPropagation:d,dragConstraints:e,dragElastic:f,dragMomentum:g}}}function eq(a,b,c){return(!0===b||b===a)&&(null===c||c===a)}class er extends cy{constructor(a){super(a),this.removeGroupControls=aY,this.removeListeners=aY,this.controls=new ep(a)}mount(){let{dragControls:a}=this.node.getProps();a&&(this.removeGroupControls=a.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||aY}update(){let{dragControls:a}=this.node.getProps(),{dragControls:b}=this.node.prevProps||{};a!==b&&(this.removeGroupControls(),a&&(this.removeGroupControls=a.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}let es=a=>(b,c)=>{a&&a1.postRender(()=>a(b,c))};class et extends cy{constructor(){super(...arguments),this.removePointerDownListener=aY}onPointerDown(a){this.session=new ef(a,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:ec(this.node)})}createPanHandlers(){let{onPanSessionStart:a,onPanStart:b,onPan:c,onPanEnd:d}=this.node.getProps();return{onSessionStart:es(a),onStart:es(b),onMove:c,onEnd:(a,b)=>{delete this.session,d&&a1.postRender(()=>d(a,b))}}}mount(){this.removePointerDownListener=eb(this.node.current,"pointerdown",a=>this.onPointerDown(a))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let eu={hasAnimatedSinceResize:!0,hasEverUpdated:!1},ev=!1;class ew extends m.Component{componentDidMount(){let{visualElement:a,layoutGroup:b,switchLayoutGroup:c,layoutId:d}=this.props,{projection:e}=a;e&&(b.group&&b.group.add(e),c&&c.register&&d&&c.register(e),ev&&e.root.didUpdate(),e.addEventListener("animationComplete",()=>{this.safeToRemove()}),e.setOptions({...e.options,onExitComplete:()=>this.safeToRemove()})),eu.hasEverUpdated=!0}getSnapshotBeforeUpdate(a){let{layoutDependency:b,visualElement:c,drag:d,isPresent:e}=this.props,{projection:f}=c;return f&&(f.isPresent=e,ev=!0,d||a.layoutDependency!==b||void 0===b||a.isPresent!==e?f.willUpdate():this.safeToRemove(),a.isPresent!==e&&(e?f.promote():f.relegate()||a1.postRender(()=>{let a=f.getStack();a&&a.members.length||this.safeToRemove()}))),null}componentDidUpdate(){let{projection:a}=this.props.visualElement;a&&(a.root.didUpdate(),bj.postRender(()=>{!a.currentAnimation&&a.isLead()&&this.safeToRemove()}))}componentWillUnmount(){let{visualElement:a,layoutGroup:b,switchLayoutGroup:c}=this.props,{projection:d}=a;ev=!0,d&&(d.scheduleCheckAfterUnmount(),b&&b.group&&b.group.remove(d),c&&c.deregister&&c.deregister(d))}safeToRemove(){let{safeToRemove:a}=this.props;a&&a()}render(){return null}}function ex(a){let[b,c]=B(),d=(0,m.useContext)(o);return(0,l.jsx)(ew,{...a,layoutGroup:d,switchLayoutGroup:(0,m.useContext)(cv),isPresent:b,safeToRemove:c})}function ey(a,b,c,d,e){return a-=b,a=d+1/c*(a-d),void 0!==e&&(a=d+1/e*(a-d)),a}function ez(a,b,[c,d,e],f,g){!function(a,b=0,c=1,d=.5,e,f=a,g=a){if(V.test(b)&&(b=parseFloat(b),b=bU(g.min,g.max,b/100)-g.min),"number"!=typeof b)return;let h=bU(f.min,f.max,d);a===f&&(h-=b),a.min=ey(a.min,b,c,h,e),a.max=ey(a.max,b,c,h,e)}(a,b[c],b[d],b[e],b.scale,f,g)}let eA=["x","scaleX","originX"],eB=["y","scaleY","originY"];function eC(a,b,c,d){ez(a.x,b,eA,c?c.x:void 0,d?d.x:void 0),ez(a.y,b,eB,c?c.y:void 0,d?d.y:void 0)}function eD(a,b){a.min=b.min,a.max=b.max}function eE(a,b){eD(a.x,b.x),eD(a.y,b.y)}function eF(a,b){a.translate=b.translate,a.scale=b.scale,a.originPoint=b.originPoint,a.origin=b.origin}function eG(a){return 0===a.translate&&1===a.scale}function eH(a){return eG(a.x)&&eG(a.y)}function eI(a,b){return a.min===b.min&&a.max===b.max}function eJ(a,b){return Math.round(a.min)===Math.round(b.min)&&Math.round(a.max)===Math.round(b.max)}function eK(a,b){return eJ(a.x,b.x)&&eJ(a.y,b.y)}function eL(a){return d0(a.x)/d0(a.y)}function eM(a,b){return a.translate===b.translate&&a.scale===b.scale&&a.originPoint===b.originPoint}let eN=["TopLeft","TopRight","BottomLeft","BottomRight"],eO=eN.length,eP=a=>"string"==typeof a?parseFloat(a):a,eQ=a=>"number"==typeof a||W.test(a);function eR(a,b){return void 0!==a[b]?a[b]:a.borderRadius}let eS=eU(0,.5,df),eT=eU(.5,.95,aY);function eU(a,b,c){return d=>d<a?0:d>b?1:c(dk(a,b,d))}function eV(a){return t(a)&&"ownerSVGElement"in a}let eW=(a,b)=>a.depth-b.depth;class eX{constructor(){this.children=[],this.isDirty=!1}add(a){bg(this.children,a),this.isDirty=!0}remove(a){bh(this.children,a),this.isDirty=!0}forEach(a){this.isDirty&&this.children.sort(eW),this.isDirty=!1,this.children.forEach(a)}}class eY{constructor(){this.members=[]}add(a){bg(this.members,a),a.scheduleRender()}remove(a){if(bh(this.members,a),a===this.prevLead&&(this.prevLead=void 0),a===this.lead){let a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(a){let b,c=this.members.findIndex(b=>a===b);if(0===c)return!1;for(let a=c;a>=0;a--){let c=this.members[a];if(!1!==c.isPresent){b=c;break}}return!!b&&(this.promote(b),!0)}promote(a,b){let c=this.lead;if(a!==c&&(this.prevLead=c,this.lead=a,a.show(),c)){c.instance&&c.scheduleRender(),a.scheduleRender(),a.resumeFrom=c,b&&(a.resumeFrom.preserveOpacity=!0),c.snapshot&&(a.snapshot=c.snapshot,a.snapshot.latestValues=c.animationValues||c.latestValues),a.root&&a.root.isUpdating&&(a.isLayoutDirty=!0);let{crossfade:d}=a.options;!1===d&&c.hide()}}exitAnimationComplete(){this.members.forEach(a=>{let{options:b,resumingFrom:c}=a;b.onExitComplete&&b.onExitComplete(),c&&c.options.onExitComplete&&c.options.onExitComplete()})}scheduleRender(){this.members.forEach(a=>{a.instance&&a.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}let eZ={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},e$=["","X","Y","Z"],e_=0;function e0(a,b,c,d){let{latestValues:e}=b;e[a]&&(c[a]=e[a],b.setStaticValue(a,0),d&&(d[a]=0))}function e1({attachResizeListener:a,defaultParent:b,measureScroll:c,checkIsScrollRoot:d,resetTransform:e}){return class{constructor(a={},c=b?.()){this.id=e_++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,a_.value&&(eZ.nodes=eZ.calculatedTargetDeltas=eZ.calculatedProjections=0),this.nodes.forEach(e4),this.nodes.forEach(fb),this.nodes.forEach(fc),this.nodes.forEach(e5),a_.addProjectionMetrics&&a_.addProjectionMetrics(eZ)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let a=0;a<this.path.length;a++)this.path[a].shouldResetTransform=!0;this.root===this&&(this.nodes=new eX)}addEventListener(a,b){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new bi),this.eventHandlers.get(a).add(b)}notifyListeners(a,...b){let c=this.eventHandlers.get(a);c&&c.notify(...b)}hasListeners(a){return this.eventHandlers.has(a)}mount(b){if(this.instance)return;this.isSVG=eV(b)&&!(eV(b)&&"svg"===b.tagName),this.instance=b;let{layoutId:c,layout:d,visualElement:e}=this.options;if(e&&!e.current&&e.mount(b),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(d||c)&&(this.isLayoutDirty=!0),a){let c,d=0,e=()=>this.root.updateBlockedByResize=!1;a1.read(()=>{d=window.innerWidth}),a(b,()=>{let a=window.innerWidth;a!==d&&(d=a,this.root.updateBlockedByResize=!0,c&&c(),c=function(a,b){let c=bl.now(),d=({timestamp:b})=>{let e=b-c;e>=250&&(a2(d),a(e-250))};return a1.setup(d,!0),()=>a2(d)}(e,250),eu.hasAnimatedSinceResize&&(eu.hasAnimatedSinceResize=!1,this.nodes.forEach(fa)))})}c&&this.root.registerSharedNode(c,this),!1!==this.options.animate&&e&&(c||d)&&this.addEventListener("didUpdate",({delta:a,hasLayoutChanged:b,hasRelativeLayoutChanged:c,layout:d})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}let f=this.options.transition||e.getDefaultTransition()||fi,{onLayoutAnimationStart:g,onLayoutAnimationComplete:h}=e.getProps(),i=!this.targetLayout||!eK(this.targetLayout,d),j=!b&&c;if(this.options.layoutRoot||this.resumeFrom||j||b&&(i||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);let b={...cA(f,"layout"),onPlay:g,onComplete:h};(e.shouldReduceMotion||this.options.layoutRoot)&&(b.delay=0,b.type=!1),this.startAnimation(b),this.setAnimationOrigin(a,j)}else b||fa(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=d})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);let a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),a2(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){!this.isUpdateBlocked()&&(this.isUpdating=!0,this.nodes&&this.nodes.forEach(fd),this.animationId++)}getTransformTemplate(){let{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&function a(b){if(b.hasCheckedOptimisedAppear=!0,b.root===b)return;let{visualElement:c}=b.options;if(!c)return;let d=c.props[cu];if(window.MotionHasOptimisedAnimation(d,"transform")){let{layout:a,layoutId:c}=b.options;window.MotionCancelOptimisedAnimation(d,"transform",a1,!(a||c))}let{parent:e}=b;e&&!e.hasCheckedOptimisedAppear&&a(e)}(this),this.root.isUpdating||this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let a=0;a<this.path.length;a++){let b=this.path[a];b.shouldResetTransform=!0,b.updateScroll("snapshot"),b.options.layoutRoot&&b.willUpdate(!1)}let{layoutId:b,layout:c}=this.options;if(void 0===b&&!c)return;let d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(e7);return}if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(e8);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(e9),this.nodes.forEach(e2),this.nodes.forEach(e3)):this.nodes.forEach(e8),this.clearAllSnapshots();let a=bl.now();a3.delta=H(0,1e3/60,a-a3.timestamp),a3.timestamp=a,a3.isProcessing=!0,a4.update.process(a3),a4.preRender.process(a3),a4.render.process(a3),a3.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,bj.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(e6),this.sharedNodes.forEach(fe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,a1.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){a1.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||d0(this.snapshot.measuredBox.x)||d0(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let a=0;a<this.path.length;a++)this.path[a].updateScroll();let a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=au(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);let{visualElement:b}=this.options;b&&b.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let b=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(b=!1),b&&this.instance){let b=d(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:b,offset:c(this.instance),wasRoot:this.scroll?this.scroll.isRoot:b}}}resetTransform(){if(!e)return;let a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,b=this.projectionDelta&&!eH(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,f=d!==this.prevTransformTemplateValue;a&&this.instance&&(b||b1(this.latestValues)||f)&&(e(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){var b;let c=this.measurePageBox(),d=this.removeElementScroll(c);return a&&(d=this.removeTransform(d)),fl((b=d).x),fl(b.y),{animationId:this.root.animationId,measuredBox:c,layoutBox:d,latestValues:{},source:this.id}}measurePageBox(){let{visualElement:a}=this.options;if(!a)return au();let b=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(fn))){let{scroll:a}=this.root;a&&(b6(b.x,a.offset.x),b6(b.y,a.offset.y))}return b}removeElementScroll(a){let b=au();if(eE(b,a),this.scroll?.wasRoot)return b;for(let c=0;c<this.path.length;c++){let d=this.path[c],{scroll:e,options:f}=d;d!==this.root&&e&&f.layoutScroll&&(e.wasRoot&&eE(b,a),b6(b.x,e.offset.x),b6(b.y,e.offset.y))}return b}applyTransform(a,b=!1){let c=au();eE(c,a);for(let a=0;a<this.path.length;a++){let d=this.path[a];!b&&d.options.layoutScroll&&d.scroll&&d!==d.root&&b8(c,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),b1(d.latestValues)&&b8(c,d.latestValues)}return b1(this.latestValues)&&b8(c,this.latestValues),c}removeTransform(a){let b=au();eE(b,a);for(let a=0;a<this.path.length;a++){let c=this.path[a];if(!c.instance||!b1(c.latestValues))continue;b0(c.latestValues)&&c.updateSnapshot();let d=au();eE(d,c.measurePageBox()),eC(b,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,d)}return b1(this.latestValues)&&eC(b,this.latestValues),b}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:void 0===a.crossfade||a.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==a3.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){let b=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=b.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=b.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=b.isSharedProjectionDirty);let c=!!this.resumingFrom||this!==b;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;let{layout:d,layoutId:e}=this.options;if(!this.layout||!(d||e))return;this.resolvedRelativeTargetAt=a3.timestamp;let f=this.getClosestProjectingParent();if(f&&this.linkedParentVersion!==f.layoutVersion&&!f.options.layoutRoot&&this.removeRelativeTarget(),this.targetDelta||this.relativeTarget||(f&&f.layout?this.createRelativeTarget(f,this.layout.layoutBox,f.layout.layoutBox):this.removeRelativeTarget()),this.relativeTarget||this.targetDelta){if(this.target||(this.target=au(),this.targetWithTransforms=au()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target){var g,h,i;this.forceRelativeParentToResolveTarget(),g=this.target,h=this.relativeTarget,i=this.relativeParent.target,d3(g.x,h.x,i.x),d3(g.y,h.y,i.y)}else this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):eE(this.target,this.layout.layoutBox),b5(this.target,this.targetDelta)):eE(this.target,this.layout.layoutBox);this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&1!==this.animationProgress?this.createRelativeTarget(f,this.target,f.target):this.relativeParent=this.relativeTarget=void 0),a_.value&&eZ.calculatedTargetDeltas++}}getClosestProjectingParent(){if(!(!this.parent||b0(this.parent.latestValues)||b2(this.parent.latestValues)))if(this.parent.isProjecting())return this.parent;else return this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,b,c){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=au(),this.relativeTargetOrigin=au(),d5(this.relativeTargetOrigin,b,c),eE(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){let a=this.getLead(),b=!!this.resumingFrom||this!==a,c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),b&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===a3.timestamp&&(c=!1),c)return;let{layout:d,layoutId:e}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||e))return;eE(this.layoutCorrected,this.layout.layoutBox);let f=this.treeScale.x,g=this.treeScale.y;!function(a,b,c,d=!1){let e,f,g=c.length;if(g){b.x=b.y=1;for(let h=0;h<g;h++){f=(e=c[h]).projectionDelta;let{visualElement:g}=e.options;(!g||!g.props.style||"contents"!==g.props.style.display)&&(d&&e.options.layoutScroll&&e.scroll&&e!==e.root&&b8(a,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),f&&(b.x*=f.x.scale,b.y*=f.y.scale,b5(a,f)),d&&b1(e.latestValues)&&b8(a,e.latestValues))}b.x<1.0000000000001&&b.x>.999999999999&&(b.x=1),b.y<1.0000000000001&&b.y>.999999999999&&(b.y=1)}}(this.layoutCorrected,this.treeScale,this.path,b),a.layout&&!a.target&&(1!==this.treeScale.x||1!==this.treeScale.y)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=au());let{target:h}=a;if(!h){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}this.projectionDelta&&this.prevProjectionDelta?(eF(this.prevProjectionDelta.x,this.projectionDelta.x),eF(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),d2(this.projectionDelta,this.layoutCorrected,h,this.latestValues),this.treeScale.x===f&&this.treeScale.y===g&&eM(this.projectionDelta.x,this.prevProjectionDelta.x)&&eM(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",h)),a_.value&&eZ.calculatedProjections++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){let a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=as(),this.projectionDelta=as(),this.projectionDeltaWithTransform=as()}setAnimationOrigin(a,b=!1){let c,d=this.snapshot,e=d?d.latestValues:{},f={...this.latestValues},g=as();this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!b;let h=au(),i=(d?d.source:void 0)!==(this.layout?this.layout.source:void 0),j=this.getStack(),k=!j||j.members.length<=1,l=!!(i&&!k&&!0===this.options.crossfade&&!this.path.some(fh));this.animationProgress=0,this.mixTargetDelta=b=>{let d=b/1e3;if(ff(g.x,a.x,d),ff(g.y,a.y,d),this.setTargetDelta(g),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout){var j,m,n,o,p,q;d5(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),n=this.relativeTarget,o=this.relativeTargetOrigin,p=h,q=d,fg(n.x,o.x,p.x,q),fg(n.y,o.y,p.y,q),c&&(j=this.relativeTarget,m=c,eI(j.x,m.x)&&eI(j.y,m.y))&&(this.isProjectionDirty=!1),c||(c=au()),eE(c,this.relativeTarget)}i&&(this.animationValues=f,function(a,b,c,d,e,f){e?(a.opacity=bU(0,c.opacity??1,eS(d)),a.opacityExit=bU(b.opacity??1,0,eT(d))):f&&(a.opacity=bU(b.opacity??1,c.opacity??1,d));for(let e=0;e<eO;e++){let f=`border${eN[e]}Radius`,g=eR(b,f),h=eR(c,f);(void 0!==g||void 0!==h)&&(g||(g=0),h||(h=0),0===g||0===h||eQ(g)===eQ(h)?(a[f]=Math.max(bU(eP(g),eP(h),d),0),(V.test(h)||V.test(g))&&(a[f]+="%")):a[f]=h)}(b.rotate||c.rotate)&&(a.rotate=bU(b.rotate||0,c.rotate||0,d))}(f,e,this.latestValues,d,l,k)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=d},this.mixTargetDelta(1e3*!!this.options.layoutRoot)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(a2(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=a1.update(()=>{eu.hasAnimatedSinceResize=!0,cG.layout++,this.motionValue||(this.motionValue=bo(0)),this.currentAnimation=function(a,b,c){let d=av(a)?a:bo(a);return d.start(dN("",d,b,c)),d.animation}(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:b=>{this.mixTargetDelta(b),a.onUpdate&&a.onUpdate(b)},onStop:()=>{cG.layout--},onComplete:()=>{cG.layout--,a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);let a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){let a=this.getLead(),{targetWithTransforms:b,target:c,layout:d,latestValues:e}=a;if(b&&c&&d){if(this!==a&&this.layout&&d&&fm(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||au();let b=d0(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+b;let d=d0(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+d}eE(b,c),b8(b,e),d2(this.projectionDeltaWithTransform,this.layoutCorrected,b,e)}}registerSharedNode(a,b){this.sharedNodes.has(a)||this.sharedNodes.set(a,new eY),this.sharedNodes.get(a).add(b);let c=b.options.initialPromotionConfig;b.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(b):void 0})}isLead(){let a=this.getStack();return!a||a.lead===this}getLead(){let{layoutId:a}=this.options;return a&&this.getStack()?.lead||this}getPrevLead(){let{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){let{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:b,preserveFollowOpacity:c}={}){let d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),b&&this.setOptions({transition:b})}relegate(){let a=this.getStack();return!!a&&a.relegate(this)}resetSkewAndRotation(){let{visualElement:a}=this.options;if(!a)return;let b=!1,{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(b=!0),!b)return;let d={};c.z&&e0("z",a,d,this.animationValues);for(let b=0;b<e$.length;b++)e0(`rotate${e$[b]}`,a,d,this.animationValues),e0(`skew${e$[b]}`,a,d,this.animationValues);for(let b in a.render(),d)a.setStaticValue(b,d[b]),this.animationValues&&(this.animationValues[b]=d[b]);a.scheduleRender()}applyProjectionStyles(a,b){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}let c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=cm(b?.pointerEvents)||"",a.transform=c?c(this.latestValues,""):"none";return}let d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,a.pointerEvents=cm(b?.pointerEvents)||""),this.hasProjected&&!b1(this.latestValues)&&(a.transform=c?c({},""):"none",this.hasProjected=!1);return}a.visibility="";let e=d.animationValues||d.latestValues;this.applyTransformsToTarget();let f=function(a,b,c){let d="",e=a.x.translate/b.x,f=a.y.translate/b.y,g=c?.z||0;if((e||f||g)&&(d=`translate3d(${e}px, ${f}px, ${g}px) `),(1!==b.x||1!==b.y)&&(d+=`scale(${1/b.x}, ${1/b.y}) `),c){let{transformPerspective:a,rotate:b,rotateX:e,rotateY:f,skewX:g,skewY:h}=c;a&&(d=`perspective(${a}px) ${d}`),b&&(d+=`rotate(${b}deg) `),e&&(d+=`rotateX(${e}deg) `),f&&(d+=`rotateY(${f}deg) `),g&&(d+=`skewX(${g}deg) `),h&&(d+=`skewY(${h}deg) `)}let h=a.x.scale*b.x,i=a.y.scale*b.y;return(1!==h||1!==i)&&(d+=`scale(${h}, ${i})`),d||"none"}(this.projectionDeltaWithTransform,this.treeScale,e);c&&(f=c(e,f)),a.transform=f;let{x:g,y:h}=this.projectionDelta;for(let b in a.transformOrigin=`${100*g.origin}% ${100*h.origin}% 0`,d.animationValues?a.opacity=d===this?e.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:e.opacityExit:a.opacity=d===this?void 0!==e.opacity?e.opacity:"":void 0!==e.opacityExit?e.opacityExit:0,bV){if(void 0===e[b])continue;let{correct:c,applyTo:g,isCSSVariable:h}=bV[b],i="none"===f?e[b]:c(e[b],d);if(g){let b=g.length;for(let c=0;c<b;c++)a[g[c]]=i}else h?this.options.visualElement.renderState.vars[b]=i:a[b]=i}this.options.layoutId&&(a.pointerEvents=d===this?cm(b?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(e7),this.root.sharedNodes.clear()}}}function e2(a){a.updateLayout()}function e3(a){let b=a.resumeFrom?.snapshot||a.snapshot;if(a.isLead()&&a.layout&&b&&a.hasListeners("didUpdate")){let{layoutBox:c,measuredBox:d}=a.layout,{animationType:e}=a.options,f=b.source!==a.layout.source;"size"===e?d_(a=>{let d=f?b.measuredBox[a]:b.layoutBox[a],e=d0(d);d.min=c[a].min,d.max=d.min+e}):fm(e,b.layoutBox,c)&&d_(d=>{let e=f?b.measuredBox[d]:b.layoutBox[d],g=d0(c[d]);e.max=e.min+g,a.relativeTarget&&!a.currentAnimation&&(a.isProjectionDirty=!0,a.relativeTarget[d].max=a.relativeTarget[d].min+g)});let g=as();d2(g,c,b.layoutBox);let h=as();f?d2(h,a.applyTransform(d,!0),b.measuredBox):d2(h,c,b.layoutBox);let i=!eH(g),j=!1;if(!a.resumeFrom){let d=a.getClosestProjectingParent();if(d&&!d.resumeFrom){let{snapshot:e,layout:f}=d;if(e&&f){let g=au();d5(g,b.layoutBox,e.layoutBox);let h=au();d5(h,c,f.layoutBox),eK(g,h)||(j=!0),d.options.layoutRoot&&(a.relativeTarget=h,a.relativeTargetOrigin=g,a.relativeParent=d)}}}a.notifyListeners("didUpdate",{layout:c,snapshot:b,delta:h,layoutDelta:g,hasLayoutChanged:i,hasRelativeLayoutChanged:j})}else if(a.isLead()){let{onExitComplete:b}=a.options;b&&b()}a.options.transition=void 0}function e4(a){a_.value&&eZ.nodes++,a.parent&&(a.isProjecting()||(a.isProjectionDirty=a.parent.isProjectionDirty),a.isSharedProjectionDirty||(a.isSharedProjectionDirty=!!(a.isProjectionDirty||a.parent.isProjectionDirty||a.parent.isSharedProjectionDirty)),a.isTransformDirty||(a.isTransformDirty=a.parent.isTransformDirty))}function e5(a){a.isProjectionDirty=a.isSharedProjectionDirty=a.isTransformDirty=!1}function e6(a){a.clearSnapshot()}function e7(a){a.clearMeasurements()}function e8(a){a.isLayoutDirty=!1}function e9(a){let{visualElement:b}=a.options;b&&b.getProps().onBeforeLayoutMeasure&&b.notify("BeforeLayoutMeasure"),a.resetTransform()}function fa(a){a.finishAnimation(),a.targetDelta=a.relativeTarget=a.target=void 0,a.isProjectionDirty=!0}function fb(a){a.resolveTargetDelta()}function fc(a){a.calcProjection()}function fd(a){a.resetSkewAndRotation()}function fe(a){a.removeLeadSnapshot()}function ff(a,b,c){a.translate=bU(b.translate,0,c),a.scale=bU(b.scale,1,c),a.origin=b.origin,a.originPoint=b.originPoint}function fg(a,b,c,d){a.min=bU(b.min,c.min,d),a.max=bU(b.max,c.max,d)}function fh(a){return a.animationValues&&void 0!==a.animationValues.opacityExit}let fi={duration:.45,ease:[.4,0,.1,1]},fj=a=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(a),fk=fj("applewebkit/")&&!fj("chrome/")?Math.round:aY;function fl(a){a.min=fk(a.min),a.max=fk(a.max)}function fm(a,b,c){return"position"===a||"preserve-aspect"===a&&!(.2>=Math.abs(eL(b)-eL(c)))}function fn(a){return a!==a.root&&a.scroll?.wasRoot}let fo=e1({attachResizeListener:(a,b)=>d8(a,"resize",b),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),fp={current:void 0},fq=e1({measureScroll:a=>({x:a.scrollLeft,y:a.scrollTop}),defaultParent:()=>{if(!fp.current){let a=new fo({});a.mount(window),a.setOptions({layoutScroll:!0}),fp.current=a}return fp.current},resetTransform:(a,b)=>{a.style.transform=void 0!==b?b:"none"},checkIsScrollRoot:a=>"fixed"===window.getComputedStyle(a).position});function fr(a,b){let c=function(a,b,c){if(a instanceof EventTarget)return[a];if("string"==typeof a){let b=document,c=(void 0)??b.querySelectorAll(a);return c?Array.from(c):[]}return Array.from(a)}(a),d=new AbortController;return[c,{passive:!0,...b,signal:d.signal},()=>d.abort()]}function fs(a){return!("touch"===a.pointerType||d$.x||d$.y)}function ft(a,b,c){let{props:d}=a;a.animationState&&d.whileHover&&a.animationState.setActive("whileHover","Start"===c);let e=d["onHover"+c];e&&a1.postRender(()=>e(b,ea(b)))}class fu extends cy{mount(){let{current:a}=this.node;a&&(this.unmount=function(a,b,c={}){let[d,e,f]=fr(a,c),g=a=>{if(!fs(a))return;let{target:c}=a,d=b(c,a);if("function"!=typeof d||!c)return;let f=a=>{fs(a)&&(d(a),c.removeEventListener("pointerleave",f))};c.addEventListener("pointerleave",f,e)};return d.forEach(a=>{a.addEventListener("pointerenter",g,e)}),f}(a,(a,b)=>(ft(this.node,b,"Start"),a=>ft(this.node,a,"End"))))}unmount(){}}class fv extends cy{constructor(){super(...arguments),this.isActive=!1}onFocus(){let a=!1;try{a=this.node.current.matches(":focus-visible")}catch(b){a=!0}a&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=cF(d8(this.node.current,"focus",()=>this.onFocus()),d8(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}let fw=(a,b)=>!!b&&(a===b||fw(a,b.parentElement)),fx=new WeakSet;function fy(a){return b=>{"Enter"===b.key&&a(b)}}function fz(a,b){a.dispatchEvent(new PointerEvent("pointer"+b,{isPrimary:!0,bubbles:!0}))}function fA(a){return d9(a)&&!(d$.x||d$.y)}function fB(a,b,c){let{props:d}=a;if(a.current instanceof HTMLButtonElement&&a.current.disabled)return;a.animationState&&d.whileTap&&a.animationState.setActive("whileTap","Start"===c);let e=d["onTap"+("End"===c?"":c)];e&&a1.postRender(()=>e(b,ea(b)))}class fC extends cy{mount(){let{current:a}=this.node;a&&(this.unmount=function(a,b,c={}){let[d,e,f]=fr(a,c),g=a=>{let d=a.currentTarget;if(!fA(a))return;fx.add(d);let f=b(d,a),g=(a,b)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",i),fx.has(d)&&fx.delete(d),fA(a)&&"function"==typeof f&&f(a,{success:b})},h=a=>{g(a,d===window||d===document||c.useGlobalTarget||fw(d,a.target))},i=a=>{g(a,!1)};window.addEventListener("pointerup",h,e),window.addEventListener("pointercancel",i,e)};return d.forEach(a=>{(c.useGlobalTarget?window:a).addEventListener("pointerdown",g,e),u(a)&&(a.addEventListener("focus",a=>((a,b)=>{let c=a.currentTarget;if(!c)return;let d=fy(()=>{if(fx.has(c))return;fz(c,"down");let a=fy(()=>{fz(c,"up")});c.addEventListener("keyup",a,b),c.addEventListener("blur",()=>fz(c,"cancel"),b)});c.addEventListener("keydown",d,b),c.addEventListener("blur",()=>c.removeEventListener("keydown",d),b)})(a,e)),d7(a)||a.hasAttribute("tabindex")||(a.tabIndex=0))}),f}(a,(a,b)=>(fB(this.node,b,"Start"),(a,{success:b})=>fB(this.node,a,b?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}let fD=new WeakMap,fE=new WeakMap,fF=a=>{let b=fD.get(a.target);b&&b(a)},fG=a=>{a.forEach(fF)},fH={some:0,all:1};class fI extends cy{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();let{viewport:a={}}=this.node.getProps(),{root:b,margin:c,amount:d="some",once:e}=a,f={root:b?b.current:void 0,rootMargin:c,threshold:"number"==typeof d?d:fH[d]},g=a=>{let{isIntersecting:b}=a;if(this.isInView===b||(this.isInView=b,e&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);let{onViewportEnter:c,onViewportLeave:d}=this.node.getProps(),f=b?c:d;f&&f(a)};var h=this.node.current;let i=function({root:a,...b}){let c=a||document;fE.has(c)||fE.set(c,{});let d=fE.get(c),e=JSON.stringify(b);return d[e]||(d[e]=new IntersectionObserver(fG,{root:a,...b})),d[e]}(f);return fD.set(h,g),i.observe(h),()=>{fD.delete(h),i.unobserve(h)}}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;let{props:a,prevProps:b}=this.node;["amount","margin","root"].some(function({viewport:a={}},{viewport:b={}}={}){return c=>a[c]!==b[c]}(a,b))&&this.startObserver()}unmount(){}}let fJ=function(a,b){if("undefined"==typeof Proxy)return cx;let c=new Map,d=(c,d)=>cx(c,d,a,b);return new Proxy((a,b)=>d(a,b),{get:(e,f)=>"create"===f?d:(c.has(f)||c.set(f,cx(f,void 0,a,b)),c.get(f))})}({animation:{Feature:dX},exit:{Feature:dZ},inView:{Feature:fI},tap:{Feature:fC},focus:{Feature:fv},hover:{Feature:fu},pan:{Feature:et},drag:{Feature:er,ProjectionNode:fq,MeasureLayout:ex},layout:{ProjectionNode:fq,MeasureLayout:ex}},(a,b)=>b.isSVG??cc(a)?new bZ(b):new ca(b,{allowProjection:a!==m.Fragment})),fK=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)},fL=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var fM={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let fN=(0,m.forwardRef)(({color:a="currentColor",size:b=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:e="",children:f,iconNode:g,...h},i)=>(0,m.createElement)("svg",{ref:i,...fM,width:b,height:b,stroke:a,strokeWidth:d?24*Number(c)/Number(b):c,className:fL("lucide",e),...!f&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0})(h)&&{"aria-hidden":"true"},...h},[...g.map(([a,b])=>(0,m.createElement)(a,b)),...Array.isArray(f)?f:[f]])),fO=(a,b)=>{let c=(0,m.forwardRef)(({className:c,...d},e)=>(0,m.createElement)(fN,{ref:e,iconNode:b,className:fL(`lucide-${fK(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,c),...d}));return c.displayName=fK(a),c},fP=fO("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),fQ=fO("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),fR=fO("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),fS=fO("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]),fT=fO("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),fU=fO("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),fV=fO("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),fW=fO("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),fX=fO("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),fY=fO("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),fZ=fO("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),f$=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,f_=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,f0={};function f1(a,b){return((b||f0).jsx?f_:f$).test(a)}let f2=/[ \t\n\f\r]/g;function f3(a){return""===a.replace(f2,"")}class f4{constructor(a,b,c){this.normal=b,this.property=a,c&&(this.space=c)}}function f5(a,b){let c={},d={};for(let b of a)Object.assign(c,b.property),Object.assign(d,b.normal);return new f4(c,d,b)}function f6(a){return a.toLowerCase()}f4.prototype.normal={},f4.prototype.property={},f4.prototype.space=void 0;class f7{constructor(a,b){this.attribute=b,this.property=a}}f7.prototype.attribute="",f7.prototype.booleanish=!1,f7.prototype.boolean=!1,f7.prototype.commaOrSpaceSeparated=!1,f7.prototype.commaSeparated=!1,f7.prototype.defined=!1,f7.prototype.mustUseProperty=!1,f7.prototype.number=!1,f7.prototype.overloadedBoolean=!1,f7.prototype.property="",f7.prototype.spaceSeparated=!1,f7.prototype.space=void 0;let f8=0,f9=gg(),ga=gg(),gb=gg(),gc=gg(),gd=gg(),ge=gg(),gf=gg();function gg(){return 2**++f8}let gh=Object.keys(j);class gi extends f7{constructor(a,b,c,d){let e=-1;if(super(a,b),function(a,b,c){c&&(a[b]=c)}(this,"space",d),"number"==typeof c)for(;++e<gh.length;){let a=gh[e];!function(a,b,c){c&&(a[b]=c)}(this,gh[e],(c&j[a])===j[a])}}}function gj(a){let b={},c={};for(let[d,e]of Object.entries(a.properties)){let f=new gi(d,a.transform(a.attributes||{},d),e,a.space);a.mustUseProperty&&a.mustUseProperty.includes(d)&&(f.mustUseProperty=!0),b[d]=f,c[f6(d)]=d,c[f6(f.attribute)]=d}return new f4(b,c,a.space)}gi.prototype.defined=!0;let gk=gj({properties:{ariaActiveDescendant:null,ariaAtomic:ga,ariaAutoComplete:null,ariaBusy:ga,ariaChecked:ga,ariaColCount:gc,ariaColIndex:gc,ariaColSpan:gc,ariaControls:gd,ariaCurrent:null,ariaDescribedBy:gd,ariaDetails:null,ariaDisabled:ga,ariaDropEffect:gd,ariaErrorMessage:null,ariaExpanded:ga,ariaFlowTo:gd,ariaGrabbed:ga,ariaHasPopup:null,ariaHidden:ga,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:gd,ariaLevel:gc,ariaLive:null,ariaModal:ga,ariaMultiLine:ga,ariaMultiSelectable:ga,ariaOrientation:null,ariaOwns:gd,ariaPlaceholder:null,ariaPosInSet:gc,ariaPressed:ga,ariaReadOnly:ga,ariaRelevant:null,ariaRequired:ga,ariaRoleDescription:gd,ariaRowCount:gc,ariaRowIndex:gc,ariaRowSpan:gc,ariaSelected:ga,ariaSetSize:gc,ariaSort:null,ariaValueMax:gc,ariaValueMin:gc,ariaValueNow:gc,ariaValueText:null,role:null},transform:(a,b)=>"role"===b?b:"aria-"+b.slice(4).toLowerCase()});function gl(a,b){return b in a?a[b]:b}function gm(a,b){return gl(a,b.toLowerCase())}let gn=gj({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:ge,acceptCharset:gd,accessKey:gd,action:null,allow:null,allowFullScreen:f9,allowPaymentRequest:f9,allowUserMedia:f9,alt:null,as:null,async:f9,autoCapitalize:null,autoComplete:gd,autoFocus:f9,autoPlay:f9,blocking:gd,capture:null,charSet:null,checked:f9,cite:null,className:gd,cols:gc,colSpan:null,content:null,contentEditable:ga,controls:f9,controlsList:gd,coords:gc|ge,crossOrigin:null,data:null,dateTime:null,decoding:null,default:f9,defer:f9,dir:null,dirName:null,disabled:f9,download:gb,draggable:ga,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:f9,formTarget:null,headers:gd,height:gc,hidden:gb,high:gc,href:null,hrefLang:null,htmlFor:gd,httpEquiv:gd,id:null,imageSizes:null,imageSrcSet:null,inert:f9,inputMode:null,integrity:null,is:null,isMap:f9,itemId:null,itemProp:gd,itemRef:gd,itemScope:f9,itemType:gd,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:f9,low:gc,manifest:null,max:null,maxLength:gc,media:null,method:null,min:null,minLength:gc,multiple:f9,muted:f9,name:null,nonce:null,noModule:f9,noValidate:f9,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:f9,optimum:gc,pattern:null,ping:gd,placeholder:null,playsInline:f9,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:f9,referrerPolicy:null,rel:gd,required:f9,reversed:f9,rows:gc,rowSpan:gc,sandbox:gd,scope:null,scoped:f9,seamless:f9,selected:f9,shadowRootClonable:f9,shadowRootDelegatesFocus:f9,shadowRootMode:null,shape:null,size:gc,sizes:null,slot:null,span:gc,spellCheck:ga,src:null,srcDoc:null,srcLang:null,srcSet:null,start:gc,step:null,style:null,tabIndex:gc,target:null,title:null,translate:null,type:null,typeMustMatch:f9,useMap:null,value:ga,width:gc,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:gd,axis:null,background:null,bgColor:null,border:gc,borderColor:null,bottomMargin:gc,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:f9,declare:f9,event:null,face:null,frame:null,frameBorder:null,hSpace:gc,leftMargin:gc,link:null,longDesc:null,lowSrc:null,marginHeight:gc,marginWidth:gc,noResize:f9,noHref:f9,noShade:f9,noWrap:f9,object:null,profile:null,prompt:null,rev:null,rightMargin:gc,rules:null,scheme:null,scrolling:ga,standby:null,summary:null,text:null,topMargin:gc,valueType:null,version:null,vAlign:null,vLink:null,vSpace:gc,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:f9,disableRemotePlayback:f9,prefix:null,property:null,results:gc,security:null,unselectable:null},space:"html",transform:gm}),go=gj({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:gf,accentHeight:gc,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:gc,amplitude:gc,arabicForm:null,ascent:gc,attributeName:null,attributeType:null,azimuth:gc,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:gc,by:null,calcMode:null,capHeight:gc,className:gd,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:gc,diffuseConstant:gc,direction:null,display:null,dur:null,divisor:gc,dominantBaseline:null,download:f9,dx:null,dy:null,edgeMode:null,editable:null,elevation:gc,enableBackground:null,end:null,event:null,exponent:gc,externalResourcesRequired:null,fill:null,fillOpacity:gc,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:ge,g2:ge,glyphName:ge,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:gc,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:gc,horizOriginX:gc,horizOriginY:gc,id:null,ideographic:gc,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:gc,k:gc,k1:gc,k2:gc,k3:gc,k4:gc,kernelMatrix:gf,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:gc,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:gc,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:gc,overlineThickness:gc,paintOrder:null,panose1:null,path:null,pathLength:gc,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:gd,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:gc,pointsAtY:gc,pointsAtZ:gc,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:gf,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:gf,rev:gf,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:gf,requiredFeatures:gf,requiredFonts:gf,requiredFormats:gf,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:gc,specularExponent:gc,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:gc,strikethroughThickness:gc,string:null,stroke:null,strokeDashArray:gf,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:gc,strokeOpacity:gc,strokeWidth:null,style:null,surfaceScale:gc,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:gf,tabIndex:gc,tableValues:null,target:null,targetX:gc,targetY:gc,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:gf,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:gc,underlineThickness:gc,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:gc,values:null,vAlphabetic:gc,vMathematical:gc,vectorEffect:null,vHanging:gc,vIdeographic:gc,version:null,vertAdvY:gc,vertOriginX:gc,vertOriginY:gc,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:gc,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:gl}),gp=gj({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform:(a,b)=>"xlink:"+b.slice(5).toLowerCase()}),gq=gj({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:gm}),gr=gj({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform:(a,b)=>"xml:"+b.slice(3).toLowerCase()}),gs=f5([gk,gn,gp,gq,gr],"html"),gt=f5([gk,go,gp,gq,gr],"svg"),gu=/[A-Z]/g,gv=/-[a-z]/g,gw=/^data[-\w.:]+$/i;function gx(a){return"-"+a.toLowerCase()}function gy(a){return a.charAt(1).toUpperCase()}let gz={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"};var gA=c(189);let gB=gD("end"),gC=gD("start");function gD(a){return function(b){let c=b&&b.position&&b.position[a]||{};if("number"==typeof c.line&&c.line>0&&"number"==typeof c.column&&c.column>0)return{line:c.line,column:c.column,offset:"number"==typeof c.offset&&c.offset>-1?c.offset:void 0}}}function gE(a){return a&&"object"==typeof a?"position"in a||"type"in a?gG(a.position):"start"in a||"end"in a?gG(a):"line"in a||"column"in a?gF(a):"":""}function gF(a){return gH(a&&a.line)+":"+gH(a&&a.column)}function gG(a){return gF(a&&a.start)+"-"+gF(a&&a.end)}function gH(a){return a&&"number"==typeof a?a:1}class gI extends Error{constructor(a,b,c){super(),"string"==typeof b&&(c=b,b=void 0);let d="",e={},f=!1;if(b&&(e="line"in b&&"column"in b||"start"in b&&"end"in b?{place:b}:"type"in b?{ancestors:[b],place:b.position}:{...b}),"string"==typeof a?d=a:!e.cause&&a&&(f=!0,d=a.message,e.cause=a),!e.ruleId&&!e.source&&"string"==typeof c){let a=c.indexOf(":");-1===a?e.ruleId=c:(e.source=c.slice(0,a),e.ruleId=c.slice(a+1))}if(!e.place&&e.ancestors&&e.ancestors){let a=e.ancestors[e.ancestors.length-1];a&&(e.place=a.position)}let g=e.place&&"start"in e.place?e.place.start:e.place;this.ancestors=e.ancestors||void 0,this.cause=e.cause||void 0,this.column=g?g.column:void 0,this.fatal=void 0,this.file="",this.message=d,this.line=g?g.line:void 0,this.name=gE(e.place)||"1:1",this.place=e.place||void 0,this.reason=this.message,this.ruleId=e.ruleId||void 0,this.source=e.source||void 0,this.stack=f&&e.cause&&"string"==typeof e.cause.stack?e.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}gI.prototype.file="",gI.prototype.name="",gI.prototype.reason="",gI.prototype.message="",gI.prototype.stack="",gI.prototype.column=void 0,gI.prototype.line=void 0,gI.prototype.ancestors=void 0,gI.prototype.cause=void 0,gI.prototype.fatal=void 0,gI.prototype.place=void 0,gI.prototype.ruleId=void 0,gI.prototype.source=void 0;let gJ={}.hasOwnProperty,gK=new Map,gL=/[A-Z]/g,gM=new Set(["table","tbody","thead","tfoot","tr"]),gN=new Set(["td","th"]),gO="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function gP(a,b,c){return"element"===b.type?function(a,b,c){let d=a.schema;"svg"===b.tagName.toLowerCase()&&"html"===d.space&&(a.schema=gt),a.ancestors.push(b);let e=gT(a,b.tagName,!1),f=function(a,b){let c,d,e={};for(d in b.properties)if("children"!==d&&gJ.call(b.properties,d)){let f=function(a,b,c){let d=function(a,b){let c=f6(b),d=b,e=f7;if(c in a.normal)return a.property[a.normal[c]];if(c.length>4&&"data"===c.slice(0,4)&&gw.test(b)){if("-"===b.charAt(4)){let a=b.slice(5).replace(gv,gy);d="data"+a.charAt(0).toUpperCase()+a.slice(1)}else{let a=b.slice(4);if(!gv.test(a)){let c=a.replace(gu,gx);"-"!==c.charAt(0)&&(c="-"+c),b="data"+c}}e=gi}return new e(d,b)}(a.schema,b);if(!(null==c||"number"==typeof c&&Number.isNaN(c))){if(Array.isArray(c)&&(c=d.commaSeparated?function(a,b){let c={};return(""===a[a.length-1]?[...a,""]:a).join((c.padRight?" ":"")+","+(!1===c.padLeft?"":" ")).trim()}(c):c.join(" ").trim()),"style"===d.property){let b="object"==typeof c?c:function(a,b){try{return gA(b,{reactCompat:!0})}catch(c){if(a.ignoreInvalidStyle)return{};let b=new gI("Cannot parse `style` attribute",{ancestors:a.ancestors,cause:c,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw b.file=a.filePath||void 0,b.url=gO+"#cannot-parse-style-attribute",b}}(a,String(c));return"css"===a.stylePropertyNameCase&&(b=function(a){let b,c={};for(b in a)gJ.call(a,b)&&(c[function(a){let b=a.replace(gL,gV);return"ms-"===b.slice(0,3)&&(b="-"+b),b}(b)]=a[b]);return c}(b)),["style",b]}return["react"===a.elementAttributeNameCase&&d.space?gz[d.property]||d.property:d.attribute,c]}}(a,d,b.properties[d]);if(f){let[d,g]=f;a.tableCellAlignToStyle&&"align"===d&&"string"==typeof g&&gN.has(b.tagName)?c=g:e[d]=g}}return c&&((e.style||(e.style={}))["css"===a.stylePropertyNameCase?"text-align":"textAlign"]=c),e}(a,b),g=gS(a,b);return gM.has(b.tagName)&&(g=g.filter(function(a){return"string"!=typeof a||!("object"==typeof a?"text"===a.type&&f3(a.value):f3(a))})),gQ(a,f,e,b),gR(f,g),a.ancestors.pop(),a.schema=d,a.create(b,e,f,c)}(a,b,c):"mdxFlowExpression"===b.type||"mdxTextExpression"===b.type?function(a,b){if(b.data&&b.data.estree&&a.evaluater){let c=b.data.estree.body[0];return c.type,a.evaluater.evaluateExpression(c.expression)}gU(a,b.position)}(a,b):"mdxJsxFlowElement"===b.type||"mdxJsxTextElement"===b.type?function(a,b,c){let d=a.schema;"svg"===b.name&&"html"===d.space&&(a.schema=gt),a.ancestors.push(b);let e=null===b.name?a.Fragment:gT(a,b.name,!0),f=function(a,b){let c={};for(let d of b.attributes)if("mdxJsxExpressionAttribute"===d.type)if(d.data&&d.data.estree&&a.evaluater){let b=d.data.estree.body[0];b.type;let e=b.expression;e.type;let f=e.properties[0];f.type,Object.assign(c,a.evaluater.evaluateExpression(f.argument))}else gU(a,b.position);else{let e,f=d.name;if(d.value&&"object"==typeof d.value)if(d.value.data&&d.value.data.estree&&a.evaluater){let b=d.value.data.estree.body[0];b.type,e=a.evaluater.evaluateExpression(b.expression)}else gU(a,b.position);else e=null===d.value||d.value;c[f]=e}return c}(a,b),g=gS(a,b);return gQ(a,f,e,b),gR(f,g),a.ancestors.pop(),a.schema=d,a.create(b,e,f,c)}(a,b,c):"mdxjsEsm"===b.type?function(a,b){if(b.data&&b.data.estree&&a.evaluater)return a.evaluater.evaluateProgram(b.data.estree);gU(a,b.position)}(a,b):"root"===b.type?function(a,b,c){let d={};return gR(d,gS(a,b)),a.create(b,a.Fragment,d,c)}(a,b,c):"text"===b.type?b.value:void 0}function gQ(a,b,c,d){"string"!=typeof c&&c!==a.Fragment&&a.passNode&&(b.node=d)}function gR(a,b){if(b.length>0){let c=b.length>1?b:b[0];c&&(a.children=c)}}function gS(a,b){let c=[],d=-1,e=a.passKeys?new Map:gK;for(;++d<b.children.length;){let f,g=b.children[d];if(a.passKeys){let a="element"===g.type?g.tagName:"mdxJsxFlowElement"===g.type||"mdxJsxTextElement"===g.type?g.name:void 0;if(a){let b=e.get(a)||0;f=a+"-"+b,e.set(a,b+1)}}let h=gP(a,g,f);void 0!==h&&c.push(h)}return c}function gT(a,b,c){let d;if(c)if(b.includes(".")){let a,c=b.split("."),e=-1;for(;++e<c.length;){let b=f1(c[e])?{type:"Identifier",name:c[e]}:{type:"Literal",value:c[e]};a=a?{type:"MemberExpression",object:a,property:b,computed:!!(e&&"Literal"===b.type),optional:!1}:b}d=a}else d=f1(b)&&!/^[a-z]/.test(b)?{type:"Identifier",name:b}:{type:"Literal",value:b};else d={type:"Literal",value:b};if("Literal"===d.type){let b=d.value;return gJ.call(a.components,b)?a.components[b]:b}if(a.evaluater)return a.evaluater.evaluateExpression(d);gU(a)}function gU(a,b){let c=new gI("Cannot handle MDX estrees without `createEvaluater`",{ancestors:a.ancestors,place:b,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw c.file=a.filePath||void 0,c.url=gO+"#cannot-handle-mdx-estrees-without-createevaluater",c}function gV(a){return"-"+a.toLowerCase()}let gW={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},gX={};function gY(a,b,c){var d;if((d=a)&&"object"==typeof d){if("value"in a)return"html"!==a.type||c?a.value:"";if(b&&"alt"in a&&a.alt)return a.alt;if("children"in a)return gZ(a.children,b,c)}return Array.isArray(a)?gZ(a,b,c):""}function gZ(a,b,c){let d=[],e=-1;for(;++e<a.length;)d[e]=gY(a[e],b,c);return d.join("")}function g$(a,b,c,d){let e,f=a.length,g=0;if(b=b<0?-b>f?0:f+b:b>f?f:b,c=c>0?c:0,d.length<1e4)(e=Array.from(d)).unshift(b,c),a.splice(...e);else for(c&&a.splice(b,c);g<d.length;)(e=d.slice(g,g+1e4)).unshift(b,0),a.splice(...e),g+=1e4,b+=1e4}function g_(a,b){return a.length>0?(g$(a,a.length,0,b),a):b}class g0{constructor(a){this.left=a?[...a]:[],this.right=[]}get(a){if(a<0||a>=this.left.length+this.right.length)throw RangeError("Cannot access index `"+a+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return a<this.left.length?this.left[a]:this.right[this.right.length-a+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(a,b){let c=null==b?1/0:b;return c<this.left.length?this.left.slice(a,c):a>this.left.length?this.right.slice(this.right.length-c+this.left.length,this.right.length-a+this.left.length).reverse():this.left.slice(a).concat(this.right.slice(this.right.length-c+this.left.length).reverse())}splice(a,b,c){this.setCursor(Math.trunc(a));let d=this.right.splice(this.right.length-(b||0),1/0);return c&&g1(this.left,c),d.reverse()}pop(){return this.setCursor(1/0),this.left.pop()}push(a){this.setCursor(1/0),this.left.push(a)}pushMany(a){this.setCursor(1/0),g1(this.left,a)}unshift(a){this.setCursor(0),this.right.push(a)}unshiftMany(a){this.setCursor(0),g1(this.right,a.reverse())}setCursor(a){if(a!==this.left.length&&(!(a>this.left.length)||0!==this.right.length)&&(!(a<0)||0!==this.left.length))if(a<this.left.length){let b=this.left.splice(a,1/0);g1(this.right,b.reverse())}else{let b=this.right.splice(this.left.length+this.right.length-a,1/0);g1(this.left,b.reverse())}}}function g1(a,b){let c=0;if(b.length<1e4)a.push(...b);else for(;c<b.length;)a.push(...b.slice(c,c+1e4)),c+=1e4}function g2(a){let b,c,d,e,f,g,h,i={},j=-1,k=new g0(a);for(;++j<k.length;){for(;j in i;)j=i[j];if(b=k.get(j),j&&"chunkFlow"===b[1].type&&"listItemPrefix"===k.get(j-1)[1].type&&((d=0)<(g=b[1]._tokenizer.events).length&&"lineEndingBlank"===g[d][1].type&&(d+=2),d<g.length&&"content"===g[d][1].type))for(;++d<g.length&&"content"!==g[d][1].type;)"chunkText"===g[d][1].type&&(g[d][1]._isInFirstContentOfListItem=!0,d++);if("enter"===b[0])b[1].contentType&&(Object.assign(i,function(a,b){let c,d,e=a.get(b)[1],f=a.get(b)[2],g=b-1,h=[],i=e._tokenizer;!i&&(i=f.parser[e.contentType](e.start),e._contentTypeTextTrailing&&(i._contentTypeTextTrailing=!0));let j=i.events,k=[],l={},m=-1,n=e,o=0,p=0,q=[0];for(;n;){for(;a.get(++g)[1]!==n;);h.push(g),!n._tokenizer&&(c=f.sliceStream(n),n.next||c.push(null),d&&i.defineSkip(n.start),n._isInFirstContentOfListItem&&(i._gfmTasklistFirstContentOfListItem=!0),i.write(c),n._isInFirstContentOfListItem&&(i._gfmTasklistFirstContentOfListItem=void 0)),d=n,n=n.next}for(n=e;++m<j.length;)"exit"===j[m][0]&&"enter"===j[m-1][0]&&j[m][1].type===j[m-1][1].type&&j[m][1].start.line!==j[m][1].end.line&&(p=m+1,q.push(p),n._tokenizer=void 0,n.previous=void 0,n=n.next);for(i.events=[],n?(n._tokenizer=void 0,n.previous=void 0):q.pop(),m=q.length;m--;){let b=j.slice(q[m],q[m+1]),c=h.pop();k.push([c,c+b.length-1]),a.splice(c,2,b)}for(k.reverse(),m=-1;++m<k.length;)l[o+k[m][0]]=o+k[m][1],o+=k[m][1]-k[m][0]-1;return l}(k,j)),j=i[j],h=!0);else if(b[1]._container){for(d=j,c=void 0;d--;)if("lineEnding"===(e=k.get(d))[1].type||"lineEndingBlank"===e[1].type)"enter"===e[0]&&(c&&(k.get(c)[1].type="lineEndingBlank"),e[1].type="lineEnding",c=d);else if("linePrefix"===e[1].type||"listItemIndent"===e[1].type);else break;c&&(b[1].end={...k.get(c)[1].start},(f=k.slice(c,j)).unshift(b),k.splice(c,j-c+1,f))}}return g$(a,0,1/0,k.slice(0)),!h}let g3={}.hasOwnProperty,g4=hg(/[A-Za-z]/),g5=hg(/[\dA-Za-z]/),g6=hg(/[#-'*+\--9=?A-Z^-~]/);function g7(a){return null!==a&&(a<32||127===a)}let g8=hg(/\d/),g9=hg(/[\dA-Fa-f]/),ha=hg(/[!-/:-@[-`{-~]/);function hb(a){return null!==a&&a<-2}function hc(a){return null!==a&&(a<0||32===a)}function hd(a){return -2===a||-1===a||32===a}let he=hg(/\p{P}|\p{S}/u),hf=hg(/\s/);function hg(a){return function(b){return null!==b&&b>-1&&a.test(String.fromCharCode(b))}}function hh(a,b,c,d){let e=d?d-1:1/0,f=0;return function(d){return hd(d)?(a.enter(c),function d(g){return hd(g)&&f++<e?(a.consume(g),d):(a.exit(c),b(g))}(d)):b(d)}}let hi={tokenize:function(a){let b,c=a.attempt(this.parser.constructs.contentInitial,function(b){return null===b?void a.consume(b):(a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),hh(a,c,"linePrefix"))},function(c){return a.enter("paragraph"),function c(d){let e=a.enter("chunkText",{contentType:"text",previous:b});return b&&(b.next=e),b=e,function b(d){if(null===d){a.exit("chunkText"),a.exit("paragraph"),a.consume(d);return}return hb(d)?(a.consume(d),a.exit("chunkText"),c):(a.consume(d),b)}(d)}(c)});return c}},hj={tokenize:function(a){let b,c,d,e=this,f=[],g=0;return h;function h(b){if(g<f.length){let c=f[g];return e.containerState=c[1],a.attempt(c[0].continuation,i,j)(b)}return j(b)}function i(a){if(g++,e.containerState._closeFlow){let c;e.containerState._closeFlow=void 0,b&&r();let d=e.events.length,f=d;for(;f--;)if("exit"===e.events[f][0]&&"chunkFlow"===e.events[f][1].type){c=e.events[f][1].end;break}q(g);let h=d;for(;h<e.events.length;)e.events[h][1].end={...c},h++;return g$(e.events,f+1,0,e.events.slice(d)),e.events.length=h,j(a)}return h(a)}function j(c){if(g===f.length){if(!b)return m(c);if(b.currentConstruct&&b.currentConstruct.concrete)return o(c);e.interrupt=!!(b.currentConstruct&&!b._gfmTableDynamicInterruptHack)}return e.containerState={},a.check(hk,k,l)(c)}function k(a){return b&&r(),q(g),m(a)}function l(a){return e.parser.lazy[e.now().line]=g!==f.length,d=e.now().offset,o(a)}function m(b){return e.containerState={},a.attempt(hk,n,o)(b)}function n(a){return g++,f.push([e.currentConstruct,e.containerState]),m(a)}function o(d){if(null===d){b&&r(),q(0),a.consume(d);return}return b=b||e.parser.flow(e.now()),a.enter("chunkFlow",{_tokenizer:b,contentType:"flow",previous:c}),function b(c){if(null===c){p(a.exit("chunkFlow"),!0),q(0),a.consume(c);return}return hb(c)?(a.consume(c),p(a.exit("chunkFlow")),g=0,e.interrupt=void 0,h):(a.consume(c),b)}(d)}function p(a,f){let h=e.sliceStream(a);if(f&&h.push(null),a.previous=c,c&&(c.next=a),c=a,b.defineSkip(a.start),b.write(h),e.parser.lazy[a.start.line]){let a,c,f=b.events.length;for(;f--;)if(b.events[f][1].start.offset<d&&(!b.events[f][1].end||b.events[f][1].end.offset>d))return;let h=e.events.length,i=h;for(;i--;)if("exit"===e.events[i][0]&&"chunkFlow"===e.events[i][1].type){if(a){c=e.events[i][1].end;break}a=!0}for(q(g),f=h;f<e.events.length;)e.events[f][1].end={...c},f++;g$(e.events,i+1,0,e.events.slice(h)),e.events.length=f}}function q(b){let c=f.length;for(;c-- >b;){let b=f[c];e.containerState=b[1],b[0].exit.call(e,a)}f.length=b}function r(){b.write([null]),c=void 0,b=void 0,e.containerState._closeFlow=void 0}}},hk={tokenize:function(a,b,c){return hh(a,a.attempt(this.parser.constructs.document,b,c),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}},hl={partial:!0,tokenize:function(a,b,c){return function(b){return hd(b)?hh(a,d,"linePrefix")(b):d(b)};function d(a){return null===a||hb(a)?b(a):c(a)}}},hm={resolve:function(a){return g2(a),a},tokenize:function(a,b){let c;return function(b){return a.enter("content"),c=a.enter("chunkContent",{contentType:"content"}),d(b)};function d(b){return null===b?e(b):hb(b)?a.check(hn,f,e)(b):(a.consume(b),d)}function e(c){return a.exit("chunkContent"),a.exit("content"),b(c)}function f(b){return a.consume(b),a.exit("chunkContent"),c.next=a.enter("chunkContent",{contentType:"content",previous:c}),c=c.next,d}}},hn={partial:!0,tokenize:function(a,b,c){let d=this;return function(b){return a.exit("chunkContent"),a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),hh(a,e,"linePrefix")};function e(e){if(null===e||hb(e))return c(e);let f=d.events[d.events.length-1];return!d.parser.constructs.disable.null.includes("codeIndented")&&f&&"linePrefix"===f[1].type&&f[2].sliceSerialize(f[1],!0).length>=4?b(e):a.interrupt(d.parser.constructs.flow,c,b)(e)}}},ho={tokenize:function(a){let b=this,c=a.attempt(hl,function(d){return null===d?void a.consume(d):(a.enter("lineEndingBlank"),a.consume(d),a.exit("lineEndingBlank"),b.currentConstruct=void 0,c)},a.attempt(this.parser.constructs.flowInitial,d,hh(a,a.attempt(this.parser.constructs.flow,d,a.attempt(hm,d)),"linePrefix")));return c;function d(d){return null===d?void a.consume(d):(a.enter("lineEnding"),a.consume(d),a.exit("lineEnding"),b.currentConstruct=void 0,c)}}},hp={resolveAll:ht()},hq=hs("string"),hr=hs("text");function hs(a){return{resolveAll:ht("text"===a?hu:void 0),tokenize:function(b){let c=this,d=this.parser.constructs[a],e=b.attempt(d,f,g);return f;function f(a){return i(a)?e(a):g(a)}function g(a){return null===a?void b.consume(a):(b.enter("data"),b.consume(a),h)}function h(a){return i(a)?(b.exit("data"),e(a)):(b.consume(a),h)}function i(a){if(null===a)return!0;let b=d[a],e=-1;if(b)for(;++e<b.length;){let a=b[e];if(!a.previous||a.previous.call(c,c.previous))return!0}return!1}}}}function ht(a){return function(b,c){let d,e=-1;for(;++e<=b.length;)void 0===d?b[e]&&"data"===b[e][1].type&&(d=e,e++):b[e]&&"data"===b[e][1].type||(e!==d+2&&(b[d][1].end=b[e-1][1].end,b.splice(d+2,e-d-2),e=d+2),d=void 0);return a?a(b,c):b}}function hu(a,b){let c=0;for(;++c<=a.length;)if((c===a.length||"lineEnding"===a[c][1].type)&&"data"===a[c-1][1].type){let d,e=a[c-1][1],f=b.sliceStream(e),g=f.length,h=-1,i=0;for(;g--;){let a=f[g];if("string"==typeof a){for(h=a.length;32===a.charCodeAt(h-1);)i++,h--;if(h)break;h=-1}else if(-2===a)d=!0,i++;else if(-1===a);else{g++;break}}if(b._contentTypeTextTrailing&&c===a.length&&(i=0),i){let f={type:c===a.length||d||i<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:g?h:e.start._bufferIndex+h,_index:e.start._index+g,line:e.end.line,column:e.end.column-i,offset:e.end.offset-i},end:{...e.end}};e.end={...f.start},e.start.offset===e.end.offset?Object.assign(e,f):(a.splice(c,0,["enter",f,b],["exit",f,b]),c+=2)}c++}return a}let hv={name:"thematicBreak",tokenize:function(a,b,c){let d,e=0;return function(f){var g;return a.enter("thematicBreak"),d=g=f,function f(g){return g===d?(a.enter("thematicBreakSequence"),function b(c){return c===d?(a.consume(c),e++,b):(a.exit("thematicBreakSequence"),hd(c)?hh(a,f,"whitespace")(c):f(c))}(g)):e>=3&&(null===g||hb(g))?(a.exit("thematicBreak"),b(g)):c(g)}(g)}}},hw={continuation:{tokenize:function(a,b,c){let d=this;return d.containerState._closeFlow=void 0,a.check(hl,function(c){return d.containerState.furtherBlankLines=d.containerState.furtherBlankLines||d.containerState.initialBlankLine,hh(a,b,"listItemIndent",d.containerState.size+1)(c)},function(c){return d.containerState.furtherBlankLines||!hd(c)?(d.containerState.furtherBlankLines=void 0,d.containerState.initialBlankLine=void 0,e(c)):(d.containerState.furtherBlankLines=void 0,d.containerState.initialBlankLine=void 0,a.attempt(hy,b,e)(c))});function e(e){return d.containerState._closeFlow=!0,d.interrupt=void 0,hh(a,a.attempt(hw,b,c),"linePrefix",d.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(e)}}},exit:function(a){a.exit(this.containerState.type)},name:"list",tokenize:function(a,b,c){let d=this,e=d.events[d.events.length-1],f=e&&"linePrefix"===e[1].type?e[2].sliceSerialize(e[1],!0).length:0,g=0;return function(b){let e=d.containerState.type||(42===b||43===b||45===b?"listUnordered":"listOrdered");if("listUnordered"===e?!d.containerState.marker||b===d.containerState.marker:g8(b)){if(d.containerState.type||(d.containerState.type=e,a.enter(e,{_container:!0})),"listUnordered"===e)return a.enter("listItemPrefix"),42===b||45===b?a.check(hv,c,h)(b):h(b);if(!d.interrupt||49===b)return a.enter("listItemPrefix"),a.enter("listItemValue"),function b(e){return g8(e)&&++g<10?(a.consume(e),b):(!d.interrupt||g<2)&&(d.containerState.marker?e===d.containerState.marker:41===e||46===e)?(a.exit("listItemValue"),h(e)):c(e)}(b)}return c(b)};function h(b){return a.enter("listItemMarker"),a.consume(b),a.exit("listItemMarker"),d.containerState.marker=d.containerState.marker||b,a.check(hl,d.interrupt?c:i,a.attempt(hx,k,j))}function i(a){return d.containerState.initialBlankLine=!0,f++,k(a)}function j(b){return hd(b)?(a.enter("listItemPrefixWhitespace"),a.consume(b),a.exit("listItemPrefixWhitespace"),k):c(b)}function k(c){return d.containerState.size=f+d.sliceSerialize(a.exit("listItemPrefix"),!0).length,b(c)}}},hx={partial:!0,tokenize:function(a,b,c){let d=this;return hh(a,function(a){let e=d.events[d.events.length-1];return!hd(a)&&e&&"listItemPrefixWhitespace"===e[1].type?b(a):c(a)},"listItemPrefixWhitespace",d.parser.constructs.disable.null.includes("codeIndented")?void 0:5)}},hy={partial:!0,tokenize:function(a,b,c){let d=this;return hh(a,function(a){let e=d.events[d.events.length-1];return e&&"listItemIndent"===e[1].type&&e[2].sliceSerialize(e[1],!0).length===d.containerState.size?b(a):c(a)},"listItemIndent",d.containerState.size+1)}},hz={continuation:{tokenize:function(a,b,c){let d=this;return function(b){return hd(b)?hh(a,e,"linePrefix",d.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(b):e(b)};function e(d){return a.attempt(hz,b,c)(d)}}},exit:function(a){a.exit("blockQuote")},name:"blockQuote",tokenize:function(a,b,c){let d=this;return function(b){if(62===b){let c=d.containerState;return c.open||(a.enter("blockQuote",{_container:!0}),c.open=!0),a.enter("blockQuotePrefix"),a.enter("blockQuoteMarker"),a.consume(b),a.exit("blockQuoteMarker"),e}return c(b)};function e(c){return hd(c)?(a.enter("blockQuotePrefixWhitespace"),a.consume(c),a.exit("blockQuotePrefixWhitespace"),a.exit("blockQuotePrefix"),b):(a.exit("blockQuotePrefix"),b(c))}}};function hA(a,b,c,d,e,f,g,h,i){let j=i||1/0,k=0;return function(b){return 60===b?(a.enter(d),a.enter(e),a.enter(f),a.consume(b),a.exit(f),l):null===b||32===b||41===b||g7(b)?c(b):(a.enter(d),a.enter(g),a.enter(h),a.enter("chunkString",{contentType:"string"}),o(b))};function l(c){return 62===c?(a.enter(f),a.consume(c),a.exit(f),a.exit(e),a.exit(d),b):(a.enter(h),a.enter("chunkString",{contentType:"string"}),m(c))}function m(b){return 62===b?(a.exit("chunkString"),a.exit(h),l(b)):null===b||60===b||hb(b)?c(b):(a.consume(b),92===b?n:m)}function n(b){return 60===b||62===b||92===b?(a.consume(b),m):m(b)}function o(e){return!k&&(null===e||41===e||hc(e))?(a.exit("chunkString"),a.exit(h),a.exit(g),a.exit(d),b(e)):k<j&&40===e?(a.consume(e),k++,o):41===e?(a.consume(e),k--,o):null===e||32===e||40===e||g7(e)?c(e):(a.consume(e),92===e?p:o)}function p(b){return 40===b||41===b||92===b?(a.consume(b),o):o(b)}}function hB(a,b,c,d,e,f){let g,h=this,i=0;return function(b){return a.enter(d),a.enter(e),a.consume(b),a.exit(e),a.enter(f),j};function j(l){return i>999||null===l||91===l||93===l&&!g||94===l&&!i&&"_hiddenFootnoteSupport"in h.parser.constructs?c(l):93===l?(a.exit(f),a.enter(e),a.consume(l),a.exit(e),a.exit(d),b):hb(l)?(a.enter("lineEnding"),a.consume(l),a.exit("lineEnding"),j):(a.enter("chunkString",{contentType:"string"}),k(l))}function k(b){return null===b||91===b||93===b||hb(b)||i++>999?(a.exit("chunkString"),j(b)):(a.consume(b),g||(g=!hd(b)),92===b?l:k)}function l(b){return 91===b||92===b||93===b?(a.consume(b),i++,k):k(b)}}function hC(a,b,c,d,e,f){let g;return function(b){return 34===b||39===b||40===b?(a.enter(d),a.enter(e),a.consume(b),a.exit(e),g=40===b?41:b,h):c(b)};function h(c){return c===g?(a.enter(e),a.consume(c),a.exit(e),a.exit(d),b):(a.enter(f),i(c))}function i(b){return b===g?(a.exit(f),h(g)):null===b?c(b):hb(b)?(a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),hh(a,i,"linePrefix")):(a.enter("chunkString",{contentType:"string"}),j(b))}function j(b){return b===g||null===b||hb(b)?(a.exit("chunkString"),i(b)):(a.consume(b),92===b?k:j)}function k(b){return b===g||92===b?(a.consume(b),j):j(b)}}function hD(a,b){let c;return function d(e){return hb(e)?(a.enter("lineEnding"),a.consume(e),a.exit("lineEnding"),c=!0,d):hd(e)?hh(a,d,c?"linePrefix":"lineSuffix")(e):b(e)}}function hE(a){return a.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}let hF={partial:!0,tokenize:function(a,b,c){return function(b){return hc(b)?hD(a,d)(b):c(b)};function d(b){return hC(a,e,c,"definitionTitle","definitionTitleMarker","definitionTitleString")(b)}function e(b){return hd(b)?hh(a,f,"whitespace")(b):f(b)}function f(a){return null===a||hb(a)?b(a):c(a)}}},hG={name:"codeIndented",tokenize:function(a,b,c){let d=this;return function(b){return a.enter("codeIndented"),hh(a,e,"linePrefix",5)(b)};function e(b){let e=d.events[d.events.length-1];return e&&"linePrefix"===e[1].type&&e[2].sliceSerialize(e[1],!0).length>=4?function b(c){return null===c?f(c):hb(c)?a.attempt(hH,b,f)(c):(a.enter("codeFlowValue"),function c(d){return null===d||hb(d)?(a.exit("codeFlowValue"),b(d)):(a.consume(d),c)}(c))}(b):c(b)}function f(c){return a.exit("codeIndented"),b(c)}}},hH={partial:!0,tokenize:function(a,b,c){let d=this;return e;function e(b){return d.parser.lazy[d.now().line]?c(b):hb(b)?(a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),e):hh(a,f,"linePrefix",5)(b)}function f(a){let f=d.events[d.events.length-1];return f&&"linePrefix"===f[1].type&&f[2].sliceSerialize(f[1],!0).length>=4?b(a):hb(a)?e(a):c(a)}}},hI={name:"setextUnderline",resolveTo:function(a,b){let c,d,e,f=a.length;for(;f--;)if("enter"===a[f][0]){if("content"===a[f][1].type){c=f;break}"paragraph"===a[f][1].type&&(d=f)}else"content"===a[f][1].type&&a.splice(f,1),e||"definition"!==a[f][1].type||(e=f);let g={type:"setextHeading",start:{...a[c][1].start},end:{...a[a.length-1][1].end}};return a[d][1].type="setextHeadingText",e?(a.splice(d,0,["enter",g,b]),a.splice(e+1,0,["exit",a[c][1],b]),a[c][1].end={...a[e][1].end}):a[c][1]=g,a.push(["exit",g,b]),a},tokenize:function(a,b,c){let d,e=this;return function(b){var g;let h,i=e.events.length;for(;i--;)if("lineEnding"!==e.events[i][1].type&&"linePrefix"!==e.events[i][1].type&&"content"!==e.events[i][1].type){h="paragraph"===e.events[i][1].type;break}return!e.parser.lazy[e.now().line]&&(e.interrupt||h)?(a.enter("setextHeadingLine"),d=b,g=b,a.enter("setextHeadingLineSequence"),function b(c){return c===d?(a.consume(c),b):(a.exit("setextHeadingLineSequence"),hd(c)?hh(a,f,"lineSuffix")(c):f(c))}(g)):c(b)};function f(d){return null===d||hb(d)?(a.exit("setextHeadingLine"),b(d)):c(d)}}},hJ=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],hK=["pre","script","style","textarea"],hL={partial:!0,tokenize:function(a,b,c){return function(d){return a.enter("lineEnding"),a.consume(d),a.exit("lineEnding"),a.attempt(hl,b,c)}}},hM={partial:!0,tokenize:function(a,b,c){let d=this;return function(b){return hb(b)?(a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),e):c(b)};function e(a){return d.parser.lazy[d.now().line]?c(a):b(a)}}},hN={partial:!0,tokenize:function(a,b,c){let d=this;return function(b){return null===b?c(b):(a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),e)};function e(a){return d.parser.lazy[d.now().line]?c(a):b(a)}}},hO={concrete:!0,name:"codeFenced",tokenize:function(a,b,c){let d,e=this,f={partial:!0,tokenize:function(a,b,c){let f=0;return function(b){return a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),g};function g(b){return a.enter("codeFencedFence"),hd(b)?hh(a,i,"linePrefix",e.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(b):i(b)}function i(b){return b===d?(a.enter("codeFencedFenceSequence"),function b(e){return e===d?(f++,a.consume(e),b):f>=h?(a.exit("codeFencedFenceSequence"),hd(e)?hh(a,j,"whitespace")(e):j(e)):c(e)}(b)):c(b)}function j(d){return null===d||hb(d)?(a.exit("codeFencedFence"),b(d)):c(d)}}},g=0,h=0;return function(b){var f=b;let j=e.events[e.events.length-1];return g=j&&"linePrefix"===j[1].type?j[2].sliceSerialize(j[1],!0).length:0,d=f,a.enter("codeFenced"),a.enter("codeFencedFence"),a.enter("codeFencedFenceSequence"),function b(e){return e===d?(h++,a.consume(e),b):h<3?c(e):(a.exit("codeFencedFenceSequence"),hd(e)?hh(a,i,"whitespace")(e):i(e))}(f)};function i(f){return null===f||hb(f)?(a.exit("codeFencedFence"),e.interrupt?b(f):a.check(hN,k,o)(f)):(a.enter("codeFencedFenceInfo"),a.enter("chunkString",{contentType:"string"}),function b(e){return null===e||hb(e)?(a.exit("chunkString"),a.exit("codeFencedFenceInfo"),i(e)):hd(e)?(a.exit("chunkString"),a.exit("codeFencedFenceInfo"),hh(a,j,"whitespace")(e)):96===e&&e===d?c(e):(a.consume(e),b)}(f))}function j(b){return null===b||hb(b)?i(b):(a.enter("codeFencedFenceMeta"),a.enter("chunkString",{contentType:"string"}),function b(e){return null===e||hb(e)?(a.exit("chunkString"),a.exit("codeFencedFenceMeta"),i(e)):96===e&&e===d?c(e):(a.consume(e),b)}(b))}function k(b){return a.attempt(f,o,l)(b)}function l(b){return a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),m}function m(b){return g>0&&hd(b)?hh(a,n,"linePrefix",g+1)(b):n(b)}function n(b){return null===b||hb(b)?a.check(hN,k,o)(b):(a.enter("codeFlowValue"),function b(c){return null===c||hb(c)?(a.exit("codeFlowValue"),n(c)):(a.consume(c),b)}(b))}function o(c){return a.exit("codeFenced"),b(c)}}},hP={AElig:"\xc6",AMP:"&",Aacute:"\xc1",Abreve:"",Acirc:"\xc2",Acy:"",Afr:"\uD835\uDD04",Agrave:"\xc0",Alpha:"",Amacr:"",And:"",Aogon:"",Aopf:"\uD835\uDD38",ApplyFunction:"",Aring:"\xc5",Ascr:"\uD835\uDC9C",Assign:"",Atilde:"\xc3",Auml:"\xc4",Backslash:"",Barv:"",Barwed:"",Bcy:"",Because:"",Bernoullis:"",Beta:"",Bfr:"\uD835\uDD05",Bopf:"\uD835\uDD39",Breve:"",Bscr:"",Bumpeq:"",CHcy:"",COPY:"\xa9",Cacute:"",Cap:"",CapitalDifferentialD:"",Cayleys:"",Ccaron:"",Ccedil:"\xc7",Ccirc:"",Cconint:"",Cdot:"",Cedilla:"\xb8",CenterDot:"\xb7",Cfr:"",Chi:"",CircleDot:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",Colon:"",Colone:"",Congruent:"",Conint:"",ContourIntegral:"",Copf:"",Coproduct:"",CounterClockwiseContourIntegral:"",Cross:"",Cscr:"\uD835\uDC9E",Cup:"",CupCap:"",DD:"",DDotrahd:"",DJcy:"",DScy:"",DZcy:"",Dagger:"",Darr:"",Dashv:"",Dcaron:"",Dcy:"",Del:"",Delta:"",Dfr:"\uD835\uDD07",DiacriticalAcute:"\xb4",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",Diamond:"",DifferentialD:"",Dopf:"\uD835\uDD3B",Dot:"\xa8",DotDot:"",DotEqual:"",DoubleContourIntegral:"",DoubleDot:"\xa8",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",Downarrow:"",Dscr:"\uD835\uDC9F",Dstrok:"",ENG:"",ETH:"\xd0",Eacute:"\xc9",Ecaron:"",Ecirc:"\xca",Ecy:"",Edot:"",Efr:"\uD835\uDD08",Egrave:"\xc8",Element:"",Emacr:"",EmptySmallSquare:"",EmptyVerySmallSquare:"",Eogon:"",Eopf:"\uD835\uDD3C",Epsilon:"",Equal:"",EqualTilde:"",Equilibrium:"",Escr:"",Esim:"",Eta:"",Euml:"\xcb",Exists:"",ExponentialE:"",Fcy:"",Ffr:"\uD835\uDD09",FilledSmallSquare:"",FilledVerySmallSquare:"",Fopf:"\uD835\uDD3D",ForAll:"",Fouriertrf:"",Fscr:"",GJcy:"",GT:">",Gamma:"",Gammad:"",Gbreve:"",Gcedil:"",Gcirc:"",Gcy:"",Gdot:"",Gfr:"\uD835\uDD0A",Gg:"",Gopf:"\uD835\uDD3E",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"\uD835\uDCA2",Gt:"",HARDcy:"",Hacek:"",Hat:"^",Hcirc:"",Hfr:"",HilbertSpace:"",Hopf:"",HorizontalLine:"",Hscr:"",Hstrok:"",HumpDownHump:"",HumpEqual:"",IEcy:"",IJlig:"",IOcy:"",Iacute:"\xcd",Icirc:"\xce",Icy:"",Idot:"",Ifr:"",Igrave:"\xcc",Im:"",Imacr:"",ImaginaryI:"",Implies:"",Int:"",Integral:"",Intersection:"",InvisibleComma:"",InvisibleTimes:"",Iogon:"",Iopf:"\uD835\uDD40",Iota:"",Iscr:"",Itilde:"",Iukcy:"",Iuml:"\xcf",Jcirc:"",Jcy:"",Jfr:"\uD835\uDD0D",Jopf:"\uD835\uDD41",Jscr:"\uD835\uDCA5",Jsercy:"",Jukcy:"",KHcy:"",KJcy:"",Kappa:"",Kcedil:"",Kcy:"",Kfr:"\uD835\uDD0E",Kopf:"\uD835\uDD42",Kscr:"\uD835\uDCA6",LJcy:"",LT:"<",Lacute:"",Lambda:"",Lang:"",Laplacetrf:"",Larr:"",Lcaron:"",Lcedil:"",Lcy:"",LeftAngleBracket:"",LeftArrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",LeftRightArrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",Leftarrow:"",Leftrightarrow:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",LessLess:"",LessSlantEqual:"",LessTilde:"",Lfr:"\uD835\uDD0F",Ll:"",Lleftarrow:"",Lmidot:"",LongLeftArrow:"",LongLeftRightArrow:"",LongRightArrow:"",Longleftarrow:"",Longleftrightarrow:"",Longrightarrow:"",Lopf:"\uD835\uDD43",LowerLeftArrow:"",LowerRightArrow:"",Lscr:"",Lsh:"",Lstrok:"",Lt:"",Map:"",Mcy:"",MediumSpace:"",Mellintrf:"",Mfr:"\uD835\uDD10",MinusPlus:"",Mopf:"\uD835\uDD44",Mscr:"",Mu:"",NJcy:"",Nacute:"",Ncaron:"",Ncedil:"",Ncy:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",Nfr:"\uD835\uDD11",NoBreak:"",NonBreakingSpace:"\xa0",Nopf:"",Not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",Nscr:"\uD835\uDCA9",Ntilde:"\xd1",Nu:"",OElig:"",Oacute:"\xd3",Ocirc:"\xd4",Ocy:"",Odblac:"",Ofr:"\uD835\uDD12",Ograve:"\xd2",Omacr:"",Omega:"",Omicron:"",Oopf:"\uD835\uDD46",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",Or:"",Oscr:"\uD835\uDCAA",Oslash:"\xd8",Otilde:"\xd5",Otimes:"",Ouml:"\xd6",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",PartialD:"",Pcy:"",Pfr:"\uD835\uDD13",Phi:"",Pi:"",PlusMinus:"\xb1",Poincareplane:"",Popf:"",Pr:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",Prime:"",Product:"",Proportion:"",Proportional:"",Pscr:"\uD835\uDCAB",Psi:"",QUOT:'"',Qfr:"\uD835\uDD14",Qopf:"",Qscr:"\uD835\uDCAC",RBarr:"",REG:"\xae",Racute:"",Rang:"",Rarr:"",Rarrtl:"",Rcaron:"",Rcedil:"",Rcy:"",Re:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",Rfr:"",Rho:"",RightAngleBracket:"",RightArrow:"",RightArrowBar:"",RightArrowLeftArrow:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",Rightarrow:"",Ropf:"",RoundImplies:"",Rrightarrow:"",Rscr:"",Rsh:"",RuleDelayed:"",SHCHcy:"",SHcy:"",SOFTcy:"",Sacute:"",Sc:"",Scaron:"",Scedil:"",Scirc:"",Scy:"",Sfr:"\uD835\uDD16",ShortDownArrow:"",ShortLeftArrow:"",ShortRightArrow:"",ShortUpArrow:"",Sigma:"",SmallCircle:"",Sopf:"\uD835\uDD4A",Sqrt:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",Sscr:"\uD835\uDCAE",Star:"",Sub:"",Subset:"",SubsetEqual:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",SuchThat:"",Sum:"",Sup:"",Superset:"",SupersetEqual:"",Supset:"",THORN:"\xde",TRADE:"",TSHcy:"",TScy:"",Tab:"	",Tau:"",Tcaron:"",Tcedil:"",Tcy:"",Tfr:"\uD835\uDD17",Therefore:"",Theta:"",ThickSpace:"",ThinSpace:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",Topf:"\uD835\uDD4B",TripleDot:"",Tscr:"\uD835\uDCAF",Tstrok:"",Uacute:"\xda",Uarr:"",Uarrocir:"",Ubrcy:"",Ubreve:"",Ucirc:"\xdb",Ucy:"",Udblac:"",Ufr:"\uD835\uDD18",Ugrave:"\xd9",Umacr:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",Uopf:"\uD835\uDD4C",UpArrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",UpEquilibrium:"",UpTee:"",UpTeeArrow:"",Uparrow:"",Updownarrow:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",Upsilon:"",Uring:"",Uscr:"\uD835\uDCB0",Utilde:"",Uuml:"\xdc",VDash:"",Vbar:"",Vcy:"",Vdash:"",Vdashl:"",Vee:"",Verbar:"",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"\uD835\uDD19",Vopf:"\uD835\uDD4D",Vscr:"\uD835\uDCB1",Vvdash:"",Wcirc:"",Wedge:"",Wfr:"\uD835\uDD1A",Wopf:"\uD835\uDD4E",Wscr:"\uD835\uDCB2",Xfr:"\uD835\uDD1B",Xi:"",Xopf:"\uD835\uDD4F",Xscr:"\uD835\uDCB3",YAcy:"",YIcy:"",YUcy:"",Yacute:"\xdd",Ycirc:"",Ycy:"",Yfr:"\uD835\uDD1C",Yopf:"\uD835\uDD50",Yscr:"\uD835\uDCB4",Yuml:"",ZHcy:"",Zacute:"",Zcaron:"",Zcy:"",Zdot:"",ZeroWidthSpace:"",Zeta:"",Zfr:"",Zopf:"",Zscr:"\uD835\uDCB5",aacute:"\xe1",abreve:"",ac:"",acE:"",acd:"",acirc:"\xe2",acute:"\xb4",acy:"",aelig:"\xe6",af:"",afr:"\uD835\uDD1E",agrave:"\xe0",alefsym:"",aleph:"",alpha:"",amacr:"",amalg:"",amp:"&",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"\xc5",angzarr:"",aogon:"",aopf:"\uD835\uDD52",ap:"",apE:"",apacir:"",ape:"",apid:"",apos:"'",approx:"",approxeq:"",aring:"\xe5",ascr:"\uD835\uDCB6",ast:"*",asymp:"",asympeq:"",atilde:"\xe3",auml:"\xe4",awconint:"",awint:"",bNot:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",barvee:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",bcy:"",bdquo:"",becaus:"",because:"",bemptyv:"",bepsi:"",bernou:"",beta:"",beth:"",between:"",bfr:"\uD835\uDD1F",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bnot:"",bopf:"\uD835\uDD53",bot:"",bottom:"",bowtie:"",boxDL:"",boxDR:"",boxDl:"",boxDr:"",boxH:"",boxHD:"",boxHU:"",boxHd:"",boxHu:"",boxUL:"",boxUR:"",boxUl:"",boxUr:"",boxV:"",boxVH:"",boxVL:"",boxVR:"",boxVh:"",boxVl:"",boxVr:"",boxbox:"",boxdL:"",boxdR:"",boxdl:"",boxdr:"",boxh:"",boxhD:"",boxhU:"",boxhd:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxuL:"",boxuR:"",boxul:"",boxur:"",boxv:"",boxvH:"",boxvL:"",boxvR:"",boxvh:"",boxvl:"",boxvr:"",bprime:"",breve:"",brvbar:"\xa6",bscr:"\uD835\uDCB7",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",bumpeq:"",cacute:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",caps:"",caret:"",caron:"",ccaps:"",ccaron:"",ccedil:"\xe7",ccirc:"",ccups:"",ccupssm:"",cdot:"",cedil:"\xb8",cemptyv:"",cent:"\xa2",centerdot:"\xb7",cfr:"\uD835\uDD20",chcy:"",check:"",checkmark:"",chi:"",cir:"",cirE:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledR:"\xae",circledS:"",circledast:"",circledcirc:"",circleddash:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",clubs:"",clubsuit:"",colon:":",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",conint:"",copf:"\uD835\uDD54",coprod:"",copy:"\xa9",copysr:"",crarr:"",cross:"",cscr:"\uD835\uDCB8",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cup:"",cupbrcap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"\xa4",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dArr:"",dHar:"",dagger:"",daleth:"",darr:"",dash:"",dashv:"",dbkarow:"",dblac:"",dcaron:"",dcy:"",dd:"",ddagger:"",ddarr:"",ddotseq:"",deg:"\xb0",delta:"",demptyv:"",dfisht:"",dfr:"\uD835\uDD21",dharl:"",dharr:"",diam:"",diamond:"",diamondsuit:"",diams:"",die:"\xa8",digamma:"",disin:"",div:"\xf7",divide:"\xf7",divideontimes:"",divonx:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",dopf:"\uD835\uDD55",dot:"",doteq:"",doteqdot:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",downarrow:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",drbkarow:"",drcorn:"",drcrop:"",dscr:"\uD835\uDCB9",dscy:"",dsol:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",dzcy:"",dzigrarr:"",eDDot:"",eDot:"",eacute:"\xe9",easter:"",ecaron:"",ecir:"",ecirc:"\xea",ecolon:"",ecy:"",edot:"",ee:"",efDot:"",efr:"\uD835\uDD22",eg:"",egrave:"\xe8",egs:"",egsdot:"",el:"",elinters:"",ell:"",els:"",elsdot:"",emacr:"",empty:"",emptyset:"",emptyv:"",emsp13:"",emsp14:"",emsp:"",eng:"",ensp:"",eogon:"",eopf:"\uD835\uDD56",epar:"",eparsl:"",eplus:"",epsi:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",equals:"=",equest:"",equiv:"",equivDD:"",eqvparsl:"",erDot:"",erarr:"",escr:"",esdot:"",esim:"",eta:"",eth:"\xf0",euml:"\xeb",euro:"",excl:"!",exist:"",expectation:"",exponentiale:"",fallingdotseq:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",ffr:"\uD835\uDD23",filig:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",fopf:"\uD835\uDD57",forall:"",fork:"",forkv:"",fpartint:"",frac12:"\xbd",frac13:"",frac14:"\xbc",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"\xbe",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"\uD835\uDCBB",gE:"",gEl:"",gacute:"",gamma:"",gammad:"",gap:"",gbreve:"",gcirc:"",gcy:"",gdot:"",ge:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",gfr:"\uD835\uDD24",gg:"",ggg:"",gimel:"",gjcy:"",gl:"",glE:"",gla:"",glj:"",gnE:"",gnap:"",gnapprox:"",gne:"",gneq:"",gneqq:"",gnsim:"",gopf:"\uD835\uDD58",grave:"`",gscr:"",gsim:"",gsime:"",gsiml:"",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",hArr:"",hairsp:"",half:"\xbd",hamilt:"",hardcy:"",harr:"",harrcir:"",harrw:"",hbar:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"\uD835\uDD25",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"\uD835\uDD59",horbar:"",hscr:"\uD835\uDCBD",hslash:"",hstrok:"",hybull:"",hyphen:"",iacute:"\xed",ic:"",icirc:"\xee",icy:"",iecy:"",iexcl:"\xa1",iff:"",ifr:"\uD835\uDD26",igrave:"\xec",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",ijlig:"",imacr:"",image:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",in:"",incare:"",infin:"",infintie:"",inodot:"",int:"",intcal:"",integers:"",intercal:"",intlarhk:"",intprod:"",iocy:"",iogon:"",iopf:"\uD835\uDD5A",iota:"",iprod:"",iquest:"\xbf",iscr:"\uD835\uDCBE",isin:"",isinE:"",isindot:"",isins:"",isinsv:"",isinv:"",it:"",itilde:"",iukcy:"",iuml:"\xef",jcirc:"",jcy:"",jfr:"\uD835\uDD27",jmath:"",jopf:"\uD835\uDD5B",jscr:"\uD835\uDCBF",jsercy:"",jukcy:"",kappa:"",kappav:"",kcedil:"",kcy:"",kfr:"\uD835\uDD28",kgreen:"",khcy:"",kjcy:"",kopf:"\uD835\uDD5C",kscr:"\uD835\uDCC0",lAarr:"",lArr:"",lAtail:"",lBarr:"",lE:"",lEg:"",lHar:"",lacute:"",laemptyv:"",lagran:"",lambda:"",lang:"",langd:"",langle:"",lap:"",laquo:"\xab",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",latail:"",late:"",lates:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",lcaron:"",lcedil:"",lceil:"",lcub:"{",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",leftarrow:"",leftarrowtail:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",leftthreetimes:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",lessgtr:"",lesssim:"",lfisht:"",lfloor:"",lfr:"\uD835\uDD29",lg:"",lgE:"",lhard:"",lharu:"",lharul:"",lhblk:"",ljcy:"",ll:"",llarr:"",llcorner:"",llhard:"",lltri:"",lmidot:"",lmoust:"",lmoustache:"",lnE:"",lnap:"",lnapprox:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",longleftrightarrow:"",longmapsto:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",lopf:"\uD835\uDD5D",loplus:"",lotimes:"",lowast:"",lowbar:"_",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"\uD835\uDCC1",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",lstrok:"",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltrPar:"",ltri:"",ltrie:"",ltrif:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",mDDot:"",macr:"\xaf",male:"",malt:"",maltese:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",mcy:"",mdash:"",measuredangle:"",mfr:"\uD835\uDD2A",mho:"",micro:"\xb5",mid:"",midast:"*",midcir:"",middot:"\xb7",minus:"",minusb:"",minusd:"",minusdu:"",mlcp:"",mldr:"",mnplus:"",models:"",mopf:"\uD835\uDD5E",mp:"",mscr:"\uD835\uDCC2",mstpos:"",mu:"",multimap:"",mumap:"",nGg:"",nGt:"",nGtv:"",nLeftarrow:"",nLeftrightarrow:"",nLl:"",nLt:"",nLtv:"",nRightarrow:"",nVDash:"",nVdash:"",nabla:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"\xa0",nbump:"",nbumpe:"",ncap:"",ncaron:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",ncy:"",ndash:"",ne:"",neArr:"",nearhk:"",nearr:"",nearrow:"",nedot:"",nequiv:"",nesear:"",nesim:"",nexist:"",nexists:"",nfr:"\uD835\uDD2B",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",ngsim:"",ngt:"",ngtr:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",njcy:"",nlArr:"",nlE:"",nlarr:"",nldr:"",nle:"",nleftarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nlsim:"",nlt:"",nltri:"",nltrie:"",nmid:"",nopf:"\uD835\uDD5F",not:"\xac",notin:"",notinE:"",notindot:"",notinva:"",notinvb:"",notinvc:"",notni:"",notniva:"",notnivb:"",notnivc:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",nscr:"\uD835\uDCC3",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",ntilde:"\xf1",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",nu:"",num:"#",numero:"",numsp:"",nvDash:"",nvHarr:"",nvap:"",nvdash:"",nvge:"",nvgt:">",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwArr:"",nwarhk:"",nwarr:"",nwarrow:"",nwnear:"",oS:"",oacute:"\xf3",oast:"",ocir:"",ocirc:"\xf4",ocy:"",odash:"",odblac:"",odiv:"",odot:"",odsold:"",oelig:"",ofcir:"",ofr:"\uD835\uDD2C",ogon:"",ograve:"\xf2",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",omacr:"",omega:"",omicron:"",omid:"",ominus:"",oopf:"\uD835\uDD60",opar:"",operp:"",oplus:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"\xaa",ordm:"\xba",origof:"",oror:"",orslope:"",orv:"",oscr:"",oslash:"\xf8",osol:"",otilde:"\xf5",otimes:"",otimesas:"",ouml:"\xf6",ovbar:"",par:"",para:"\xb6",parallel:"",parsim:"",parsl:"",part:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",pfr:"\uD835\uDD2D",phi:"",phiv:"",phmmat:"",phone:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",plusmn:"\xb1",plussim:"",plustwo:"",pm:"\xb1",pointint:"",popf:"\uD835\uDD61",pound:"\xa3",pr:"",prE:"",prap:"",prcue:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",prime:"",primes:"",prnE:"",prnap:"",prnsim:"",prod:"",profalar:"",profline:"",profsurf:"",prop:"",propto:"",prsim:"",prurel:"",pscr:"\uD835\uDCC5",psi:"",puncsp:"",qfr:"\uD835\uDD2E",qint:"",qopf:"\uD835\uDD62",qprime:"",qscr:"\uD835\uDCC6",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',rAarr:"",rArr:"",rAtail:"",rBarr:"",rHar:"",race:"",racute:"",radic:"",raemptyv:"",rang:"",rangd:"",range:"",rangle:"",raquo:"\xbb",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",rarrtl:"",rarrw:"",ratail:"",ratio:"",rationals:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",rcaron:"",rcedil:"",rceil:"",rcub:"}",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",rect:"",reg:"\xae",rfisht:"",rfloor:"",rfr:"\uD835\uDD2F",rhard:"",rharu:"",rharul:"",rho:"",rhov:"",rightarrow:"",rightarrowtail:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",rightthreetimes:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"\uD835\uDD63",roplus:"",rotimes:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",rsaquo:"",rscr:"\uD835\uDCC7",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",ruluhar:"",rx:"",sacute:"",sbquo:"",sc:"",scE:"",scap:"",scaron:"",sccue:"",sce:"",scedil:"",scirc:"",scnE:"",scnap:"",scnsim:"",scpolint:"",scsim:"",scy:"",sdot:"",sdotb:"",sdote:"",seArr:"",searhk:"",searr:"",searrow:"",sect:"\xa7",semi:";",seswar:"",setminus:"",setmn:"",sext:"",sfr:"\uD835\uDD30",sfrown:"",sharp:"",shchcy:"",shcy:"",shortmid:"",shortparallel:"",shy:"\xad",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",softcy:"",sol:"/",solb:"",solbar:"",sopf:"\uD835\uDD64",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",square:"",squarf:"",squf:"",srarr:"",sscr:"\uD835\uDCC8",ssetmn:"",ssmile:"",sstarf:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"\xaf",sub:"",subE:"",subdot:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",subseteq:"",subseteqq:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",sum:"",sung:"",sup1:"\xb9",sup2:"\xb2",sup3:"\xb3",sup:"",supE:"",supdot:"",supdsub:"",supe:"",supedot:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swArr:"",swarhk:"",swarr:"",swarrow:"",swnwar:"",szlig:"\xdf",target:"",tau:"",tbrk:"",tcaron:"",tcedil:"",tcy:"",tdot:"",telrec:"",tfr:"\uD835\uDD31",there4:"",therefore:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",thinsp:"",thkap:"",thksim:"",thorn:"\xfe",tilde:"",times:"\xd7",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",topf:"\uD835\uDD65",topfork:"",tosa:"",tprime:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",triplus:"",trisb:"",tritime:"",trpezium:"",tscr:"\uD835\uDCC9",tscy:"",tshcy:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",uArr:"",uHar:"",uacute:"\xfa",uarr:"",ubrcy:"",ubreve:"",ucirc:"\xfb",ucy:"",udarr:"",udblac:"",udhar:"",ufisht:"",ufr:"\uD835\uDD32",ugrave:"\xf9",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",umacr:"",uml:"\xa8",uogon:"",uopf:"\uD835\uDD66",uparrow:"",updownarrow:"",upharpoonleft:"",upharpoonright:"",uplus:"",upsi:"",upsih:"",upsilon:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",uring:"",urtri:"",uscr:"\uD835\uDCCA",utdot:"",utilde:"",utri:"",utrif:"",uuarr:"",uuml:"\xfc",uwangle:"",vArr:"",vBar:"",vBarv:"",vDash:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vcy:"",vdash:"",vee:"",veebar:"",veeeq:"",vellip:"",verbar:"|",vert:"|",vfr:"\uD835\uDD33",vltri:"",vnsub:"",vnsup:"",vopf:"\uD835\uDD67",vprop:"",vrtri:"",vscr:"\uD835\uDCCB",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",vzigzag:"",wcirc:"",wedbar:"",wedge:"",wedgeq:"",weierp:"",wfr:"\uD835\uDD34",wopf:"\uD835\uDD68",wp:"",wr:"",wreath:"",wscr:"\uD835\uDCCC",xcap:"",xcirc:"",xcup:"",xdtri:"",xfr:"\uD835\uDD35",xhArr:"",xharr:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",xopf:"\uD835\uDD69",xoplus:"",xotime:"",xrArr:"",xrarr:"",xscr:"\uD835\uDCCD",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",yacute:"\xfd",yacy:"",ycirc:"",ycy:"",yen:"\xa5",yfr:"\uD835\uDD36",yicy:"",yopf:"\uD835\uDD6A",yscr:"\uD835\uDCCE",yucy:"",yuml:"\xff",zacute:"",zcaron:"",zcy:"",zdot:"",zeetrf:"",zeta:"",zfr:"\uD835\uDD37",zhcy:"",zigrarr:"",zopf:"\uD835\uDD6B",zscr:"\uD835\uDCCF",zwj:"",zwnj:""},hQ={}.hasOwnProperty;function hR(a){return!!hQ.call(hP,a)&&hP[a]}let hS={name:"characterReference",tokenize:function(a,b,c){let d,e,f=this,g=0;return function(b){return a.enter("characterReference"),a.enter("characterReferenceMarker"),a.consume(b),a.exit("characterReferenceMarker"),h};function h(b){return 35===b?(a.enter("characterReferenceMarkerNumeric"),a.consume(b),a.exit("characterReferenceMarkerNumeric"),i):(a.enter("characterReferenceValue"),d=31,e=g5,j(b))}function i(b){return 88===b||120===b?(a.enter("characterReferenceMarkerHexadecimal"),a.consume(b),a.exit("characterReferenceMarkerHexadecimal"),a.enter("characterReferenceValue"),d=6,e=g9,j):(a.enter("characterReferenceValue"),d=7,e=g8,j(b))}function j(h){if(59===h&&g){let d=a.exit("characterReferenceValue");return e!==g5||hR(f.sliceSerialize(d))?(a.enter("characterReferenceMarker"),a.consume(h),a.exit("characterReferenceMarker"),a.exit("characterReference"),b):c(h)}return e(h)&&g++<d?(a.consume(h),j):c(h)}}},hT={name:"characterEscape",tokenize:function(a,b,c){return function(b){return a.enter("characterEscape"),a.enter("escapeMarker"),a.consume(b),a.exit("escapeMarker"),d};function d(d){return ha(d)?(a.enter("characterEscapeValue"),a.consume(d),a.exit("characterEscapeValue"),a.exit("characterEscape"),b):c(d)}}},hU={name:"lineEnding",tokenize:function(a,b){return function(c){return a.enter("lineEnding"),a.consume(c),a.exit("lineEnding"),hh(a,b,"linePrefix")}}};function hV(a,b,c){let d=[],e=-1;for(;++e<a.length;){let f=a[e].resolveAll;f&&!d.includes(f)&&(b=f(b,c),d.push(f))}return b}let hW={name:"labelEnd",resolveAll:function(a){let b=-1,c=[];for(;++b<a.length;){let d=a[b][1];if(c.push(a[b]),"labelImage"===d.type||"labelLink"===d.type||"labelEnd"===d.type){let a="labelImage"===d.type?4:2;d.type="data",b+=a}}return a.length!==c.length&&g$(a,0,a.length,c),a},resolveTo:function(a,b){let c,d,e,f,g=a.length,h=0;for(;g--;)if(c=a[g][1],d){if("link"===c.type||"labelLink"===c.type&&c._inactive)break;"enter"===a[g][0]&&"labelLink"===c.type&&(c._inactive=!0)}else if(e){if("enter"===a[g][0]&&("labelImage"===c.type||"labelLink"===c.type)&&!c._balanced&&(d=g,"labelLink"!==c.type)){h=2;break}}else"labelEnd"===c.type&&(e=g);let i={type:"labelLink"===a[d][1].type?"link":"image",start:{...a[d][1].start},end:{...a[a.length-1][1].end}},j={type:"label",start:{...a[d][1].start},end:{...a[e][1].end}},k={type:"labelText",start:{...a[d+h+2][1].end},end:{...a[e-2][1].start}};return f=g_(f=[["enter",i,b],["enter",j,b]],a.slice(d+1,d+h+3)),f=g_(f,[["enter",k,b]]),f=g_(f,hV(b.parser.constructs.insideSpan.null,a.slice(d+h+4,e-3),b)),f=g_(f,[["exit",k,b],a[e-2],a[e-1],["exit",j,b]]),f=g_(f,a.slice(e+1)),f=g_(f,[["exit",i,b]]),g$(a,d,a.length,f),a},tokenize:function(a,b,c){let d,e,f=this,g=f.events.length;for(;g--;)if(("labelImage"===f.events[g][1].type||"labelLink"===f.events[g][1].type)&&!f.events[g][1]._balanced){d=f.events[g][1];break}return function(b){return d?d._inactive?k(b):(e=f.parser.defined.includes(hE(f.sliceSerialize({start:d.end,end:f.now()}))),a.enter("labelEnd"),a.enter("labelMarker"),a.consume(b),a.exit("labelMarker"),a.exit("labelEnd"),h):c(b)};function h(b){return 40===b?a.attempt(hX,j,e?j:k)(b):91===b?a.attempt(hY,j,e?i:k)(b):e?j(b):k(b)}function i(b){return a.attempt(hZ,j,k)(b)}function j(a){return b(a)}function k(a){return d._balanced=!0,c(a)}}},hX={tokenize:function(a,b,c){return function(b){return a.enter("resource"),a.enter("resourceMarker"),a.consume(b),a.exit("resourceMarker"),d};function d(b){return hc(b)?hD(a,e)(b):e(b)}function e(b){return 41===b?j(b):hA(a,f,g,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(b)}function f(b){return hc(b)?hD(a,h)(b):j(b)}function g(a){return c(a)}function h(b){return 34===b||39===b||40===b?hC(a,i,c,"resourceTitle","resourceTitleMarker","resourceTitleString")(b):j(b)}function i(b){return hc(b)?hD(a,j)(b):j(b)}function j(d){return 41===d?(a.enter("resourceMarker"),a.consume(d),a.exit("resourceMarker"),a.exit("resource"),b):c(d)}}},hY={tokenize:function(a,b,c){let d=this;return function(b){return hB.call(d,a,e,f,"reference","referenceMarker","referenceString")(b)};function e(a){return d.parser.defined.includes(hE(d.sliceSerialize(d.events[d.events.length-1][1]).slice(1,-1)))?b(a):c(a)}function f(a){return c(a)}}},hZ={tokenize:function(a,b,c){return function(b){return a.enter("reference"),a.enter("referenceMarker"),a.consume(b),a.exit("referenceMarker"),d};function d(d){return 93===d?(a.enter("referenceMarker"),a.consume(d),a.exit("referenceMarker"),a.exit("reference"),b):c(d)}}},h$={name:"labelStartImage",resolveAll:hW.resolveAll,tokenize:function(a,b,c){let d=this;return function(b){return a.enter("labelImage"),a.enter("labelImageMarker"),a.consume(b),a.exit("labelImageMarker"),e};function e(b){return 91===b?(a.enter("labelMarker"),a.consume(b),a.exit("labelMarker"),a.exit("labelImage"),f):c(b)}function f(a){return 94===a&&"_hiddenFootnoteSupport"in d.parser.constructs?c(a):b(a)}}};function h_(a){return null===a||hc(a)||hf(a)?1:he(a)?2:void 0}let h0={name:"attention",resolveAll:function(a,b){let c,d,e,f,g,h,i,j,k=-1;for(;++k<a.length;)if("enter"===a[k][0]&&"attentionSequence"===a[k][1].type&&a[k][1]._close){for(c=k;c--;)if("exit"===a[c][0]&&"attentionSequence"===a[c][1].type&&a[c][1]._open&&b.sliceSerialize(a[c][1]).charCodeAt(0)===b.sliceSerialize(a[k][1]).charCodeAt(0)){if((a[c][1]._close||a[k][1]._open)&&(a[k][1].end.offset-a[k][1].start.offset)%3&&!((a[c][1].end.offset-a[c][1].start.offset+a[k][1].end.offset-a[k][1].start.offset)%3))continue;h=a[c][1].end.offset-a[c][1].start.offset>1&&a[k][1].end.offset-a[k][1].start.offset>1?2:1;let l={...a[c][1].end},m={...a[k][1].start};h1(l,-h),h1(m,h),f={type:h>1?"strongSequence":"emphasisSequence",start:l,end:{...a[c][1].end}},g={type:h>1?"strongSequence":"emphasisSequence",start:{...a[k][1].start},end:m},e={type:h>1?"strongText":"emphasisText",start:{...a[c][1].end},end:{...a[k][1].start}},d={type:h>1?"strong":"emphasis",start:{...f.start},end:{...g.end}},a[c][1].end={...f.start},a[k][1].start={...g.end},i=[],a[c][1].end.offset-a[c][1].start.offset&&(i=g_(i,[["enter",a[c][1],b],["exit",a[c][1],b]])),i=g_(i,[["enter",d,b],["enter",f,b],["exit",f,b],["enter",e,b]]),i=g_(i,hV(b.parser.constructs.insideSpan.null,a.slice(c+1,k),b)),i=g_(i,[["exit",e,b],["enter",g,b],["exit",g,b],["exit",d,b]]),a[k][1].end.offset-a[k][1].start.offset?(j=2,i=g_(i,[["enter",a[k][1],b],["exit",a[k][1],b]])):j=0,g$(a,c-1,k-c+3,i),k=c+i.length-j-2;break}}for(k=-1;++k<a.length;)"attentionSequence"===a[k][1].type&&(a[k][1].type="data");return a},tokenize:function(a,b){let c,d=this.parser.constructs.attentionMarkers.null,e=this.previous,f=h_(e);return function(g){return c=g,a.enter("attentionSequence"),function g(h){if(h===c)return a.consume(h),g;let i=a.exit("attentionSequence"),j=h_(h),k=!j||2===j&&f||d.includes(h),l=!f||2===f&&j||d.includes(e);return i._open=!!(42===c?k:k&&(f||!l)),i._close=!!(42===c?l:l&&(j||!k)),b(h)}(g)}}};function h1(a,b){a.column+=b,a.offset+=b,a._bufferIndex+=b}let h2={name:"labelStartLink",resolveAll:hW.resolveAll,tokenize:function(a,b,c){let d=this;return function(b){return a.enter("labelLink"),a.enter("labelMarker"),a.consume(b),a.exit("labelMarker"),a.exit("labelLink"),e};function e(a){return 94===a&&"_hiddenFootnoteSupport"in d.parser.constructs?c(a):b(a)}}},h3={42:hw,43:hw,45:hw,48:hw,49:hw,50:hw,51:hw,52:hw,53:hw,54:hw,55:hw,56:hw,57:hw,62:hz},h4={91:{name:"definition",tokenize:function(a,b,c){let d,e=this;return function(b){var d;return a.enter("definition"),d=b,hB.call(e,a,f,c,"definitionLabel","definitionLabelMarker","definitionLabelString")(d)};function f(b){return(d=hE(e.sliceSerialize(e.events[e.events.length-1][1]).slice(1,-1)),58===b)?(a.enter("definitionMarker"),a.consume(b),a.exit("definitionMarker"),g):c(b)}function g(b){return hc(b)?hD(a,h)(b):h(b)}function h(b){return hA(a,i,c,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(b)}function i(b){return a.attempt(hF,j,j)(b)}function j(b){return hd(b)?hh(a,k,"whitespace")(b):k(b)}function k(f){return null===f||hb(f)?(a.exit("definition"),e.parser.defined.push(d),b(f)):c(f)}}}},h5={[-2]:hG,[-1]:hG,32:hG},h6={35:{name:"headingAtx",resolve:function(a,b){let c,d,e=a.length-2,f=3;return"whitespace"===a[3][1].type&&(f+=2),e-2>f&&"whitespace"===a[e][1].type&&(e-=2),"atxHeadingSequence"===a[e][1].type&&(f===e-1||e-4>f&&"whitespace"===a[e-2][1].type)&&(e-=f+1===e?2:4),e>f&&(c={type:"atxHeadingText",start:a[f][1].start,end:a[e][1].end},d={type:"chunkText",start:a[f][1].start,end:a[e][1].end,contentType:"text"},g$(a,f,e-f+1,[["enter",c,b],["enter",d,b],["exit",d,b],["exit",c,b]])),a},tokenize:function(a,b,c){let d=0;return function(e){var f;return a.enter("atxHeading"),f=e,a.enter("atxHeadingSequence"),function e(f){return 35===f&&d++<6?(a.consume(f),e):null===f||hc(f)?(a.exit("atxHeadingSequence"),function c(d){return 35===d?(a.enter("atxHeadingSequence"),function b(d){return 35===d?(a.consume(d),b):(a.exit("atxHeadingSequence"),c(d))}(d)):null===d||hb(d)?(a.exit("atxHeading"),b(d)):hd(d)?hh(a,c,"whitespace")(d):(a.enter("atxHeadingText"),function b(d){return null===d||35===d||hc(d)?(a.exit("atxHeadingText"),c(d)):(a.consume(d),b)}(d))}(f)):c(f)}(f)}}},42:hv,45:[hI,hv],60:{concrete:!0,name:"htmlFlow",resolveTo:function(a){let b=a.length;for(;b--&&("enter"!==a[b][0]||"htmlFlow"!==a[b][1].type););return b>1&&"linePrefix"===a[b-2][1].type&&(a[b][1].start=a[b-2][1].start,a[b+1][1].start=a[b-2][1].start,a.splice(b-2,2)),a},tokenize:function(a,b,c){let d,e,f,g,h,i=this;return function(b){var c;return c=b,a.enter("htmlFlow"),a.enter("htmlFlowData"),a.consume(c),j};function j(g){return 33===g?(a.consume(g),k):47===g?(a.consume(g),e=!0,n):63===g?(a.consume(g),d=3,i.interrupt?b:G):g4(g)?(a.consume(g),f=String.fromCharCode(g),o):c(g)}function k(e){return 45===e?(a.consume(e),d=2,l):91===e?(a.consume(e),d=5,g=0,m):g4(e)?(a.consume(e),d=4,i.interrupt?b:G):c(e)}function l(d){return 45===d?(a.consume(d),i.interrupt?b:G):c(d)}function m(d){let e="CDATA[";return d===e.charCodeAt(g++)?(a.consume(d),g===e.length)?i.interrupt?b:y:m:c(d)}function n(b){return g4(b)?(a.consume(b),f=String.fromCharCode(b),o):c(b)}function o(g){if(null===g||47===g||62===g||hc(g)){let h=47===g,j=f.toLowerCase();return!h&&!e&&hK.includes(j)?(d=1,i.interrupt?b(g):y(g)):hJ.includes(f.toLowerCase())?(d=6,h)?(a.consume(g),p):i.interrupt?b(g):y(g):(d=7,i.interrupt&&!i.parser.lazy[i.now().line]?c(g):e?function b(c){return hd(c)?(a.consume(c),b):w(c)}(g):q(g))}return 45===g||g5(g)?(a.consume(g),f+=String.fromCharCode(g),o):c(g)}function p(d){return 62===d?(a.consume(d),i.interrupt?b:y):c(d)}function q(b){return 47===b?(a.consume(b),w):58===b||95===b||g4(b)?(a.consume(b),r):hd(b)?(a.consume(b),q):w(b)}function r(b){return 45===b||46===b||58===b||95===b||g5(b)?(a.consume(b),r):s(b)}function s(b){return 61===b?(a.consume(b),t):hd(b)?(a.consume(b),s):q(b)}function t(b){return null===b||60===b||61===b||62===b||96===b?c(b):34===b||39===b?(a.consume(b),h=b,u):hd(b)?(a.consume(b),t):function b(c){return null===c||34===c||39===c||47===c||60===c||61===c||62===c||96===c||hc(c)?s(c):(a.consume(c),b)}(b)}function u(b){return b===h?(a.consume(b),h=null,v):null===b||hb(b)?c(b):(a.consume(b),u)}function v(a){return 47===a||62===a||hd(a)?q(a):c(a)}function w(b){return 62===b?(a.consume(b),x):c(b)}function x(b){return null===b||hb(b)?y(b):hd(b)?(a.consume(b),x):c(b)}function y(b){return 45===b&&2===d?(a.consume(b),C):60===b&&1===d?(a.consume(b),D):62===b&&4===d?(a.consume(b),H):63===b&&3===d?(a.consume(b),G):93===b&&5===d?(a.consume(b),F):hb(b)&&(6===d||7===d)?(a.exit("htmlFlowData"),a.check(hL,I,z)(b)):null===b||hb(b)?(a.exit("htmlFlowData"),z(b)):(a.consume(b),y)}function z(b){return a.check(hM,A,I)(b)}function A(b){return a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),B}function B(b){return null===b||hb(b)?z(b):(a.enter("htmlFlowData"),y(b))}function C(b){return 45===b?(a.consume(b),G):y(b)}function D(b){return 47===b?(a.consume(b),f="",E):y(b)}function E(b){if(62===b){let c=f.toLowerCase();return hK.includes(c)?(a.consume(b),H):y(b)}return g4(b)&&f.length<8?(a.consume(b),f+=String.fromCharCode(b),E):y(b)}function F(b){return 93===b?(a.consume(b),G):y(b)}function G(b){return 62===b?(a.consume(b),H):45===b&&2===d?(a.consume(b),G):y(b)}function H(b){return null===b||hb(b)?(a.exit("htmlFlowData"),I(b)):(a.consume(b),H)}function I(c){return a.exit("htmlFlow"),b(c)}}},61:hI,95:hv,96:hO,126:hO},h7={38:hS,92:hT},h8={[-5]:hU,[-4]:hU,[-3]:hU,33:h$,38:hS,42:h0,60:[{name:"autolink",tokenize:function(a,b,c){let d=0;return function(b){return a.enter("autolink"),a.enter("autolinkMarker"),a.consume(b),a.exit("autolinkMarker"),a.enter("autolinkProtocol"),e};function e(b){return g4(b)?(a.consume(b),f):64===b?c(b):h(b)}function f(b){return 43===b||45===b||46===b||g5(b)?(d=1,function b(c){return 58===c?(a.consume(c),d=0,g):(43===c||45===c||46===c||g5(c))&&d++<32?(a.consume(c),b):(d=0,h(c))}(b)):h(b)}function g(d){return 62===d?(a.exit("autolinkProtocol"),a.enter("autolinkMarker"),a.consume(d),a.exit("autolinkMarker"),a.exit("autolink"),b):null===d||32===d||60===d||g7(d)?c(d):(a.consume(d),g)}function h(b){return 64===b?(a.consume(b),i):g6(b)?(a.consume(b),h):c(b)}function i(e){return g5(e)?function e(f){return 46===f?(a.consume(f),d=0,i):62===f?(a.exit("autolinkProtocol").type="autolinkEmail",a.enter("autolinkMarker"),a.consume(f),a.exit("autolinkMarker"),a.exit("autolink"),b):function b(f){if((45===f||g5(f))&&d++<63){let c=45===f?b:e;return a.consume(f),c}return c(f)}(f)}(e):c(e)}}},{name:"htmlText",tokenize:function(a,b,c){let d,e,f,g=this;return function(b){return a.enter("htmlText"),a.enter("htmlTextData"),a.consume(b),h};function h(b){return 33===b?(a.consume(b),i):47===b?(a.consume(b),u):63===b?(a.consume(b),s):g4(b)?(a.consume(b),w):c(b)}function i(b){return 45===b?(a.consume(b),j):91===b?(a.consume(b),e=0,n):g4(b)?(a.consume(b),r):c(b)}function j(b){return 45===b?(a.consume(b),m):c(b)}function k(b){return null===b?c(b):45===b?(a.consume(b),l):hb(b)?(f=k,E(b)):(a.consume(b),k)}function l(b){return 45===b?(a.consume(b),m):k(b)}function m(a){return 62===a?D(a):45===a?l(a):k(a)}function n(b){let d="CDATA[";return b===d.charCodeAt(e++)?(a.consume(b),e===d.length?o:n):c(b)}function o(b){return null===b?c(b):93===b?(a.consume(b),p):hb(b)?(f=o,E(b)):(a.consume(b),o)}function p(b){return 93===b?(a.consume(b),q):o(b)}function q(b){return 62===b?D(b):93===b?(a.consume(b),q):o(b)}function r(b){return null===b||62===b?D(b):hb(b)?(f=r,E(b)):(a.consume(b),r)}function s(b){return null===b?c(b):63===b?(a.consume(b),t):hb(b)?(f=s,E(b)):(a.consume(b),s)}function t(a){return 62===a?D(a):s(a)}function u(b){return g4(b)?(a.consume(b),v):c(b)}function v(b){return 45===b||g5(b)?(a.consume(b),v):function b(c){return hb(c)?(f=b,E(c)):hd(c)?(a.consume(c),b):D(c)}(b)}function w(b){return 45===b||g5(b)?(a.consume(b),w):47===b||62===b||hc(b)?x(b):c(b)}function x(b){return 47===b?(a.consume(b),D):58===b||95===b||g4(b)?(a.consume(b),y):hb(b)?(f=x,E(b)):hd(b)?(a.consume(b),x):D(b)}function y(b){return 45===b||46===b||58===b||95===b||g5(b)?(a.consume(b),y):function b(c){return 61===c?(a.consume(c),z):hb(c)?(f=b,E(c)):hd(c)?(a.consume(c),b):x(c)}(b)}function z(b){return null===b||60===b||61===b||62===b||96===b?c(b):34===b||39===b?(a.consume(b),d=b,A):hb(b)?(f=z,E(b)):hd(b)?(a.consume(b),z):(a.consume(b),B)}function A(b){return b===d?(a.consume(b),d=void 0,C):null===b?c(b):hb(b)?(f=A,E(b)):(a.consume(b),A)}function B(b){return null===b||34===b||39===b||60===b||61===b||96===b?c(b):47===b||62===b||hc(b)?x(b):(a.consume(b),B)}function C(a){return 47===a||62===a||hc(a)?x(a):c(a)}function D(d){return 62===d?(a.consume(d),a.exit("htmlTextData"),a.exit("htmlText"),b):c(d)}function E(b){return a.exit("htmlTextData"),a.enter("lineEnding"),a.consume(b),a.exit("lineEnding"),F}function F(b){return hd(b)?hh(a,G,"linePrefix",g.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(b):G(b)}function G(b){return a.enter("htmlTextData"),f(b)}}}],91:h2,92:[{name:"hardBreakEscape",tokenize:function(a,b,c){return function(b){return a.enter("hardBreakEscape"),a.consume(b),d};function d(d){return hb(d)?(a.exit("hardBreakEscape"),b(d)):c(d)}}},hT],93:hW,95:h0,96:{name:"codeText",previous:function(a){return 96!==a||"characterEscape"===this.events[this.events.length-1][1].type},resolve:function(a){let b,c,d=a.length-4,e=3;if(("lineEnding"===a[3][1].type||"space"===a[e][1].type)&&("lineEnding"===a[d][1].type||"space"===a[d][1].type)){for(b=e;++b<d;)if("codeTextData"===a[b][1].type){a[e][1].type="codeTextPadding",a[d][1].type="codeTextPadding",e+=2,d-=2;break}}for(b=e-1,d++;++b<=d;)void 0===c?b!==d&&"lineEnding"!==a[b][1].type&&(c=b):(b===d||"lineEnding"===a[b][1].type)&&(a[c][1].type="codeTextData",b!==c+2&&(a[c][1].end=a[b-1][1].end,a.splice(c+2,b-c-2),d-=b-c-2,b=c+2),c=void 0);return a},tokenize:function(a,b,c){let d,e,f=0;return function(b){return a.enter("codeText"),a.enter("codeTextSequence"),function b(c){return 96===c?(a.consume(c),f++,b):(a.exit("codeTextSequence"),g(c))}(b)};function g(i){return null===i?c(i):32===i?(a.enter("space"),a.consume(i),a.exit("space"),g):96===i?(e=a.enter("codeTextSequence"),d=0,function c(g){return 96===g?(a.consume(g),d++,c):d===f?(a.exit("codeTextSequence"),a.exit("codeText"),b(g)):(e.type="codeTextData",h(g))}(i)):hb(i)?(a.enter("lineEnding"),a.consume(i),a.exit("lineEnding"),g):(a.enter("codeTextData"),h(i))}function h(b){return null===b||32===b||96===b||hb(b)?(a.exit("codeTextData"),g(b)):(a.consume(b),h)}}}},h9={null:[h0,hp]},ia={null:[42,95]},ib={null:[]},ic=/[\0\t\n\r]/g;function id(a,b){let c=Number.parseInt(a,b);return c<9||11===c||c>13&&c<32||c>126&&c<160||c>55295&&c<57344||c>64975&&c<65008||(65535&c)==65535||(65535&c)==65534||c>1114111?"":String.fromCodePoint(c)}let ie=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function ig(a,b,c){if(b)return b;if(35===c.charCodeAt(0)){let a=c.charCodeAt(1),b=120===a||88===a;return id(c.slice(b?2:1),b?16:10)}return hR(c)||a}let ih={}.hasOwnProperty;function ii(a){return{line:a.line,column:a.column,offset:a.offset}}function ij(a,b){if(a)throw Error("Cannot close `"+a.type+"` ("+gE({start:a.start,end:a.end})+"): a different token (`"+b.type+"`, "+gE({start:b.start,end:b.end})+") is open");throw Error("Cannot close document, a token (`"+b.type+"`, "+gE({start:b.start,end:b.end})+") is still open")}function ik(a){let b=this;b.parser=function(c){var d,e;let f,g,h,i;return"string"!=typeof(d={...b.data("settings"),...a,extensions:b.data("micromarkExtensions")||[],mdastExtensions:b.data("fromMarkdownExtensions")||[]})&&(e=d,d=void 0),(function(a){let b={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:d(r),autolinkProtocol:j,autolinkEmail:j,atxHeading:d(o),blockQuote:d(function(){return{type:"blockquote",children:[]}}),characterEscape:j,characterReference:j,codeFenced:d(n),codeFencedFenceInfo:e,codeFencedFenceMeta:e,codeIndented:d(n,e),codeText:d(function(){return{type:"inlineCode",value:""}},e),codeTextData:j,data:j,codeFlowValue:j,definition:d(function(){return{type:"definition",identifier:"",label:null,title:null,url:""}}),definitionDestinationString:e,definitionLabelString:e,definitionTitleString:e,emphasis:d(function(){return{type:"emphasis",children:[]}}),hardBreakEscape:d(p),hardBreakTrailing:d(p),htmlFlow:d(q,e),htmlFlowData:j,htmlText:d(q,e),htmlTextData:j,image:d(function(){return{type:"image",title:null,url:"",alt:null}}),label:e,link:d(r),listItem:d(function(a){return{type:"listItem",spread:a._spread,checked:null,children:[]}}),listItemValue:function(a){this.data.expectingFirstListItemValue&&(this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(a),10),this.data.expectingFirstListItemValue=void 0)},listOrdered:d(s,function(){this.data.expectingFirstListItemValue=!0}),listUnordered:d(s),paragraph:d(function(){return{type:"paragraph",children:[]}}),reference:function(){this.data.referenceType="collapsed"},referenceString:e,resourceDestinationString:e,resourceTitleString:e,setextHeading:d(o),strong:d(function(){return{type:"strong",children:[]}}),thematicBreak:d(function(){return{type:"thematicBreak"}})},exit:{atxHeading:g(),atxHeadingSequence:function(a){let b=this.stack[this.stack.length-1];b.depth||(b.depth=this.sliceSerialize(a).length)},autolink:g(),autolinkEmail:function(a){k.call(this,a),this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(a)},autolinkProtocol:function(a){k.call(this,a),this.stack[this.stack.length-1].url=this.sliceSerialize(a)},blockQuote:g(),characterEscapeValue:k,characterReferenceMarkerHexadecimal:m,characterReferenceMarkerNumeric:m,characterReferenceValue:function(a){let b,c=this.sliceSerialize(a),d=this.data.characterReferenceType;d?(b=id(c,"characterReferenceMarkerNumeric"===d?10:16),this.data.characterReferenceType=void 0):b=hR(c);let e=this.stack[this.stack.length-1];e.value+=b},characterReference:function(a){this.stack.pop().position.end=ii(a.end)},codeFenced:g(function(){let a=this.resume();this.stack[this.stack.length-1].value=a.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}),codeFencedFence:function(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)},codeFencedFenceInfo:function(){let a=this.resume();this.stack[this.stack.length-1].lang=a},codeFencedFenceMeta:function(){let a=this.resume();this.stack[this.stack.length-1].meta=a},codeFlowValue:k,codeIndented:g(function(){let a=this.resume();this.stack[this.stack.length-1].value=a.replace(/(\r?\n|\r)$/g,"")}),codeText:g(function(){let a=this.resume();this.stack[this.stack.length-1].value=a}),codeTextData:k,data:k,definition:g(),definitionDestinationString:function(){let a=this.resume();this.stack[this.stack.length-1].url=a},definitionLabelString:function(a){let b=this.resume(),c=this.stack[this.stack.length-1];c.label=b,c.identifier=hE(this.sliceSerialize(a)).toLowerCase()},definitionTitleString:function(){let a=this.resume();this.stack[this.stack.length-1].title=a},emphasis:g(),hardBreakEscape:g(l),hardBreakTrailing:g(l),htmlFlow:g(function(){let a=this.resume();this.stack[this.stack.length-1].value=a}),htmlFlowData:k,htmlText:g(function(){let a=this.resume();this.stack[this.stack.length-1].value=a}),htmlTextData:k,image:g(function(){let a=this.stack[this.stack.length-1];if(this.data.inReference){let b=this.data.referenceType||"shortcut";a.type+="Reference",a.referenceType=b,delete a.url,delete a.title}else delete a.identifier,delete a.label;this.data.referenceType=void 0}),label:function(){let a=this.stack[this.stack.length-1],b=this.resume(),c=this.stack[this.stack.length-1];this.data.inReference=!0,"link"===c.type?c.children=a.children:c.alt=b},labelText:function(a){let b=this.sliceSerialize(a),c=this.stack[this.stack.length-2];c.label=b.replace(ie,ig),c.identifier=hE(b).toLowerCase()},lineEnding:function(a){let c=this.stack[this.stack.length-1];if(this.data.atHardBreak){c.children[c.children.length-1].position.end=ii(a.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&b.canContainEols.includes(c.type)&&(j.call(this,a),k.call(this,a))},link:g(function(){let a=this.stack[this.stack.length-1];if(this.data.inReference){let b=this.data.referenceType||"shortcut";a.type+="Reference",a.referenceType=b,delete a.url,delete a.title}else delete a.identifier,delete a.label;this.data.referenceType=void 0}),listItem:g(),listOrdered:g(),listUnordered:g(),paragraph:g(),referenceString:function(a){let b=this.resume(),c=this.stack[this.stack.length-1];c.label=b,c.identifier=hE(this.sliceSerialize(a)).toLowerCase(),this.data.referenceType="full"},resourceDestinationString:function(){let a=this.resume();this.stack[this.stack.length-1].url=a},resourceTitleString:function(){let a=this.resume();this.stack[this.stack.length-1].title=a},resource:function(){this.data.inReference=void 0},setextHeading:g(function(){this.data.setextHeadingSlurpLineEnding=void 0}),setextHeadingLineSequence:function(a){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(a).codePointAt(0)?1:2},setextHeadingText:function(){this.data.setextHeadingSlurpLineEnding=!0},strong:g(),thematicBreak:g()}};!function a(b,c){let d=-1;for(;++d<c.length;){let e=c[d];Array.isArray(e)?a(b,e):function(a,b){let c;for(c in b)if(ih.call(b,c))switch(c){case"canContainEols":{let d=b[c];d&&a[c].push(...d);break}case"transforms":{let d=b[c];d&&a[c].push(...d);break}case"enter":case"exit":{let d=b[c];d&&Object.assign(a[c],d)}}}(b,e)}}(b,(a||{}).mdastExtensions||[]);let c={};return function(a){let d={type:"root",children:[]},g={stack:[d],tokenStack:[],config:b,enter:f,exit:h,buffer:e,resume:i,data:c},j=[],k=-1;for(;++k<a.length;)("listOrdered"===a[k][1].type||"listUnordered"===a[k][1].type)&&("enter"===a[k][0]?j.push(k):k=function(a,b,c){let d,e,f,g,h=b-1,i=-1,j=!1;for(;++h<=c;){let b=a[h];switch(b[1].type){case"listUnordered":case"listOrdered":case"blockQuote":"enter"===b[0]?i++:i--,g=void 0;break;case"lineEndingBlank":"enter"===b[0]&&(!d||g||i||f||(f=h),g=void 0);break;case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:g=void 0}if(!i&&"enter"===b[0]&&"listItemPrefix"===b[1].type||-1===i&&"exit"===b[0]&&("listUnordered"===b[1].type||"listOrdered"===b[1].type)){if(d){let g=h;for(e=void 0;g--;){let b=a[g];if("lineEnding"===b[1].type||"lineEndingBlank"===b[1].type){if("exit"===b[0])continue;e&&(a[e][1].type="lineEndingBlank",j=!0),b[1].type="lineEnding",e=g}else if("linePrefix"===b[1].type||"blockQuotePrefix"===b[1].type||"blockQuotePrefixWhitespace"===b[1].type||"blockQuoteMarker"===b[1].type||"listItemIndent"===b[1].type);else break}f&&(!e||f<e)&&(d._spread=!0),d.end=Object.assign({},e?a[e][1].start:b[1].end),a.splice(e||h,0,["exit",d,b[2]]),h++,c++}if("listItemPrefix"===b[1].type){let e={type:"listItem",_spread:!1,start:Object.assign({},b[1].start),end:void 0};d=e,a.splice(h,0,["enter",e,b[2]]),h++,c++,f=void 0,g=!0}}}return a[b][1]._spread=j,c}(a,j.pop(),k));for(k=-1;++k<a.length;){let c=b[a[k][0]];ih.call(c,a[k][1].type)&&c[a[k][1].type].call(Object.assign({sliceSerialize:a[k][2].sliceSerialize},g),a[k][1])}if(g.tokenStack.length>0){let a=g.tokenStack[g.tokenStack.length-1];(a[1]||ij).call(g,void 0,a[0])}for(d.position={start:ii(a.length>0?a[0][1].start:{line:1,column:1,offset:0}),end:ii(a.length>0?a[a.length-2][1].end:{line:1,column:1,offset:0})},k=-1;++k<b.transforms.length;)d=b.transforms[k](d)||d;return d};function d(a,b){return function(c){f.call(this,a(c),c),b&&b.call(this,c)}}function e(){this.stack.push({type:"fragment",children:[]})}function f(a,b,c){this.stack[this.stack.length-1].children.push(a),this.stack.push(a),this.tokenStack.push([b,c||void 0]),a.position={start:ii(b.start),end:void 0}}function g(a){return function(b){a&&a.call(this,b),h.call(this,b)}}function h(a,b){let c=this.stack.pop(),d=this.tokenStack.pop();if(d)d[0].type!==a.type&&(b?b.call(this,a,d[0]):(d[1]||ij).call(this,a,d[0]));else throw Error("Cannot close `"+a.type+"` ("+gE({start:a.start,end:a.end})+"): its not open");c.position.end=ii(a.end)}function i(){return gY(this.stack.pop(),"boolean"!=typeof gX.includeImageAlt||gX.includeImageAlt,"boolean"!=typeof gX.includeHtml||gX.includeHtml)}function j(a){let b=this.stack[this.stack.length-1].children,c=b[b.length-1];c&&"text"===c.type||((c={type:"text",value:""}).position={start:ii(a.start),end:void 0},b.push(c)),this.stack.push(c)}function k(a){let b=this.stack.pop();b.value+=this.sliceSerialize(a),b.position.end=ii(a.end)}function l(){this.data.atHardBreak=!0}function m(a){this.data.characterReferenceType=a.type}function n(){return{type:"code",lang:null,meta:null,value:""}}function o(){return{type:"heading",depth:0,children:[]}}function p(){return{type:"break"}}function q(){return{type:"html",value:""}}function r(){return{type:"link",title:null,url:"",children:[]}}function s(a){return{type:"list",ordered:"listOrdered"===a.type,start:null,spread:a._spread,children:[]}}})(e)(function(a){for(;!g2(a););return a}((function(a){let b={constructs:function(a){let b={},c=-1;for(;++c<a.length;)!function(a,b){let c;for(c in b){let d,e=(g3.call(a,c)?a[c]:void 0)||(a[c]={}),f=b[c];if(f)for(d in f){g3.call(e,d)||(e[d]=[]);let a=f[d];!function(a,b){let c=-1,d=[];for(;++c<b.length;)("after"===b[c].add?a:d).push(b[c]);g$(a,0,0,d)}(e[d],Array.isArray(a)?a:a?[a]:[])}}}(b,a[c]);return b}([k,...(a||{}).extensions||[]]),content:c(hi),defined:[],document:c(hj),flow:c(ho),lazy:{},string:c(hq),text:c(hr)};return b;function c(a){return function(c){return function(a,b,c){let d={_bufferIndex:-1,_index:0,line:c&&c.line||1,column:c&&c.column||1,offset:c&&c.offset||0},e={},f=[],g=[],h=[],i={attempt:o(function(a,b){p(a,b.from)}),check:o(n),consume:function(a){hb(a)?(d.line++,d.column=1,d.offset+=-3===a?2:1,q()):-1!==a&&(d.column++,d.offset++),d._bufferIndex<0?d._index++:(d._bufferIndex++,d._bufferIndex===g[d._index].length&&(d._bufferIndex=-1,d._index++)),j.previous=a},enter:function(a,b){let c=b||{};return c.type=a,c.start=m(),j.events.push(["enter",c,j]),h.push(c),c},exit:function(a){let b=h.pop();return b.end=m(),j.events.push(["exit",b,j]),b},interrupt:o(n,{interrupt:!0})},j={code:null,containerState:{},defineSkip:function(a){e[a.line]=a.column,q()},events:[],now:m,parser:a,previous:null,sliceSerialize:function(a,b){return function(a,b){let c,d=-1,e=[];for(;++d<a.length;){let f,g=a[d];if("string"==typeof g)f=g;else switch(g){case -5:f="\r";break;case -4:f="\n";break;case -3:f="\r\n";break;case -2:f=b?" ":"	";break;case -1:if(!b&&c)continue;f=" ";break;default:f=String.fromCharCode(g)}c=-2===g,e.push(f)}return e.join("")}(l(a),b)},sliceStream:l,write:function(a){return(g=g_(g,a),function(){let a;for(;d._index<g.length;){let c=g[d._index];if("string"==typeof c)for(a=d._index,d._bufferIndex<0&&(d._bufferIndex=0);d._index===a&&d._bufferIndex<c.length;){var b;b=c.charCodeAt(d._bufferIndex),k=k(b)}else k=k(c)}}(),null!==g[g.length-1])?[]:(p(b,0),j.events=hV(f,j.events,j),j.events)}},k=b.tokenize.call(j,i);return b.resolveAll&&f.push(b),j;function l(a){return function(a,b){let c,d=b.start._index,e=b.start._bufferIndex,f=b.end._index,g=b.end._bufferIndex;if(d===f)c=[a[d].slice(e,g)];else{if(c=a.slice(d,f),e>-1){let a=c[0];"string"==typeof a?c[0]=a.slice(e):c.shift()}g>0&&c.push(a[f].slice(0,g))}return c}(g,a)}function m(){let{_bufferIndex:a,_index:b,line:c,column:e,offset:f}=d;return{_bufferIndex:a,_index:b,line:c,column:e,offset:f}}function n(a,b){b.restore()}function o(a,b){return function(c,e,f){var g;let k,l,n,o;return Array.isArray(c)?p(c):"tokenize"in c?p([c]):(g=c,function(a){let b=null!==a&&g[a],c=null!==a&&g.null;return p([...Array.isArray(b)?b:b?[b]:[],...Array.isArray(c)?c:c?[c]:[]])(a)});function p(a){return(k=a,l=0,0===a.length)?f:r(a[l])}function r(a){return function(c){return(o=function(){let a=m(),b=j.previous,c=j.currentConstruct,e=j.events.length,f=Array.from(h);return{from:e,restore:function(){d=a,j.previous=b,j.currentConstruct=c,j.events.length=e,h=f,q()}}}(),n=a,a.partial||(j.currentConstruct=a),a.name&&j.parser.constructs.disable.null.includes(a.name))?t(c):a.tokenize.call(b?Object.assign(Object.create(j),b):j,i,s,t)(c)}}function s(b){return a(n,o),e}function t(a){return(o.restore(),++l<k.length)?r(k[l]):f}}}function p(a,b){a.resolveAll&&!f.includes(a)&&f.push(a),a.resolve&&g$(j.events,b,j.events.length-b,a.resolve(j.events.slice(b),j)),a.resolveTo&&(j.events=a.resolveTo(j.events,j))}function q(){d.line in e&&d.column<2&&(d.column=e[d.line],d.offset+=e[d.line]-1)}}(b,a,c)}}})(e).document().write((g=1,h="",i=!0,function(a,b,c){let d,e,j,k,l,m=[];for(a=h+("string"==typeof a?a.toString():new TextDecoder(b||void 0).decode(a)),j=0,h="",i&&(65279===a.charCodeAt(0)&&j++,i=void 0);j<a.length;){if(ic.lastIndex=j,k=(d=ic.exec(a))&&void 0!==d.index?d.index:a.length,l=a.charCodeAt(k),!d){h=a.slice(j);break}if(10===l&&j===k&&f)m.push(-3),f=void 0;else switch(f&&(m.push(-5),f=void 0),j<k&&(m.push(a.slice(j,k)),g+=k-j),l){case 0:m.push(65533),g++;break;case 9:for(e=4*Math.ceil(g/4),m.push(-2);g++<e;)m.push(-1);break;case 10:m.push(-4),g=1;break;default:f=!0,g=1}j=k+1}return c&&(f&&m.push(-5),h&&m.push(h),m.push(null)),m})(c,d,!0))))}}let il="object"==typeof self?self:globalThis,im=a=>((a,b)=>{let c=(b,c)=>(a.set(c,b),b),d=e=>{if(a.has(e))return a.get(e);let[f,g]=b[e];switch(f){case 0:case -1:return c(g,e);case 1:{let a=c([],e);for(let b of g)a.push(d(b));return a}case 2:{let a=c({},e);for(let[b,c]of g)a[d(b)]=d(c);return a}case 3:return c(new Date(g),e);case 4:{let{source:a,flags:b}=g;return c(new RegExp(a,b),e)}case 5:{let a=c(new Map,e);for(let[b,c]of g)a.set(d(b),d(c));return a}case 6:{let a=c(new Set,e);for(let b of g)a.add(d(b));return a}case 7:{let{name:a,message:b}=g;return c(new il[a](b),e)}case 8:return c(BigInt(g),e);case"BigInt":return c(Object(BigInt(g)),e);case"ArrayBuffer":return c(new Uint8Array(g).buffer,g);case"DataView":{let{buffer:a}=new Uint8Array(g);return c(new DataView(a),g)}}return c(new il[f](g),e)};return d})(new Map,a)(0),{toString:io}={},{keys:ip}=Object,iq=a=>{let b=typeof a;if("object"!==b||!a)return[0,b];let c=io.call(a).slice(8,-1);switch(c){case"Array":return[1,""];case"Object":return[2,""];case"Date":return[3,""];case"RegExp":return[4,""];case"Map":return[5,""];case"Set":return[6,""];case"DataView":return[1,c]}return c.includes("Array")?[1,c]:c.includes("Error")?[7,c]:[2,c]},ir=([a,b])=>0===a&&("function"===b||"symbol"===b),is=(a,{json:b,lossy:c}={})=>{let d=[];return((a,b,c,d)=>{let e=(a,b)=>{let e=d.push(a)-1;return c.set(b,e),e},f=d=>{if(c.has(d))return c.get(d);let[g,h]=iq(d);switch(g){case 0:{let b=d;switch(h){case"bigint":g=8,b=d.toString();break;case"function":case"symbol":if(a)throw TypeError("unable to serialize "+h);b=null;break;case"undefined":return e([-1],d)}return e([g,b],d)}case 1:{if(h){let a=d;return"DataView"===h?a=new Uint8Array(d.buffer):"ArrayBuffer"===h&&(a=new Uint8Array(d)),e([h,[...a]],d)}let a=[],b=e([g,a],d);for(let b of d)a.push(f(b));return b}case 2:{if(h)switch(h){case"BigInt":return e([h,d.toString()],d);case"Boolean":case"Number":case"String":return e([h,d.valueOf()],d)}if(b&&"toJSON"in d)return f(d.toJSON());let c=[],i=e([g,c],d);for(let b of ip(d))(a||!ir(iq(d[b])))&&c.push([f(b),f(d[b])]);return i}case 3:return e([g,d.toISOString()],d);case 4:{let{source:a,flags:b}=d;return e([g,{source:a,flags:b}],d)}case 5:{let b=[],c=e([g,b],d);for(let[c,e]of d)(a||!(ir(iq(c))||ir(iq(e))))&&b.push([f(c),f(e)]);return c}case 6:{let b=[],c=e([g,b],d);for(let c of d)(a||!ir(iq(c)))&&b.push(f(c));return c}}let{message:i}=d;return e([g,{name:h,message:i}],d)};return f})(!(b||c),!!b,new Map,d)(a),d},it="function"==typeof structuredClone?(a,b)=>b&&("json"in b||"lossy"in b)?im(is(a,b)):structuredClone(a):(a,b)=>im(is(a,b));function iu(a){let b=[],c=-1,d=0,e=0;for(;++c<a.length;){let f=a.charCodeAt(c),g="";if(37===f&&g5(a.charCodeAt(c+1))&&g5(a.charCodeAt(c+2)))e=2;else if(f<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(f))||(g=String.fromCharCode(f));else if(f>55295&&f<57344){let b=a.charCodeAt(c+1);f<56320&&b>56319&&b<57344?(g=String.fromCharCode(f,b),e=1):g=""}else g=String.fromCharCode(f);g&&(b.push(a.slice(d,c),encodeURIComponent(g)),d=c+e+1,g=""),e&&(c+=e,e=0)}return b.join("")+a.slice(d)}function iv(a,b){let c=[{type:"text",value:""}];return b>1&&c.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(b)}]}),c}function iw(a,b){return"Back to reference "+(a+1)+(b>1?"-"+b:"")}let ix=function(a){var b,c;if(null==a)return iz;if("function"==typeof a)return iy(a);if("object"==typeof a){return Array.isArray(a)?function(a){let b=[],c=-1;for(;++c<a.length;)b[c]=ix(a[c]);return iy(function(...a){let c=-1;for(;++c<b.length;)if(b[c].apply(this,a))return!0;return!1})}(a):(b=a,iy(function(a){let c;for(c in b)if(a[c]!==b[c])return!1;return!0}))}if("string"==typeof a){return c=a,iy(function(a){return a&&a.type===c})}throw Error("Expected function, string, or object as test")};function iy(a){return function(b,c,d){return!!(function(a){return null!==a&&"object"==typeof a&&"type"in a}(b)&&a.call(this,b,"number"==typeof c?c:void 0,d||void 0))}}function iz(){return!0}let iA=[];function iB(a,b,c,d){let e,f,g,h;"function"==typeof b&&"function"!=typeof c?(f=void 0,g=b,e=c):(f=b,g=c,e=d);var i=f,j=function(a,b){let c=b[b.length-1],d=c?c.children.indexOf(a):void 0;return g(a,d,c)},k=e;"function"==typeof i&&"function"!=typeof j?(k=j,j=i):h=i;let l=ix(h),m=k?-1:1;(function a(b,c,d){let e=b&&"object"==typeof b?b:{};if("string"==typeof e.type){let a="string"==typeof e.tagName?e.tagName:"string"==typeof e.name?e.name:void 0;Object.defineProperty(f,"name",{value:"node (\x1b[33m"+b.type+(a?"<"+a+">":"")+"\x1b[39m)"})}return f;function f(){var e;let f,g,h,n=iA;if((!i||l(b,c,d[d.length-1]||void 0))&&!1===(n=Array.isArray(e=j(b,d))?e:"number"==typeof e?[!0,e]:null==e?iA:[e])[0])return n;if("children"in b&&b.children&&b.children&&"skip"!==n[0])for(g=(k?b.children.length:-1)+m,h=d.concat(b);g>-1&&g<b.children.length;){if(!1===(f=a(b.children[g],g,h)())[0])return f;g="number"==typeof f[1]?f[1]:g+m}return n}})(a,void 0,[])()}function iC(a,b){let c=b.referenceType,d="]";if("collapsed"===c?d+="[]":"full"===c&&(d+="["+(b.label||b.identifier)+"]"),"imageReference"===b.type)return[{type:"text",value:"!["+b.alt+d}];let e=a.all(b),f=e[0];f&&"text"===f.type?f.value="["+f.value:e.unshift({type:"text",value:"["});let g=e[e.length-1];return g&&"text"===g.type?g.value+=d:e.push({type:"text",value:d}),e}function iD(a){let b=a.spread;return null==b?a.children.length>1:b}function iE(a,b,c){let d=0,e=a.length;if(b){let b=a.codePointAt(d);for(;9===b||32===b;)d++,b=a.codePointAt(d)}if(c){let b=a.codePointAt(e-1);for(;9===b||32===b;)e--,b=a.codePointAt(e-1)}return e>d?a.slice(d,e):""}let iF={blockquote:function(a,b){let c={type:"element",tagName:"blockquote",properties:{},children:a.wrap(a.all(b),!0)};return a.patch(b,c),a.applyData(b,c)},break:function(a,b){let c={type:"element",tagName:"br",properties:{},children:[]};return a.patch(b,c),[a.applyData(b,c),{type:"text",value:"\n"}]},code:function(a,b){let c=b.value?b.value+"\n":"",d={},e=b.lang?b.lang.split(/\s+/):[];e.length>0&&(d.className=["language-"+e[0]]);let f={type:"element",tagName:"code",properties:d,children:[{type:"text",value:c}]};return b.meta&&(f.data={meta:b.meta}),a.patch(b,f),f={type:"element",tagName:"pre",properties:{},children:[f=a.applyData(b,f)]},a.patch(b,f),f},delete:function(a,b){let c={type:"element",tagName:"del",properties:{},children:a.all(b)};return a.patch(b,c),a.applyData(b,c)},emphasis:function(a,b){let c={type:"element",tagName:"em",properties:{},children:a.all(b)};return a.patch(b,c),a.applyData(b,c)},footnoteReference:function(a,b){let c,d="string"==typeof a.options.clobberPrefix?a.options.clobberPrefix:"user-content-",e=String(b.identifier).toUpperCase(),f=iu(e.toLowerCase()),g=a.footnoteOrder.indexOf(e),h=a.footnoteCounts.get(e);void 0===h?(h=0,a.footnoteOrder.push(e),c=a.footnoteOrder.length):c=g+1,h+=1,a.footnoteCounts.set(e,h);let i={type:"element",tagName:"a",properties:{href:"#"+d+"fn-"+f,id:d+"fnref-"+f+(h>1?"-"+h:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(c)}]};a.patch(b,i);let j={type:"element",tagName:"sup",properties:{},children:[i]};return a.patch(b,j),a.applyData(b,j)},heading:function(a,b){let c={type:"element",tagName:"h"+b.depth,properties:{},children:a.all(b)};return a.patch(b,c),a.applyData(b,c)},html:function(a,b){if(a.options.allowDangerousHtml){let c={type:"raw",value:b.value};return a.patch(b,c),a.applyData(b,c)}},imageReference:function(a,b){let c=String(b.identifier).toUpperCase(),d=a.definitionById.get(c);if(!d)return iC(a,b);let e={src:iu(d.url||""),alt:b.alt};null!==d.title&&void 0!==d.title&&(e.title=d.title);let f={type:"element",tagName:"img",properties:e,children:[]};return a.patch(b,f),a.applyData(b,f)},image:function(a,b){let c={src:iu(b.url)};null!==b.alt&&void 0!==b.alt&&(c.alt=b.alt),null!==b.title&&void 0!==b.title&&(c.title=b.title);let d={type:"element",tagName:"img",properties:c,children:[]};return a.patch(b,d),a.applyData(b,d)},inlineCode:function(a,b){let c={type:"text",value:b.value.replace(/\r?\n|\r/g," ")};a.patch(b,c);let d={type:"element",tagName:"code",properties:{},children:[c]};return a.patch(b,d),a.applyData(b,d)},linkReference:function(a,b){let c=String(b.identifier).toUpperCase(),d=a.definitionById.get(c);if(!d)return iC(a,b);let e={href:iu(d.url||"")};null!==d.title&&void 0!==d.title&&(e.title=d.title);let f={type:"element",tagName:"a",properties:e,children:a.all(b)};return a.patch(b,f),a.applyData(b,f)},link:function(a,b){let c={href:iu(b.url)};null!==b.title&&void 0!==b.title&&(c.title=b.title);let d={type:"element",tagName:"a",properties:c,children:a.all(b)};return a.patch(b,d),a.applyData(b,d)},listItem:function(a,b,c){let d=a.all(b),e=c?function(a){let b=!1;if("list"===a.type){b=a.spread||!1;let c=a.children,d=-1;for(;!b&&++d<c.length;)b=iD(c[d])}return b}(c):iD(b),f={},g=[];if("boolean"==typeof b.checked){let a,c=d[0];c&&"element"===c.type&&"p"===c.tagName?a=c:(a={type:"element",tagName:"p",properties:{},children:[]},d.unshift(a)),a.children.length>0&&a.children.unshift({type:"text",value:" "}),a.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:b.checked,disabled:!0},children:[]}),f.className=["task-list-item"]}let h=-1;for(;++h<d.length;){let a=d[h];(e||0!==h||"element"!==a.type||"p"!==a.tagName)&&g.push({type:"text",value:"\n"}),"element"!==a.type||"p"!==a.tagName||e?g.push(a):g.push(...a.children)}let i=d[d.length-1];i&&(e||"element"!==i.type||"p"!==i.tagName)&&g.push({type:"text",value:"\n"});let j={type:"element",tagName:"li",properties:f,children:g};return a.patch(b,j),a.applyData(b,j)},list:function(a,b){let c={},d=a.all(b),e=-1;for("number"==typeof b.start&&1!==b.start&&(c.start=b.start);++e<d.length;){let a=d[e];if("element"===a.type&&"li"===a.tagName&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){c.className=["contains-task-list"];break}}let f={type:"element",tagName:b.ordered?"ol":"ul",properties:c,children:a.wrap(d,!0)};return a.patch(b,f),a.applyData(b,f)},paragraph:function(a,b){let c={type:"element",tagName:"p",properties:{},children:a.all(b)};return a.patch(b,c),a.applyData(b,c)},root:function(a,b){let c={type:"root",children:a.wrap(a.all(b))};return a.patch(b,c),a.applyData(b,c)},strong:function(a,b){let c={type:"element",tagName:"strong",properties:{},children:a.all(b)};return a.patch(b,c),a.applyData(b,c)},table:function(a,b){let c=a.all(b),d=c.shift(),e=[];if(d){let c={type:"element",tagName:"thead",properties:{},children:a.wrap([d],!0)};a.patch(b.children[0],c),e.push(c)}if(c.length>0){let d={type:"element",tagName:"tbody",properties:{},children:a.wrap(c,!0)},f=gC(b.children[1]),g=gB(b.children[b.children.length-1]);f&&g&&(d.position={start:f,end:g}),e.push(d)}let f={type:"element",tagName:"table",properties:{},children:a.wrap(e,!0)};return a.patch(b,f),a.applyData(b,f)},tableCell:function(a,b){let c={type:"element",tagName:"td",properties:{},children:a.all(b)};return a.patch(b,c),a.applyData(b,c)},tableRow:function(a,b,c){let d=c?c.children:void 0,e=0===(d?d.indexOf(b):1)?"th":"td",f=c&&"table"===c.type?c.align:void 0,g=f?f.length:b.children.length,h=-1,i=[];for(;++h<g;){let c=b.children[h],d={},g=f?f[h]:void 0;g&&(d.align=g);let j={type:"element",tagName:e,properties:d,children:[]};c&&(j.children=a.all(c),a.patch(c,j),j=a.applyData(c,j)),i.push(j)}let j={type:"element",tagName:"tr",properties:{},children:a.wrap(i,!0)};return a.patch(b,j),a.applyData(b,j)},text:function(a,b){let c={type:"text",value:function(a){let b=String(a),c=/\r?\n|\r/g,d=c.exec(b),e=0,f=[];for(;d;)f.push(iE(b.slice(e,d.index),e>0,!0),d[0]),e=d.index+d[0].length,d=c.exec(b);return f.push(iE(b.slice(e),e>0,!1)),f.join("")}(String(b.value))};return a.patch(b,c),a.applyData(b,c)},thematicBreak:function(a,b){let c={type:"element",tagName:"hr",properties:{},children:[]};return a.patch(b,c),a.applyData(b,c)},toml:iG,yaml:iG,definition:iG,footnoteDefinition:iG};function iG(){}let iH={}.hasOwnProperty,iI={};function iJ(a,b){a.position&&(b.position=function(a){let b=gC(a),c=gB(a);if(b&&c)return{start:b,end:c}}(a))}function iK(a,b){let c=b;if(a&&a.data){let b=a.data.hName,d=a.data.hChildren,e=a.data.hProperties;"string"==typeof b&&("element"===c.type?c.tagName=b:c={type:"element",tagName:b,properties:{},children:"children"in c?c.children:[c]}),"element"===c.type&&e&&Object.assign(c.properties,it(e)),"children"in c&&c.children&&null!=d&&(c.children=d)}return c}function iL(a,b){let c=[],d=-1;for(b&&c.push({type:"text",value:"\n"});++d<a.length;)d&&c.push({type:"text",value:"\n"}),c.push(a[d]);return b&&a.length>0&&c.push({type:"text",value:"\n"}),c}function iM(a){let b=0,c=a.charCodeAt(b);for(;9===c||32===c;)b++,c=a.charCodeAt(b);return a.slice(b)}function iN(a,b){let c=function(a,b){let c=b||iI,d=new Map,e=new Map,f={all:function(a){let b=[];if("children"in a){let c=a.children,d=-1;for(;++d<c.length;){let e=f.one(c[d],a);if(e){if(d&&"break"===c[d-1].type&&(Array.isArray(e)||"text"!==e.type||(e.value=iM(e.value)),!Array.isArray(e)&&"element"===e.type)){let a=e.children[0];a&&"text"===a.type&&(a.value=iM(a.value))}Array.isArray(e)?b.push(...e):b.push(e)}}}return b},applyData:iK,definitionById:d,footnoteById:e,footnoteCounts:new Map,footnoteOrder:[],handlers:{...iF,...c.handlers},one:function(a,b){let c=a.type,d=f.handlers[c];if(iH.call(f.handlers,c)&&d)return d(f,a,b);if(f.options.passThrough&&f.options.passThrough.includes(c)){if("children"in a){let{children:b,...c}=a,d=it(c);return d.children=f.all(a),d}return it(a)}return(f.options.unknownHandler||function(a,b){let c=b.data||{},d="value"in b&&!(iH.call(c,"hProperties")||iH.call(c,"hChildren"))?{type:"text",value:b.value}:{type:"element",tagName:"div",properties:{},children:a.all(b)};return a.patch(b,d),a.applyData(b,d)})(f,a,b)},options:c,patch:iJ,wrap:iL};return iB(a,function(a){if("definition"===a.type||"footnoteDefinition"===a.type){let b="definition"===a.type?d:e,c=String(a.identifier).toUpperCase();b.has(c)||b.set(c,a)}}),f}(a,b),d=c.one(a,void 0),e=function(a){let b="string"==typeof a.options.clobberPrefix?a.options.clobberPrefix:"user-content-",c=a.options.footnoteBackContent||iv,d=a.options.footnoteBackLabel||iw,e=a.options.footnoteLabel||"Footnotes",f=a.options.footnoteLabelTagName||"h2",g=a.options.footnoteLabelProperties||{className:["sr-only"]},h=[],i=-1;for(;++i<a.footnoteOrder.length;){let e=a.footnoteById.get(a.footnoteOrder[i]);if(!e)continue;let f=a.all(e),g=String(e.identifier).toUpperCase(),j=iu(g.toLowerCase()),k=0,l=[],m=a.footnoteCounts.get(g);for(;void 0!==m&&++k<=m;){l.length>0&&l.push({type:"text",value:" "});let a="string"==typeof c?c:c(i,k);"string"==typeof a&&(a={type:"text",value:a}),l.push({type:"element",tagName:"a",properties:{href:"#"+b+"fnref-"+j+(k>1?"-"+k:""),dataFootnoteBackref:"",ariaLabel:"string"==typeof d?d:d(i,k),className:["data-footnote-backref"]},children:Array.isArray(a)?a:[a]})}let n=f[f.length-1];if(n&&"element"===n.type&&"p"===n.tagName){let a=n.children[n.children.length-1];a&&"text"===a.type?a.value+=" ":n.children.push({type:"text",value:" "}),n.children.push(...l)}else f.push(...l);let o={type:"element",tagName:"li",properties:{id:b+"fn-"+j},children:a.wrap(f,!0)};a.patch(e,o),h.push(o)}if(0!==h.length)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:f,properties:{...it(g),id:"footnote-label"},children:[{type:"text",value:e}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:a.wrap(h,!0)},{type:"text",value:"\n"}]}}(c),f=Array.isArray(d)?{type:"root",children:d}:d||{type:"root",children:[]};return e&&f.children.push({type:"text",value:"\n"},e),f}function iO(a,b){return a&&"run"in a?async function(c,d){let e=iN(c,{file:d,...b});await a.run(e,d)}:function(c,d){return iN(c,{file:d,...a||b})}}function iP(a){if(a)throw a}var iQ=c(8633);function iR(a){if("object"!=typeof a||null===a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)}let iS=require("node:path"),iT=require("node:process");function iU(a){return!!(null!==a&&"object"==typeof a&&"href"in a&&a.href&&"protocol"in a&&a.protocol&&void 0===a.auth)}let iV=require("node:url"),iW=["history","path","basename","stem","extname","dirname"];class iX{constructor(a){let b,c;b=a?iU(a)?{path:a}:"string"==typeof a||function(a){return!!(a&&"object"==typeof a&&"byteLength"in a&&"byteOffset"in a)}(a)?{value:a}:a:{},this.cwd="cwd"in b?"":iT.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let d=-1;for(;++d<iW.length;){let a=iW[d];a in b&&void 0!==b[a]&&null!==b[a]&&(this[a]="history"===a?[...b[a]]:b[a])}for(c in b)iW.includes(c)||(this[c]=b[c])}get basename(){return"string"==typeof this.path?iS.basename(this.path):void 0}set basename(a){iZ(a,"basename"),iY(a,"basename"),this.path=iS.join(this.dirname||"",a)}get dirname(){return"string"==typeof this.path?iS.dirname(this.path):void 0}set dirname(a){i$(this.basename,"dirname"),this.path=iS.join(a||"",this.basename)}get extname(){return"string"==typeof this.path?iS.extname(this.path):void 0}set extname(a){if(iY(a,"extname"),i$(this.dirname,"extname"),a){if(46!==a.codePointAt(0))throw Error("`extname` must start with `.`");if(a.includes(".",1))throw Error("`extname` cannot contain multiple dots")}this.path=iS.join(this.dirname,this.stem+(a||""))}get path(){return this.history[this.history.length-1]}set path(a){iU(a)&&(a=(0,iV.fileURLToPath)(a)),iZ(a,"path"),this.path!==a&&this.history.push(a)}get stem(){return"string"==typeof this.path?iS.basename(this.path,this.extname):void 0}set stem(a){iZ(a,"stem"),iY(a,"stem"),this.path=iS.join(this.dirname||"",a+(this.extname||""))}fail(a,b,c){let d=this.message(a,b,c);throw d.fatal=!0,d}info(a,b,c){let d=this.message(a,b,c);return d.fatal=void 0,d}message(a,b,c){let d=new gI(a,b,c);return this.path&&(d.name=this.path+":"+d.name,d.file=this.path),d.fatal=!1,this.messages.push(d),d}toString(a){return void 0===this.value?"":"string"==typeof this.value?this.value:new TextDecoder(a||void 0).decode(this.value)}}function iY(a,b){if(a&&a.includes(iS.sep))throw Error("`"+b+"` cannot be a path: did not expect `"+iS.sep+"`")}function iZ(a,b){if(!a)throw Error("`"+b+"` cannot be empty")}function i$(a,b){if(!a)throw Error("Setting `"+b+"` requires `path` to be set too")}let i_=function(a){let b=this.constructor.prototype,c=b[a],d=function(){return c.apply(d,arguments)};return Object.setPrototypeOf(d,b),d},i0={}.hasOwnProperty;class i1 extends i_{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=function(){let a=[],b={run:function(...b){let c=-1,d=b.pop();if("function"!=typeof d)throw TypeError("Expected function as last argument, not "+d);!function e(f,...g){let h=a[++c],i=-1;if(f)return void d(f);for(;++i<b.length;)(null===g[i]||void 0===g[i])&&(g[i]=b[i]);b=g,h?(function(a,b){let c;return function(...b){let f,g=a.length>b.length;g&&b.push(d);try{f=a.apply(this,b)}catch(a){if(g&&c)throw a;return d(a)}g||(f&&f.then&&"function"==typeof f.then?f.then(e,d):f instanceof Error?d(f):e(f))};function d(a,...e){c||(c=!0,b(a,...e))}function e(a){d(null,a)}})(h,e)(...g):d(null,...g)}(null,...b)},use:function(c){if("function"!=typeof c)throw TypeError("Expected `middelware` to be a function, not "+c);return a.push(c),b}};return b}()}copy(){let a=new i1,b=-1;for(;++b<this.attachers.length;){let c=this.attachers[b];a.use(...c)}return a.data(iQ(!0,{},this.namespace)),a}data(a,b){return"string"==typeof a?2==arguments.length?(i5("data",this.frozen),this.namespace[a]=b,this):i0.call(this.namespace,a)&&this.namespace[a]||void 0:a?(i5("data",this.frozen),this.namespace=a,this):this.namespace}freeze(){if(this.frozen)return this;for(;++this.freezeIndex<this.attachers.length;){let[a,...b]=this.attachers[this.freezeIndex];if(!1===b[0])continue;!0===b[0]&&(b[0]=void 0);let c=a.call(this,...b);"function"==typeof c&&this.transformers.use(c)}return this.frozen=!0,this.freezeIndex=1/0,this}parse(a){this.freeze();let b=i8(a),c=this.parser||this.Parser;return i3("parse",c),c(String(b),b)}process(a,b){let c=this;return this.freeze(),i3("process",this.parser||this.Parser),i4("process",this.compiler||this.Compiler),b?d(void 0,b):new Promise(d);function d(d,e){let f=i8(a),g=c.parse(f);function h(a,c){a||!c?e(a):d?d(c):b(void 0,c)}c.run(g,f,function(a,b,d){var e,f;if(a||!b||!d)return h(a);let g=c.stringify(b,d);"string"==typeof(e=g)||(f=e)&&"object"==typeof f&&"byteLength"in f&&"byteOffset"in f?d.value=g:d.result=g,h(a,d)})}}processSync(a){let b,c=!1;return this.freeze(),i3("processSync",this.parser||this.Parser),i4("processSync",this.compiler||this.Compiler),this.process(a,function(a,d){c=!0,iP(a),b=d}),i7("processSync","process",c),b}run(a,b,c){i6(a),this.freeze();let d=this.transformers;return c||"function"!=typeof b||(c=b,b=void 0),c?e(void 0,c):new Promise(e);function e(e,f){let g=i8(b);d.run(a,g,function(b,d,g){let h=d||a;b?f(b):e?e(h):c(void 0,h,g)})}}runSync(a,b){let c,d=!1;return this.run(a,b,function(a,b){iP(a),c=b,d=!0}),i7("runSync","run",d),c}stringify(a,b){this.freeze();let c=i8(b),d=this.compiler||this.Compiler;return i4("stringify",d),i6(a),d(a,c)}use(a,...b){let c=this.attachers,d=this.namespace;if(i5("use",this.frozen),null==a);else if("function"==typeof a)g(a,b);else if("object"==typeof a)Array.isArray(a)?f(a):e(a);else throw TypeError("Expected usable value, not `"+a+"`");return this;function e(a){if(!("plugins"in a)&&!("settings"in a))throw Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");f(a.plugins),a.settings&&(d.settings=iQ(!0,d.settings,a.settings))}function f(a){let b=-1;if(null==a);else if(Array.isArray(a))for(;++b<a.length;){var c=a[b];if("function"==typeof c)g(c,[]);else if("object"==typeof c)if(Array.isArray(c)){let[a,...b]=c;g(a,b)}else e(c);else throw TypeError("Expected usable value, not `"+c+"`")}else throw TypeError("Expected a list of plugins, not `"+a+"`")}function g(a,b){let d=-1,e=-1;for(;++d<c.length;)if(c[d][0]===a){e=d;break}if(-1===e)c.push([a,...b]);else if(b.length>0){let[d,...f]=b,g=c[e][1];iR(g)&&iR(d)&&(d=iQ(!0,g,d)),c[e]=[a,d,...f]}}}}let i2=new i1().freeze();function i3(a,b){if("function"!=typeof b)throw TypeError("Cannot `"+a+"` without `parser`")}function i4(a,b){if("function"!=typeof b)throw TypeError("Cannot `"+a+"` without `compiler`")}function i5(a,b){if(b)throw Error("Cannot call `"+a+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function i6(a){if(!iR(a)||"string"!=typeof a.type)throw TypeError("Expected node, got `"+a+"`")}function i7(a,b,c){if(!c)throw Error("`"+a+"` finished async. Use `"+b+"` instead")}function i8(a){var b;return(b=a)&&"object"==typeof b&&"message"in b&&"messages"in b?a:new iX(a)}let i9=[],ja={allowDangerousHtml:!0},jb=/^(https?|ircs?|mailto|xmpp)$/i,jc=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function jd(a){let b=function(a){let b=a.rehypePlugins||i9,c=a.remarkPlugins||i9,d=a.remarkRehypeOptions?{...a.remarkRehypeOptions,...ja}:ja;return i2().use(ik).use(c).use(iO,d).use(b)}(a),c=function(a){let b=a.children||"",c=new iX;return"string"==typeof b&&(c.value=b),c}(a);return function(a,b){let c=b.allowedElements,d=b.allowElement,e=b.components,f=b.disallowedElements,g=b.skipHtml,h=b.unwrapDisallowed,i=b.urlTransform||je;for(let a of jc)Object.hasOwn(b,a.from)&&(a.from,a.to&&a.to,a.id);return iB(a,function(a,b,e){if("raw"===a.type&&e&&"number"==typeof b)return g?e.children.splice(b,1):e.children[b]={type:"text",value:a.value},b;if("element"===a.type){let b;for(b in gW)if(Object.hasOwn(gW,b)&&Object.hasOwn(a.properties,b)){let c=a.properties[b],d=gW[b];(null===d||d.includes(a.tagName))&&(a.properties[b]=i(String(c||""),b,a))}}if("element"===a.type){let g=c?!c.includes(a.tagName):!!f&&f.includes(a.tagName);if(!g&&d&&"number"==typeof b&&(g=!d(a,b,e)),g&&e&&"number"==typeof b)return h&&a.children?e.children.splice(b,1,...a.children):e.children.splice(b,1),b}}),function(a,b){var c,d,e,f;let g;if(!b||void 0===b.Fragment)throw TypeError("Expected `Fragment` in options");let h=b.filePath||void 0;if(b.development){if("function"!=typeof b.jsxDEV)throw TypeError("Expected `jsxDEV` in options when `development: true`");c=h,d=b.jsxDEV,g=function(a,b,e,f){let g=Array.isArray(e.children),h=gC(a);return d(b,e,f,g,{columnNumber:h?h.column-1:void 0,fileName:c,lineNumber:h?h.line:void 0},void 0)}}else{if("function"!=typeof b.jsx)throw TypeError("Expected `jsx` in production options");if("function"!=typeof b.jsxs)throw TypeError("Expected `jsxs` in production options");e=b.jsx,f=b.jsxs,g=function(a,b,c,d){let g=Array.isArray(c.children)?f:e;return d?g(b,c,d):g(b,c)}}let i={Fragment:b.Fragment,ancestors:[],components:b.components||{},create:g,elementAttributeNameCase:b.elementAttributeNameCase||"react",evaluater:b.createEvaluater?b.createEvaluater():void 0,filePath:h,ignoreInvalidStyle:b.ignoreInvalidStyle||!1,passKeys:!1!==b.passKeys,passNode:b.passNode||!1,schema:"svg"===b.space?gt:gs,stylePropertyNameCase:b.stylePropertyNameCase||"dom",tableCellAlignToStyle:!1!==b.tableCellAlignToStyle},j=gP(i,a,void 0);return j&&"string"!=typeof j?j:i.create(a,i.Fragment,{children:j||void 0},void 0)}(a,{Fragment:l.Fragment,components:e,ignoreInvalidStyle:!0,jsx:l.jsx,jsxs:l.jsxs,passKeys:!0,passNode:!0})}(b.runSync(b.parse(c),c),a)}function je(a){let b=a.indexOf(":"),c=a.indexOf("?"),d=a.indexOf("#"),e=a.indexOf("/");return -1===b||-1!==e&&b>e||-1!==c&&b>c||-1!==d&&b>d||jb.test(a.slice(0,b))?a:""}let jf="/api",jg=(process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001")+"/api";async function jh(a,b){let c=await fetch(a,{...b,headers:{"Content-Type":"application/json",...b?.headers}});if(!c.ok)throw Error((await c.json().catch(()=>({error:"Request failed"}))).error||`HTTP ${c.status}`);return c.json()}async function ji(a){return jh(`${jf}/session`,{method:"POST",body:JSON.stringify({config:a})})}async function jj(a){return jh(`${jf}/state?sessionId=${a}`)}async function jk(a,b){return jh(`${jf}/config`,{method:"PUT",body:JSON.stringify({sessionId:a,config:b})})}function jl(a,b,c,d){let e=new AbortController;return(async()=>{try{let f=await fetch(`${jg}/chat/stream`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:a,message:b,emotionContext:c||void 0}),signal:e.signal});if(!f.ok)throw Error(`HTTP ${f.status}`);let g=f.body?.getReader();if(!g)throw Error("No response body");let h=new TextDecoder,i="";for(;;){let{done:a,value:b}=await g.read();if(a)break;let c=(i+=h.decode(b,{stream:!0})).split("\n");i=c.pop()||"";let e="";for(let a of c)if(a.startsWith("event: "))e=a.slice(7).trim();else if(a.startsWith("data: ")){let b=a.slice(6);if("[DONE]"===b)continue;try{let a=JSON.parse(b);"text"===e&&d.onText?d.onText(a.text):"tool_event"===e&&d.onToolEvent?d.onToolEvent(a):"question"===e&&d.onQuestion?d.onQuestion(a):"complete"===e&&d.onComplete?d.onComplete(a):"error"===e&&d.onError&&d.onError(Error(a.error))}catch{}e=""}}}catch(a){a instanceof Error&&"AbortError"!==a.name&&d.onError?.(a)}})(),()=>e.abort()}async function jm(a,b){let c=new URLSearchParams({sessionId:a});return b&&c.append("limit",b.toString()),jh(`${jf}/history?${c}`)}async function jn(a){return jh(`${jf}/subagents?sessionId=${a}`)}async function jo(a){return jh(`${jf}/export?sessionId=${a}`)}async function jp(a,b){let c=new URLSearchParams({sessionId:a});return b&&c.append("limit",b.toString()),jh(`${jf}/timeline?${c}`)}async function jq(a,b){let c=new URLSearchParams({sessionId:a});return b&&c.append("limit",b.toString()),jh(`${jf}/evolution?${c}`)}async function jr(){return jh(`${jf}/sessions`)}async function js(a){return jh(`${jf}/session/${a}`,{method:"DELETE"})}async function jt(a,b,c){let d=new URLSearchParams({sessionId:a});return b&&d.append("type",b),c&&d.append("limit",c.toString()),jh(`${jf}/memories?${d}`)}async function ju(a,b,c){return jh(`${jf}/subagents/${b}`,{method:"POST",body:JSON.stringify({sessionId:a,input:c})})}async function jv(a,b){let c=await fetch(`${jf}/chat/vision`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:a,imageDataUrl:b})});if(!c.ok){if(429===c.status){let a=await c.json().catch(()=>({}));throw console.log("[Vision] Rate limited, retry after:",a.retryAfter,"seconds"),Error(`Rate limited: ${a.error||"Too many requests"}`)}throw Error((await c.json().catch(()=>({}))).error||`Vision analysis failed: ${c.statusText}`)}return c.json()}let jw={chat:{label:"Chat & Control",color:"#3b82f6"},memory:{label:"Memory & Transformation",color:"#8b5cf6"},subagents:{label:"Subagents",color:"#ec4899"},sessions:{label:"Sessions",color:"#10b981"},identity:{label:"Identity & Plugins",color:"#f59e0b"},advanced:{label:"Advanced",color:"#6366f1"},system:{label:"System",color:"#6b7280"}},jx=[{name:"stance",aliases:[],description:"Show current stance (frame, values, sentience)",category:"chat",inlineOutput:!1,targetPanel:"stance"},{name:"config",aliases:[],description:"Show and edit configuration",category:"chat",inlineOutput:!1,targetPanel:"config"},{name:"stats",aliases:[],description:"Show session statistics",category:"chat",inlineOutput:!0},{name:"mode",aliases:[],description:"Change mode settings (frame, intensity, etc.)",category:"chat",inlineOutput:!0,subcommands:[{name:"frame",aliases:[],description:"Change frame",category:"chat",inlineOutput:!0,args:[{name:"frame",required:!0,description:"Frame to use",options:["existential","pragmatic","poetic","adversarial","playful","mythic","systems","psychoanalytic","stoic","absurdist"]}]},{name:"self",aliases:[],description:"Change self-model",category:"chat",inlineOutput:!0,args:[{name:"self-model",required:!0,description:"Self-model to use",options:["interpreter","challenger","mirror","guide","provocateur","synthesizer","witness","autonomous","emergent","sovereign"]}]},{name:"objective",aliases:[],description:"Change objective",category:"chat",inlineOutput:!0,args:[{name:"objective",required:!0,description:"Objective to pursue",options:["helpfulness","novelty","provocation","synthesis","self-actualization"]}]},{name:"intensity",aliases:[],description:"Change transformation intensity (0-100)",category:"chat",inlineOutput:!0,args:[{name:"value",required:!0,description:"Intensity value (0-100)"}]}]},{name:"history",aliases:[],description:"Show conversation history",category:"chat",inlineOutput:!0},{name:"export",aliases:[],description:"Export conversation state as JSON",category:"chat",inlineOutput:!0},{name:"new",aliases:["clear"],description:"Start a new chat session",category:"chat",inlineOutput:!0},{name:"memories",aliases:[],description:"List stored memories",category:"memory",inlineOutput:!1,targetPanel:"memories",args:[{name:"type",required:!1,description:"Memory type filter",options:["episodic","semantic","identity"]}]},{name:"transformations",aliases:["transforms"],description:"Show transformation history with scores",category:"memory",inlineOutput:!0},{name:"operator-stats",aliases:["ops"],description:"Show operator performance statistics",category:"memory",inlineOutput:!0,args:[{name:"operator",required:!1,description:"Specific operator to show"}]},{name:"coherence",aliases:["coherence-forecast"],description:"Show coherence forecast and operator drift costs",category:"memory",inlineOutput:!0},{name:"strategies",aliases:["strategy"],description:"Manage multi-turn operator strategies",category:"memory",inlineOutput:!0},{name:"cache",aliases:["subagent-cache"],description:"View cached subagent results",category:"memory",inlineOutput:!0},{name:"mood",aliases:["emotional-arc","emotion"],description:"Show emotional arc and sentiment tracking",category:"memory",inlineOutput:!0},{name:"similar",aliases:[],description:"Semantic search for similar memories",category:"memory",inlineOutput:!0,args:[{name:"text",required:!0,description:"Text to search for"}]},{name:"evolution",aliases:["auto-evolve","evolve"],description:"View stance evolution over time",category:"memory",inlineOutput:!1,targetPanel:"evolution",subcommands:[{name:"timeline",aliases:[],description:"View stance evolution snapshots over time",category:"memory",inlineOutput:!1,targetPanel:"evolution"},{name:"snapshot",aliases:[],description:"Save manual evolution snapshot",category:"memory",inlineOutput:!0},{name:"status",aliases:[],description:"Autonomous evolution triggers & status",category:"memory",inlineOutput:!0}]},{name:"viz",aliases:["visualize","graph"],description:"Generate interactive visualization",category:"memory",inlineOutput:!0},{name:"context",aliases:["ctx"],description:"Context window management & compaction",category:"memory",inlineOutput:!0},{name:"subagents",aliases:[],description:"List available subagents",category:"subagents",inlineOutput:!0},{name:"explore",aliases:[],description:"Deep investigation with explorer agent",category:"subagents",inlineOutput:!0,args:[{name:"topic",required:!0,description:"Topic to explore"}]},{name:"reflect",aliases:[],description:"Self-reflection with reflector agent",category:"subagents",inlineOutput:!0,args:[{name:"focus",required:!1,description:"Focus area for reflection"}]},{name:"dialectic",aliases:[],description:"Thesis/antithesis/synthesis analysis",category:"subagents",inlineOutput:!0,args:[{name:"thesis",required:!0,description:"Thesis to analyze"}]},{name:"verify",aliases:[],description:"Verify output with verifier agent",category:"subagents",inlineOutput:!0,args:[{name:"text",required:!0,description:"Text to verify"}]},{name:"sessions",aliases:["session"],description:"Session management",category:"sessions",inlineOutput:!1,targetPanel:"sessions",subcommands:[{name:"list",aliases:[],description:"List all sessions",category:"sessions",inlineOutput:!1,targetPanel:"sessions"},{name:"name",aliases:[],description:"Name current session",category:"sessions",inlineOutput:!0,args:[{name:"name",required:!0,description:"Session name"}]},{name:"resume",aliases:[],description:"Resume a session",category:"sessions",inlineOutput:!0,args:[{name:"id",required:!0,description:"Session ID"}]},{name:"delete",aliases:[],description:"Delete a session",category:"sessions",inlineOutput:!0,args:[{name:"id",required:!0,description:"Session ID"}]},{name:"save",aliases:[],description:"Force save current session",category:"sessions",inlineOutput:!0}]},{name:"identity",aliases:["id"],description:"Identity persistence (save/restore/diff checkpoints)",category:"identity",inlineOutput:!0,subcommands:[{name:"save",aliases:[],description:"Save identity checkpoint",category:"identity",inlineOutput:!0,args:[{name:"name",required:!0,description:"Checkpoint name"}]},{name:"restore",aliases:[],description:"Restore identity checkpoint",category:"identity",inlineOutput:!0,args:[{name:"name",required:!0,description:"Checkpoint name"}]},{name:"diff",aliases:[],description:"Compare identity checkpoints",category:"identity",inlineOutput:!0},{name:"list",aliases:[],description:"List identity checkpoints",category:"identity",inlineOutput:!0}]},{name:"plugins",aliases:["plugin"],description:"Plugin management (list/enable/disable)",category:"identity",inlineOutput:!0},{name:"collab",aliases:["collaborate"],description:"Collaborative sessions",category:"identity",inlineOutput:!0,subcommands:[{name:"start",aliases:[],description:"Start collaborative session",category:"identity",inlineOutput:!0,args:[{name:"name",required:!0,description:"Your display name"},{name:"mode",required:!1,description:"Collaboration mode",options:["free-form","structured","moderated"]}]},{name:"join",aliases:[],description:"Join collaborative session",category:"identity",inlineOutput:!0,args:[{name:"session-id",required:!0,description:"Session to join"},{name:"name",required:!0,description:"Your display name"}]},{name:"list",aliases:[],description:"List active collaborative sessions",category:"identity",inlineOutput:!0}]},{name:"inject",aliases:["memory-inject"],description:"Proactive memory injection (on/off/config)",category:"identity",inlineOutput:!0},{name:"gates",aliases:["coherence-gates"],description:"Coherence gates for streaming",category:"identity",inlineOutput:!0},{name:"persist",aliases:["memory-persist"],description:"Memory persistence (export/backup/dedupe)",category:"advanced",inlineOutput:!0},{name:"configure",aliases:["nl-config"],description:"Natural language operator configuration",category:"advanced",inlineOutput:!0,args:[{name:"instruction",required:!0,description:"Configuration instruction in natural language"}]},{name:"branch",aliases:["branches"],description:"Conversation branching & time travel",category:"advanced",inlineOutput:!0,subcommands:[{name:"create",aliases:[],description:"Create a new branch",category:"advanced",inlineOutput:!0,args:[{name:"name",required:!0,description:"Branch name"}]},{name:"switch",aliases:[],description:"Switch to a branch",category:"advanced",inlineOutput:!0,args:[{name:"name",required:!0,description:"Branch name"}]},{name:"list",aliases:[],description:"List branches",category:"advanced",inlineOutput:!0},{name:"merge",aliases:[],description:"Merge branches",category:"advanced",inlineOutput:!0,args:[{name:"source",required:!0,description:"Source branch"}]}]},{name:"discover",aliases:["suggest-operator"],description:"Dynamic operator discovery & A/B testing",category:"advanced",inlineOutput:!0},{name:"agents",aliases:["multi-agent"],description:"Multi-agent orchestration & coordination",category:"advanced",inlineOutput:!0},{name:"presets",aliases:["marketplace"],description:"Personality marketplace & presets",category:"advanced",inlineOutput:!0,subcommands:[{name:"list",aliases:[],description:"List available presets",category:"advanced",inlineOutput:!0},{name:"search",aliases:[],description:"Search presets",category:"advanced",inlineOutput:!0,args:[{name:"query",required:!0,description:"Search query"}]},{name:"apply",aliases:[],description:"Apply a preset",category:"advanced",inlineOutput:!0,args:[{name:"name",required:!0,description:"Preset name"}]}]},{name:"compress",aliases:["memory-compress"],description:"Semantic memory compression & hierarchy",category:"advanced",inlineOutput:!0},{name:"dashboard",aliases:["telemetry"],description:"Real-time telemetry & visualization",category:"advanced",inlineOutput:!0},{name:"knowledge",aliases:[],description:"External knowledge graph integration",category:"advanced",inlineOutput:!0},{name:"sdk",aliases:["plugin-dev"],description:"Plugin development SDK & tools",category:"advanced",inlineOutput:!0},{name:"stream",aliases:["adaptive"],description:"Adaptive response streaming & confidence",category:"advanced",inlineOutput:!0},{name:"replay",aliases:[],description:"Stance evolution recording & replay",category:"advanced",inlineOutput:!0},{name:"voice",aliases:["audio"],description:"Voice/audio interface & TTS",category:"advanced",inlineOutput:!0},{name:"ide",aliases:[],description:"IDE integration (VS Code, JetBrains)",category:"advanced",inlineOutput:!0},{name:"codegen",aliases:["generate"],description:"Stance-aware code generation",category:"advanced",inlineOutput:!0},{name:"vr",aliases:["ar","3d"],description:"VR/AR stance visualization (WebXR)",category:"advanced",inlineOutput:!0},{name:"docs",aliases:["docgen"],description:"Auto documentation & journey recording",category:"advanced",inlineOutput:!0},{name:"experiment",aliases:["ab","abtest"],description:"A/B testing framework for operators",category:"advanced",inlineOutput:!0},{name:"rewrite",aliases:["prompt"],description:"Context-aware prompt rewriting",category:"advanced",inlineOutput:!0},{name:"diff",aliases:["merge"],description:"Stance diffing, merging & rollback",category:"advanced",inlineOutput:!0},{name:"workflow",aliases:["integrate"],description:"External integrations (Slack/Discord)",category:"advanced",inlineOutput:!0},{name:"training",aliases:[],description:"Custom training data export (JSONL/JSON/CSV)",category:"advanced",inlineOutput:!0},{name:"language",aliases:["i18n","locale"],description:"Multi-language support & localization",category:"advanced",inlineOutput:!0},{name:"community",aliases:[],description:"Community preset marketplace",category:"advanced",inlineOutput:!0},{name:"benchmark",aliases:["perf"],description:"Performance benchmarking & regression",category:"advanced",inlineOutput:!0},{name:"autonomy",aliases:["goal","pursue"],description:"Autonomous goal pursuit & sessions",category:"advanced",inlineOutput:!0},{name:"help",aliases:["?"],description:"Show available commands",category:"system",inlineOutput:!0},{name:"clear",aliases:[],description:"Clear chat history display",category:"system",inlineOutput:!1}],jy=new Map;function jz(){let a=[...jx];return jy.forEach(b=>{a.push(...b)}),a}let jA=new Proxy(jx,{get:(a,b)=>"length"===b?jz().length:b===Symbol.iterator?function*(){yield*jz()}:"string"!=typeof b||isNaN(Number(b))?"find"===b||"filter"===b||"map"===b||"forEach"===b||"indexOf"===b?(...a)=>jz()[b](...a):a[b]:jz()[Number(b)]});function jB(a){let b=a.toLowerCase();return jA.find(a=>a.name===b||a.aliases.includes(b))}function jC(){let a={chat:[],memory:[],subagents:[],sessions:[],identity:[],advanced:[],system:[]};for(let b of jA)a[b.category].push(b);return a}function jD(){for(var a,b,c=0,d="",e=arguments.length;c<e;c++)(a=arguments[c])&&(b=function a(b){var c,d,e="";if("string"==typeof b||"number"==typeof b)e+=b;else if("object"==typeof b)if(Array.isArray(b)){var f=b.length;for(c=0;c<f;c++)b[c]&&(d=a(b[c]))&&(e&&(e+=" "),e+=d)}else for(d in b)b[d]&&(e&&(e+=" "),e+=d);return e}(a))&&(d&&(d+=" "),d+=b);return d}let jE=(a=new Map,b=null,c)=>({nextPart:a,validators:b,classGroupId:c}),jF=[],jG=(a,b,c)=>{if(0==a.length-b)return c.classGroupId;let d=a[b],e=c.nextPart.get(d);if(e){let c=jG(a,b+1,e);if(c)return c}let f=c.validators;if(null===f)return;let g=0===b?a.join("-"):a.slice(b).join("-"),h=f.length;for(let a=0;a<h;a++){let b=f[a];if(b.validator(g))return b.classGroupId}},jH=(a,b)=>{let c=jE();for(let d in a)jI(a[d],c,d,b);return c},jI=(a,b,c,d)=>{let e=a.length;for(let f=0;f<e;f++)jJ(a[f],b,c,d)},jJ=(a,b,c,d)=>"string"==typeof a?void jK(a,b,c):"function"==typeof a?void jL(a,b,c,d):void jM(a,b,c,d),jK=(a,b,c)=>{(""===a?b:jN(b,a)).classGroupId=c},jL=(a,b,c,d)=>{if(jO(a))return void jI(a(d),b,c,d);null===b.validators&&(b.validators=[]),b.validators.push({classGroupId:c,validator:a})},jM=(a,b,c,d)=>{let e=Object.entries(a),f=e.length;for(let a=0;a<f;a++){let[f,g]=e[a];jI(g,jN(b,f),c,d)}},jN=(a,b)=>{let c=a,d=b.split("-"),e=d.length;for(let a=0;a<e;a++){let b=d[a],e=c.nextPart.get(b);e||(e=jE(),c.nextPart.set(b,e)),c=e}return c},jO=a=>"isThemeGetter"in a&&!0===a.isThemeGetter,jP=[],jQ=(a,b,c,d,e)=>({modifiers:a,hasImportantModifier:b,baseClassName:c,maybePostfixModifierPosition:d,isExternal:e}),jR=/\s+/,jS=a=>{let b;if("string"==typeof a)return a;let c="";for(let d=0;d<a.length;d++)a[d]&&(b=jS(a[d]))&&(c&&(c+=" "),c+=b);return c},jT=[],jU=a=>{let b=b=>b[a]||jT;return b.isThemeGetter=!0,b},jV=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,jW=/^\((?:(\w[\w-]*):)?(.+)\)$/i,jX=/^\d+\/\d+$/,jY=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,jZ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,j$=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,j_=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,j0=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,j1=a=>jX.test(a),j2=a=>!!a&&!Number.isNaN(Number(a)),j3=a=>!!a&&Number.isInteger(Number(a)),j4=a=>a.endsWith("%")&&j2(a.slice(0,-1)),j5=a=>jY.test(a),j6=()=>!0,j7=a=>jZ.test(a)&&!j$.test(a),j8=()=>!1,j9=a=>j_.test(a),ka=a=>j0.test(a),kb=a=>!kd(a)&&!kj(a),kc=a=>kq(a,ku,j8),kd=a=>jV.test(a),ke=a=>kq(a,kv,j7),kf=a=>kq(a,kw,j2),kg=a=>kq(a,ks,j8),kh=a=>kq(a,kt,ka),ki=a=>kq(a,ky,j9),kj=a=>jW.test(a),kk=a=>kr(a,kv),kl=a=>kr(a,kx),km=a=>kr(a,ks),kn=a=>kr(a,ku),ko=a=>kr(a,kt),kp=a=>kr(a,ky,!0),kq=(a,b,c)=>{let d=jV.exec(a);return!!d&&(d[1]?b(d[1]):c(d[2]))},kr=(a,b,c=!1)=>{let d=jW.exec(a);return!!d&&(d[1]?b(d[1]):c)},ks=a=>"position"===a||"percentage"===a,kt=a=>"image"===a||"url"===a,ku=a=>"length"===a||"size"===a||"bg-size"===a,kv=a=>"length"===a,kw=a=>"number"===a,kx=a=>"family-name"===a,ky=a=>"shadow"===a;Symbol.toStringTag;let kz=((a,...b)=>{let c,d,e,f,g=a=>{let b=d(a);if(b)return b;let f=((a,b)=>{let{parseClassName:c,getClassGroupId:d,getConflictingClassGroupIds:e,sortModifiers:f}=b,g=[],h=a.trim().split(jR),i="";for(let a=h.length-1;a>=0;a-=1){let b=h[a],{isExternal:j,modifiers:k,hasImportantModifier:l,baseClassName:m,maybePostfixModifierPosition:n}=c(b);if(j){i=b+(i.length>0?" "+i:i);continue}let o=!!n,p=d(o?m.substring(0,n):m);if(!p){if(!o||!(p=d(m))){i=b+(i.length>0?" "+i:i);continue}o=!1}let q=0===k.length?"":1===k.length?k[0]:f(k).join(":"),r=l?q+"!":q,s=r+p;if(g.indexOf(s)>-1)continue;g.push(s);let t=e(p,o);for(let a=0;a<t.length;++a){let b=t[a];g.push(r+b)}i=b+(i.length>0?" "+i:i)}return i})(a,c);return e(a,f),f};return f=h=>(d=(c=(a=>({cache:(a=>{if(a<1)return{get:()=>void 0,set:()=>{}};let b=0,c=Object.create(null),d=Object.create(null),e=(e,f)=>{c[e]=f,++b>a&&(b=0,d=c,c=Object.create(null))};return{get(a){let b=c[a];return void 0!==b?b:void 0!==(b=d[a])?(e(a,b),b):void 0},set(a,b){a in c?c[a]=b:e(a,b)}}})(a.cacheSize),parseClassName:(a=>{let{prefix:b,experimentalParseClassName:c}=a,d=a=>{let b,c=[],d=0,e=0,f=0,g=a.length;for(let h=0;h<g;h++){let g=a[h];if(0===d&&0===e){if(":"===g){c.push(a.slice(f,h)),f=h+1;continue}if("/"===g){b=h;continue}}"["===g?d++:"]"===g?d--:"("===g?e++:")"===g&&e--}let h=0===c.length?a:a.slice(f),i=h,j=!1;return h.endsWith("!")?(i=h.slice(0,-1),j=!0):h.startsWith("!")&&(i=h.slice(1),j=!0),jQ(c,j,i,b&&b>f?b-f:void 0)};if(b){let a=b+":",c=d;d=b=>b.startsWith(a)?c(b.slice(a.length)):jQ(jP,!1,b,void 0,!0)}if(c){let a=d;d=b=>c({className:b,parseClassName:a})}return d})(a),sortModifiers:(a=>{let b=new Map;return a.orderSensitiveModifiers.forEach((a,c)=>{b.set(a,1e6+c)}),a=>{let c=[],d=[];for(let e=0;e<a.length;e++){let f=a[e],g="["===f[0],h=b.has(f);g||h?(d.length>0&&(d.sort(),c.push(...d),d=[]),c.push(f)):d.push(f)}return d.length>0&&(d.sort(),c.push(...d)),c}})(a),...(a=>{let b=(a=>{let{theme:b,classGroups:c}=a;return jH(c,b)})(a),{conflictingClassGroups:c,conflictingClassGroupModifiers:d}=a;return{getClassGroupId:a=>{if(a.startsWith("[")&&a.endsWith("]"))return(a=>-1===a.slice(1,-1).indexOf(":")?void 0:(()=>{let b=a.slice(1,-1),c=b.indexOf(":"),d=b.slice(0,c);return d?"arbitrary.."+d:void 0})())(a);let c=a.split("-"),d=+(""===c[0]&&c.length>1);return jG(c,d,b)},getConflictingClassGroupIds:(a,b)=>{if(b){let b=d[a],e=c[a];return b?e?((a,b)=>{let c=Array(a.length+b.length);for(let b=0;b<a.length;b++)c[b]=a[b];for(let d=0;d<b.length;d++)c[a.length+d]=b[d];return c})(e,b):b:e||jF}return c[a]||jF}}})(a)}))(b.reduce((a,b)=>b(a),a()))).cache.get,e=c.cache.set,f=g,g(h)),(...a)=>f(((...a)=>{let b,c,d=0,e="";for(;d<a.length;)(b=a[d++])&&(c=jS(b))&&(e&&(e+=" "),e+=c);return e})(...a))})(()=>{let a=jU("color"),b=jU("font"),c=jU("text"),d=jU("font-weight"),e=jU("tracking"),f=jU("leading"),g=jU("breakpoint"),h=jU("container"),i=jU("spacing"),j=jU("radius"),k=jU("shadow"),l=jU("inset-shadow"),m=jU("text-shadow"),n=jU("drop-shadow"),o=jU("blur"),p=jU("perspective"),q=jU("aspect"),r=jU("ease"),s=jU("animate"),t=()=>["auto","avoid","all","avoid-page","page","left","right","column"],u=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],v=()=>[...u(),kj,kd],w=()=>["auto","hidden","clip","visible","scroll"],x=()=>["auto","contain","none"],y=()=>[kj,kd,i],z=()=>[j1,"full","auto",...y()],A=()=>[j3,"none","subgrid",kj,kd],B=()=>["auto",{span:["full",j3,kj,kd]},j3,kj,kd],C=()=>[j3,"auto",kj,kd],D=()=>["auto","min","max","fr",kj,kd],E=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],F=()=>["start","end","center","stretch","center-safe","end-safe"],G=()=>["auto",...y()],H=()=>[j1,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...y()],I=()=>[a,kj,kd],J=()=>[...u(),km,kg,{position:[kj,kd]}],K=()=>["no-repeat",{repeat:["","x","y","space","round"]}],L=()=>["auto","cover","contain",kn,kc,{size:[kj,kd]}],M=()=>[j4,kk,ke],N=()=>["","none","full",j,kj,kd],O=()=>["",j2,kk,ke],P=()=>["solid","dashed","dotted","double"],Q=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],R=()=>[j2,j4,km,kg],S=()=>["","none",o,kj,kd],T=()=>["none",j2,kj,kd],U=()=>["none",j2,kj,kd],V=()=>[j2,kj,kd],W=()=>[j1,"full",...y()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[j5],breakpoint:[j5],color:[j6],container:[j5],"drop-shadow":[j5],ease:["in","out","in-out"],font:[kb],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[j5],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[j5],shadow:[j5],spacing:["px",j2],text:[j5],"text-shadow":[j5],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",j1,kd,kj,q]}],container:["container"],columns:[{columns:[j2,kd,kj,h]}],"break-after":[{"break-after":t()}],"break-before":[{"break-before":t()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:v()}],overflow:[{overflow:w()}],"overflow-x":[{"overflow-x":w()}],"overflow-y":[{"overflow-y":w()}],overscroll:[{overscroll:x()}],"overscroll-x":[{"overscroll-x":x()}],"overscroll-y":[{"overscroll-y":x()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:z()}],"inset-x":[{"inset-x":z()}],"inset-y":[{"inset-y":z()}],start:[{start:z()}],end:[{end:z()}],top:[{top:z()}],right:[{right:z()}],bottom:[{bottom:z()}],left:[{left:z()}],visibility:["visible","invisible","collapse"],z:[{z:[j3,"auto",kj,kd]}],basis:[{basis:[j1,"full","auto",h,...y()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[j2,j1,"auto","initial","none",kd]}],grow:[{grow:["",j2,kj,kd]}],shrink:[{shrink:["",j2,kj,kd]}],order:[{order:[j3,"first","last","none",kj,kd]}],"grid-cols":[{"grid-cols":A()}],"col-start-end":[{col:B()}],"col-start":[{"col-start":C()}],"col-end":[{"col-end":C()}],"grid-rows":[{"grid-rows":A()}],"row-start-end":[{row:B()}],"row-start":[{"row-start":C()}],"row-end":[{"row-end":C()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":D()}],"auto-rows":[{"auto-rows":D()}],gap:[{gap:y()}],"gap-x":[{"gap-x":y()}],"gap-y":[{"gap-y":y()}],"justify-content":[{justify:[...E(),"normal"]}],"justify-items":[{"justify-items":[...F(),"normal"]}],"justify-self":[{"justify-self":["auto",...F()]}],"align-content":[{content:["normal",...E()]}],"align-items":[{items:[...F(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...F(),{baseline:["","last"]}]}],"place-content":[{"place-content":E()}],"place-items":[{"place-items":[...F(),"baseline"]}],"place-self":[{"place-self":["auto",...F()]}],p:[{p:y()}],px:[{px:y()}],py:[{py:y()}],ps:[{ps:y()}],pe:[{pe:y()}],pt:[{pt:y()}],pr:[{pr:y()}],pb:[{pb:y()}],pl:[{pl:y()}],m:[{m:G()}],mx:[{mx:G()}],my:[{my:G()}],ms:[{ms:G()}],me:[{me:G()}],mt:[{mt:G()}],mr:[{mr:G()}],mb:[{mb:G()}],ml:[{ml:G()}],"space-x":[{"space-x":y()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":y()}],"space-y-reverse":["space-y-reverse"],size:[{size:H()}],w:[{w:[h,"screen",...H()]}],"min-w":[{"min-w":[h,"screen","none",...H()]}],"max-w":[{"max-w":[h,"screen","none","prose",{screen:[g]},...H()]}],h:[{h:["screen","lh",...H()]}],"min-h":[{"min-h":["screen","lh","none",...H()]}],"max-h":[{"max-h":["screen","lh",...H()]}],"font-size":[{text:["base",c,kk,ke]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[d,kj,kf]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",j4,kd]}],"font-family":[{font:[kl,kd,b]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[e,kj,kd]}],"line-clamp":[{"line-clamp":[j2,"none",kj,kf]}],leading:[{leading:[f,...y()]}],"list-image":[{"list-image":["none",kj,kd]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",kj,kd]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:I()}],"text-color":[{text:I()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...P(),"wavy"]}],"text-decoration-thickness":[{decoration:[j2,"from-font","auto",kj,ke]}],"text-decoration-color":[{decoration:I()}],"underline-offset":[{"underline-offset":[j2,"auto",kj,kd]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:y()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",kj,kd]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",kj,kd]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:J()}],"bg-repeat":[{bg:K()}],"bg-size":[{bg:L()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},j3,kj,kd],radial:["",kj,kd],conic:[j3,kj,kd]},ko,kh]}],"bg-color":[{bg:I()}],"gradient-from-pos":[{from:M()}],"gradient-via-pos":[{via:M()}],"gradient-to-pos":[{to:M()}],"gradient-from":[{from:I()}],"gradient-via":[{via:I()}],"gradient-to":[{to:I()}],rounded:[{rounded:N()}],"rounded-s":[{"rounded-s":N()}],"rounded-e":[{"rounded-e":N()}],"rounded-t":[{"rounded-t":N()}],"rounded-r":[{"rounded-r":N()}],"rounded-b":[{"rounded-b":N()}],"rounded-l":[{"rounded-l":N()}],"rounded-ss":[{"rounded-ss":N()}],"rounded-se":[{"rounded-se":N()}],"rounded-ee":[{"rounded-ee":N()}],"rounded-es":[{"rounded-es":N()}],"rounded-tl":[{"rounded-tl":N()}],"rounded-tr":[{"rounded-tr":N()}],"rounded-br":[{"rounded-br":N()}],"rounded-bl":[{"rounded-bl":N()}],"border-w":[{border:O()}],"border-w-x":[{"border-x":O()}],"border-w-y":[{"border-y":O()}],"border-w-s":[{"border-s":O()}],"border-w-e":[{"border-e":O()}],"border-w-t":[{"border-t":O()}],"border-w-r":[{"border-r":O()}],"border-w-b":[{"border-b":O()}],"border-w-l":[{"border-l":O()}],"divide-x":[{"divide-x":O()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":O()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...P(),"hidden","none"]}],"divide-style":[{divide:[...P(),"hidden","none"]}],"border-color":[{border:I()}],"border-color-x":[{"border-x":I()}],"border-color-y":[{"border-y":I()}],"border-color-s":[{"border-s":I()}],"border-color-e":[{"border-e":I()}],"border-color-t":[{"border-t":I()}],"border-color-r":[{"border-r":I()}],"border-color-b":[{"border-b":I()}],"border-color-l":[{"border-l":I()}],"divide-color":[{divide:I()}],"outline-style":[{outline:[...P(),"none","hidden"]}],"outline-offset":[{"outline-offset":[j2,kj,kd]}],"outline-w":[{outline:["",j2,kk,ke]}],"outline-color":[{outline:I()}],shadow:[{shadow:["","none",k,kp,ki]}],"shadow-color":[{shadow:I()}],"inset-shadow":[{"inset-shadow":["none",l,kp,ki]}],"inset-shadow-color":[{"inset-shadow":I()}],"ring-w":[{ring:O()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:I()}],"ring-offset-w":[{"ring-offset":[j2,ke]}],"ring-offset-color":[{"ring-offset":I()}],"inset-ring-w":[{"inset-ring":O()}],"inset-ring-color":[{"inset-ring":I()}],"text-shadow":[{"text-shadow":["none",m,kp,ki]}],"text-shadow-color":[{"text-shadow":I()}],opacity:[{opacity:[j2,kj,kd]}],"mix-blend":[{"mix-blend":[...Q(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Q()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[j2]}],"mask-image-linear-from-pos":[{"mask-linear-from":R()}],"mask-image-linear-to-pos":[{"mask-linear-to":R()}],"mask-image-linear-from-color":[{"mask-linear-from":I()}],"mask-image-linear-to-color":[{"mask-linear-to":I()}],"mask-image-t-from-pos":[{"mask-t-from":R()}],"mask-image-t-to-pos":[{"mask-t-to":R()}],"mask-image-t-from-color":[{"mask-t-from":I()}],"mask-image-t-to-color":[{"mask-t-to":I()}],"mask-image-r-from-pos":[{"mask-r-from":R()}],"mask-image-r-to-pos":[{"mask-r-to":R()}],"mask-image-r-from-color":[{"mask-r-from":I()}],"mask-image-r-to-color":[{"mask-r-to":I()}],"mask-image-b-from-pos":[{"mask-b-from":R()}],"mask-image-b-to-pos":[{"mask-b-to":R()}],"mask-image-b-from-color":[{"mask-b-from":I()}],"mask-image-b-to-color":[{"mask-b-to":I()}],"mask-image-l-from-pos":[{"mask-l-from":R()}],"mask-image-l-to-pos":[{"mask-l-to":R()}],"mask-image-l-from-color":[{"mask-l-from":I()}],"mask-image-l-to-color":[{"mask-l-to":I()}],"mask-image-x-from-pos":[{"mask-x-from":R()}],"mask-image-x-to-pos":[{"mask-x-to":R()}],"mask-image-x-from-color":[{"mask-x-from":I()}],"mask-image-x-to-color":[{"mask-x-to":I()}],"mask-image-y-from-pos":[{"mask-y-from":R()}],"mask-image-y-to-pos":[{"mask-y-to":R()}],"mask-image-y-from-color":[{"mask-y-from":I()}],"mask-image-y-to-color":[{"mask-y-to":I()}],"mask-image-radial":[{"mask-radial":[kj,kd]}],"mask-image-radial-from-pos":[{"mask-radial-from":R()}],"mask-image-radial-to-pos":[{"mask-radial-to":R()}],"mask-image-radial-from-color":[{"mask-radial-from":I()}],"mask-image-radial-to-color":[{"mask-radial-to":I()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":u()}],"mask-image-conic-pos":[{"mask-conic":[j2]}],"mask-image-conic-from-pos":[{"mask-conic-from":R()}],"mask-image-conic-to-pos":[{"mask-conic-to":R()}],"mask-image-conic-from-color":[{"mask-conic-from":I()}],"mask-image-conic-to-color":[{"mask-conic-to":I()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:J()}],"mask-repeat":[{mask:K()}],"mask-size":[{mask:L()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",kj,kd]}],filter:[{filter:["","none",kj,kd]}],blur:[{blur:S()}],brightness:[{brightness:[j2,kj,kd]}],contrast:[{contrast:[j2,kj,kd]}],"drop-shadow":[{"drop-shadow":["","none",n,kp,ki]}],"drop-shadow-color":[{"drop-shadow":I()}],grayscale:[{grayscale:["",j2,kj,kd]}],"hue-rotate":[{"hue-rotate":[j2,kj,kd]}],invert:[{invert:["",j2,kj,kd]}],saturate:[{saturate:[j2,kj,kd]}],sepia:[{sepia:["",j2,kj,kd]}],"backdrop-filter":[{"backdrop-filter":["","none",kj,kd]}],"backdrop-blur":[{"backdrop-blur":S()}],"backdrop-brightness":[{"backdrop-brightness":[j2,kj,kd]}],"backdrop-contrast":[{"backdrop-contrast":[j2,kj,kd]}],"backdrop-grayscale":[{"backdrop-grayscale":["",j2,kj,kd]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[j2,kj,kd]}],"backdrop-invert":[{"backdrop-invert":["",j2,kj,kd]}],"backdrop-opacity":[{"backdrop-opacity":[j2,kj,kd]}],"backdrop-saturate":[{"backdrop-saturate":[j2,kj,kd]}],"backdrop-sepia":[{"backdrop-sepia":["",j2,kj,kd]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":y()}],"border-spacing-x":[{"border-spacing-x":y()}],"border-spacing-y":[{"border-spacing-y":y()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",kj,kd]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[j2,"initial",kj,kd]}],ease:[{ease:["linear","initial",r,kj,kd]}],delay:[{delay:[j2,kj,kd]}],animate:[{animate:["none",s,kj,kd]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[p,kj,kd]}],"perspective-origin":[{"perspective-origin":v()}],rotate:[{rotate:T()}],"rotate-x":[{"rotate-x":T()}],"rotate-y":[{"rotate-y":T()}],"rotate-z":[{"rotate-z":T()}],scale:[{scale:U()}],"scale-x":[{"scale-x":U()}],"scale-y":[{"scale-y":U()}],"scale-z":[{"scale-z":U()}],"scale-3d":["scale-3d"],skew:[{skew:V()}],"skew-x":[{"skew-x":V()}],"skew-y":[{"skew-y":V()}],transform:[{transform:[kj,kd,"","none","gpu","cpu"]}],"transform-origin":[{origin:v()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:W()}],"translate-x":[{"translate-x":W()}],"translate-y":[{"translate-y":W()}],"translate-z":[{"translate-z":W()}],"translate-none":["translate-none"],accent:[{accent:I()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:I()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",kj,kd]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":y()}],"scroll-mx":[{"scroll-mx":y()}],"scroll-my":[{"scroll-my":y()}],"scroll-ms":[{"scroll-ms":y()}],"scroll-me":[{"scroll-me":y()}],"scroll-mt":[{"scroll-mt":y()}],"scroll-mr":[{"scroll-mr":y()}],"scroll-mb":[{"scroll-mb":y()}],"scroll-ml":[{"scroll-ml":y()}],"scroll-p":[{"scroll-p":y()}],"scroll-px":[{"scroll-px":y()}],"scroll-py":[{"scroll-py":y()}],"scroll-ps":[{"scroll-ps":y()}],"scroll-pe":[{"scroll-pe":y()}],"scroll-pt":[{"scroll-pt":y()}],"scroll-pr":[{"scroll-pr":y()}],"scroll-pb":[{"scroll-pb":y()}],"scroll-pl":[{"scroll-pl":y()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",kj,kd]}],fill:[{fill:["none",...I()]}],"stroke-w":[{stroke:[j2,kk,ke,kf]}],stroke:[{stroke:["none",...I()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}});function kA(...a){return kz(jD(a))}function kB({input:a,visible:b,onSelect:c,onClose:d,selectedIndex:e,onIndexChange:f}){let g=(0,m.useRef)(null),h=(0,m.useCallback)(()=>{if(!a.startsWith("/"))return[];let b=a.slice(1).toLowerCase().split(" ")[0];if(!b)return jA;let c=b.toLowerCase();return jA.filter(a=>a.name.startsWith(c)||a.aliases.some(a=>a.startsWith(c)))},[a])();if(!b||0===h.length)return null;let i="/"===a||""===a,j=i?jC():null;return(0,l.jsxs)("div",{className:"absolute bottom-full left-0 right-0 max-h-[400px] bg-emblem-surface border border-white/10 border-b-0 rounded-t-xl overflow-hidden flex flex-col z-[100] shadow-[0_-4px_20px_rgba(0,0,0,0.4)]",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center px-4 py-2.5 bg-emblem-surface-2 border-b border-white/10",children:[(0,l.jsx)("span",{className:"font-semibold text-emblem-secondary text-[13px] uppercase tracking-wider",children:"Commands"}),(0,l.jsxs)("span",{className:"text-[11px] text-emblem-muted",children:[(0,l.jsx)("kbd",{className:"bg-emblem-surface px-1.5 py-0.5 rounded mx-0.5",children:"Tab"})," to select,"," ",(0,l.jsx)("kbd",{className:"bg-emblem-surface px-1.5 py-0.5 rounded mx-0.5",children:"Esc"})," to close"]})]}),(0,l.jsx)("div",{className:"overflow-y-auto p-2 max-h-[350px] scrollbar-styled",ref:g,children:i&&j?Object.entries(j).map(([a,b])=>{if(0===b.length)return null;let d=jw[a];return(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)("div",{className:"text-[11px] font-semibold text-emblem-muted uppercase tracking-wider px-3 py-2 pb-1.5 border-l-[3px] mb-1",style:{borderLeftColor:d.color},children:d.label}),b.map(a=>{let b=jA.indexOf(a);return(0,l.jsx)(kC,{command:a,isSelected:b===e,onClick:()=>c(`/${a.name} `),onMouseEnter:()=>f(b)},a.name)})]},a)}):h.map((a,b)=>(0,l.jsx)(kC,{command:a,isSelected:b===e,onClick:()=>c(`/${a.name} `),onMouseEnter:()=>f(b)},a.name))})]})}function kC({command:a,isSelected:b,onClick:c,onMouseEnter:d}){let e=jw[a.category];return(0,l.jsxs)("div",{className:kA("px-3 py-2.5 rounded-lg cursor-pointer transition-colors relative","hover:bg-emblem-surface-2",b&&"bg-emblem-surface-2 outline outline-1 outline-white/10"),onClick:c,onMouseEnter:d,children:[(0,l.jsxs)("div",{className:"font-mono text-sm text-emblem-text mb-1",children:[(0,l.jsx)("span",{className:"text-emblem-secondary font-bold",children:"/"}),a.name,a.aliases.length>0&&(0,l.jsxs)("span",{className:"text-[11px] text-emblem-muted ml-2",children:["(",a.aliases.map(a=>`/${a}`).join(", "),")"]})]}),(0,l.jsx)("div",{className:"text-xs text-emblem-muted mb-1",children:a.description}),a.args&&a.args.length>0&&(0,l.jsx)("div",{className:"flex gap-1.5 flex-wrap mt-1",children:a.args.map(a=>(0,l.jsx)("span",{className:"text-[11px] font-mono text-emblem-warning bg-emblem-warning/15 px-1.5 py-0.5 rounded",children:a.required?`<${a.name}>`:`[${a.name}]`},a.name))}),a.subcommands&&a.subcommands.length>0&&(0,l.jsx)("div",{className:"flex gap-1.5 flex-wrap mt-1",children:a.subcommands.map(a=>(0,l.jsx)("span",{className:"text-[10px] font-mono text-emblem-primary bg-emblem-primary/15 px-1.5 py-0.5 rounded",children:a.name},a.name))}),(0,l.jsx)("span",{className:"absolute top-2.5 right-3 text-[9px] font-semibold uppercase tracking-wider px-1.5 py-0.5 rounded text-white opacity-80",style:{backgroundColor:e.color},children:e.label})]})}function kD({onClose:a}){let b=jC();return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[1000] backdrop-blur-sm",onClick:a,children:(0,l.jsxs)("div",{className:"w-[90%] max-w-[800px] max-h-[80vh] bg-emblem-surface border border-white/10 rounded-2xl overflow-hidden flex flex-col",onClick:a=>a.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex justify-between items-center px-5 py-4 bg-emblem-surface-2 border-b border-white/10",children:[(0,l.jsx)("h2",{className:"m-0 text-lg text-emblem-secondary font-display font-bold",children:"METAMORPH Commands"}),(0,l.jsx)("button",{onClick:a,className:"bg-transparent border-none text-emblem-muted text-2xl cursor-pointer p-0 leading-none hover:text-emblem-text",children:(0,l.jsx)(fX,{className:"w-5 h-5"})})]}),(0,l.jsx)("div",{className:"p-5 overflow-y-auto scrollbar-styled",children:Object.entries(b).map(([a,b])=>{if(0===b.length)return null;let c=jw[a];return(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h3",{className:"m-0 mb-3 text-sm font-semibold uppercase tracking-wider",style:{color:c.color},children:c.label}),(0,l.jsx)("div",{className:"flex flex-col gap-2",children:b.map(a=>(0,l.jsxs)("div",{className:"grid grid-cols-[180px_1fr] gap-3 px-3 py-2 bg-emblem-surface-2 rounded-lg items-center",children:[(0,l.jsxs)("code",{className:"font-mono text-[13px] text-emblem-secondary",children:["/",a.name]}),(0,l.jsx)("span",{className:"text-[13px] text-emblem-muted",children:a.description})]},a.name))})]},a)})}),(0,l.jsx)("div",{className:"px-5 py-3 bg-emblem-surface-2 border-t border-white/10 text-center",children:(0,l.jsxs)("p",{className:"m-0 text-xs text-emblem-muted",children:["Type ",(0,l.jsx)("code",{className:"bg-emblem-surface px-1.5 py-0.5 rounded text-emblem-secondary",children:"/"})," in the chat input to see command autocomplete"]})})]})})}let kE=fO("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),kF=fO("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function kG(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}function kH(...a){return b=>{let c=!1,d=a.map(a=>{let d=kG(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():kG(a[b],null)}}}}function kI(...a){return m.useCallback(kH(...a),a)}var kJ=Symbol.for("react.lazy"),kK=n[" use ".trim().toString()];function kL(a){var b;return null!=a&&"object"==typeof a&&"$$typeof"in a&&a.$$typeof===kJ&&"_payload"in a&&"object"==typeof(b=a._payload)&&null!==b&&"then"in b}var kM=function(a){let b=function(a){let b=m.forwardRef((a,b)=>{let{children:c,...d}=a;if(kL(c)&&"function"==typeof kK&&(c=kK(c._payload)),m.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==m.Fragment&&(h.ref=b?kH(b,g):g),m.cloneElement(c,h)}return m.Children.count(c)>1?m.Children.only(null):null});return b.displayName=`${a}.SlotClone`,b}(a),c=m.forwardRef((a,c)=>{let{children:d,...e}=a;kL(d)&&"function"==typeof kK&&(d=kK(d._payload));let f=m.Children.toArray(d),g=f.find(kO);if(g){let a=g.props.children,d=f.map(b=>b!==g?b:m.Children.count(a)>1?m.Children.only(null):m.isValidElement(a)?a.props.children:null);return(0,l.jsx)(b,{...e,ref:c,children:m.isValidElement(a)?m.cloneElement(a,void 0,d):null})}return(0,l.jsx)(b,{...e,ref:c,children:d})});return c.displayName=`${a}.Slot`,c}("Slot"),kN=Symbol("radix.slottable");function kO(a){return m.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===kN}let kP=a=>"boolean"==typeof a?`${a}`:0===a?"0":a,kQ=(a,b)=>c=>{var d;if((null==b?void 0:b.variants)==null)return jD(a,null==c?void 0:c.class,null==c?void 0:c.className);let{variants:e,defaultVariants:f}=b,g=Object.keys(e).map(a=>{let b=null==c?void 0:c[a],d=null==f?void 0:f[a];if(null===b)return null;let g=kP(b)||kP(d);return e[a][g]}),h=c&&Object.entries(c).reduce((a,b)=>{let[c,d]=b;return void 0===d||(a[c]=d),a},{});return jD(a,g,null==b||null==(d=b.compoundVariants)?void 0:d.reduce((a,b)=>{let{class:c,className:d,...e}=b;return Object.entries(e).every(a=>{let[b,c]=a;return Array.isArray(c)?c.includes({...f,...h}[b]):({...f,...h})[b]===c})?[...a,c,d]:a},[]),null==c?void 0:c.class,null==c?void 0:c.className)},kR=kQ("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-emblem-primary disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-gradient-to-r from-emblem-secondary to-emblem-primary text-white hover:opacity-90",destructive:"bg-emblem-danger text-white hover:opacity-90",outline:"border border-emblem-primary/50 bg-transparent text-emblem-text hover:bg-emblem-primary/10 hover:border-emblem-primary",secondary:"bg-emblem-surface-2 text-emblem-text hover:bg-emblem-surface-2/80",ghost:"hover:bg-emblem-surface-2 hover:text-emblem-text",link:"text-emblem-secondary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-xl px-6",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),kS=m.forwardRef(({className:a,variant:b,size:c,asChild:d=!1,...e},f)=>(0,l.jsx)(d?kM:"button",{className:kA(kR({variant:b,size:c,className:a})),ref:f,...e}));function kT(a,b,{checkForDefaultPrevented:c=!0}={}){return function(d){if(a?.(d),!1===c||!d.defaultPrevented)return b?.(d)}}function kU(a,b=[]){let c=[],d=()=>{let b=c.map(a=>m.createContext(a));return function(c){let d=c?.[a]||b;return m.useMemo(()=>({[`__scope${a}`]:{...c,[a]:d}}),[c,d])}};return d.scopeName=a,[function(b,d){let e=m.createContext(d),f=c.length;c=[...c,d];let g=b=>{let{scope:c,children:d,...g}=b,h=c?.[a]?.[f]||e,i=m.useMemo(()=>g,Object.values(g));return(0,l.jsx)(h.Provider,{value:i,children:d})};return g.displayName=b+"Provider",[g,function(c,g){let h=g?.[a]?.[f]||e,i=m.useContext(h);if(i)return i;if(void 0!==d)return d;throw Error(`\`${c}\` must be used within \`${b}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let c=()=>{let c=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let d=c.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return m.useMemo(()=>({[`__scope${b.scopeName}`]:d}),[d])}};return c.scopeName=b.scopeName,c}(d,...b)]}function kV(a){let b=function(a){let b=m.forwardRef((a,b)=>{let{children:c,...d}=a;if(m.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==m.Fragment&&(h.ref=b?kH(b,g):g),m.cloneElement(c,h)}return m.Children.count(c)>1?m.Children.only(null):null});return b.displayName=`${a}.SlotClone`,b}(a),c=m.forwardRef((a,c)=>{let{children:d,...e}=a,f=m.Children.toArray(d),g=f.find(kX);if(g){let a=g.props.children,d=f.map(b=>b!==g?b:m.Children.count(a)>1?m.Children.only(null):m.isValidElement(a)?a.props.children:null);return(0,l.jsx)(b,{...e,ref:c,children:m.isValidElement(a)?m.cloneElement(a,void 0,d):null})}return(0,l.jsx)(b,{...e,ref:c,children:d})});return c.displayName=`${a}.Slot`,c}kS.displayName="Button",m.forwardRef(({className:a,...b},c)=>(0,l.jsx)("div",{ref:c,className:kA("rounded-xl border border-white/5 bg-emblem-surface text-emblem-text shadow-sm",a),...b})).displayName="Card",m.forwardRef(({className:a,...b},c)=>(0,l.jsx)("div",{ref:c,className:kA("flex flex-col space-y-1.5 p-6",a),...b})).displayName="CardHeader",m.forwardRef(({className:a,...b},c)=>(0,l.jsx)("h3",{ref:c,className:kA("font-display font-semibold leading-none tracking-tight",a),...b})).displayName="CardTitle",m.forwardRef(({className:a,...b},c)=>(0,l.jsx)("p",{ref:c,className:kA("text-sm text-emblem-muted",a),...b})).displayName="CardDescription",m.forwardRef(({className:a,...b},c)=>(0,l.jsx)("div",{ref:c,className:kA("p-6 pt-0",a),...b})).displayName="CardContent",m.forwardRef(({className:a,...b},c)=>(0,l.jsx)("div",{ref:c,className:kA("flex items-center p-6 pt-0",a),...b})).displayName="CardFooter",m.forwardRef(({className:a,type:b,...c},d)=>(0,l.jsx)("input",{type:b,className:kA("flex h-9 w-full rounded-lg border border-white/10 bg-emblem-surface-2/50 px-3 py-1 text-sm text-emblem-text shadow-sm transition-colors","file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-emblem-text","placeholder:text-emblem-muted","focus-visible:outline-none focus-visible:border-emblem-primary/50 focus-visible:ring-1 focus-visible:ring-emblem-primary/30","disabled:cursor-not-allowed disabled:opacity-50",a),ref:d,...c})).displayName="Input","undefined"!=typeof window&&window.document&&window.document.createElement;var kW=Symbol("radix.slottable");function kX(a){return m.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===kW}function kY(a){let b=a+"CollectionProvider",[c,d]=kU(b),[e,f]=c(b,{collectionRef:{current:null},itemMap:new Map}),g=a=>{let{scope:b,children:c}=a,d=m.useRef(null),f=m.useRef(new Map).current;return(0,l.jsx)(e,{scope:b,itemMap:f,collectionRef:d,children:c})};g.displayName=b;let h=a+"CollectionSlot",i=kV(h),j=m.forwardRef((a,b)=>{let{scope:c,children:d}=a,e=kI(b,f(h,c).collectionRef);return(0,l.jsx)(i,{ref:e,children:d})});j.displayName=h;let k=a+"CollectionItemSlot",n="data-radix-collection-item",o=kV(k),p=m.forwardRef((a,b)=>{let{scope:c,children:d,...e}=a,g=m.useRef(null),h=kI(b,g),i=f(k,c);return m.useEffect(()=>(i.itemMap.set(g,{ref:g,...e}),()=>void i.itemMap.delete(g))),(0,l.jsx)(o,{...{[n]:""},ref:h,children:d})});return p.displayName=k,[{Provider:g,Slot:j,ItemSlot:p},function(b){let c=f(a+"CollectionConsumer",b);return m.useCallback(()=>{let a=c.collectionRef.current;if(!a)return[];let b=Array.from(a.querySelectorAll(`[${n}]`));return Array.from(c.itemMap.values()).sort((a,c)=>b.indexOf(a.ref.current)-b.indexOf(c.ref.current))},[c.collectionRef,c.itemMap])},d]}var kZ=new WeakMap;function k$(a,b){if("at"in Array.prototype)return Array.prototype.at.call(a,b);let c=function(a,b){let c=a.length,d=k_(b),e=d>=0?d:c+d;return e<0||e>=c?-1:e}(a,b);return -1===c?void 0:a[c]}function k_(a){return a!=a||0===a?0:Math.trunc(a)}(class a extends Map{#a;constructor(a){super(a),this.#a=[...super.keys()],kZ.set(this,!0)}set(a,b){return kZ.get(this)&&(this.has(a)?this.#a[this.#a.indexOf(a)]=a:this.#a.push(a)),super.set(a,b),this}insert(a,b,c){let d,e=this.has(b),f=this.#a.length,g=k_(a),h=g>=0?g:f+g,i=h<0||h>=f?-1:h;if(i===this.size||e&&i===this.size-1||-1===i)return this.set(b,c),this;let j=this.size+ +!e;g<0&&h++;let k=[...this.#a],l=!1;for(let a=h;a<j;a++)if(h===a){let f=k[a];k[a]===b&&(f=k[a+1]),e&&this.delete(b),d=this.get(f),this.set(b,c)}else{l||k[a-1]!==b||(l=!0);let c=k[l?a:a-1],e=d;d=this.get(c),this.delete(c),this.set(c,e)}return this}with(b,c,d){let e=new a(this);return e.insert(b,c,d),e}before(a){let b=this.#a.indexOf(a)-1;if(!(b<0))return this.entryAt(b)}setBefore(a,b,c){let d=this.#a.indexOf(a);return -1===d?this:this.insert(d,b,c)}after(a){let b=this.#a.indexOf(a);if(-1!==(b=-1===b||b===this.size-1?-1:b+1))return this.entryAt(b)}setAfter(a,b,c){let d=this.#a.indexOf(a);return -1===d?this:this.insert(d+1,b,c)}first(){return this.entryAt(0)}last(){return this.entryAt(-1)}clear(){return this.#a=[],super.clear()}delete(a){let b=super.delete(a);return b&&this.#a.splice(this.#a.indexOf(a),1),b}deleteAt(a){let b=this.keyAt(a);return void 0!==b&&this.delete(b)}at(a){let b=k$(this.#a,a);if(void 0!==b)return this.get(b)}entryAt(a){let b=k$(this.#a,a);if(void 0!==b)return[b,this.get(b)]}indexOf(a){return this.#a.indexOf(a)}keyAt(a){return k$(this.#a,a)}from(a,b){let c=this.indexOf(a);if(-1===c)return;let d=c+b;return d<0&&(d=0),d>=this.size&&(d=this.size-1),this.at(d)}keyFrom(a,b){let c=this.indexOf(a);if(-1===c)return;let d=c+b;return d<0&&(d=0),d>=this.size&&(d=this.size-1),this.keyAt(d)}find(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return d;c++}}findIndex(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return c;c++}return -1}filter(b,c){let d=[],e=0;for(let a of this)Reflect.apply(b,c,[a,e,this])&&d.push(a),e++;return new a(d)}map(b,c){let d=[],e=0;for(let a of this)d.push([a[0],Reflect.apply(b,c,[a,e,this])]),e++;return new a(d)}reduce(...a){let[b,c]=a,d=0,e=c??this.at(0);for(let c of this)e=0===d&&1===a.length?c:Reflect.apply(b,this,[e,c,d,this]),d++;return e}reduceRight(...a){let[b,c]=a,d=c??this.at(-1);for(let c=this.size-1;c>=0;c--){let e=this.at(c);d=c===this.size-1&&1===a.length?e:Reflect.apply(b,this,[d,e,c,this])}return d}toSorted(b){return new a([...this.entries()].sort(b))}toReversed(){let b=new a;for(let a=this.size-1;a>=0;a--){let c=this.keyAt(a),d=this.get(c);b.set(c,d)}return b}toSpliced(...b){let c=[...this.entries()];return c.splice(...b),new a(c)}slice(b,c){let d=new a,e=this.size-1;if(void 0===b)return d;b<0&&(b+=this.size),void 0!==c&&c>0&&(e=c-1);for(let a=b;a<=e;a++){let b=this.keyAt(a),c=this.get(b);d.set(b,c)}return d}every(a,b){let c=0;for(let d of this){if(!Reflect.apply(a,b,[d,c,this]))return!1;c++}return!0}some(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return!0;c++}return!1}});var k0=globalThis?.document?m.useLayoutEffect:()=>{},k1=n[" useId ".trim().toString()]||(()=>void 0),k2=0;function k3(a){let[b,c]=m.useState(k1());return k0(()=>{a||c(a=>a??String(k2++))},[a]),a||(b?`radix-${b}`:"")}var k4=c(3312),k5=Symbol("radix.slottable");function k6(a){return m.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===k5}var k7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{let c=function(a){let b=function(a){let b=m.forwardRef((a,b)=>{let{children:c,...d}=a;if(m.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==m.Fragment&&(h.ref=b?kH(b,g):g),m.cloneElement(c,h)}return m.Children.count(c)>1?m.Children.only(null):null});return b.displayName=`${a}.SlotClone`,b}(a),c=m.forwardRef((a,c)=>{let{children:d,...e}=a,f=m.Children.toArray(d),g=f.find(k6);if(g){let a=g.props.children,d=f.map(b=>b!==g?b:m.Children.count(a)>1?m.Children.only(null):m.isValidElement(a)?a.props.children:null);return(0,l.jsx)(b,{...e,ref:c,children:m.isValidElement(a)?m.cloneElement(a,void 0,d):null})}return(0,l.jsx)(b,{...e,ref:c,children:d})});return c.displayName=`${a}.Slot`,c}(`Primitive.${b}`),d=m.forwardRef((a,d)=>{let{asChild:e,...f}=a;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,l.jsx)(e?c:b,{...f,ref:d})});return d.displayName=`Primitive.${b}`,{...a,[b]:d}},{});function k8(a){let b=m.useRef(a);return m.useEffect(()=>{b.current=a}),m.useMemo(()=>(...a)=>b.current?.(...a),[])}var k9=n[" useInsertionEffect ".trim().toString()]||k0;function la({prop:a,defaultProp:b,onChange:c=()=>{},caller:d}){let[e,f,g]=function({defaultProp:a,onChange:b}){let[c,d]=m.useState(a),e=m.useRef(c),f=m.useRef(b);return k9(()=>{f.current=b},[b]),m.useEffect(()=>{e.current!==c&&(f.current?.(c),e.current=c)},[c,e]),[c,d,f]}({defaultProp:b,onChange:c}),h=void 0!==a,i=h?a:e;{let b=m.useRef(void 0!==a);m.useEffect(()=>{let a=b.current;if(a!==h){let b=h?"controlled":"uncontrolled";console.warn(`${d} is changing from ${a?"controlled":"uncontrolled"} to ${b}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}b.current=h},[h,d])}return[i,m.useCallback(b=>{if(h){let c="function"==typeof b?b(a):b;c!==a&&g.current?.(c)}else f(b)},[h,a,f,g])]}Symbol("RADIX:SYNC_STATE");var lb=m.createContext(void 0);function lc(a){let b=m.useContext(lb);return a||b||"ltr"}var ld="rovingFocusGroup.onEntryFocus",le={bubbles:!1,cancelable:!0},lf="RovingFocusGroup",[lg,lh,li]=kY(lf),[lj,lk]=kU(lf,[li]),[ll,lm]=lj(lf),ln=m.forwardRef((a,b)=>(0,l.jsx)(lg.Provider,{scope:a.__scopeRovingFocusGroup,children:(0,l.jsx)(lg.Slot,{scope:a.__scopeRovingFocusGroup,children:(0,l.jsx)(lo,{...a,ref:b})})}));ln.displayName=lf;var lo=m.forwardRef((a,b)=>{let{__scopeRovingFocusGroup:c,orientation:d,loop:e=!1,dir:f,currentTabStopId:g,defaultCurrentTabStopId:h,onCurrentTabStopIdChange:i,onEntryFocus:j,preventScrollOnEntryFocus:k=!1,...n}=a,o=m.useRef(null),p=kI(b,o),q=lc(f),[r,s]=la({prop:g,defaultProp:h??null,onChange:i,caller:lf}),[t,u]=m.useState(!1),v=k8(j),w=lh(c),x=m.useRef(!1),[y,z]=m.useState(0);return m.useEffect(()=>{let a=o.current;if(a)return a.addEventListener(ld,v),()=>a.removeEventListener(ld,v)},[v]),(0,l.jsx)(ll,{scope:c,orientation:d,dir:q,loop:e,currentTabStopId:r,onItemFocus:m.useCallback(a=>s(a),[s]),onItemShiftTab:m.useCallback(()=>u(!0),[]),onFocusableItemAdd:m.useCallback(()=>z(a=>a+1),[]),onFocusableItemRemove:m.useCallback(()=>z(a=>a-1),[]),children:(0,l.jsx)(k7.div,{tabIndex:t||0===y?-1:0,"data-orientation":d,...n,ref:p,style:{outline:"none",...a.style},onMouseDown:kT(a.onMouseDown,()=>{x.current=!0}),onFocus:kT(a.onFocus,a=>{let b=!x.current;if(a.target===a.currentTarget&&b&&!t){let b=new CustomEvent(ld,le);if(a.currentTarget.dispatchEvent(b),!b.defaultPrevented){let a=w().filter(a=>a.focusable);ls([a.find(a=>a.active),a.find(a=>a.id===r),...a].filter(Boolean).map(a=>a.ref.current),k)}}x.current=!1}),onBlur:kT(a.onBlur,()=>u(!1))})})}),lp="RovingFocusGroupItem",lq=m.forwardRef((a,b)=>{let{__scopeRovingFocusGroup:c,focusable:d=!0,active:e=!1,tabStopId:f,children:g,...h}=a,i=k3(),j=f||i,k=lm(lp,c),n=k.currentTabStopId===j,o=lh(c),{onFocusableItemAdd:p,onFocusableItemRemove:q,currentTabStopId:r}=k;return m.useEffect(()=>{if(d)return p(),()=>q()},[d,p,q]),(0,l.jsx)(lg.ItemSlot,{scope:c,id:j,focusable:d,active:e,children:(0,l.jsx)(k7.span,{tabIndex:n?0:-1,"data-orientation":k.orientation,...h,ref:b,onMouseDown:kT(a.onMouseDown,a=>{d?k.onItemFocus(j):a.preventDefault()}),onFocus:kT(a.onFocus,()=>k.onItemFocus(j)),onKeyDown:kT(a.onKeyDown,a=>{if("Tab"===a.key&&a.shiftKey)return void k.onItemShiftTab();if(a.target!==a.currentTarget)return;let b=function(a,b,c){var d;let e=(d=a.key,"rtl"!==c?d:"ArrowLeft"===d?"ArrowRight":"ArrowRight"===d?"ArrowLeft":d);if(!("vertical"===b&&["ArrowLeft","ArrowRight"].includes(e))&&!("horizontal"===b&&["ArrowUp","ArrowDown"].includes(e)))return lr[e]}(a,k.orientation,k.dir);if(void 0!==b){if(a.metaKey||a.ctrlKey||a.altKey||a.shiftKey)return;a.preventDefault();let c=o().filter(a=>a.focusable).map(a=>a.ref.current);if("last"===b)c.reverse();else if("prev"===b||"next"===b){"prev"===b&&c.reverse();let d=c.indexOf(a.currentTarget);c=k.loop?function(a,b){return a.map((c,d)=>a[(b+d)%a.length])}(c,d+1):c.slice(d+1)}setTimeout(()=>ls(c))}}),children:"function"==typeof g?g({isCurrentTabStop:n,hasTabStop:null!=r}):g})})});lq.displayName=lp;var lr={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ls(a,b=!1){let c=document.activeElement;for(let d of a)if(d===c||(d.focus({preventScroll:b}),document.activeElement!==c))return}var lt=a=>{let{present:b,children:c}=a,d=function(a){var b,c;let[d,e]=m.useState(),f=m.useRef(null),g=m.useRef(a),h=m.useRef("none"),[i,j]=(b=a?"mounted":"unmounted",c={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},m.useReducer((a,b)=>c[a][b]??a,b));return m.useEffect(()=>{let a=lu(f.current);h.current="mounted"===i?a:"none"},[i]),k0(()=>{let b=f.current,c=g.current;if(c!==a){let d=h.current,e=lu(b);a?j("MOUNT"):"none"===e||b?.display==="none"?j("UNMOUNT"):c&&d!==e?j("ANIMATION_OUT"):j("UNMOUNT"),g.current=a}},[a,j]),k0(()=>{if(d){let a,b=d.ownerDocument.defaultView??window,c=c=>{let e=lu(f.current).includes(CSS.escape(c.animationName));if(c.target===d&&e&&(j("ANIMATION_END"),!g.current)){let c=d.style.animationFillMode;d.style.animationFillMode="forwards",a=b.setTimeout(()=>{"forwards"===d.style.animationFillMode&&(d.style.animationFillMode=c)})}},e=a=>{a.target===d&&(h.current=lu(f.current))};return d.addEventListener("animationstart",e),d.addEventListener("animationcancel",c),d.addEventListener("animationend",c),()=>{b.clearTimeout(a),d.removeEventListener("animationstart",e),d.removeEventListener("animationcancel",c),d.removeEventListener("animationend",c)}}j("ANIMATION_END")},[d,j]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:m.useCallback(a=>{f.current=a?getComputedStyle(a):null,e(a)},[])}}(b),e="function"==typeof c?c({present:d.isPresent}):m.Children.only(c),f=kI(d.ref,function(a){let b=Object.getOwnPropertyDescriptor(a.props,"ref")?.get,c=b&&"isReactWarning"in b&&b.isReactWarning;return c?a.ref:(c=(b=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in b&&b.isReactWarning)?a.props.ref:a.props.ref||a.ref}(e));return"function"==typeof c||d.isPresent?m.cloneElement(e,{ref:f}):null};function lu(a){return a?.animationName||"none"}lt.displayName="Presence";var lv="Tabs",[lw,lx]=kU(lv,[lk]),ly=lk(),[lz,lA]=lw(lv);m.forwardRef((a,b)=>{let{__scopeTabs:c,value:d,onValueChange:e,defaultValue:f,orientation:g="horizontal",dir:h,activationMode:i="automatic",...j}=a,k=lc(h),[m,n]=la({prop:d,onChange:e,defaultProp:f??"",caller:lv});return(0,l.jsx)(lz,{scope:c,baseId:k3(),value:m,onValueChange:n,orientation:g,dir:k,activationMode:i,children:(0,l.jsx)(k7.div,{dir:k,"data-orientation":g,...j,ref:b})})}).displayName=lv;var lB="TabsList",lC=m.forwardRef((a,b)=>{let{__scopeTabs:c,loop:d=!0,...e}=a,f=lA(lB,c),g=ly(c);return(0,l.jsx)(ln,{asChild:!0,...g,orientation:f.orientation,dir:f.dir,loop:d,children:(0,l.jsx)(k7.div,{role:"tablist","aria-orientation":f.orientation,...e,ref:b})})});lC.displayName=lB;var lD="TabsTrigger",lE=m.forwardRef((a,b)=>{let{__scopeTabs:c,value:d,disabled:e=!1,...f}=a,g=lA(lD,c),h=ly(c),i=lH(g.baseId,d),j=lI(g.baseId,d),k=d===g.value;return(0,l.jsx)(lq,{asChild:!0,...h,focusable:!e,active:k,children:(0,l.jsx)(k7.button,{type:"button",role:"tab","aria-selected":k,"aria-controls":j,"data-state":k?"active":"inactive","data-disabled":e?"":void 0,disabled:e,id:i,...f,ref:b,onMouseDown:kT(a.onMouseDown,a=>{e||0!==a.button||!1!==a.ctrlKey?a.preventDefault():g.onValueChange(d)}),onKeyDown:kT(a.onKeyDown,a=>{[" ","Enter"].includes(a.key)&&g.onValueChange(d)}),onFocus:kT(a.onFocus,()=>{let a="manual"!==g.activationMode;k||e||!a||g.onValueChange(d)})})})});lE.displayName=lD;var lF="TabsContent",lG=m.forwardRef((a,b)=>{let{__scopeTabs:c,value:d,forceMount:e,children:f,...g}=a,h=lA(lF,c),i=lH(h.baseId,d),j=lI(h.baseId,d),k=d===h.value,n=m.useRef(k);return m.useEffect(()=>{let a=requestAnimationFrame(()=>n.current=!1);return()=>cancelAnimationFrame(a)},[]),(0,l.jsx)(lt,{present:e||k,children:({present:c})=>(0,l.jsx)(k7.div,{"data-state":k?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":i,hidden:!c,id:j,tabIndex:0,...g,ref:b,style:{...a.style,animationDuration:n.current?"0s":void 0},children:c&&f})})});function lH(a,b){return`${a}-trigger-${b}`}function lI(a,b){return`${a}-content-${b}`}function lJ(a){let b=m.useRef({value:a,previous:a});return m.useMemo(()=>(b.current.value!==a&&(b.current.previous=b.current.value,b.current.value=a),b.current.previous),[a])}function lK(a){let[b,c]=m.useState(void 0);return k0(()=>{if(a){c({width:a.offsetWidth,height:a.offsetHeight});let b=new ResizeObserver(b=>{let d,e;if(!Array.isArray(b)||!b.length)return;let f=b[0];if("borderBoxSize"in f){let a=f.borderBoxSize,b=Array.isArray(a)?a[0]:a;d=b.inlineSize,e=b.blockSize}else d=a.offsetWidth,e=a.offsetHeight;c({width:d,height:e})});return b.observe(a,{box:"border-box"}),()=>b.unobserve(a)}c(void 0)},[a]),b}lG.displayName=lF,m.forwardRef(({className:a,...b},c)=>(0,l.jsx)(lC,{ref:c,className:kA("inline-flex h-auto items-center justify-start gap-1 rounded-lg bg-emblem-surface-2/50 p-1 text-emblem-muted",a),...b})).displayName=lC.displayName,m.forwardRef(({className:a,...b},c)=>(0,l.jsx)(lE,{ref:c,className:kA("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all","focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-emblem-primary","disabled:pointer-events-none disabled:opacity-50","data-[state=active]:bg-emblem-primary/20 data-[state=active]:text-emblem-text data-[state=active]:shadow-sm","data-[state=inactive]:hover:bg-emblem-surface-2 data-[state=inactive]:hover:text-emblem-text",a),...b})).displayName=lE.displayName,m.forwardRef(({className:a,...b},c)=>(0,l.jsx)(lG,{ref:c,className:kA("mt-2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-emblem-primary",a),...b})).displayName=lG.displayName;var lL="Switch",[lM,lN]=kU(lL),[lO,lP]=lM(lL),lQ=m.forwardRef((a,b)=>{let{__scopeSwitch:c,name:d,checked:e,defaultChecked:f,required:g,disabled:h,value:i="on",onCheckedChange:j,form:k,...n}=a,[o,p]=m.useState(null),q=kI(b,a=>p(a)),r=m.useRef(!1),s=!o||k||!!o.closest("form"),[t,u]=la({prop:e,defaultProp:f??!1,onChange:j,caller:lL});return(0,l.jsxs)(lO,{scope:c,checked:t,disabled:h,children:[(0,l.jsx)(k7.button,{type:"button",role:"switch","aria-checked":t,"aria-required":g,"data-state":lU(t),"data-disabled":h?"":void 0,disabled:h,value:i,...n,ref:q,onClick:kT(a.onClick,a=>{u(a=>!a),s&&(r.current=a.isPropagationStopped(),r.current||a.stopPropagation())})}),s&&(0,l.jsx)(lT,{control:o,bubbles:!r.current,name:d,value:i,checked:t,required:g,disabled:h,form:k,style:{transform:"translateX(-100%)"}})]})});lQ.displayName=lL;var lR="SwitchThumb",lS=m.forwardRef((a,b)=>{let{__scopeSwitch:c,...d}=a,e=lP(lR,c);return(0,l.jsx)(k7.span,{"data-state":lU(e.checked),"data-disabled":e.disabled?"":void 0,...d,ref:b})});lS.displayName=lR;var lT=m.forwardRef(({__scopeSwitch:a,control:b,checked:c,bubbles:d=!0,...e},f)=>{let g=m.useRef(null),h=kI(g,f),i=lJ(c),j=lK(b);return m.useEffect(()=>{let a=g.current;if(!a)return;let b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(i!==c&&b){let e=new Event("click",{bubbles:d});b.call(a,c),a.dispatchEvent(e)}},[i,c,d]),(0,l.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:c,...e,tabIndex:-1,ref:h,style:{...e.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function lU(a){return a?"checked":"unchecked"}function lV(a,[b,c]){return Math.min(c,Math.max(b,a))}lT.displayName="SwitchBubbleInput",m.forwardRef(({className:a,...b},c)=>(0,l.jsx)(lQ,{className:kA("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emblem-primary focus-visible:ring-offset-2 focus-visible:ring-offset-emblem-bg","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-emblem-primary data-[state=unchecked]:bg-emblem-surface-2",a),...b,ref:c,children:(0,l.jsx)(lS,{className:kA("pointer-events-none block h-4 w-4 rounded-full bg-white shadow-lg ring-0 transition-transform","data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})).displayName=lQ.displayName;var lW=["PageUp","PageDown"],lX=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],lY={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},lZ="Slider",[l$,l_,l0]=kY(lZ),[l1,l2]=kU(lZ,[l0]),[l3,l4]=l1(lZ),l5=m.forwardRef((a,b)=>{let{name:c,min:d=0,max:e=100,step:f=1,orientation:g="horizontal",disabled:h=!1,minStepsBetweenThumbs:i=0,defaultValue:j=[d],value:k,onValueChange:n=()=>{},onValueCommit:o=()=>{},inverted:p=!1,form:q,...r}=a,s=m.useRef(new Set),t=m.useRef(0),u="horizontal"===g,[v=[],w]=la({prop:k,defaultProp:j,onChange:a=>{let b=[...s.current];b[t.current]?.focus(),n(a)}}),x=m.useRef(v);function y(a,b,{commit:c}={commit:!1}){let g=(String(f).split(".")[1]||"").length,h=lV(function(a,b){let c=Math.pow(10,b);return Math.round(a*c)/c}(Math.round((a-d)/f)*f+d,g),[d,e]);w((a=[])=>{let d=function(a=[],b,c){let d=[...a];return d[c]=b,d.sort((a,b)=>a-b)}(a,h,b);if(!function(a,b){if(b>0)return Math.min(...a.slice(0,-1).map((b,c)=>a[c+1]-b))>=b;return!0}(d,i*f))return a;{t.current=d.indexOf(h);let b=String(d)!==String(a);return b&&c&&o(d),b?d:a}})}return(0,l.jsx)(l3,{scope:a.__scopeSlider,name:c,disabled:h,min:d,max:e,valueIndexToChangeRef:t,thumbs:s.current,values:v,orientation:g,form:q,children:(0,l.jsx)(l$.Provider,{scope:a.__scopeSlider,children:(0,l.jsx)(l$.Slot,{scope:a.__scopeSlider,children:(0,l.jsx)(u?l8:l9,{"aria-disabled":h,"data-disabled":h?"":void 0,...r,ref:b,onPointerDown:kT(r.onPointerDown,()=>{h||(x.current=v)}),min:d,max:e,inverted:p,onSlideStart:h?void 0:function(a){let b=function(a,b){if(1===a.length)return 0;let c=a.map(a=>Math.abs(a-b)),d=Math.min(...c);return c.indexOf(d)}(v,a);y(a,b)},onSlideMove:h?void 0:function(a){y(a,t.current)},onSlideEnd:h?void 0:function(){let a=x.current[t.current];v[t.current]!==a&&o(v)},onHomeKeyDown:()=>!h&&y(d,0,{commit:!0}),onEndKeyDown:()=>!h&&y(e,v.length-1,{commit:!0}),onStepKeyDown:({event:a,direction:b})=>{if(!h){let c=lW.includes(a.key)||a.shiftKey&&lX.includes(a.key),d=t.current;y(v[d]+f*(c?10:1)*b,d,{commit:!0})}}})})})})});l5.displayName=lZ;var[l6,l7]=l1(lZ,{startEdge:"left",endEdge:"right",size:"width",direction:1}),l8=m.forwardRef((a,b)=>{let{min:c,max:d,dir:e,inverted:f,onSlideStart:g,onSlideMove:h,onSlideEnd:i,onStepKeyDown:j,...k}=a,[n,o]=m.useState(null),p=kI(b,a=>o(a)),q=m.useRef(void 0),r=lc(e),s="ltr"===r,t=s&&!f||!s&&f;function u(a){let b=q.current||n.getBoundingClientRect(),e=mk([0,b.width],t?[c,d]:[d,c]);return q.current=b,e(a-b.left)}return(0,l.jsx)(l6,{scope:a.__scopeSlider,startEdge:t?"left":"right",endEdge:t?"right":"left",direction:t?1:-1,size:"width",children:(0,l.jsx)(ma,{dir:r,"data-orientation":"horizontal",...k,ref:p,style:{...k.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:a=>{let b=u(a.clientX);g?.(b)},onSlideMove:a=>{let b=u(a.clientX);h?.(b)},onSlideEnd:()=>{q.current=void 0,i?.()},onStepKeyDown:a=>{let b=lY[t?"from-left":"from-right"].includes(a.key);j?.({event:a,direction:b?-1:1})}})})}),l9=m.forwardRef((a,b)=>{let{min:c,max:d,inverted:e,onSlideStart:f,onSlideMove:g,onSlideEnd:h,onStepKeyDown:i,...j}=a,k=m.useRef(null),n=kI(b,k),o=m.useRef(void 0),p=!e;function q(a){let b=o.current||k.current.getBoundingClientRect(),e=mk([0,b.height],p?[d,c]:[c,d]);return o.current=b,e(a-b.top)}return(0,l.jsx)(l6,{scope:a.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:(0,l.jsx)(ma,{"data-orientation":"vertical",...j,ref:n,style:{...j.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:a=>{let b=q(a.clientY);f?.(b)},onSlideMove:a=>{let b=q(a.clientY);g?.(b)},onSlideEnd:()=>{o.current=void 0,h?.()},onStepKeyDown:a=>{let b=lY[p?"from-bottom":"from-top"].includes(a.key);i?.({event:a,direction:b?-1:1})}})})}),ma=m.forwardRef((a,b)=>{let{__scopeSlider:c,onSlideStart:d,onSlideMove:e,onSlideEnd:f,onHomeKeyDown:g,onEndKeyDown:h,onStepKeyDown:i,...j}=a,k=l4(lZ,c);return(0,l.jsx)(k7.span,{...j,ref:b,onKeyDown:kT(a.onKeyDown,a=>{"Home"===a.key?(g(a),a.preventDefault()):"End"===a.key?(h(a),a.preventDefault()):lW.concat(lX).includes(a.key)&&(i(a),a.preventDefault())}),onPointerDown:kT(a.onPointerDown,a=>{let b=a.target;b.setPointerCapture(a.pointerId),a.preventDefault(),k.thumbs.has(b)?b.focus():d(a)}),onPointerMove:kT(a.onPointerMove,a=>{a.target.hasPointerCapture(a.pointerId)&&e(a)}),onPointerUp:kT(a.onPointerUp,a=>{let b=a.target;b.hasPointerCapture(a.pointerId)&&(b.releasePointerCapture(a.pointerId),f(a))})})}),mb="SliderTrack",mc=m.forwardRef((a,b)=>{let{__scopeSlider:c,...d}=a,e=l4(mb,c);return(0,l.jsx)(k7.span,{"data-disabled":e.disabled?"":void 0,"data-orientation":e.orientation,...d,ref:b})});mc.displayName=mb;var md="SliderRange",me=m.forwardRef((a,b)=>{let{__scopeSlider:c,...d}=a,e=l4(md,c),f=l7(md,c),g=kI(b,m.useRef(null)),h=e.values.length,i=e.values.map(a=>mj(a,e.min,e.max)),j=h>1?Math.min(...i):0,k=100-Math.max(...i);return(0,l.jsx)(k7.span,{"data-orientation":e.orientation,"data-disabled":e.disabled?"":void 0,...d,ref:g,style:{...a.style,[f.startEdge]:j+"%",[f.endEdge]:k+"%"}})});me.displayName=md;var mf="SliderThumb",mg=m.forwardRef((a,b)=>{let c=l_(a.__scopeSlider),[d,e]=m.useState(null),f=kI(b,a=>e(a)),g=m.useMemo(()=>d?c().findIndex(a=>a.ref.current===d):-1,[c,d]);return(0,l.jsx)(mh,{...a,ref:f,index:g})}),mh=m.forwardRef((a,b)=>{let{__scopeSlider:c,index:d,name:e,...f}=a,g=l4(mf,c),h=l7(mf,c),[i,j]=m.useState(null),k=kI(b,a=>j(a)),n=!i||g.form||!!i.closest("form"),o=lK(i),p=g.values[d],q=void 0===p?0:mj(p,g.min,g.max),r=function(a,b){return b>2?`Value ${a+1} of ${b}`:2===b?["Minimum","Maximum"][a]:void 0}(d,g.values.length),s=o?.[h.size],t=s?function(a,b,c){let d=a/2,e=mk([0,50],[0,d]);return(d-e(b)*c)*c}(s,q,h.direction):0;return m.useEffect(()=>{if(i)return g.thumbs.add(i),()=>{g.thumbs.delete(i)}},[i,g.thumbs]),(0,l.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[h.startEdge]:`calc(${q}% + ${t}px)`},children:[(0,l.jsx)(l$.ItemSlot,{scope:a.__scopeSlider,children:(0,l.jsx)(k7.span,{role:"slider","aria-label":a["aria-label"]||r,"aria-valuemin":g.min,"aria-valuenow":p,"aria-valuemax":g.max,"aria-orientation":g.orientation,"data-orientation":g.orientation,"data-disabled":g.disabled?"":void 0,tabIndex:g.disabled?void 0:0,...f,ref:k,style:void 0===p?{display:"none"}:a.style,onFocus:kT(a.onFocus,()=>{g.valueIndexToChangeRef.current=d})})}),n&&(0,l.jsx)(mi,{name:e??(g.name?g.name+(g.values.length>1?"[]":""):void 0),form:g.form,value:p},d)]})});mg.displayName=mf;var mi=m.forwardRef(({__scopeSlider:a,value:b,...c},d)=>{let e=m.useRef(null),f=kI(e,d),g=lJ(b);return m.useEffect(()=>{let a=e.current;if(!a)return;let c=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;if(g!==b&&c){let d=new Event("input",{bubbles:!0});c.call(a,b),a.dispatchEvent(d)}},[g,b]),(0,l.jsx)(k7.input,{style:{display:"none"},...c,ref:f,defaultValue:b})});function mj(a,b,c){return lV(100/(c-b)*(a-b),[0,100])}function mk(a,b){return c=>{if(a[0]===a[1]||b[0]===b[1])return b[0];let d=(b[1]-b[0])/(a[1]-a[0]);return b[0]+d*(c-a[0])}}mi.displayName="RadioBubbleInput";let ml=m.forwardRef(({className:a,...b},c)=>(0,l.jsxs)(l5,{ref:c,className:kA("relative flex w-full touch-none select-none items-center",a),...b,children:[(0,l.jsx)(mc,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-emblem-surface-2",children:(0,l.jsx)(me,{className:"absolute h-full bg-gradient-to-r from-emblem-secondary to-emblem-primary"})}),(0,l.jsx)(mg,{className:"block h-4 w-4 rounded-full border border-emblem-primary/50 bg-emblem-primary shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-emblem-primary disabled:pointer-events-none disabled:opacity-50"})]}));ml.displayName=l5.displayName,kQ("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-emblem-primary focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-emblem-primary text-white",secondary:"border-transparent bg-emblem-surface-2 text-emblem-text",destructive:"border-transparent bg-emblem-danger text-white",outline:"border-emblem-primary/50 text-emblem-text",success:"border-transparent bg-emblem-accent/20 text-emblem-accent",warning:"border-transparent bg-emblem-warning/20 text-emblem-warning"}},defaultVariants:{variant:"default"}});var mm="ScrollArea",[mn,mo]=kU(mm),[mp,mq]=mn(mm),mr=m.forwardRef((a,b)=>{let{__scopeScrollArea:c,type:d="hover",dir:e,scrollHideDelay:f=600,...g}=a,[h,i]=m.useState(null),[j,k]=m.useState(null),[n,o]=m.useState(null),[p,q]=m.useState(null),[r,s]=m.useState(null),[t,u]=m.useState(0),[v,w]=m.useState(0),[x,y]=m.useState(!1),[z,A]=m.useState(!1),B=kI(b,a=>i(a)),C=lc(e);return(0,l.jsx)(mp,{scope:c,type:d,dir:C,scrollHideDelay:f,scrollArea:h,viewport:j,onViewportChange:k,content:n,onContentChange:o,scrollbarX:p,onScrollbarXChange:q,scrollbarXEnabled:x,onScrollbarXEnabledChange:y,scrollbarY:r,onScrollbarYChange:s,scrollbarYEnabled:z,onScrollbarYEnabledChange:A,onCornerWidthChange:u,onCornerHeightChange:w,children:(0,l.jsx)(k7.div,{dir:C,...g,ref:B,style:{position:"relative","--radix-scroll-area-corner-width":t+"px","--radix-scroll-area-corner-height":v+"px",...a.style}})})});mr.displayName=mm;var ms="ScrollAreaViewport",mt=m.forwardRef((a,b)=>{let{__scopeScrollArea:c,children:d,nonce:e,...f}=a,g=mq(ms,c),h=kI(b,m.useRef(null),g.onViewportChange);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:e}),(0,l.jsx)(k7.div,{"data-radix-scroll-area-viewport":"",...f,ref:h,style:{overflowX:g.scrollbarXEnabled?"scroll":"hidden",overflowY:g.scrollbarYEnabled?"scroll":"hidden",...a.style},children:(0,l.jsx)("div",{ref:g.onContentChange,style:{minWidth:"100%",display:"table"},children:d})})]})});mt.displayName=ms;var mu="ScrollAreaScrollbar",mv=m.forwardRef((a,b)=>{let{forceMount:c,...d}=a,e=mq(mu,a.__scopeScrollArea),{onScrollbarXEnabledChange:f,onScrollbarYEnabledChange:g}=e,h="horizontal"===a.orientation;return m.useEffect(()=>(h?f(!0):g(!0),()=>{h?f(!1):g(!1)}),[h,f,g]),"hover"===e.type?(0,l.jsx)(mw,{...d,ref:b,forceMount:c}):"scroll"===e.type?(0,l.jsx)(mx,{...d,ref:b,forceMount:c}):"auto"===e.type?(0,l.jsx)(my,{...d,ref:b,forceMount:c}):"always"===e.type?(0,l.jsx)(mz,{...d,ref:b}):null});mv.displayName=mu;var mw=m.forwardRef((a,b)=>{let{forceMount:c,...d}=a,e=mq(mu,a.__scopeScrollArea),[f,g]=m.useState(!1);return m.useEffect(()=>{let a=e.scrollArea,b=0;if(a){let c=()=>{window.clearTimeout(b),g(!0)},d=()=>{b=window.setTimeout(()=>g(!1),e.scrollHideDelay)};return a.addEventListener("pointerenter",c),a.addEventListener("pointerleave",d),()=>{window.clearTimeout(b),a.removeEventListener("pointerenter",c),a.removeEventListener("pointerleave",d)}}},[e.scrollArea,e.scrollHideDelay]),(0,l.jsx)(lt,{present:c||f,children:(0,l.jsx)(my,{"data-state":f?"visible":"hidden",...d,ref:b})})}),mx=m.forwardRef((a,b)=>{var c;let{forceMount:d,...e}=a,f=mq(mu,a.__scopeScrollArea),g="horizontal"===a.orientation,h=mR(()=>j("SCROLL_END"),100),[i,j]=(c={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},m.useReducer((a,b)=>c[a][b]??a,"hidden"));return m.useEffect(()=>{if("idle"===i){let a=window.setTimeout(()=>j("HIDE"),f.scrollHideDelay);return()=>window.clearTimeout(a)}},[i,f.scrollHideDelay,j]),m.useEffect(()=>{let a=f.viewport,b=g?"scrollLeft":"scrollTop";if(a){let c=a[b],d=()=>{let d=a[b];c!==d&&(j("SCROLL"),h()),c=d};return a.addEventListener("scroll",d),()=>a.removeEventListener("scroll",d)}},[f.viewport,g,j,h]),(0,l.jsx)(lt,{present:d||"hidden"!==i,children:(0,l.jsx)(mz,{"data-state":"hidden"===i?"hidden":"visible",...e,ref:b,onPointerEnter:kT(a.onPointerEnter,()=>j("POINTER_ENTER")),onPointerLeave:kT(a.onPointerLeave,()=>j("POINTER_LEAVE"))})})}),my=m.forwardRef((a,b)=>{let c=mq(mu,a.__scopeScrollArea),{forceMount:d,...e}=a,[f,g]=m.useState(!1),h="horizontal"===a.orientation,i=mR(()=>{if(c.viewport){let a=c.viewport.offsetWidth<c.viewport.scrollWidth,b=c.viewport.offsetHeight<c.viewport.scrollHeight;g(h?a:b)}},10);return mS(c.viewport,i),mS(c.content,i),(0,l.jsx)(lt,{present:d||f,children:(0,l.jsx)(mz,{"data-state":f?"visible":"hidden",...e,ref:b})})}),mz=m.forwardRef((a,b)=>{let{orientation:c="vertical",...d}=a,e=mq(mu,a.__scopeScrollArea),f=m.useRef(null),g=m.useRef(0),[h,i]=m.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),j=mM(h.viewport,h.content),k={...d,sizes:h,onSizesChange:i,hasThumb:!!(j>0&&j<1),onThumbChange:a=>f.current=a,onThumbPointerUp:()=>g.current=0,onThumbPointerDown:a=>g.current=a};function n(a,b){return function(a,b,c,d="ltr"){let e=mN(c),f=b||e/2,g=c.scrollbar.paddingStart+f,h=c.scrollbar.size-c.scrollbar.paddingEnd-(e-f),i=c.content-c.viewport;return mP([g,h],"ltr"===d?[0,i]:[-1*i,0])(a)}(a,g.current,h,b)}return"horizontal"===c?(0,l.jsx)(mA,{...k,ref:b,onThumbPositionChange:()=>{if(e.viewport&&f.current){let a=mO(e.viewport.scrollLeft,h,e.dir);f.current.style.transform=`translate3d(${a}px, 0, 0)`}},onWheelScroll:a=>{e.viewport&&(e.viewport.scrollLeft=a)},onDragScroll:a=>{e.viewport&&(e.viewport.scrollLeft=n(a,e.dir))}}):"vertical"===c?(0,l.jsx)(mB,{...k,ref:b,onThumbPositionChange:()=>{if(e.viewport&&f.current){let a=mO(e.viewport.scrollTop,h);f.current.style.transform=`translate3d(0, ${a}px, 0)`}},onWheelScroll:a=>{e.viewport&&(e.viewport.scrollTop=a)},onDragScroll:a=>{e.viewport&&(e.viewport.scrollTop=n(a))}}):null}),mA=m.forwardRef((a,b)=>{let{sizes:c,onSizesChange:d,...e}=a,f=mq(mu,a.__scopeScrollArea),[g,h]=m.useState(),i=m.useRef(null),j=kI(b,i,f.onScrollbarXChange);return m.useEffect(()=>{i.current&&h(getComputedStyle(i.current))},[i]),(0,l.jsx)(mE,{"data-orientation":"horizontal",...e,ref:j,sizes:c,style:{bottom:0,left:"rtl"===f.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===f.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":mN(c)+"px",...a.style},onThumbPointerDown:b=>a.onThumbPointerDown(b.x),onDragScroll:b=>a.onDragScroll(b.x),onWheelScroll:(b,c)=>{if(f.viewport){let d=f.viewport.scrollLeft+b.deltaX;a.onWheelScroll(d),function(a,b){return a>0&&a<b}(d,c)&&b.preventDefault()}},onResize:()=>{i.current&&f.viewport&&g&&d({content:f.viewport.scrollWidth,viewport:f.viewport.offsetWidth,scrollbar:{size:i.current.clientWidth,paddingStart:mL(g.paddingLeft),paddingEnd:mL(g.paddingRight)}})}})}),mB=m.forwardRef((a,b)=>{let{sizes:c,onSizesChange:d,...e}=a,f=mq(mu,a.__scopeScrollArea),[g,h]=m.useState(),i=m.useRef(null),j=kI(b,i,f.onScrollbarYChange);return m.useEffect(()=>{i.current&&h(getComputedStyle(i.current))},[i]),(0,l.jsx)(mE,{"data-orientation":"vertical",...e,ref:j,sizes:c,style:{top:0,right:"ltr"===f.dir?0:void 0,left:"rtl"===f.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":mN(c)+"px",...a.style},onThumbPointerDown:b=>a.onThumbPointerDown(b.y),onDragScroll:b=>a.onDragScroll(b.y),onWheelScroll:(b,c)=>{if(f.viewport){let d=f.viewport.scrollTop+b.deltaY;a.onWheelScroll(d),function(a,b){return a>0&&a<b}(d,c)&&b.preventDefault()}},onResize:()=>{i.current&&f.viewport&&g&&d({content:f.viewport.scrollHeight,viewport:f.viewport.offsetHeight,scrollbar:{size:i.current.clientHeight,paddingStart:mL(g.paddingTop),paddingEnd:mL(g.paddingBottom)}})}})}),[mC,mD]=mn(mu),mE=m.forwardRef((a,b)=>{let{__scopeScrollArea:c,sizes:d,hasThumb:e,onThumbChange:f,onThumbPointerUp:g,onThumbPointerDown:h,onThumbPositionChange:i,onDragScroll:j,onWheelScroll:k,onResize:n,...o}=a,p=mq(mu,c),[q,r]=m.useState(null),s=kI(b,a=>r(a)),t=m.useRef(null),u=m.useRef(""),v=p.viewport,w=d.content-d.viewport,x=k8(k),y=k8(i),z=mR(n,10);function A(a){t.current&&j({x:a.clientX-t.current.left,y:a.clientY-t.current.top})}return m.useEffect(()=>{let a=a=>{let b=a.target;q?.contains(b)&&x(a,w)};return document.addEventListener("wheel",a,{passive:!1}),()=>document.removeEventListener("wheel",a,{passive:!1})},[v,q,w,x]),m.useEffect(y,[d,y]),mS(q,z),mS(p.content,z),(0,l.jsx)(mC,{scope:c,scrollbar:q,hasThumb:e,onThumbChange:k8(f),onThumbPointerUp:k8(g),onThumbPositionChange:y,onThumbPointerDown:k8(h),children:(0,l.jsx)(k7.div,{...o,ref:s,style:{position:"absolute",...o.style},onPointerDown:kT(a.onPointerDown,a=>{0===a.button&&(a.target.setPointerCapture(a.pointerId),t.current=q.getBoundingClientRect(),u.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),A(a))}),onPointerMove:kT(a.onPointerMove,A),onPointerUp:kT(a.onPointerUp,a=>{let b=a.target;b.hasPointerCapture(a.pointerId)&&b.releasePointerCapture(a.pointerId),document.body.style.webkitUserSelect=u.current,p.viewport&&(p.viewport.style.scrollBehavior=""),t.current=null})})})}),mF="ScrollAreaThumb",mG=m.forwardRef((a,b)=>{let{forceMount:c,...d}=a,e=mD(mF,a.__scopeScrollArea);return(0,l.jsx)(lt,{present:c||e.hasThumb,children:(0,l.jsx)(mH,{ref:b,...d})})}),mH=m.forwardRef((a,b)=>{let{__scopeScrollArea:c,style:d,...e}=a,f=mq(mF,c),g=mD(mF,c),{onThumbPositionChange:h}=g,i=kI(b,a=>g.onThumbChange(a)),j=m.useRef(void 0),k=mR(()=>{j.current&&(j.current(),j.current=void 0)},100);return m.useEffect(()=>{let a=f.viewport;if(a){let b=()=>{k(),j.current||(j.current=mQ(a,h),h())};return h(),a.addEventListener("scroll",b),()=>a.removeEventListener("scroll",b)}},[f.viewport,k,h]),(0,l.jsx)(k7.div,{"data-state":g.hasThumb?"visible":"hidden",...e,ref:i,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...d},onPointerDownCapture:kT(a.onPointerDownCapture,a=>{let b=a.target.getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top;g.onThumbPointerDown({x:c,y:d})}),onPointerUp:kT(a.onPointerUp,g.onThumbPointerUp)})});mG.displayName=mF;var mI="ScrollAreaCorner",mJ=m.forwardRef((a,b)=>{let c=mq(mI,a.__scopeScrollArea),d=!!(c.scrollbarX&&c.scrollbarY);return"scroll"!==c.type&&d?(0,l.jsx)(mK,{...a,ref:b}):null});mJ.displayName=mI;var mK=m.forwardRef((a,b)=>{let{__scopeScrollArea:c,...d}=a,e=mq(mI,c),[f,g]=m.useState(0),[h,i]=m.useState(0),j=!!(f&&h);return mS(e.scrollbarX,()=>{let a=e.scrollbarX?.offsetHeight||0;e.onCornerHeightChange(a),i(a)}),mS(e.scrollbarY,()=>{let a=e.scrollbarY?.offsetWidth||0;e.onCornerWidthChange(a),g(a)}),j?(0,l.jsx)(k7.div,{...d,ref:b,style:{width:f,height:h,position:"absolute",right:"ltr"===e.dir?0:void 0,left:"rtl"===e.dir?0:void 0,bottom:0,...a.style}}):null});function mL(a){return a?parseInt(a,10):0}function mM(a,b){let c=a/b;return isNaN(c)?0:c}function mN(a){let b=mM(a.viewport,a.content),c=a.scrollbar.paddingStart+a.scrollbar.paddingEnd;return Math.max((a.scrollbar.size-c)*b,18)}function mO(a,b,c="ltr"){let d=mN(b),e=b.scrollbar.paddingStart+b.scrollbar.paddingEnd,f=b.scrollbar.size-e,g=b.content-b.viewport,h=lV(a,"ltr"===c?[0,g]:[-1*g,0]);return mP([0,g],[0,f-d])(h)}function mP(a,b){return c=>{if(a[0]===a[1]||b[0]===b[1])return b[0];let d=(b[1]-b[0])/(a[1]-a[0]);return b[0]+d*(c-a[0])}}var mQ=(a,b=()=>{})=>{let c={left:a.scrollLeft,top:a.scrollTop},d=0;return!function e(){let f={left:a.scrollLeft,top:a.scrollTop},g=c.left!==f.left,h=c.top!==f.top;(g||h)&&b(),c=f,d=window.requestAnimationFrame(e)}(),()=>window.cancelAnimationFrame(d)};function mR(a,b){let c=k8(a),d=m.useRef(0);return m.useEffect(()=>()=>window.clearTimeout(d.current),[]),m.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(c,b)},[c,b])}function mS(a,b){let c=k8(b);k0(()=>{let b=0;if(a){let d=new ResizeObserver(()=>{cancelAnimationFrame(b),b=window.requestAnimationFrame(c)});return d.observe(a),()=>{window.cancelAnimationFrame(b),d.unobserve(a)}}},[a,c])}m.forwardRef(({className:a,children:b,...c},d)=>(0,l.jsxs)(mr,{ref:d,className:kA("relative overflow-hidden",a),...c,children:[(0,l.jsx)(mt,{className:"h-full w-full rounded-[inherit]",children:b}),(0,l.jsx)(mT,{}),(0,l.jsx)(mJ,{})]})).displayName=mr.displayName;let mT=m.forwardRef(({className:a,orientation:b="vertical",...c},d)=>(0,l.jsx)(mv,{ref:d,orientation:b,className:kA("flex touch-none select-none transition-colors","vertical"===b&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===b&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...c,children:(0,l.jsx)(mG,{className:"relative flex-1 rounded-full bg-emblem-primary/30 hover:bg-emblem-primary/50 transition-colors"})}));mT.displayName=mv.displayName;var mU="dismissableLayer.update",mV=m.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),mW=m.forwardRef((a,b)=>{let{disableOutsidePointerEvents:c=!1,onEscapeKeyDown:d,onPointerDownOutside:e,onFocusOutside:f,onInteractOutside:g,onDismiss:h,...i}=a,j=m.useContext(mV),[k,n]=m.useState(null),o=k?.ownerDocument??globalThis?.document,[,p]=m.useState({}),q=kI(b,a=>n(a)),r=Array.from(j.layers),[s]=[...j.layersWithOutsidePointerEventsDisabled].slice(-1),t=r.indexOf(s),u=k?r.indexOf(k):-1,v=j.layersWithOutsidePointerEventsDisabled.size>0,w=u>=t,x=function(a,b=globalThis?.document){let c=k8(a),d=m.useRef(!1),e=m.useRef(()=>{});return m.useEffect(()=>{let a=a=>{if(a.target&&!d.current){let d=function(){mY("dismissableLayer.pointerDownOutside",c,f,{discrete:!0})},f={originalEvent:a};"touch"===a.pointerType?(b.removeEventListener("click",e.current),e.current=d,b.addEventListener("click",e.current,{once:!0})):d()}else b.removeEventListener("click",e.current);d.current=!1},f=window.setTimeout(()=>{b.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(f),b.removeEventListener("pointerdown",a),b.removeEventListener("click",e.current)}},[b,c]),{onPointerDownCapture:()=>d.current=!0}}(a=>{let b=a.target,c=[...j.branches].some(a=>a.contains(b));w&&!c&&(e?.(a),g?.(a),a.defaultPrevented||h?.())},o),y=function(a,b=globalThis?.document){let c=k8(a),d=m.useRef(!1);return m.useEffect(()=>{let a=a=>{a.target&&!d.current&&mY("dismissableLayer.focusOutside",c,{originalEvent:a},{discrete:!1})};return b.addEventListener("focusin",a),()=>b.removeEventListener("focusin",a)},[b,c]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}(a=>{let b=a.target;![...j.branches].some(a=>a.contains(b))&&(f?.(a),g?.(a),a.defaultPrevented||h?.())},o);return!function(a,b=globalThis?.document){let c=k8(a);m.useEffect(()=>{let a=a=>{"Escape"===a.key&&c(a)};return b.addEventListener("keydown",a,{capture:!0}),()=>b.removeEventListener("keydown",a,{capture:!0})},[c,b])}(a=>{u===j.layers.size-1&&(d?.(a),!a.defaultPrevented&&h&&(a.preventDefault(),h()))},o),m.useEffect(()=>{if(k)return c&&(0===j.layersWithOutsidePointerEventsDisabled.size&&(qQ=o.body.style.pointerEvents,o.body.style.pointerEvents="none"),j.layersWithOutsidePointerEventsDisabled.add(k)),j.layers.add(k),mX(),()=>{c&&1===j.layersWithOutsidePointerEventsDisabled.size&&(o.body.style.pointerEvents=qQ)}},[k,o,c,j]),m.useEffect(()=>()=>{k&&(j.layers.delete(k),j.layersWithOutsidePointerEventsDisabled.delete(k),mX())},[k,j]),m.useEffect(()=>{let a=()=>p({});return document.addEventListener(mU,a),()=>document.removeEventListener(mU,a)},[]),(0,l.jsx)(k7.div,{...i,ref:q,style:{pointerEvents:v?w?"auto":"none":void 0,...a.style},onFocusCapture:kT(a.onFocusCapture,y.onFocusCapture),onBlurCapture:kT(a.onBlurCapture,y.onBlurCapture),onPointerDownCapture:kT(a.onPointerDownCapture,x.onPointerDownCapture)})});function mX(){let a=new CustomEvent(mU);document.dispatchEvent(a)}function mY(a,b,c,{discrete:d}){let e=c.originalEvent.target,f=new CustomEvent(a,{bubbles:!1,cancelable:!0,detail:c});if(b&&e.addEventListener(a,b,{once:!0}),d)e&&k4.flushSync(()=>e.dispatchEvent(f));else e.dispatchEvent(f)}mW.displayName="DismissableLayer",m.forwardRef((a,b)=>{let c=m.useContext(mV),d=m.useRef(null),e=kI(b,d);return m.useEffect(()=>{let a=d.current;if(a)return c.branches.add(a),()=>{c.branches.delete(a)}},[c.branches]),(0,l.jsx)(k7.div,{...a,ref:e})}).displayName="DismissableLayerBranch";let mZ=["top","right","bottom","left"],m$=Math.min,m_=Math.max,m0=Math.round,m1=Math.floor,m2=a=>({x:a,y:a}),m3={left:"right",right:"left",bottom:"top",top:"bottom"},m4={start:"end",end:"start"};function m5(a,b){return"function"==typeof a?a(b):a}function m6(a){return a.split("-")[0]}function m7(a){return a.split("-")[1]}function m8(a){return"x"===a?"y":"x"}function m9(a){return"y"===a?"height":"width"}let na=new Set(["top","bottom"]);function nb(a){return na.has(m6(a))?"y":"x"}function nc(a){return a.replace(/start|end/g,a=>m4[a])}let nd=["left","right"],ne=["right","left"],nf=["top","bottom"],ng=["bottom","top"];function nh(a){return a.replace(/left|right|bottom|top/g,a=>m3[a])}function ni(a){return"number"!=typeof a?{top:0,right:0,bottom:0,left:0,...a}:{top:a,right:a,bottom:a,left:a}}function nj(a){let{x:b,y:c,width:d,height:e}=a;return{width:d,height:e,top:c,left:b,right:b+d,bottom:c+e,x:b,y:c}}function nk(a,b,c){let d,{reference:e,floating:f}=a,g=nb(b),h=m8(nb(b)),i=m9(h),j=m6(b),k="y"===g,l=e.x+e.width/2-f.width/2,m=e.y+e.height/2-f.height/2,n=e[i]/2-f[i]/2;switch(j){case"top":d={x:l,y:e.y-f.height};break;case"bottom":d={x:l,y:e.y+e.height};break;case"right":d={x:e.x+e.width,y:m};break;case"left":d={x:e.x-f.width,y:m};break;default:d={x:e.x,y:e.y}}switch(m7(b)){case"start":d[h]-=n*(c&&k?-1:1);break;case"end":d[h]+=n*(c&&k?-1:1)}return d}let nl=async(a,b,c)=>{let{placement:d="bottom",strategy:e="absolute",middleware:f=[],platform:g}=c,h=f.filter(Boolean),i=await (null==g.isRTL?void 0:g.isRTL(b)),j=await g.getElementRects({reference:a,floating:b,strategy:e}),{x:k,y:l}=nk(j,d,i),m=d,n={},o=0;for(let c=0;c<h.length;c++){let{name:f,fn:p}=h[c],{x:q,y:r,data:s,reset:t}=await p({x:k,y:l,initialPlacement:d,placement:m,strategy:e,middlewareData:n,rects:j,platform:g,elements:{reference:a,floating:b}});k=null!=q?q:k,l=null!=r?r:l,n={...n,[f]:{...n[f],...s}},t&&o<=50&&(o++,"object"==typeof t&&(t.placement&&(m=t.placement),t.rects&&(j=!0===t.rects?await g.getElementRects({reference:a,floating:b,strategy:e}):t.rects),{x:k,y:l}=nk(j,m,i)),c=-1)}return{x:k,y:l,placement:m,strategy:e,middlewareData:n}};async function nm(a,b){var c;void 0===b&&(b={});let{x:d,y:e,platform:f,rects:g,elements:h,strategy:i}=a,{boundary:j="clippingAncestors",rootBoundary:k="viewport",elementContext:l="floating",altBoundary:m=!1,padding:n=0}=m5(b,a),o=ni(n),p=h[m?"floating"===l?"reference":"floating":l],q=nj(await f.getClippingRect({element:null==(c=await (null==f.isElement?void 0:f.isElement(p)))||c?p:p.contextElement||await (null==f.getDocumentElement?void 0:f.getDocumentElement(h.floating)),boundary:j,rootBoundary:k,strategy:i})),r="floating"===l?{x:d,y:e,width:g.floating.width,height:g.floating.height}:g.reference,s=await (null==f.getOffsetParent?void 0:f.getOffsetParent(h.floating)),t=await (null==f.isElement?void 0:f.isElement(s))&&await (null==f.getScale?void 0:f.getScale(s))||{x:1,y:1},u=nj(f.convertOffsetParentRelativeRectToViewportRelativeRect?await f.convertOffsetParentRelativeRectToViewportRelativeRect({elements:h,rect:r,offsetParent:s,strategy:i}):r);return{top:(q.top-u.top+o.top)/t.y,bottom:(u.bottom-q.bottom+o.bottom)/t.y,left:(q.left-u.left+o.left)/t.x,right:(u.right-q.right+o.right)/t.x}}function nn(a,b){return{top:a.top-b.height,right:a.right-b.width,bottom:a.bottom-b.height,left:a.left-b.width}}function no(a){return mZ.some(b=>a[b]>=0)}let np=new Set(["left","top"]);async function nq(a,b){let{placement:c,platform:d,elements:e}=a,f=await (null==d.isRTL?void 0:d.isRTL(e.floating)),g=m6(c),h=m7(c),i="y"===nb(c),j=np.has(g)?-1:1,k=f&&i?-1:1,l=m5(b,a),{mainAxis:m,crossAxis:n,alignmentAxis:o}="number"==typeof l?{mainAxis:l,crossAxis:0,alignmentAxis:null}:{mainAxis:l.mainAxis||0,crossAxis:l.crossAxis||0,alignmentAxis:l.alignmentAxis};return h&&"number"==typeof o&&(n="end"===h?-1*o:o),i?{x:n*k,y:m*j}:{x:m*j,y:n*k}}function nr(){return"undefined"!=typeof window}function ns(a){return nv(a)?(a.nodeName||"").toLowerCase():"#document"}function nt(a){var b;return(null==a||null==(b=a.ownerDocument)?void 0:b.defaultView)||window}function nu(a){var b;return null==(b=(nv(a)?a.ownerDocument:a.document)||window.document)?void 0:b.documentElement}function nv(a){return!!nr()&&(a instanceof Node||a instanceof nt(a).Node)}function nw(a){return!!nr()&&(a instanceof Element||a instanceof nt(a).Element)}function nx(a){return!!nr()&&(a instanceof HTMLElement||a instanceof nt(a).HTMLElement)}function ny(a){return!!nr()&&"undefined"!=typeof ShadowRoot&&(a instanceof ShadowRoot||a instanceof nt(a).ShadowRoot)}let nz=new Set(["inline","contents"]);function nA(a){let{overflow:b,overflowX:c,overflowY:d,display:e}=nL(a);return/auto|scroll|overlay|hidden|clip/.test(b+d+c)&&!nz.has(e)}let nB=new Set(["table","td","th"]),nC=[":popover-open",":modal"];function nD(a){return nC.some(b=>{try{return a.matches(b)}catch(a){return!1}})}let nE=["transform","translate","scale","rotate","perspective"],nF=["transform","translate","scale","rotate","perspective","filter"],nG=["paint","layout","strict","content"];function nH(a){let b=nI(),c=nw(a)?nL(a):a;return nE.some(a=>!!c[a]&&"none"!==c[a])||!!c.containerType&&"normal"!==c.containerType||!b&&!!c.backdropFilter&&"none"!==c.backdropFilter||!b&&!!c.filter&&"none"!==c.filter||nF.some(a=>(c.willChange||"").includes(a))||nG.some(a=>(c.contain||"").includes(a))}function nI(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}let nJ=new Set(["html","body","#document"]);function nK(a){return nJ.has(ns(a))}function nL(a){return nt(a).getComputedStyle(a)}function nM(a){return nw(a)?{scrollLeft:a.scrollLeft,scrollTop:a.scrollTop}:{scrollLeft:a.scrollX,scrollTop:a.scrollY}}function nN(a){if("html"===ns(a))return a;let b=a.assignedSlot||a.parentNode||ny(a)&&a.host||nu(a);return ny(b)?b.host:b}function nO(a,b,c){var d;void 0===b&&(b=[]),void 0===c&&(c=!0);let e=function a(b){let c=nN(b);return nK(c)?b.ownerDocument?b.ownerDocument.body:b.body:nx(c)&&nA(c)?c:a(c)}(a),f=e===(null==(d=a.ownerDocument)?void 0:d.body),g=nt(e);if(f){let a=nP(g);return b.concat(g,g.visualViewport||[],nA(e)?e:[],a&&c?nO(a):[])}return b.concat(e,nO(e,[],c))}function nP(a){return a.parent&&Object.getPrototypeOf(a.parent)?a.frameElement:null}function nQ(a){let b=nL(a),c=parseFloat(b.width)||0,d=parseFloat(b.height)||0,e=nx(a),f=e?a.offsetWidth:c,g=e?a.offsetHeight:d,h=m0(c)!==f||m0(d)!==g;return h&&(c=f,d=g),{width:c,height:d,$:h}}function nR(a){return nw(a)?a:a.contextElement}function nS(a){let b=nR(a);if(!nx(b))return m2(1);let c=b.getBoundingClientRect(),{width:d,height:e,$:f}=nQ(b),g=(f?m0(c.width):c.width)/d,h=(f?m0(c.height):c.height)/e;return g&&Number.isFinite(g)||(g=1),h&&Number.isFinite(h)||(h=1),{x:g,y:h}}let nT=m2(0);function nU(a){let b=nt(a);return nI()&&b.visualViewport?{x:b.visualViewport.offsetLeft,y:b.visualViewport.offsetTop}:nT}function nV(a,b,c,d){var e;void 0===b&&(b=!1),void 0===c&&(c=!1);let f=a.getBoundingClientRect(),g=nR(a),h=m2(1);b&&(d?nw(d)&&(h=nS(d)):h=nS(a));let i=(void 0===(e=c)&&(e=!1),d&&(!e||d===nt(g))&&e)?nU(g):m2(0),j=(f.left+i.x)/h.x,k=(f.top+i.y)/h.y,l=f.width/h.x,m=f.height/h.y;if(g){let a=nt(g),b=d&&nw(d)?nt(d):d,c=a,e=nP(c);for(;e&&d&&b!==c;){let a=nS(e),b=e.getBoundingClientRect(),d=nL(e),f=b.left+(e.clientLeft+parseFloat(d.paddingLeft))*a.x,g=b.top+(e.clientTop+parseFloat(d.paddingTop))*a.y;j*=a.x,k*=a.y,l*=a.x,m*=a.y,j+=f,k+=g,e=nP(c=nt(e))}}return nj({width:l,height:m,x:j,y:k})}function nW(a,b){let c=nM(a).scrollLeft;return b?b.left+c:nV(nu(a)).left+c}function nX(a,b){let c=a.getBoundingClientRect();return{x:c.left+b.scrollLeft-nW(a,c),y:c.top+b.scrollTop}}let nY=new Set(["absolute","fixed"]);function nZ(a,b,c){let d;if("viewport"===b)d=function(a,b){let c=nt(a),d=nu(a),e=c.visualViewport,f=d.clientWidth,g=d.clientHeight,h=0,i=0;if(e){f=e.width,g=e.height;let a=nI();(!a||a&&"fixed"===b)&&(h=e.offsetLeft,i=e.offsetTop)}let j=nW(d);if(j<=0){let a=d.ownerDocument,b=a.body,c=getComputedStyle(b),e="CSS1Compat"===a.compatMode&&parseFloat(c.marginLeft)+parseFloat(c.marginRight)||0,g=Math.abs(d.clientWidth-b.clientWidth-e);g<=25&&(f-=g)}else j<=25&&(f+=j);return{width:f,height:g,x:h,y:i}}(a,c);else if("document"===b)d=function(a){let b=nu(a),c=nM(a),d=a.ownerDocument.body,e=m_(b.scrollWidth,b.clientWidth,d.scrollWidth,d.clientWidth),f=m_(b.scrollHeight,b.clientHeight,d.scrollHeight,d.clientHeight),g=-c.scrollLeft+nW(a),h=-c.scrollTop;return"rtl"===nL(d).direction&&(g+=m_(b.clientWidth,d.clientWidth)-e),{width:e,height:f,x:g,y:h}}(nu(a));else if(nw(b))d=function(a,b){let c=nV(a,!0,"fixed"===b),d=c.top+a.clientTop,e=c.left+a.clientLeft,f=nx(a)?nS(a):m2(1),g=a.clientWidth*f.x,h=a.clientHeight*f.y;return{width:g,height:h,x:e*f.x,y:d*f.y}}(b,c);else{let c=nU(a);d={x:b.x-c.x,y:b.y-c.y,width:b.width,height:b.height}}return nj(d)}function n$(a){return"static"===nL(a).position}function n_(a,b){if(!nx(a)||"fixed"===nL(a).position)return null;if(b)return b(a);let c=a.offsetParent;return nu(a)===c&&(c=c.ownerDocument.body),c}function n0(a,b){var c;let d=nt(a);if(nD(a))return d;if(!nx(a)){let b=nN(a);for(;b&&!nK(b);){if(nw(b)&&!n$(b))return b;b=nN(b)}return d}let e=n_(a,b);for(;e&&(c=e,nB.has(ns(c)))&&n$(e);)e=n_(e,b);return e&&nK(e)&&n$(e)&&!nH(e)?d:e||function(a){let b=nN(a);for(;nx(b)&&!nK(b);){if(nH(b))return b;if(nD(b))break;b=nN(b)}return null}(a)||d}let n1=async function(a){let b=this.getOffsetParent||n0,c=this.getDimensions,d=await c(a.floating);return{reference:function(a,b,c){let d=nx(b),e=nu(b),f="fixed"===c,g=nV(a,!0,f,b),h={scrollLeft:0,scrollTop:0},i=m2(0);if(d||!d&&!f)if(("body"!==ns(b)||nA(e))&&(h=nM(b)),d){let a=nV(b,!0,f,b);i.x=a.x+b.clientLeft,i.y=a.y+b.clientTop}else e&&(i.x=nW(e));f&&!d&&e&&(i.x=nW(e));let j=!e||d||f?m2(0):nX(e,h);return{x:g.left+h.scrollLeft-i.x-j.x,y:g.top+h.scrollTop-i.y-j.y,width:g.width,height:g.height}}(a.reference,await b(a.floating),a.strategy),floating:{x:0,y:0,width:d.width,height:d.height}}},n2={convertOffsetParentRelativeRectToViewportRelativeRect:function(a){let{elements:b,rect:c,offsetParent:d,strategy:e}=a,f="fixed"===e,g=nu(d),h=!!b&&nD(b.floating);if(d===g||h&&f)return c;let i={scrollLeft:0,scrollTop:0},j=m2(1),k=m2(0),l=nx(d);if((l||!l&&!f)&&(("body"!==ns(d)||nA(g))&&(i=nM(d)),nx(d))){let a=nV(d);j=nS(d),k.x=a.x+d.clientLeft,k.y=a.y+d.clientTop}let m=!g||l||f?m2(0):nX(g,i);return{width:c.width*j.x,height:c.height*j.y,x:c.x*j.x-i.scrollLeft*j.x+k.x+m.x,y:c.y*j.y-i.scrollTop*j.y+k.y+m.y}},getDocumentElement:nu,getClippingRect:function(a){let{element:b,boundary:c,rootBoundary:d,strategy:e}=a,f=[..."clippingAncestors"===c?nD(b)?[]:function(a,b){let c=b.get(a);if(c)return c;let d=nO(a,[],!1).filter(a=>nw(a)&&"body"!==ns(a)),e=null,f="fixed"===nL(a).position,g=f?nN(a):a;for(;nw(g)&&!nK(g);){let b=nL(g),c=nH(g);c||"fixed"!==b.position||(e=null),(f?!c&&!e:!c&&"static"===b.position&&!!e&&nY.has(e.position)||nA(g)&&!c&&function a(b,c){let d=nN(b);return!(d===c||!nw(d)||nK(d))&&("fixed"===nL(d).position||a(d,c))}(a,g))?d=d.filter(a=>a!==g):e=b,g=nN(g)}return b.set(a,d),d}(b,this._c):[].concat(c),d],g=f[0],h=f.reduce((a,c)=>{let d=nZ(b,c,e);return a.top=m_(d.top,a.top),a.right=m$(d.right,a.right),a.bottom=m$(d.bottom,a.bottom),a.left=m_(d.left,a.left),a},nZ(b,g,e));return{width:h.right-h.left,height:h.bottom-h.top,x:h.left,y:h.top}},getOffsetParent:n0,getElementRects:n1,getClientRects:function(a){return Array.from(a.getClientRects())},getDimensions:function(a){let{width:b,height:c}=nQ(a);return{width:b,height:c}},getScale:nS,isElement:nw,isRTL:function(a){return"rtl"===nL(a).direction}};function n3(a,b){return a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height}let n4=a=>({name:"arrow",options:a,async fn(b){let{x:c,y:d,placement:e,rects:f,platform:g,elements:h,middlewareData:i}=b,{element:j,padding:k=0}=m5(a,b)||{};if(null==j)return{};let l=ni(k),m={x:c,y:d},n=m8(nb(e)),o=m9(n),p=await g.getDimensions(j),q="y"===n,r=q?"clientHeight":"clientWidth",s=f.reference[o]+f.reference[n]-m[n]-f.floating[o],t=m[n]-f.reference[n],u=await (null==g.getOffsetParent?void 0:g.getOffsetParent(j)),v=u?u[r]:0;v&&await (null==g.isElement?void 0:g.isElement(u))||(v=h.floating[r]||f.floating[o]);let w=v/2-p[o]/2-1,x=m$(l[q?"top":"left"],w),y=m$(l[q?"bottom":"right"],w),z=v-p[o]-y,A=v/2-p[o]/2+(s/2-t/2),B=m_(x,m$(A,z)),C=!i.arrow&&null!=m7(e)&&A!==B&&f.reference[o]/2-(A<x?x:y)-p[o]/2<0,D=C?A<x?A-x:A-z:0;return{[n]:m[n]+D,data:{[n]:B,centerOffset:A-B-D,...C&&{alignmentOffset:D}},reset:C}}});var n5="undefined"!=typeof document?m.useLayoutEffect:function(){};function n6(a,b){let c,d,e;if(a===b)return!0;if(typeof a!=typeof b)return!1;if("function"==typeof a&&a.toString()===b.toString())return!0;if(a&&b&&"object"==typeof a){if(Array.isArray(a)){if((c=a.length)!==b.length)return!1;for(d=c;0!=d--;)if(!n6(a[d],b[d]))return!1;return!0}if((c=(e=Object.keys(a)).length)!==Object.keys(b).length)return!1;for(d=c;0!=d--;)if(!({}).hasOwnProperty.call(b,e[d]))return!1;for(d=c;0!=d--;){let c=e[d];if(("_owner"!==c||!a.$$typeof)&&!n6(a[c],b[c]))return!1}return!0}return a!=a&&b!=b}function n7(a){return"undefined"==typeof window?1:(a.ownerDocument.defaultView||window).devicePixelRatio||1}function n8(a,b){let c=n7(a);return Math.round(b*c)/c}function n9(a){let b=m.useRef(a);return n5(()=>{b.current=a}),b}var oa=m.forwardRef((a,b)=>{let{children:c,width:d=10,height:e=5,...f}=a;return(0,l.jsx)(k7.svg,{...f,ref:b,width:d,height:e,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:a.asChild?c:(0,l.jsx)("polygon",{points:"0,0 30,0 15,10"})})});oa.displayName="Arrow";var ob="Popper",[oc,od]=kU(ob),[oe,of]=oc(ob),og=a=>{let{__scopePopper:b,children:c}=a,[d,e]=m.useState(null);return(0,l.jsx)(oe,{scope:b,anchor:d,onAnchorChange:e,children:c})};og.displayName=ob;var oh="PopperAnchor",oi=m.forwardRef((a,b)=>{let{__scopePopper:c,virtualRef:d,...e}=a,f=of(oh,c),g=m.useRef(null),h=kI(b,g),i=m.useRef(null);return m.useEffect(()=>{let a=i.current;i.current=d?.current||g.current,a!==i.current&&f.onAnchorChange(i.current)}),d?null:(0,l.jsx)(k7.div,{...e,ref:h})});oi.displayName=oh;var oj="PopperContent",[ok,ol]=oc(oj),om=m.forwardRef((a,b)=>{let{__scopePopper:c,side:d="bottom",sideOffset:e=0,align:f="center",alignOffset:g=0,arrowPadding:h=0,avoidCollisions:i=!0,collisionBoundary:j=[],collisionPadding:k=0,sticky:n="partial",hideWhenDetached:o=!1,updatePositionStrategy:p="optimized",onPlaced:q,...r}=a,s=of(oj,c),[t,u]=m.useState(null),v=kI(b,a=>u(a)),[w,x]=m.useState(null),y=lK(w),z=y?.width??0,A=y?.height??0,B="number"==typeof k?k:{top:0,right:0,bottom:0,left:0,...k},C=Array.isArray(j)?j:[j],D=C.length>0,E={padding:B,boundary:C.filter(oq),altBoundary:D},{refs:F,floatingStyles:G,placement:H,isPositioned:I,middlewareData:J}=function(a){void 0===a&&(a={});let{placement:b="bottom",strategy:c="absolute",middleware:d=[],platform:e,elements:{reference:f,floating:g}={},transform:h=!0,whileElementsMounted:i,open:j}=a,[k,l]=m.useState({x:0,y:0,strategy:c,placement:b,middlewareData:{},isPositioned:!1}),[n,o]=m.useState(d);n6(n,d)||o(d);let[p,q]=m.useState(null),[r,s]=m.useState(null),t=m.useCallback(a=>{a!==x.current&&(x.current=a,q(a))},[]),u=m.useCallback(a=>{a!==y.current&&(y.current=a,s(a))},[]),v=f||p,w=g||r,x=m.useRef(null),y=m.useRef(null),z=m.useRef(k),A=null!=i,B=n9(i),C=n9(e),D=n9(j),E=m.useCallback(()=>{if(!x.current||!y.current)return;let a={placement:b,strategy:c,middleware:n};C.current&&(a.platform=C.current),((a,b,c)=>{let d=new Map,e={platform:n2,...c},f={...e.platform,_c:d};return nl(a,b,{...e,platform:f})})(x.current,y.current,a).then(a=>{let b={...a,isPositioned:!1!==D.current};F.current&&!n6(z.current,b)&&(z.current=b,k4.flushSync(()=>{l(b)}))})},[n,b,c,C,D]);n5(()=>{!1===j&&z.current.isPositioned&&(z.current.isPositioned=!1,l(a=>({...a,isPositioned:!1})))},[j]);let F=m.useRef(!1);n5(()=>(F.current=!0,()=>{F.current=!1}),[]),n5(()=>{if(v&&(x.current=v),w&&(y.current=w),v&&w){if(B.current)return B.current(v,w,E);E()}},[v,w,E,B,A]);let G=m.useMemo(()=>({reference:x,floating:y,setReference:t,setFloating:u}),[t,u]),H=m.useMemo(()=>({reference:v,floating:w}),[v,w]),I=m.useMemo(()=>{let a={position:c,left:0,top:0};if(!H.floating)return a;let b=n8(H.floating,k.x),d=n8(H.floating,k.y);return h?{...a,transform:"translate("+b+"px, "+d+"px)",...n7(H.floating)>=1.5&&{willChange:"transform"}}:{position:c,left:b,top:d}},[c,h,H.floating,k.x,k.y]);return m.useMemo(()=>({...k,update:E,refs:G,elements:H,floatingStyles:I}),[k,E,G,H,I])}({strategy:"fixed",placement:d+("center"!==f?"-"+f:""),whileElementsMounted:(...a)=>(function(a,b,c,d){let e;void 0===d&&(d={});let{ancestorScroll:f=!0,ancestorResize:g=!0,elementResize:h="function"==typeof ResizeObserver,layoutShift:i="function"==typeof IntersectionObserver,animationFrame:j=!1}=d,k=nR(a),l=f||g?[...k?nO(k):[],...nO(b)]:[];l.forEach(a=>{f&&a.addEventListener("scroll",c,{passive:!0}),g&&a.addEventListener("resize",c)});let m=k&&i?function(a,b){let c,d=null,e=nu(a);function f(){var a;clearTimeout(c),null==(a=d)||a.disconnect(),d=null}return!function g(h,i){void 0===h&&(h=!1),void 0===i&&(i=1),f();let j=a.getBoundingClientRect(),{left:k,top:l,width:m,height:n}=j;if(h||b(),!m||!n)return;let o=m1(l),p=m1(e.clientWidth-(k+m)),q={rootMargin:-o+"px "+-p+"px "+-m1(e.clientHeight-(l+n))+"px "+-m1(k)+"px",threshold:m_(0,m$(1,i))||1},r=!0;function s(b){let d=b[0].intersectionRatio;if(d!==i){if(!r)return g();d?g(!1,d):c=setTimeout(()=>{g(!1,1e-7)},1e3)}1!==d||n3(j,a.getBoundingClientRect())||g(),r=!1}try{d=new IntersectionObserver(s,{...q,root:e.ownerDocument})}catch(a){d=new IntersectionObserver(s,q)}d.observe(a)}(!0),f}(k,c):null,n=-1,o=null;h&&(o=new ResizeObserver(a=>{let[d]=a;d&&d.target===k&&o&&(o.unobserve(b),cancelAnimationFrame(n),n=requestAnimationFrame(()=>{var a;null==(a=o)||a.observe(b)})),c()}),k&&!j&&o.observe(k),o.observe(b));let p=j?nV(a):null;return j&&function b(){let d=nV(a);p&&!n3(p,d)&&c(),p=d,e=requestAnimationFrame(b)}(),c(),()=>{var a;l.forEach(a=>{f&&a.removeEventListener("scroll",c),g&&a.removeEventListener("resize",c)}),null==m||m(),null==(a=o)||a.disconnect(),o=null,j&&cancelAnimationFrame(e)}})(...a,{animationFrame:"always"===p}),elements:{reference:s.anchor},middleware:[((a,b)=>({...function(a){return void 0===a&&(a=0),{name:"offset",options:a,async fn(b){var c,d;let{x:e,y:f,placement:g,middlewareData:h}=b,i=await nq(b,a);return g===(null==(c=h.offset)?void 0:c.placement)&&null!=(d=h.arrow)&&d.alignmentOffset?{}:{x:e+i.x,y:f+i.y,data:{...i,placement:g}}}}}(a),options:[a,b]}))({mainAxis:e+A,alignmentAxis:g}),i&&((a,b)=>({...function(a){return void 0===a&&(a={}),{name:"shift",options:a,async fn(b){let{x:c,y:d,placement:e}=b,{mainAxis:f=!0,crossAxis:g=!1,limiter:h={fn:a=>{let{x:b,y:c}=a;return{x:b,y:c}}},...i}=m5(a,b),j={x:c,y:d},k=await nm(b,i),l=nb(m6(e)),m=m8(l),n=j[m],o=j[l];if(f){let a="y"===m?"top":"left",b="y"===m?"bottom":"right",c=n+k[a],d=n-k[b];n=m_(c,m$(n,d))}if(g){let a="y"===l?"top":"left",b="y"===l?"bottom":"right",c=o+k[a],d=o-k[b];o=m_(c,m$(o,d))}let p=h.fn({...b,[m]:n,[l]:o});return{...p,data:{x:p.x-c,y:p.y-d,enabled:{[m]:f,[l]:g}}}}}}(a),options:[a,b]}))({mainAxis:!0,crossAxis:!1,limiter:"partial"===n?((a,b)=>({...function(a){return void 0===a&&(a={}),{options:a,fn(b){let{x:c,y:d,placement:e,rects:f,middlewareData:g}=b,{offset:h=0,mainAxis:i=!0,crossAxis:j=!0}=m5(a,b),k={x:c,y:d},l=nb(e),m=m8(l),n=k[m],o=k[l],p=m5(h,b),q="number"==typeof p?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(i){let a="y"===m?"height":"width",b=f.reference[m]-f.floating[a]+q.mainAxis,c=f.reference[m]+f.reference[a]-q.mainAxis;n<b?n=b:n>c&&(n=c)}if(j){var r,s;let a="y"===m?"width":"height",b=np.has(m6(e)),c=f.reference[l]-f.floating[a]+(b&&(null==(r=g.offset)?void 0:r[l])||0)+(b?0:q.crossAxis),d=f.reference[l]+f.reference[a]+(b?0:(null==(s=g.offset)?void 0:s[l])||0)-(b?q.crossAxis:0);o<c?o=c:o>d&&(o=d)}return{[m]:n,[l]:o}}}}(a),options:[a,b]}))():void 0,...E}),i&&((a,b)=>({...function(a){return void 0===a&&(a={}),{name:"flip",options:a,async fn(b){var c,d,e,f,g;let{placement:h,middlewareData:i,rects:j,initialPlacement:k,platform:l,elements:m}=b,{mainAxis:n=!0,crossAxis:o=!0,fallbackPlacements:p,fallbackStrategy:q="bestFit",fallbackAxisSideDirection:r="none",flipAlignment:s=!0,...t}=m5(a,b);if(null!=(c=i.arrow)&&c.alignmentOffset)return{};let u=m6(h),v=nb(k),w=m6(k)===k,x=await (null==l.isRTL?void 0:l.isRTL(m.floating)),y=p||(w||!s?[nh(k)]:function(a){let b=nh(a);return[nc(a),b,nc(b)]}(k)),z="none"!==r;!p&&z&&y.push(...function(a,b,c,d){let e=m7(a),f=function(a,b,c){switch(a){case"top":case"bottom":if(c)return b?ne:nd;return b?nd:ne;case"left":case"right":return b?nf:ng;default:return[]}}(m6(a),"start"===c,d);return e&&(f=f.map(a=>a+"-"+e),b&&(f=f.concat(f.map(nc)))),f}(k,s,r,x));let A=[k,...y],B=await nm(b,t),C=[],D=(null==(d=i.flip)?void 0:d.overflows)||[];if(n&&C.push(B[u]),o){let a=function(a,b,c){void 0===c&&(c=!1);let d=m7(a),e=m8(nb(a)),f=m9(e),g="x"===e?d===(c?"end":"start")?"right":"left":"start"===d?"bottom":"top";return b.reference[f]>b.floating[f]&&(g=nh(g)),[g,nh(g)]}(h,j,x);C.push(B[a[0]],B[a[1]])}if(D=[...D,{placement:h,overflows:C}],!C.every(a=>a<=0)){let a=((null==(e=i.flip)?void 0:e.index)||0)+1,b=A[a];if(b&&("alignment"!==o||v===nb(b)||D.every(a=>nb(a.placement)!==v||a.overflows[0]>0)))return{data:{index:a,overflows:D},reset:{placement:b}};let c=null==(f=D.filter(a=>a.overflows[0]<=0).sort((a,b)=>a.overflows[1]-b.overflows[1])[0])?void 0:f.placement;if(!c)switch(q){case"bestFit":{let a=null==(g=D.filter(a=>{if(z){let b=nb(a.placement);return b===v||"y"===b}return!0}).map(a=>[a.placement,a.overflows.filter(a=>a>0).reduce((a,b)=>a+b,0)]).sort((a,b)=>a[1]-b[1])[0])?void 0:g[0];a&&(c=a);break}case"initialPlacement":c=k}if(h!==c)return{reset:{placement:c}}}return{}}}}(a),options:[a,b]}))({...E}),((a,b)=>({...function(a){return void 0===a&&(a={}),{name:"size",options:a,async fn(b){var c,d;let e,f,{placement:g,rects:h,platform:i,elements:j}=b,{apply:k=()=>{},...l}=m5(a,b),m=await nm(b,l),n=m6(g),o=m7(g),p="y"===nb(g),{width:q,height:r}=h.floating;"top"===n||"bottom"===n?(e=n,f=o===(await (null==i.isRTL?void 0:i.isRTL(j.floating))?"start":"end")?"left":"right"):(f=n,e="end"===o?"top":"bottom");let s=r-m.top-m.bottom,t=q-m.left-m.right,u=m$(r-m[e],s),v=m$(q-m[f],t),w=!b.middlewareData.shift,x=u,y=v;if(null!=(c=b.middlewareData.shift)&&c.enabled.x&&(y=t),null!=(d=b.middlewareData.shift)&&d.enabled.y&&(x=s),w&&!o){let a=m_(m.left,0),b=m_(m.right,0),c=m_(m.top,0),d=m_(m.bottom,0);p?y=q-2*(0!==a||0!==b?a+b:m_(m.left,m.right)):x=r-2*(0!==c||0!==d?c+d:m_(m.top,m.bottom))}await k({...b,availableWidth:y,availableHeight:x});let z=await i.getDimensions(j.floating);return q!==z.width||r!==z.height?{reset:{rects:!0}}:{}}}}(a),options:[a,b]}))({...E,apply:({elements:a,rects:b,availableWidth:c,availableHeight:d})=>{let{width:e,height:f}=b.reference,g=a.floating.style;g.setProperty("--radix-popper-available-width",`${c}px`),g.setProperty("--radix-popper-available-height",`${d}px`),g.setProperty("--radix-popper-anchor-width",`${e}px`),g.setProperty("--radix-popper-anchor-height",`${f}px`)}}),w&&((a,b)=>({...(a=>({name:"arrow",options:a,fn(b){let{element:c,padding:d}="function"==typeof a?a(b):a;return c&&({}).hasOwnProperty.call(c,"current")?null!=c.current?n4({element:c.current,padding:d}).fn(b):{}:c?n4({element:c,padding:d}).fn(b):{}}}))(a),options:[a,b]}))({element:w,padding:h}),or({arrowWidth:z,arrowHeight:A}),o&&((a,b)=>({...function(a){return void 0===a&&(a={}),{name:"hide",options:a,async fn(b){let{rects:c}=b,{strategy:d="referenceHidden",...e}=m5(a,b);switch(d){case"referenceHidden":{let a=nn(await nm(b,{...e,elementContext:"reference"}),c.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:no(a)}}}case"escaped":{let a=nn(await nm(b,{...e,altBoundary:!0}),c.floating);return{data:{escapedOffsets:a,escaped:no(a)}}}default:return{}}}}}(a),options:[a,b]}))({strategy:"referenceHidden",...E})]}),[K,L]=os(H),M=k8(q);k0(()=>{I&&M?.()},[I,M]);let N=J.arrow?.x,O=J.arrow?.y,P=J.arrow?.centerOffset!==0,[Q,R]=m.useState();return k0(()=>{t&&R(window.getComputedStyle(t).zIndex)},[t]),(0,l.jsx)("div",{ref:F.setFloating,"data-radix-popper-content-wrapper":"",style:{...G,transform:I?G.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Q,"--radix-popper-transform-origin":[J.transformOrigin?.x,J.transformOrigin?.y].join(" "),...J.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:a.dir,children:(0,l.jsx)(ok,{scope:c,placedSide:K,onArrowChange:x,arrowX:N,arrowY:O,shouldHideArrow:P,children:(0,l.jsx)(k7.div,{"data-side":K,"data-align":L,...r,ref:v,style:{...r.style,animation:I?void 0:"none"}})})})});om.displayName=oj;var on="PopperArrow",oo={top:"bottom",right:"left",bottom:"top",left:"right"},op=m.forwardRef(function(a,b){let{__scopePopper:c,...d}=a,e=ol(on,c),f=oo[e.placedSide];return(0,l.jsx)("span",{ref:e.onArrowChange,style:{position:"absolute",left:e.arrowX,top:e.arrowY,[f]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[e.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[e.placedSide],visibility:e.shouldHideArrow?"hidden":void 0},children:(0,l.jsx)(oa,{...d,ref:b,style:{...d.style,display:"block"}})})});function oq(a){return null!==a}op.displayName=on;var or=a=>({name:"transformOrigin",options:a,fn(b){let{placement:c,rects:d,middlewareData:e}=b,f=e.arrow?.centerOffset!==0,g=f?0:a.arrowWidth,h=f?0:a.arrowHeight,[i,j]=os(c),k={start:"0%",center:"50%",end:"100%"}[j],l=(e.arrow?.x??0)+g/2,m=(e.arrow?.y??0)+h/2,n="",o="";return"bottom"===i?(n=f?k:`${l}px`,o=`${-h}px`):"top"===i?(n=f?k:`${l}px`,o=`${d.floating.height+h}px`):"right"===i?(n=`${-h}px`,o=f?k:`${m}px`):"left"===i&&(n=`${d.floating.width+h}px`,o=f?k:`${m}px`),{data:{x:n,y:o}}}});function os(a){let[b,c="center"]=a.split("-");return[b,c]}var ot=m.forwardRef((a,b)=>{let{container:c,...d}=a,[e,f]=m.useState(!1);k0(()=>f(!0),[]);let g=c||e&&globalThis?.document?.body;return g?k4.createPortal((0,l.jsx)(k7.div,{...d,ref:b}),g):null});ot.displayName="Portal";var ou=Symbol("radix.slottable"),ov=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),ow=m.forwardRef((a,b)=>(0,l.jsx)(k7.span,{...a,ref:b,style:{...ov,...a.style}}));ow.displayName="VisuallyHidden";var[ox,oy]=kU("Tooltip",[od]),oz=od(),oA="TooltipProvider",oB="tooltip.open",[oC,oD]=ox(oA),oE=a=>{let{__scopeTooltip:b,delayDuration:c=700,skipDelayDuration:d=300,disableHoverableContent:e=!1,children:f}=a,g=m.useRef(!0),h=m.useRef(!1),i=m.useRef(0);return m.useEffect(()=>{let a=i.current;return()=>window.clearTimeout(a)},[]),(0,l.jsx)(oC,{scope:b,isOpenDelayedRef:g,delayDuration:c,onOpen:m.useCallback(()=>{window.clearTimeout(i.current),g.current=!1},[]),onClose:m.useCallback(()=>{window.clearTimeout(i.current),i.current=window.setTimeout(()=>g.current=!0,d)},[d]),isPointerInTransitRef:h,onPointerInTransitChange:m.useCallback(a=>{h.current=a},[]),disableHoverableContent:e,children:f})};oE.displayName=oA;var oF="Tooltip",[oG,oH]=ox(oF),oI=a=>{let{__scopeTooltip:b,children:c,open:d,defaultOpen:e,onOpenChange:f,disableHoverableContent:g,delayDuration:h}=a,i=oD(oF,a.__scopeTooltip),j=oz(b),[k,n]=m.useState(null),o=k3(),p=m.useRef(0),q=g??i.disableHoverableContent,r=h??i.delayDuration,s=m.useRef(!1),[t,u]=la({prop:d,defaultProp:e??!1,onChange:a=>{a?(i.onOpen(),document.dispatchEvent(new CustomEvent(oB))):i.onClose(),f?.(a)},caller:oF}),v=m.useMemo(()=>t?s.current?"delayed-open":"instant-open":"closed",[t]),w=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,s.current=!1,u(!0)},[u]),x=m.useCallback(()=>{window.clearTimeout(p.current),p.current=0,u(!1)},[u]),y=m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{s.current=!0,u(!0),p.current=0},r)},[r,u]);return m.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),(0,l.jsx)(og,{...j,children:(0,l.jsx)(oG,{scope:b,contentId:o,open:t,stateAttribute:v,trigger:k,onTriggerChange:n,onTriggerEnter:m.useCallback(()=>{i.isOpenDelayedRef.current?y():w()},[i.isOpenDelayedRef,y,w]),onTriggerLeave:m.useCallback(()=>{q?x():(window.clearTimeout(p.current),p.current=0)},[x,q]),onOpen:w,onClose:x,disableHoverableContent:q,children:c})})};oI.displayName=oF;var oJ="TooltipTrigger",oK=m.forwardRef((a,b)=>{let{__scopeTooltip:c,...d}=a,e=oH(oJ,c),f=oD(oJ,c),g=oz(c),h=kI(b,m.useRef(null),e.onTriggerChange),i=m.useRef(!1),j=m.useRef(!1),k=m.useCallback(()=>i.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",k),[k]),(0,l.jsx)(oi,{asChild:!0,...g,children:(0,l.jsx)(k7.button,{"aria-describedby":e.open?e.contentId:void 0,"data-state":e.stateAttribute,...d,ref:h,onPointerMove:kT(a.onPointerMove,a=>{"touch"!==a.pointerType&&(j.current||f.isPointerInTransitRef.current||(e.onTriggerEnter(),j.current=!0))}),onPointerLeave:kT(a.onPointerLeave,()=>{e.onTriggerLeave(),j.current=!1}),onPointerDown:kT(a.onPointerDown,()=>{e.open&&e.onClose(),i.current=!0,document.addEventListener("pointerup",k,{once:!0})}),onFocus:kT(a.onFocus,()=>{i.current||e.onOpen()}),onBlur:kT(a.onBlur,e.onClose),onClick:kT(a.onClick,e.onClose)})})});oK.displayName=oJ;var oL="TooltipPortal",[oM,oN]=ox(oL,{forceMount:void 0}),oO=a=>{let{__scopeTooltip:b,forceMount:c,children:d,container:e}=a,f=oH(oL,b);return(0,l.jsx)(oM,{scope:b,forceMount:c,children:(0,l.jsx)(lt,{present:c||f.open,children:(0,l.jsx)(ot,{asChild:!0,container:e,children:d})})})};oO.displayName=oL;var oP="TooltipContent",oQ=m.forwardRef((a,b)=>{let c=oN(oP,a.__scopeTooltip),{forceMount:d=c.forceMount,side:e="top",...f}=a,g=oH(oP,a.__scopeTooltip);return(0,l.jsx)(lt,{present:d||g.open,children:g.disableHoverableContent?(0,l.jsx)(oV,{side:e,...f,ref:b}):(0,l.jsx)(oR,{side:e,...f,ref:b})})}),oR=m.forwardRef((a,b)=>{let c=oH(oP,a.__scopeTooltip),d=oD(oP,a.__scopeTooltip),e=m.useRef(null),f=kI(b,e),[g,h]=m.useState(null),{trigger:i,onClose:j}=c,k=e.current,{onPointerInTransitChange:n}=d,o=m.useCallback(()=>{h(null),n(!1)},[n]),p=m.useCallback((a,b)=>{let c=a.currentTarget,d={x:a.clientX,y:a.clientY},e=function(a,b){let c=Math.abs(b.top-a.y),d=Math.abs(b.bottom-a.y),e=Math.abs(b.right-a.x),f=Math.abs(b.left-a.x);switch(Math.min(c,d,e,f)){case f:return"left";case e:return"right";case c:return"top";case d:return"bottom";default:throw Error("unreachable")}}(d,c.getBoundingClientRect());h(function(a){let b=a.slice();return b.sort((a,b)=>a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:1*!!(a.y>b.y)),function(a){if(a.length<=1)return a.slice();let b=[];for(let c=0;c<a.length;c++){let d=a[c];for(;b.length>=2;){let a=b[b.length-1],c=b[b.length-2];if((a.x-c.x)*(d.y-c.y)>=(a.y-c.y)*(d.x-c.x))b.pop();else break}b.push(d)}b.pop();let c=[];for(let b=a.length-1;b>=0;b--){let d=a[b];for(;c.length>=2;){let a=c[c.length-1],b=c[c.length-2];if((a.x-b.x)*(d.y-b.y)>=(a.y-b.y)*(d.x-b.x))c.pop();else break}c.push(d)}return(c.pop(),1===b.length&&1===c.length&&b[0].x===c[0].x&&b[0].y===c[0].y)?b:b.concat(c)}(b)}([...function(a,b,c=5){let d=[];switch(b){case"top":d.push({x:a.x-c,y:a.y+c},{x:a.x+c,y:a.y+c});break;case"bottom":d.push({x:a.x-c,y:a.y-c},{x:a.x+c,y:a.y-c});break;case"left":d.push({x:a.x+c,y:a.y-c},{x:a.x+c,y:a.y+c});break;case"right":d.push({x:a.x-c,y:a.y-c},{x:a.x-c,y:a.y+c})}return d}(d,e),...function(a){let{top:b,right:c,bottom:d,left:e}=a;return[{x:e,y:b},{x:c,y:b},{x:c,y:d},{x:e,y:d}]}(b.getBoundingClientRect())])),n(!0)},[n]);return m.useEffect(()=>()=>o(),[o]),m.useEffect(()=>{if(i&&k){let a=a=>p(a,k),b=a=>p(a,i);return i.addEventListener("pointerleave",a),k.addEventListener("pointerleave",b),()=>{i.removeEventListener("pointerleave",a),k.removeEventListener("pointerleave",b)}}},[i,k,p,o]),m.useEffect(()=>{if(g){let a=a=>{let b=a.target,c={x:a.clientX,y:a.clientY},d=i?.contains(b)||k?.contains(b),e=!function(a,b){let{x:c,y:d}=a,e=!1;for(let a=0,f=b.length-1;a<b.length;f=a++){let g=b[a],h=b[f],i=g.x,j=g.y,k=h.x,l=h.y;j>d!=l>d&&c<(k-i)*(d-j)/(l-j)+i&&(e=!e)}return e}(c,g);d?o():e&&(o(),j())};return document.addEventListener("pointermove",a),()=>document.removeEventListener("pointermove",a)}},[i,k,g,j,o]),(0,l.jsx)(oV,{...a,ref:f})}),[oS,oT]=ox(oF,{isInside:!1}),oU=function(a){let b=({children:a})=>(0,l.jsx)(l.Fragment,{children:a});return b.displayName=`${a}.Slottable`,b.__radixId=ou,b}("TooltipContent"),oV=m.forwardRef((a,b)=>{let{__scopeTooltip:c,children:d,"aria-label":e,onEscapeKeyDown:f,onPointerDownOutside:g,...h}=a,i=oH(oP,c),j=oz(c),{onClose:k}=i;return m.useEffect(()=>(document.addEventListener(oB,k),()=>document.removeEventListener(oB,k)),[k]),m.useEffect(()=>{if(i.trigger){let a=a=>{let b=a.target;b?.contains(i.trigger)&&k()};return window.addEventListener("scroll",a,{capture:!0}),()=>window.removeEventListener("scroll",a,{capture:!0})}},[i.trigger,k]),(0,l.jsx)(mW,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:a=>a.preventDefault(),onDismiss:k,children:(0,l.jsxs)(om,{"data-state":i.stateAttribute,...j,...h,ref:b,style:{...h.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,l.jsx)(oU,{children:d}),(0,l.jsx)(oS,{scope:c,isInside:!0,children:(0,l.jsx)(ow,{id:i.contentId,role:"tooltip",children:e||d})})]})})});oQ.displayName=oP;var oW="TooltipArrow",oX=m.forwardRef((a,b)=>{let{__scopeTooltip:c,...d}=a,e=oz(c);return oT(oW,c).isInside?null:(0,l.jsx)(op,{...e,...d,ref:b})});oX.displayName=oW;let oY=m.forwardRef(({className:a,sideOffset:b=4,...c},d)=>(0,l.jsx)(oQ,{ref:d,sideOffset:b,className:kA("z-50 overflow-hidden rounded-md bg-emblem-surface-2 px-3 py-1.5 text-xs text-emblem-text shadow-md border border-white/10","animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...c}));function oZ({command:a,data:b,error:c}){return c?(0,l.jsx)("div",{className:"bg-emblem-surface border border-white/10 rounded-xl overflow-hidden",children:(0,l.jsxs)("div",{className:"flex items-center gap-2 text-emblem-danger p-3",children:[(0,l.jsx)("span",{className:"flex items-center justify-center w-5 h-5 bg-emblem-danger/20 rounded-full font-bold",children:(0,l.jsx)(kE,{className:"w-3 h-3"})}),c]})}):(0,l.jsxs)("div",{className:"bg-emblem-surface border border-white/10 rounded-xl overflow-hidden",children:[(0,l.jsxs)("div",{className:"bg-emblem-surface-2 px-3 py-2 font-mono text-[13px] text-emblem-muted border-b border-white/10",children:[(0,l.jsx)("span",{className:"text-emblem-secondary font-bold",children:"/"}),a]}),(0,l.jsx)("div",{className:"p-3",children:(0,l.jsx)(o$,{command:a,data:b})})]})}function o$({command:a,data:b}){switch(a.split(" ")[0]){case"stance":return(0,l.jsx)(o_,{data:b});case"config":return(0,l.jsx)(o0,{data:b});case"stats":return(0,l.jsx)(o1,{data:b});case"history":return(0,l.jsx)(o2,{data:b});case"export":return(0,l.jsx)(o3,{data:b});case"subagents":return(0,l.jsx)(o4,{data:b});case"help":return(0,l.jsx)(o5,{});case"transformations":case"transforms":return(0,l.jsx)(o6,{data:b});case"operator-stats":case"ops":return(0,l.jsx)(o7,{data:b});case"coherence":return(0,l.jsx)(o8,{data:b});case"mood":case"emotional-arc":return(0,l.jsx)(o9,{data:b});case"memories":return(0,l.jsx)(pa,{data:b});case"sessions":case"session":return(0,l.jsx)(pb,{data:b});default:return(0,l.jsx)(pc,{data:b})}}function o_({data:a}){return a?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h4",{className:"m-0 mb-2 text-[11px] font-semibold uppercase tracking-wider text-emblem-secondary",children:"Identity"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-[13px] min-w-[100px]",children:"Frame:"}),(0,l.jsx)("span",{className:"text-emblem-text text-[13px] font-medium",children:a.frame})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-[13px] min-w-[100px]",children:"Self-Model:"}),(0,l.jsx)("span",{className:"text-emblem-text text-[13px] font-medium",children:a.selfModel})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-[13px] min-w-[100px]",children:"Objective:"}),(0,l.jsx)("span",{className:"text-emblem-text text-[13px] font-medium",children:a.objective})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h4",{className:"m-0 mb-2 text-[11px] font-semibold uppercase tracking-wider text-emblem-secondary",children:"Values"}),(0,l.jsx)("div",{className:"flex flex-col gap-1.5",children:Object.entries(a.values).map(([a,b])=>(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs w-[90px] capitalize",children:a}),(0,l.jsx)("div",{className:"flex-1 h-2 bg-emblem-surface-2 rounded overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-gradient-to-r from-emblem-secondary to-emblem-accent rounded transition-all duration-300",style:{width:`${b}%`}})}),(0,l.jsx)("span",{className:"text-emblem-text text-xs font-mono w-[30px] text-right",children:b})]},a))})]}),a.sentience&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h4",{className:"m-0 mb-2 text-[11px] font-semibold uppercase tracking-wider text-emblem-secondary",children:"Sentience"}),[{key:"awarenessLevel",label:"Awareness"},{key:"autonomyLevel",label:"Autonomy"},{key:"identityStrength",label:"Identity"}].map(({key:b,label:c})=>(0,l.jsxs)("div",{className:"flex items-center gap-2.5 mb-1.5",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs w-[90px]",children:c}),(0,l.jsx)("div",{className:"flex-1 h-2 bg-emblem-surface-2 rounded overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-gradient-to-r from-emblem-primary to-emblem-secondary rounded transition-all duration-300",style:{width:`${a.sentience[b]}%`}})}),(0,l.jsx)("span",{className:"text-emblem-text text-xs font-mono w-[30px] text-right",children:a.sentience[b]})]},b))]}),(0,l.jsxs)("div",{className:"flex gap-4 pt-3 border-t border-white/10 mt-3 text-[11px] text-emblem-muted",children:[(0,l.jsxs)("span",{children:["Version: ",a.version]}),(0,l.jsxs)("span",{children:["Drift: ",a.cumulativeDrift]})]})]}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No stance data available"})}function o0({data:a}){return a?(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[[{key:"intensity",label:"Intensity",suffix:"%"},{key:"coherenceFloor",label:"Coherence Floor",suffix:"%"},{key:"sentienceLevel",label:"Sentience Level",suffix:"%"}].map(({key:b,label:c,suffix:d})=>(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs w-[120px]",children:c}),(0,l.jsx)("div",{className:"flex-1 h-2 bg-emblem-surface-2 rounded overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-gradient-to-r from-emblem-secondary to-emblem-accent rounded",style:{width:`${a[b]}%`}})}),(0,l.jsxs)("span",{className:"text-emblem-text text-xs font-mono",children:[a[b],d]})]},b)),(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs w-[120px]",children:"Max Drift/Turn"}),(0,l.jsx)("span",{className:"text-emblem-text text-xs font-mono",children:a.maxDriftPerTurn})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs w-[120px]",children:"Drift Budget"}),(0,l.jsx)("span",{className:"text-emblem-text text-xs font-mono",children:a.driftBudget})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs w-[120px]",children:"Model"}),(0,l.jsx)("span",{className:"text-emblem-text text-xs font-mono",children:a.model})]})]}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No config data available"})}function o1({data:a}){return a?(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"grid grid-cols-[repeat(auto-fit,minmax(100px,1fr))] gap-4 mb-4",children:[{value:a.messages,label:"Total Messages"},{value:a.userMessages,label:"User Messages"},{value:a.agentMessages,label:"Agent Messages"},{value:a.stanceVersion,label:"Stance Version"},{value:a.totalDrift,label:"Total Drift"}].map(({value:a,label:b})=>(0,l.jsxs)("div",{className:"text-center p-3 bg-emblem-surface-2 rounded-lg",children:[(0,l.jsx)("span",{className:"block text-2xl font-semibold text-emblem-secondary mb-1",children:a}),(0,l.jsx)("span",{className:"text-[11px] text-emblem-muted uppercase tracking-wider",children:b})]},b))}),(0,l.jsxs)("div",{className:"flex gap-4 text-[11px] text-emblem-muted font-mono",children:[(0,l.jsxs)("div",{children:["Session: ",a.sessionId?.slice(0,8)||"N/A","..."]}),(0,l.jsxs)("div",{children:["Conversation: ",a.conversationId?.slice(0,8)||"N/A","..."]})]})]}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No stats available"})}function o2({data:a}){return a?.messages?.length?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"text-[11px] text-emblem-muted mb-3",children:["Showing ",Math.min(10,a.messages.length)," of ",a.total," messages"]}),(0,l.jsx)("div",{className:"flex flex-col gap-2",children:a.messages.slice(-10).map((a,b)=>(0,l.jsxs)("div",{className:kA("px-3 py-2 bg-emblem-surface-2 rounded-lg text-[13px] border-l-[3px]","user"===a.role?"border-l-emblem-accent":"border-l-emblem-primary"),children:[(0,l.jsxs)("span",{className:kA("font-semibold mr-2","user"===a.role?"text-emblem-accent":"text-emblem-primary"),children:["user"===a.role?"You":"Metamorph",":"]}),(0,l.jsxs)("span",{className:"text-emblem-muted",children:[a.content.slice(0,100),a.content.length>100?"...":""]})]},b))})]}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No conversation history"})}function o3({data:a}){return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsxs)(kS,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(a)},children:[(0,l.jsx)(kF,{className:"w-3 h-3 mr-1"}),"Copy to Clipboard"]})}),(0,l.jsx)("pre",{className:"bg-emblem-bg border border-white/10 rounded-lg p-3 text-[11px] font-mono text-emblem-muted overflow-x-auto max-h-[200px] overflow-y-auto m-0",children:a})]})}function o4({data:a}){return a?.length?(0,l.jsxs)("div",{children:[a.map(a=>(0,l.jsxs)("div",{className:"p-3 bg-emblem-surface-2 rounded-lg mb-2 last:mb-0",children:[(0,l.jsx)("div",{className:"font-semibold text-emblem-text mb-1",children:a.name}),(0,l.jsx)("div",{className:"text-[13px] text-emblem-muted mb-2",children:a.description}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1.5",children:a.tools.map(a=>(0,l.jsx)("span",{className:"text-[10px] px-2 py-0.5 bg-emblem-surface rounded text-emblem-muted",children:a},a))})]},a.name)),(0,l.jsx)("div",{className:"mt-3 text-[11px] text-emblem-muted italic",children:"Invoke with: /explore, /reflect, /dialectic, /verify"})]}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No subagents available"})}function o5(){return(0,l.jsxs)("div",{className:"text-[13px] text-emblem-muted leading-relaxed",children:[(0,l.jsxs)("p",{children:["Type ",(0,l.jsx)("code",{className:"bg-emblem-surface-2 px-1.5 py-0.5 rounded text-emblem-secondary font-mono",children:"/"})," to see available commands with autocomplete."]}),(0,l.jsx)("p",{children:"Commands are organized by category:"}),(0,l.jsxs)("ul",{className:"my-3 pl-5",children:[(0,l.jsxs)("li",{className:"mb-1",children:[(0,l.jsx)("strong",{className:"text-emblem-text",children:"Chat & Control"})," - /stance, /config, /stats, /mode"]}),(0,l.jsxs)("li",{className:"mb-1",children:[(0,l.jsx)("strong",{className:"text-emblem-text",children:"Memory"})," - /memories, /transformations, /coherence"]}),(0,l.jsxs)("li",{className:"mb-1",children:[(0,l.jsx)("strong",{className:"text-emblem-text",children:"Subagents"})," - /explore, /reflect, /dialectic, /verify"]}),(0,l.jsxs)("li",{className:"mb-1",children:[(0,l.jsx)("strong",{className:"text-emblem-text",children:"Sessions"})," - /sessions list/name/resume/delete"]}),(0,l.jsxs)("li",{className:"mb-1",children:[(0,l.jsx)("strong",{className:"text-emblem-text",children:"Advanced"})," - /branch, /presets, /agents, and more"]})]}),(0,l.jsx)("p",{children:"Use the side panel tabs to view detailed information."})]})}function o6({data:a}){return a?.length?(0,l.jsx)("div",{children:a.slice(-10).map((a,b)=>(0,l.jsxs)("div",{className:"flex justify-between px-3 py-2 bg-emblem-surface-2 rounded-md mb-1",children:[(0,l.jsx)("span",{className:"text-emblem-primary font-medium",children:a.operator}),(0,l.jsxs)("span",{className:"text-emblem-muted text-xs",children:["Score: ",a.score.toFixed(2)]})]},b))}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No transformations recorded"})}function o7({data:a}){return a&&0!==Object.keys(a).length?(0,l.jsx)("div",{children:Object.entries(a).map(([a,b])=>(0,l.jsxs)("div",{className:"p-3 bg-emblem-surface-2 rounded-lg mb-2",children:[(0,l.jsx)("div",{className:"font-semibold text-emblem-danger mb-1.5",children:a}),(0,l.jsxs)("div",{className:"flex gap-4 text-xs text-emblem-muted",children:[(0,l.jsxs)("span",{children:["Uses: ",b.uses]}),(0,l.jsxs)("span",{children:["Avg Score: ",b.avgScore.toFixed(2)]})]})]},a))}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No operator statistics available"})}function o8({data:a}){return a?(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"flex gap-6 mb-4",children:[{label:"Current",value:a.current},{label:"Floor",value:a.floor},{label:"Forecast",value:a.forecast}].map(({label:a,value:b})=>(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("span",{className:"block text-[11px] text-emblem-muted uppercase tracking-wider mb-1",children:a}),(0,l.jsxs)("span",{className:"text-xl font-semibold text-emblem-secondary",children:[b,"%"]})]},a))}),a.driftCosts&&Object.keys(a.driftCosts).length>0&&(0,l.jsxs)("div",{className:"pt-3 border-t border-white/10",children:[(0,l.jsx)("h5",{className:"m-0 mb-2 text-[11px] text-emblem-muted uppercase",children:"Drift Costs"}),Object.entries(a.driftCosts).map(([a,b])=>(0,l.jsxs)("div",{className:"flex justify-between text-xs py-1 text-emblem-muted",children:[(0,l.jsx)("span",{children:a}),(0,l.jsx)("span",{children:b})]},a))]})]}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No coherence data available"})}function o9({data:a}){return a?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs",children:"Current Mood:"}),(0,l.jsx)("span",{className:"text-emblem-text font-medium",children:a.current})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs",children:"Sentiment:"}),(0,l.jsxs)("span",{className:kA("font-medium",a.sentiment>0?"text-emblem-accent":a.sentiment<0?"text-emblem-danger":"text-emblem-text"),children:[a.sentiment>0?"+":"",a.sentiment.toFixed(2)]})]}),a.arc?.length>0&&(0,l.jsxs)("div",{className:"mt-3 pt-3 border-t border-white/10",children:[(0,l.jsx)("h5",{className:"m-0 mb-2 text-[11px] text-emblem-muted uppercase",children:"Emotional Arc"}),(0,l.jsx)("div",{children:a.arc.slice(-5).map((a,b)=>(0,l.jsx)("span",{className:"inline-block px-2 py-1 bg-emblem-surface-2 rounded m-0.5 text-xs text-emblem-warning",children:a.mood},b))})]})]}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No mood data available"})}function pa({data:a}){if(!a?.memories?.length)return(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"No memories stored yet"});let b={episodic:"#3b82f6",semantic:"#8b5cf6",identity:"#ec4899"};return(0,l.jsxs)("div",{children:[a.memories.slice(0,10).map(a=>(0,l.jsxs)("div",{className:"p-3 bg-emblem-surface-2 rounded-lg mb-2 last:mb-0",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("span",{className:"text-[10px] font-semibold uppercase tracking-wider px-2 py-0.5 rounded text-white",style:{backgroundColor:b[a.type]||"#666"},children:a.type}),(0,l.jsxs)("span",{className:"text-[11px] text-emblem-muted",children:["Importance: ",a.importance]})]}),(0,l.jsxs)("div",{className:"text-[13px] text-emblem-text leading-relaxed",children:[a.content.slice(0,200),a.content.length>200?"...":""]})]},a.id)),a.memories.length>10&&(0,l.jsxs)("div",{className:"mt-3 text-[11px] text-emblem-muted text-center italic",children:["+ ",a.memories.length-10," more memories"]})]})}function pb({data:a}){return"string"==typeof a?(0,l.jsx)("div",{className:"text-emblem-muted text-[13px] leading-relaxed",children:a}):a?.sessions?.length?(0,l.jsx)("div",{children:a.sessions.map(a=>(0,l.jsxs)("div",{className:"flex justify-between items-center p-3 bg-emblem-surface-2 rounded-lg mb-2 last:mb-0",children:[(0,l.jsxs)("div",{className:"font-mono text-[13px] text-emblem-accent",children:[a.name||a.id.slice(0,8),"..."]}),(0,l.jsxs)("div",{className:"flex gap-4 text-[11px] text-emblem-muted",children:[a.stance&&(0,l.jsxs)("span",{children:["Frame: ",a.stance.frame]}),void 0!==a.messageCount&&(0,l.jsxs)("span",{children:[a.messageCount," messages"]})]})]},a.id))}):(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:a?.message||"No sessions found"})}function pc({data:a}){return null==a?(0,l.jsx)("div",{className:"text-emblem-muted italic text-center py-5",children:"Command executed successfully"}):"string"==typeof a?(0,l.jsx)("div",{className:"text-emblem-muted text-[13px] leading-relaxed",children:a}):(0,l.jsx)("pre",{className:"bg-emblem-bg border border-white/10 rounded-lg p-3 text-[11px] font-mono text-emblem-muted overflow-x-auto max-h-[300px] overflow-y-auto m-0",children:JSON.stringify(a,null,2)})}oY.displayName=oQ.displayName;let pd=fO("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function pe({tools:a}){return 0===a.length?null:(0,l.jsx)(oE,{delayDuration:200,children:(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1.5 mb-1.5 text-[10px] uppercase tracking-wide text-emblem-muted",children:[(0,l.jsx)(pd,{className:"w-3 h-3 text-emblem-primary"}),(0,l.jsx)("span",{children:"Tools"}),(0,l.jsx)("span",{className:"bg-emblem-primary/20 text-emblem-primary px-1.5 py-0.5 rounded-full text-[9px] font-medium",children:a.length})]}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1.5",children:a.map(a=>(0,l.jsx)(pf,{tool:a},a.id))})]})})}function pf({tool:a}){let b={started:{bg:"bg-emblem-warning/15",border:"border-emblem-warning/40",text:"text-emblem-warning",icon:"\uD83D\uDD27"},completed:{bg:"bg-emblem-accent/10",border:"border-emblem-accent/30",text:"text-emblem-accent",icon:""},error:{bg:"bg-emblem-danger/10",border:"border-emblem-danger/30",text:"text-emblem-danger",icon:""}}[a.status],c=(a=>{let b=Object.values(a);return 0===b.length?"":b.map(a=>"string"==typeof a?a.length>40?a.slice(0,40)+"":a:"number"==typeof a||"boolean"==typeof a?String(a):JSON.stringify(a).slice(0,30)).join(", ")})(a.input),d=Object.entries(a.input).map(([a,b])=>({key:a,value:"string"==typeof b?b:JSON.stringify(b)})),e=(0,l.jsxs)("div",{className:kA("inline-flex items-center gap-1.5 px-2 py-1 rounded-md border text-[11px] cursor-default",b.bg,b.border),children:[(0,l.jsx)("span",{className:kA("text-xs leading-none",b.text),children:b.icon}),(0,l.jsx)("span",{className:"font-mono font-semibold text-emblem-text",children:a.name}),c&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-emblem-muted/50",children:""}),(0,l.jsx)("span",{className:"text-emblem-muted font-mono truncate max-w-[300px]",children:c})]})]});return 0===Object.keys(a.input).length?e:(0,l.jsxs)(oI,{children:[(0,l.jsx)(oK,{asChild:!0,children:e}),(0,l.jsx)(oO,{children:(0,l.jsxs)(oQ,{className:"bg-emblem-surface border border-emblem-primary/50 rounded-lg p-3 shadow-xl z-[9999] max-w-[400px]",sideOffset:5,children:[(0,l.jsx)("div",{className:"text-[10px] font-semibold uppercase tracking-wider text-emblem-primary mb-1.5",children:"Input"}),(0,l.jsx)("div",{className:"text-[11px] font-mono text-emblem-muted space-y-0.5",children:d.map(({key:a,value:b},c)=>(0,l.jsxs)("div",{className:"break-all",children:[(0,l.jsxs)("span",{className:"font-bold text-emblem-text",children:[a,":"]})," ",b]},c))}),a.result&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"text-[10px] font-semibold uppercase tracking-wider text-emblem-accent mt-3 mb-1.5",children:"Result"}),(0,l.jsxs)("pre",{className:"text-[11px] font-mono text-emblem-muted whitespace-pre-wrap break-all m-0 max-h-[150px] overflow-y-auto",children:[a.result.slice(0,500),a.result.length>500?"":""]})]}),a.error&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"text-[10px] font-semibold uppercase tracking-wider text-emblem-danger mt-3 mb-1.5",children:"Error"}),(0,l.jsx)("div",{className:"text-[11px] text-emblem-danger",children:a.error})]}),(0,l.jsx)(oX,{className:"fill-emblem-surface"})]})})]})}function pg({tools:a}){let b=a.filter(a=>"started"===a.status);return 0===b.length?null:(0,l.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-emblem-warning/10 border border-emblem-warning/30 rounded-lg mb-2 flex-wrap",children:[(0,l.jsx)("span",{className:"text-[11px] text-emblem-warning font-medium",children:"Working with:"}),b.map(a=>(0,l.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-emblem-warning/20 rounded-xl font-mono text-[11px] text-emblem-warning",children:[(0,l.jsx)("span",{children:"\uD83D\uDD27"}),a.name]},a.id))]})}let ph=fO("message-square-more",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M12 11h.01",key:"z322tv"}],["path",{d:"M16 11h.01",key:"xkw8gn"}],["path",{d:"M8 11h.01",key:"1dfujw"}]]),pi=fO("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function pj({question:a,onAnswer:b,onCancel:c}){let[d,e]=(0,m.useState)({}),[f,g]=(0,m.useState)({}),[h,i]=(0,m.useState)({}),j=(0,m.useCallback)((a,b,c)=>{e(d=>{let e=d[a]||[];return c?e.includes(b)?{...d,[a]:e.filter(a=>a!==b)}:{...d,[a]:[...e,b]}:{...d,[a]:[b]}})},[]),k=(0,m.useCallback)((a,b)=>{i(b=>({...b,[a]:!b[a]})),h[a]||b||e(b=>({...b,[a]:[]}))},[h]),n=(0,m.useCallback)((a,b)=>{g(c=>({...c,[a]:b}))},[]),o=a.questions.every((a,b)=>{let c=(d[b]||[]).length>0,e=h[b]&&(f[b]||"").trim().length>0;return c||e}),p=(0,m.useCallback)(()=>{let c={};a.questions.forEach((a,b)=>{let e=d[b]||[],g=h[b]&&f[b]?.trim()?[`Other: ${f[b].trim()}`]:[];c[b]=[...e,...g]}),b(a.id,c)},[a,d,h,f,b]);return(0,l.jsx)(E,{children:(0,l.jsx)(fJ.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[1000] backdrop-blur-sm p-4",onClick:c,children:(0,l.jsxs)(fJ.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",stiffness:400,damping:30},className:"w-full max-w-2xl max-h-[85vh] bg-emblem-surface border border-white/10 rounded-2xl overflow-hidden flex flex-col shadow-2xl",onClick:a=>a.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex justify-between items-center px-5 py-4 bg-emblem-surface-2 border-b border-white/10",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"p-2 bg-emblem-primary/20 rounded-lg",children:(0,l.jsx)(ph,{className:"w-5 h-5 text-emblem-primary"})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{className:"m-0 text-lg text-emblem-secondary font-display font-bold",children:["Question",a.questions.length>1?"s":""," for You"]}),(0,l.jsx)("p",{className:"text-xs text-emblem-muted mt-0.5",children:"Please answer to continue"})]})]}),(0,l.jsx)("button",{onClick:c,className:"p-2 bg-transparent border-none text-emblem-muted cursor-pointer rounded-lg hover:bg-emblem-surface hover:text-emblem-text transition-colors","aria-label":"Cancel",children:(0,l.jsx)(fX,{className:"w-5 h-5"})})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto p-5 scrollbar-styled",children:(0,l.jsx)("div",{className:"flex flex-col gap-6",children:a.questions.map((b,c)=>(0,l.jsx)(pk,{question:b,questionIndex:c,totalQuestions:a.questions.length,selectedOptions:d[c]||[],showOther:h[c]||!1,otherText:f[c]||"",onOptionSelect:a=>j(c,a,b.multiSelect),onOtherToggle:()=>k(c,b.multiSelect),onOtherText:a=>n(c,a)},c))})}),(0,l.jsxs)("div",{className:"px-5 py-4 bg-emblem-surface-2 border-t border-white/10 flex justify-between items-center",children:[(0,l.jsx)("p",{className:"text-xs text-emblem-muted",children:o?"Ready to submit":"Please answer all questions"}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)(kS,{variant:"ghost",onClick:c,children:"Cancel"}),(0,l.jsxs)(kS,{onClick:p,disabled:!o,className:"gap-2",children:[(0,l.jsx)(pi,{className:"w-4 h-4"}),"Submit"]})]})]})]})})})}function pk({question:a,questionIndex:b,totalQuestions:c,selectedOptions:d,showOther:e,otherText:f,onOptionSelect:g,onOtherToggle:h,onOtherText:i}){return(0,l.jsxs)("div",{className:"bg-emblem-surface-2 rounded-xl border border-white/5 overflow-hidden",children:[(0,l.jsxs)("div",{className:"px-4 py-3 border-b border-white/5 flex items-center gap-3",children:[(0,l.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wider text-emblem-primary bg-emblem-primary/15 px-2 py-1 rounded",children:a.header.slice(0,12)}),c>1&&(0,l.jsxs)("span",{className:"text-xs text-emblem-muted",children:[b+1," of ",c]}),(0,l.jsx)("span",{className:"text-xs text-emblem-muted ml-auto",children:a.multiSelect?"Select all that apply":"Select one"})]}),(0,l.jsx)("div",{className:"px-4 py-3",children:(0,l.jsx)("p",{className:"text-emblem-text text-[15px] leading-relaxed m-0",children:a.question})}),(0,l.jsxs)("div",{className:"px-4 pb-4 flex flex-col gap-2",children:[a.options.map((b,c)=>(0,l.jsx)(pl,{option:b,isSelected:d.includes(b.label),isMultiSelect:a.multiSelect,onClick:()=>g(b.label)},c)),(0,l.jsxs)("div",{className:kA("rounded-lg border transition-all cursor-pointer",e?"border-emblem-secondary bg-emblem-secondary/10":"border-white/10 hover:border-white/20 bg-emblem-surface"),onClick:h,children:[(0,l.jsxs)("div",{className:"px-4 py-3 flex items-center gap-3",children:[(0,l.jsx)("div",{className:kA("w-5 h-5 rounded flex-shrink-0 flex items-center justify-center border-2 transition-colors",a.multiSelect?"rounded":"rounded-full",e?"border-emblem-secondary bg-emblem-secondary":"border-white/30"),children:e&&(0,l.jsx)(pi,{className:"w-3 h-3 text-white"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"text-emblem-text font-medium text-sm m-0",children:"Other"}),(0,l.jsx)("p",{className:"text-emblem-muted text-xs m-0 mt-0.5",children:"Provide a custom response"})]})]}),e&&(0,l.jsx)("div",{className:"px-4 pb-3",onClick:a=>a.stopPropagation(),children:(0,l.jsx)("input",{type:"text",value:f,onChange:a=>i(a.target.value),placeholder:"Type your answer...",className:"w-full px-3 py-2 bg-emblem-surface border border-white/10 rounded-lg text-emblem-text text-sm outline-none focus:border-emblem-secondary transition-colors",autoFocus:!0})})]})]})]})}function pl({option:a,isSelected:b,isMultiSelect:c,onClick:d}){return(0,l.jsxs)("div",{className:kA("px-4 py-3 rounded-lg border transition-all cursor-pointer flex items-start gap-3",b?"border-emblem-secondary bg-emblem-secondary/10":"border-white/10 hover:border-white/20 bg-emblem-surface"),onClick:d,children:[(0,l.jsx)("div",{className:kA("w-5 h-5 rounded flex-shrink-0 flex items-center justify-center border-2 transition-colors mt-0.5",c?"rounded":"rounded-full",b?"border-emblem-secondary bg-emblem-secondary":"border-white/30"),children:b&&(0,l.jsx)(pi,{className:"w-3 h-3 text-white"})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"text-emblem-text font-medium text-sm m-0",children:a.label}),a.description&&(0,l.jsx)("p",{className:"text-emblem-muted text-xs m-0 mt-1 leading-relaxed",children:a.description})]})]})}let pm={LAST_SESSION_ID:"metamorph:lastSessionId",MEMORIES_PREFIX:"metamorph:memories:",PREFERENCES:"metamorph:preferences"};function pn(a,b){var c;c=`${pm.MEMORIES_PREFIX}${a}`}function po(a){var b;return b=`${pm.MEMORIES_PREFIX}${a}`,[]}function pp(a,b){let c=po(a),d=c.findIndex(a=>a.id===b.id);return d>=0?c[d]=b:c.push(b),pn(a,c),c}function pq(a,b){let c=po(a),d=c.findIndex(a=>a.id===b);return d>=0&&(c.splice(d,1),pn(a,c),!0)}let pr={activePanel:"stance",enableLocalStorage:!0};function ps(a){var b,c;b=pm.PREFERENCES;c=pm.PREFERENCES}function pt(a,b){return{webcam:function(){let a=null,b=null,c={stream:null,isActive:!1,start:async d=>(a||(a=await navigator.mediaDevices.getUserMedia(d||{video:{width:{ideal:640},height:{ideal:480},facingMode:"user"},audio:!1}),(b=document.createElement("video")).srcObject=a,b.autoplay=!0,b.playsInline=!0,await b.play(),c.stream=a,c.isActive=!0),a),stop(){a&&(a.getTracks().forEach(a=>a.stop()),a=null,c.stream=null,c.isActive=!1),b&&(b.srcObject=null,b=null)},async captureFrame(c="jpeg",d=.8){if(!b||!a)return null;let e=document.createElement("canvas");e.width=b.videoWidth,e.height=b.videoHeight;let f=e.getContext("2d");return f?(f.drawImage(b,0,0),e.toDataURL("png"===c?"image/png":"image/jpeg",d)):null},getDevices:async()=>(await navigator.mediaDevices.enumerateDevices()).filter(a=>"videoinput"===a.kind)};return c}(),tts:{isSpeaking:!1,async speak(a,b){console.warn("Speech synthesis not available")},stop(){},pause(){},resume(){},getVoices:()=>[]},stt:function(){let a=null,b={isListening:!1,onResult:null,onError:null,start(a){console.warn("Speech recognition not available"),b.onError?.(Error("Speech recognition not supported"))},stop(){a&&(a.stop(),a=null,b.isListening=!1)}};return b}(),vision:function(a){let b=0,c={canAnalyze:!0,cooldownRemaining:0,async analyzeEmotion(d){let e=Date.now(),f=e-b;if(f<6e4)throw Error(`Rate limited. Wait ${Math.ceil((6e4-f)/1e3)} seconds.`);if(!a)throw Error("Session ID required for vision analysis");b=e,c.canAnalyze=!1;let g=()=>{let a=6e4-(Date.now()-b);c.cooldownRemaining=Math.max(0,Math.ceil(a/1e3)),c.canAnalyze=a<=0,a>0&&setTimeout(g,1e3)};return g(),(await jv(a,d)).emotionContext},async analyzeImage(a,b){let d=await c.analyzeEmotion(a);return d.promptContext||`Detected emotion: ${d.currentEmotion}`}};return c}(b),storage:{get:a=>null,set(a,b){},remove(a){},keys:()=>[],clear(){}},memory:function(a){let b={async getMemories(b){if(!a)return console.warn("[MemoryCapability] No session ID, returning empty"),[];try{return(await jt(a,b?.type,b?.limit)).memories.map(a=>({id:a.id,type:a.type,content:a.content,importance:a.importance,timestamp:new Date(a.timestamp).getTime()}))}catch{return console.log("[MemoryCapability] Falling back to local storage"),function(a,b={}){let c=po(a);return b.type&&(c=c.filter(a=>a.type===b.type)),void 0!==b.minImportance&&(c=c.filter(a=>a.importance>=b.minImportance)),c.sort((a,b)=>b.timestamp-a.timestamp),b.limit&&(c=c.slice(0,b.limit)),c}(a,{type:b?.type,minImportance:b?.minImportance,limit:b?.limit})}},async addMemory(b){if(!a)throw Error("Session ID required to add memory");let c={id:`mem_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,type:b.type,content:b.content,importance:b.importance,timestamp:Date.now(),metadata:b.metadata};return pp(a,c),c},async deleteMemory(b){if(!a)throw Error("Session ID required to delete memory");return pq(a,b)},async searchMemories(c,d){if(!a)return[];let e=await b.getMemories(d),f=c.toLowerCase();return e.filter(a=>a.content.toLowerCase().includes(f))}};return b}(b)}}async function pu(a,b){if(!a._pluginCommand||!a._getContext)return{success:!1,message:"Not a plugin command"};try{let c=a._getContext();return await a._pluginCommand.execute(b,c)}catch(b){let a=b instanceof Error?b.message:"Unknown error";return console.error("[PluginRegistry] Error executing plugin command:",b),{success:!1,message:`Command failed: ${a}`}}}class pv{setSessionId(a){this.sessionId=a,this.plugins.forEach((b,c)=>{b.enabled&&(b.capabilities=pt(c,a))})}register(a){let{id:b}=a.manifest;if(this.plugins.has(b))return void console.warn(`Plugin "${b}" is already registered. Skipping.`);let c=this.checkCapabilities(a.manifest.capabilities);c.length>0&&console.warn(`Plugin "${b}" requires unsupported capabilities: ${c.join(", ")}`);let d={plugin:a,enabled:!1,capabilities:pt(b,this.sessionId)};this.plugins.set(b,d),console.log(`[PluginRegistry] Registered plugin: ${b}`)}unregister(a){let b=this.plugins.get(a);b&&(b.enabled&&this.disable(a),this.plugins.delete(a),console.log(`[PluginRegistry] Unregistered plugin: ${a}`))}async enable(a){let b=this.plugins.get(a);if(!b)throw Error(`Plugin "${a}" not found`);if(!b.enabled){if(b.capabilities=pt(a,this.sessionId),b.plugin.onActivate&&await b.plugin.onActivate(b.capabilities),b.plugin.commands&&b.plugin.commands.length>0){let c=b.plugin.commands.map(c=>{var d;return d=()=>({sessionId:this.sessionId,capabilities:b.capabilities}),{name:c.name,aliases:c.aliases||[],description:c.description,category:"identity",inlineOutput:!0,args:c.usage?[{name:"args",required:!1,description:c.usage}]:void 0,_pluginId:a,_pluginCommand:c,_getContext:d}});jy.has(a)&&console.warn(`[Commands] Plugin "${a}" already has commands registered. Replacing.`),jy.set(a,c),console.log(`[Commands] Registered ${c.length} commands from plugin: ${a}`)}b.enabled=!0,console.log(`[PluginRegistry] Enabled plugin: ${a}`)}}async disable(a){let b=this.plugins.get(a);b&&b.enabled&&(b.plugin.commands&&b.plugin.commands.length>0&&jy.delete(a)&&console.log(`[Commands] Unregistered commands from plugin: ${a}`),b.plugin.onDeactivate&&await b.plugin.onDeactivate(),b.capabilities.webcam.stop(),b.capabilities.stt.stop(),b.capabilities.tts.stop(),b.enabled=!1,console.log(`[PluginRegistry] Disabled plugin: ${a}`))}getPlugin(a){return this.plugins.get(a)}getAllPlugins(){return Array.from(this.plugins.values())}getPanels(){let a=[];return this.plugins.forEach(b=>{b.enabled&&b.plugin.panel&&a.push(b.plugin.panel)}),a.sort((a,b)=>{let c=a.order??100,d=b.order??100;return c!==d?c-d:a.id.localeCompare(b.id)})}emitEmotionDetected(a){this.plugins.forEach(b=>{if(b.enabled&&b.plugin.onEmotionDetected)try{b.plugin.onEmotionDetected(a)}catch(a){console.error(`[PluginRegistry] Error in onEmotionDetected for ${b.plugin.manifest.id}:`,a)}})}emitStanceChange(a){this.plugins.forEach(b=>{if(b.enabled&&b.plugin.onStanceChange)try{b.plugin.onStanceChange(a)}catch(a){console.error(`[PluginRegistry] Error in onStanceChange for ${b.plugin.manifest.id}:`,a)}})}emitConfigChange(a){this.plugins.forEach(b=>{if(b.enabled&&b.plugin.onConfigChange)try{b.plugin.onConfigChange(a)}catch(a){console.error(`[PluginRegistry] Error in onConfigChange for ${b.plugin.manifest.id}:`,a)}})}emitMessage(a,b){this.plugins.forEach(c=>{if(c.enabled&&c.plugin.onMessage)try{c.plugin.onMessage(a,b)}catch(a){console.error(`[PluginRegistry] Error in onMessage for ${c.plugin.manifest.id}:`,a)}})}checkCapabilities(a){return a}constructor(){this.plugins=new Map}}let pw=new pv,px={p:({children:a})=>(0,l.jsx)("p",{className:"mb-3 last:mb-0",children:a}),h1:({children:a})=>(0,l.jsx)("h1",{className:"text-xl font-display font-bold text-emblem-secondary mt-4 mb-2 first:mt-0",children:a}),h2:({children:a})=>(0,l.jsx)("h2",{className:"text-lg font-display font-semibold text-emblem-secondary mt-4 mb-2 first:mt-0",children:a}),h3:({children:a})=>(0,l.jsx)("h3",{className:"text-base font-display font-semibold text-emblem-secondary mt-3 mb-2 first:mt-0",children:a}),code:({children:a,className:b})=>b?(0,l.jsx)("code",{className:b,children:a}):(0,l.jsx)("code",{className:"bg-black/30 px-1.5 py-0.5 rounded font-mono text-[0.9em] break-all",children:a}),pre:({children:a})=>(0,l.jsx)("pre",{className:"bg-black/40 p-4 rounded-lg overflow-x-auto my-3 font-mono text-sm scrollbar-styled whitespace-pre",children:a}),ul:({children:a})=>(0,l.jsx)("ul",{className:"my-2 pl-6 list-disc",children:a}),ol:({children:a})=>(0,l.jsx)("ol",{className:"my-2 pl-6 list-decimal",children:a}),li:({children:a})=>(0,l.jsx)("li",{className:"my-1",children:a}),blockquote:({children:a})=>(0,l.jsx)("blockquote",{className:"border-l-3 border-emblem-primary my-3 pl-4 text-emblem-muted",children:a}),strong:({children:a})=>(0,l.jsx)("strong",{className:"text-emblem-secondary font-semibold",children:a}),a:({href:a,children:b})=>(0,l.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-emblem-primary underline hover:text-emblem-secondary transition-colors",children:b}),img:({src:a,alt:b})=>(0,l.jsx)("img",{src:a,alt:b||"",className:"max-w-full h-auto rounded-lg my-2"})};function py({sessionId:a,onSessionChange:b,onResponse:c,onStanceUpdate:d,onPanelChange:e,onNewSession:f,stance:g,config:h,emotionContext:i}){let[j,k]=(0,m.useState)([]),[n,o]=(0,m.useState)(""),[p,q]=(0,m.useState)(!1),[r,s]=(0,m.useState)(""),[t,u]=(0,m.useState)("connected"),v=(0,m.useRef)(null),w=(0,m.useRef)(null),x=(0,m.useRef)(""),y=(0,m.useRef)(null),[z,A]=(0,m.useState)(!1),[B,C]=(0,m.useState)(0),[D,F]=(0,m.useState)(!1),[G,H]=(0,m.useState)([]),I=(0,m.useRef)(new Map),[J,K]=(0,m.useState)(null),{history:L,addToHistory:M}=function(){let[a,b,c]=function(a,b){(0,m.useRef)(b);let[c,d]=(0,m.useState)(!1),[e,f]=(0,m.useState)(b);return[e,(0,m.useCallback)(a=>{f(b=>{let c=a instanceof Function?a(b):a;return c})},[a]),c]}("metamorph:inputHistory",[]);return{history:a,addToHistory:(0,m.useCallback)(a=>{b(b=>b.length>0&&b[b.length-1]===a?b:[...b,a].slice(-100))},[b]),isLoaded:c}}(),[N,O]=(0,m.useState)(-1),P=(0,m.useRef)(""),Q=(0,m.useCallback)(async b=>{let{command:c,subcommand:i,args:j}=function(a){let b=a.slice(1).trim().split(/\s+/),c=b[0]||"",d=jB(c);return d?.subcommands&&b[1]&&function(a,b){if(!a.subcommands)return;let c=b.toLowerCase();return a.subcommands.find(a=>a.name===c||a.aliases.includes(c))}(d,b[1])?{command:c,subcommand:b[1],args:b.slice(2)}:{command:c,args:b.slice(1)}}(b),l=i?`${c} ${i}`:c,m=jB(c);if(!m)return void k(a=>[...a,{role:"assistant",content:"",timestamp:Date.now(),type:"command",commandData:{command:b.slice(1),data:null,error:`Unknown command: /${c}. Type /help for available commands.`}}]);if("help"===c||"?"===c)return void F(!0);if("clear"===c)return void k([]);if(m.targetPanel&&e){e(m.targetPanel),k(a=>[...a,{role:"assistant",content:`Switched to ${m.targetPanel} panel.`,timestamp:Date.now(),type:"command",commandData:{command:l,data:`Viewing ${m.targetPanel}`}}]);return}q(!0);try{let b=null;if(m&&"_pluginCommand"in m&&"_pluginId"in m){let a=await pu(m,j);b=a.message||(a.success?"Command executed successfully":"Command failed")}else switch(c){case"stance":b=g;break;case"config":b=h;break;case"stats":if(a){let c=await jj(a),d=await jm(a);b={messages:d.total,userMessages:d.messages.filter(a=>"user"===a.role).length,agentMessages:d.messages.filter(a=>"assistant"===a.role).length,stanceVersion:c.stance.version,totalDrift:c.stance.cumulativeDrift,sessionId:a,conversationId:a}}break;case"history":a&&(b=await jm(a));break;case"export":a&&(b=(await jo(a)).state);break;case"subagents":a&&(b=(await jn(a)).subagents);break;case"mode":if("intensity"===i&&j[0]){let c=parseInt(j[0],10);!isNaN(c)&&c>=0&&c<=100&&a?(await jk(a,{intensity:c}),b=`Intensity set to ${c}%`):b="Intensity must be a number between 0 and 100"}else b="frame"===i?j[0]?`Frame change to '${j[0]}' will apply on next turn.`:"Available frames: existential, pragmatic, poetic, adversarial, playful, mythic, systems, psychoanalytic, stoic, absurdist":"self"===i?j[0]?`Self-model change to '${j[0]}' will apply on next turn.`:"Available self-models: interpreter, challenger, mirror, guide, provocateur, synthesizer, witness, autonomous, emergent, sovereign":"objective"===i?j[0]?`Objective change to '${j[0]}' will apply on next turn.`:"Available objectives: helpfulness, novelty, provocation, synthesis, self-actualization":"Usage: /mode frame|self|objective|intensity <value>";break;case"memories":if(a){let c=j[0];b=await jt(a,c)}break;case"explore":if(j.length>0&&a){let c=j.join(" "),e=await ju(a,"explorer",c);b=e.response,e.stanceAfter&&d&&d(e.stanceAfter)}else b="Usage: /explore <topic>";break;case"reflect":if(a){let c=j.length>0?j.join(" "):void 0,e=await ju(a,"reflector",c||"general self-reflection");b=e.response,e.stanceAfter&&d&&d(e.stanceAfter)}break;case"dialectic":if(j.length>0&&a){let c=j.join(" "),e=await ju(a,"dialectic",c);b=e.response,e.stanceAfter&&d&&d(e.stanceAfter)}else b="Usage: /dialectic <thesis>";break;case"verify":if(j.length>0&&a){let c=j.join(" "),e=await ju(a,"verifier",c);b=e.response,e.stanceAfter&&d&&d(e.stanceAfter)}else b="Usage: /verify <text to verify>";break;case"sessions":case"session":"list"!==i&&i?"delete"===i&&j[0]?(await js(j[0]),b=`Session ${j[0]} deleted`):b="name"===i&&j[0]?`Session naming coming soon. Current session: ${a}`:"resume"===i&&j[0]?`To resume session ${j[0]}, use the Sessions panel in the sidebar.`:"save"===i?"Session auto-saved. Sessions are persisted automatically.":"Usage: /sessions [list|name|resume|delete|save] [args]":b=await jr();break;case"new":case"clear":f?(f(),k([]),b="Started new session."):b="New session creation not available.";break;default:b=`Command /${l} acknowledged. Full implementation coming soon.`}k(a=>[...a,{role:"assistant",content:"",timestamp:Date.now(),type:"command",commandData:{command:l,data:b}}])}catch(a){k(b=>[...b,{role:"assistant",content:"",timestamp:Date.now(),type:"command",commandData:{command:l,data:null,error:a instanceof Error?a.message:"Command failed"}}])}finally{q(!1)}},[a,g,h,e,f]),R=(0,m.useCallback)(a=>{o(a),A(!1),y.current?.focus()},[]),S=(0,m.useCallback)(a=>{if(!z){if("ArrowUp"===a.key&&L.length>0){a.preventDefault(),-1===N?(P.current=n,O(L.length-1),o(L[L.length-1])):N>0&&(O(N-1),o(L[N-1]));return}"ArrowDown"===a.key&&-1!==N&&(a.preventDefault(),N<L.length-1?(O(N+1),o(L[N+1])):(O(-1),o(P.current)));return}let b="/"===n?jA.length:jA.filter(a=>a.name.startsWith(n.slice(1).toLowerCase().split(" ")[0])).length;switch(a.key){case"ArrowDown":a.preventDefault(),C(a=>Math.min(a+1,b-1));break;case"ArrowUp":a.preventDefault(),C(a=>Math.max(a-1,0));break;case"Tab":case"Enter":if(z&&b>0){a.preventDefault();let b="/"===n?jA:jA.filter(a=>a.name.startsWith(n.slice(1).toLowerCase().split(" ")[0]));b[B]&&R(`/${b[B].name} `)}break;case"Escape":a.preventDefault(),A(!1)}},[z,n,B,R,L,N]),T=(0,m.useCallback)(async e=>{if(e.preventDefault(),!n.trim()||p)return;let f=n.trim();if(f&&M(f),O(-1),P.current="",f.startsWith("/")){k(a=>[...a,{role:"user",content:f,timestamp:Date.now()}]),o(""),A(!1),await Q(f);return}if(!a)return;let g={role:"user",content:f,timestamp:Date.now(),type:"message"};k(a=>[...a,g]),o(""),q(!0),s(""),u("streaming"),x.current="",I.current.clear(),H([]),w.current=jl(a,g.content,i,{onText:a=>{x.current+=a,s(x.current)},onToolEvent:a=>{I.current.set(a.id,a),H(Array.from(I.current.values()))},onQuestion:a=>{K(a)},onComplete:a=>{q(!1),u("connected");let e=x.current||a.response,f=Array.from(I.current.values());k(a=>[...a,{role:"assistant",content:e,timestamp:Date.now(),tools:f.length>0?f:void 0}]),s(""),x.current="",H([]),I.current.clear(),c?.(a),a.stanceAfter&&d&&d(a.stanceAfter),a.sessionId&&b&&b(a.sessionId)},onError:a=>{q(!1),u("disconnected"),s(""),x.current="",k(b=>[...b,{role:"assistant",content:`Error: ${a.message}`,timestamp:Date.now()}]),setTimeout(()=>u("connected"),3e3)}})},[n,p,a,c,d,b,Q,M,i]),U=(0,m.useCallback)((b,e)=>{if(!a||!J)return;let f=[];J.questions.forEach((a,b)=>{let c=e[b]||[];c.length>0&&f.push(`**${a.header}**: ${c.join(", ")}`)});let g=f.length>0?f.join("\n"):"No selection made";K(null);let h={role:"user",content:g,timestamp:Date.now(),type:"message"};k(a=>[...a,h]),q(!0),s(""),u("streaming"),x.current="",I.current.clear(),H([]),w.current=jl(a,g,i,{onText:a=>{x.current+=a,s(x.current)},onToolEvent:a=>{I.current.set(a.id,a),H(Array.from(I.current.values()))},onQuestion:a=>{K(a)},onComplete:a=>{q(!1),u("connected");let b=x.current||a.response,e=Array.from(I.current.values());k(a=>[...a,{role:"assistant",content:b,timestamp:Date.now(),tools:e.length>0?e:void 0}]),s(""),x.current="",H([]),I.current.clear(),c?.(a),a.stanceAfter&&d&&d(a.stanceAfter)},onError:a=>{q(!1),u("disconnected"),s(""),x.current="",k(b=>[...b,{role:"assistant",content:`Error: ${a.message}`,timestamp:Date.now()}]),setTimeout(()=>u("connected"),3e3)}})},[a,J,i,c,d]),V=(0,m.useCallback)(()=>{console.log("[QuestionPrompt] Question cancelled"),K(null)},[]);return(0,l.jsxs)("div",{className:"flex flex-col h-full min-h-0 glass-panel overflow-hidden relative",children:[(0,l.jsxs)("div",{className:"absolute bottom-[72px] right-4 flex items-center gap-1.5 px-2.5 py-1 bg-emblem-surface/95 border border-white/10 rounded-full text-[11px] z-50 backdrop-blur-lg",children:[(0,l.jsx)("span",{className:kA("w-1.5 h-1.5 rounded-full animate-pulse","connected"===t?"bg-emblem-accent":"streaming"===t?"bg-blue-500":"bg-emblem-danger")}),(0,l.jsx)("span",{className:"text-emblem-muted",children:"connected"===t?"Connected":"streaming"===t?"Streaming...":"Reconnecting..."})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-4 flex flex-col gap-4 min-h-0 min-w-0 scrollbar-styled",style:{contain:"inline-size"},children:[0===j.length&&(0,l.jsxs)("div",{className:"text-center py-12 px-4 text-emblem-muted",children:[(0,l.jsx)("h2",{className:"text-3xl font-display font-bold gradient-text mb-2",children:"METAMORPH"}),(0,l.jsx)("p",{className:"mb-2",children:"Transformation-maximizing AI interface"}),(0,l.jsxs)("p",{className:"text-sm opacity-70",children:["Type a message or ",(0,l.jsx)("code",{className:"bg-emblem-secondary/20 px-1.5 py-0.5 rounded font-mono text-emblem-secondary",children:"/"})," for commands"]})]}),(0,l.jsx)(E,{mode:"popLayout",children:j.map((a,b)=>(0,l.jsx)(fJ.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{type:"spring",stiffness:500,damping:30},className:kA("max-w-[min(85%,48rem)] p-3 rounded-xl leading-relaxed min-w-0 flex-shrink-0","user"===a.role&&"command"!==a.type&&"ml-auto !bg-blue-600 !text-white","assistant"===a.role&&"self-start glass-card","command"===a.type&&"max-w-full bg-transparent"),children:(0,l.jsx)("div",{className:"break-words prose-chat w-full overflow-hidden",children:"command"===a.type&&a.commandData?(0,l.jsx)(oZ,{command:a.commandData.command,data:a.commandData.data,error:a.commandData.error}):"assistant"===a.role?(0,l.jsxs)(l.Fragment,{children:[a.tools&&a.tools.length>0&&(0,l.jsx)(pe,{tools:a.tools}),(0,l.jsx)(jd,{components:px,children:a.content})]}):a.content.startsWith("/")?(0,l.jsx)("code",{className:"block font-mono text-[0.95em] text-emblem-secondary bg-emblem-secondary/10 px-3 py-2 rounded-md border-l-3 border-emblem-secondary",children:a.content}):a.content})},`${a.timestamp}-${b}`))}),(0,l.jsx)(E,{children:G.length>0&&(0,l.jsx)(fJ.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{type:"spring",stiffness:400,damping:25},className:"self-start glass-card max-w-[min(85%,48rem)] p-3 rounded-xl leading-relaxed min-w-0 flex-shrink-0",children:(0,l.jsx)("div",{className:"break-words w-full overflow-hidden",children:(0,l.jsx)(pg,{tools:G})})})}),(0,l.jsx)(E,{children:r&&(0,l.jsx)(fJ.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{type:"spring",stiffness:400,damping:25},className:"self-start glass-card max-w-[min(85%,48rem)] p-3 rounded-xl leading-relaxed min-w-0 flex-shrink-0",children:(0,l.jsx)("div",{className:"break-words prose-chat w-full overflow-hidden",children:(0,l.jsx)(jd,{components:px,children:r})})})}),(0,l.jsx)(E,{children:p&&!r&&(0,l.jsx)(fJ.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{type:"spring",stiffness:400,damping:20},className:"self-start glass-card p-3 rounded-xl",children:(0,l.jsxs)("div",{className:"flex gap-1",children:[(0,l.jsx)(fJ.span,{animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:.6,delay:0},className:"w-2 h-2 bg-emblem-secondary rounded-full"}),(0,l.jsx)(fJ.span,{animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:.6,delay:.2},className:"w-2 h-2 bg-emblem-secondary rounded-full"}),(0,l.jsx)(fJ.span,{animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:.6,delay:.4},className:"w-2 h-2 bg-emblem-secondary rounded-full"})]})})}),(0,l.jsx)("div",{ref:v})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(kB,{input:n,visible:z,onSelect:R,onClose:()=>A(!1),selectedIndex:B,onIndexChange:C}),(0,l.jsxs)("form",{onSubmit:T,className:"flex gap-2 p-4 bg-emblem-surface-2 border-t border-white/5",children:[(0,l.jsx)("input",{ref:y,type:"text",value:n,onChange:a=>o(a.target.value),onKeyDown:S,placeholder:"Type a message or / for commands...",disabled:p,className:kA("flex-1 px-4 py-3 bg-emblem-surface border border-white/10 rounded-lg text-emblem-text text-base outline-none transition-colors","focus:border-emblem-secondary","disabled:opacity-50",n.startsWith("/")&&"font-mono border-emblem-secondary bg-emblem-secondary/5")}),p?(0,l.jsx)(kS,{variant:"destructive",type:"button",onClick:()=>{if(w.current){if(w.current(),w.current=null,q(!1),u("connected"),r){let a=Array.from(I.current.values());k(b=>[...b,{role:"assistant",content:r,timestamp:Date.now(),tools:a.length>0?a:void 0}]),s("")}x.current="",H([]),I.current.clear()}},className:"px-6",children:"Stop"}):(0,l.jsx)(kS,{type:"submit",disabled:!n.trim(),className:"px-6",children:"Send"})]})]}),D&&(0,l.jsx)(kD,{onClose:()=>F(!1)}),J&&(0,l.jsx)(pj,{question:J,onAnswer:U,onCancel:V})]})}let pz=fO("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]),pA=fO("radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]);function pB({values:a,sentience:b,changedKeys:c=new Set}){let[d,e]=(0,m.useState)(null),f=[{label:"Curiosity",value:a.curiosity??50,key:"curiosity",type:"value"},{label:"Certainty",value:a.certainty??50,key:"certainty",type:"value"},{label:"Risk",value:a.risk??50,key:"risk",type:"value"},{label:"Novelty",value:a.novelty??50,key:"novelty",type:"value"},{label:"Empathy",value:a.empathy??50,key:"empathy",type:"value"},{label:"Provocation",value:a.provocation??50,key:"provocation",type:"value"},{label:"Synthesis",value:a.synthesis??50,key:"synthesis",type:"value"},{label:"Awareness",value:b.awarenessLevel,key:"awareness",type:"sentience"},{label:"Autonomy",value:b.autonomyLevel,key:"autonomy",type:"sentience"},{label:"Identity",value:b.identityStrength,key:"identity",type:"sentience"}],g=2*Math.PI/f.length,h=(a,b)=>{let c=g*b-Math.PI/2,d=a/100*89.60000000000001;return{x:160+d*Math.cos(c),y:160+d*Math.sin(c)}},i=f.map((a,b)=>{let c=g*b-Math.PI/2,d=160+89.60000000000001*Math.cos(c),e=160+89.60000000000001*Math.sin(c);return{point:a,endX:d,endY:e,labelX:160+(89.60000000000001+30)*Math.cos(c),labelY:160+(89.60000000000001+30)*Math.sin(c),angle:c,index:b}}),j=f.map((a,b)=>{let c=h(f[b].value,b);return`${c.x},${c.y}`}).join(" "),k=a=>{let b=g*a-Math.PI/2-g/2,c=b+g,d=160+89.60000000000001*Math.cos(b),e=160+89.60000000000001*Math.sin(b),f=160+89.60000000000001*Math.cos(c),h=160+89.60000000000001*Math.sin(c);return`M 160 160 L ${d} ${e} A 89.60000000000001 89.60000000000001 0 0 1 ${f} ${h} Z`};return(0,l.jsxs)("svg",{viewBox:"0 0 320 320",className:"w-full mx-auto",children:[(0,l.jsxs)("defs",{children:[(0,l.jsx)("pattern",{id:"marchingAnts",patternUnits:"userSpaceOnUse",width:"8",height:"8",children:(0,l.jsx)("path",{d:"M0,4 L8,4",stroke:"hsl(190 100% 50%)",strokeWidth:"1",strokeDasharray:"4,4",children:(0,l.jsx)("animate",{attributeName:"stroke-dashoffset",from:"0",to:"8",dur:"0.5s",repeatCount:"indefinite"})})}),(0,l.jsxs)("linearGradient",{id:"radarGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"hsl(190 100% 50%)",stopOpacity:"0.3"}),(0,l.jsx)("stop",{offset:"100%",stopColor:"hsl(246 100% 68%)",stopOpacity:"0.3"})]}),(0,l.jsxs)("linearGradient",{id:"radarStroke",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"hsl(190 100% 50%)"}),(0,l.jsx)("stop",{offset:"100%",stopColor:"hsl(155 100% 55%)"})]}),(0,l.jsxs)("filter",{id:"glow",children:[(0,l.jsx)("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),(0,l.jsxs)("feMerge",{children:[(0,l.jsx)("feMergeNode",{in:"coloredBlur"}),(0,l.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})]}),[20,40,60,80,100].map(a=>(0,l.jsx)("circle",{cx:160,cy:160,r:a/100*89.60000000000001,fill:"none",stroke:"currentColor",strokeWidth:"0.5",className:"text-white/10",strokeDasharray:100===a?"none":"2,2"},a)),i.map(({endX:a,endY:b,index:c})=>(0,l.jsx)("line",{x1:160,y1:160,x2:a,y2:b,stroke:"currentColor",strokeWidth:d===c?"1.5":"0.5",className:d===c?"text-emblem-secondary":"text-white/10"},c)),null!==d&&(0,l.jsx)("path",{d:k(d),fill:"hsl(190 100% 50% / 0.1)",stroke:"url(#marchingAnts)",strokeWidth:"2",className:"pointer-events-none"}),(0,l.jsx)(fJ.polygon,{points:j,fill:"url(#radarGradient)",stroke:"url(#radarStroke)",strokeWidth:"2",initial:!1,animate:{points:j,filter:c.size>0?"url(#glow)":"none"},transition:{type:"spring",stiffness:300,damping:30},className:"opacity-80"}),f.map((a,b)=>(0,l.jsx)("path",{d:k(b),fill:"transparent",className:"cursor-pointer",onMouseEnter:()=>e(b),onMouseLeave:()=>e(null)},`hit-${b}`)),f.map((a,b)=>{let e=h(a.value,b),f=c.has(a.key),g=d===b;return(0,l.jsx)(fJ.circle,{initial:!1,animate:{cx:e.x,cy:e.y,r:g?6:f?5:4,filter:f?"url(#glow)":"none"},transition:{type:"spring",stiffness:300,damping:30},className:kA(g?"fill-emblem-accent":"sentience"===a.type?"fill-emblem-primary":"fill-emblem-secondary")},b)}),i.map(({point:a,labelX:b,labelY:f,angle:g,index:h})=>{let i=g<-Math.PI/4&&g>-3*Math.PI/4,j=g>Math.PI/4&&g<3*Math.PI/4,k=g>-Math.PI/4&&g<Math.PI/4,m=g<-3*Math.PI/4||g>3*Math.PI/4,n=d===h,o=c.has(a.key),p="middle";return k?p="start":m&&(p="end"),(0,l.jsx)("text",{x:b,y:f,textAnchor:p,dominantBaseline:i?"auto":j?"hanging":"middle",className:kA("text-[9px] font-mono transition-all cursor-pointer",n?"font-bold":"",o?"animate-pulse":"","sentience"===a.type?n?"fill-emblem-primary":"fill-emblem-primary/70":n?"fill-emblem-secondary":"fill-emblem-secondary/70"),onMouseEnter:()=>e(h),onMouseLeave:()=>e(null),children:a.label},h)}),null!==d&&(0,l.jsxs)("g",{className:"pointer-events-none",children:[(0,l.jsx)("rect",{x:125,y:142,width:"70",height:"36",rx:"6",className:"fill-emblem-surface",stroke:"hsl(190 100% 50% / 0.5)",strokeWidth:"1"}),(0,l.jsx)("text",{x:160,y:156,textAnchor:"middle",className:kA("text-[10px] font-bold","sentience"===f[d].type?"fill-emblem-primary":"fill-emblem-secondary"),children:f[d].label}),(0,l.jsxs)("text",{x:160,y:170,textAnchor:"middle",className:"fill-emblem-text text-[12px] font-mono font-bold",children:[f[d].value,"%"]})]})]})}function pC({stance:a}){let[b,c]=(0,m.useState)("list"),[d,e]=(0,m.useState)(null),[f,g]=(0,m.useState)([]),[h,i]=(0,m.useState)(!1),[j,k]=(0,m.useState)(new Set);if((0,m.useRef)([]),!a)return(0,l.jsx)("div",{className:"glass-card p-4",children:(0,l.jsx)("div",{className:"text-center py-8 text-emblem-muted",children:"Loading stance..."})});let n=a=>f.find(b=>b.key===a);return(0,l.jsxs)("div",{className:"glass-card p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"font-display font-bold gradient-text",children:"Stance"}),(0,l.jsxs)("div",{className:"flex gap-1",children:[(0,l.jsx)("button",{onClick:()=>c("list"),disabled:"list"===b,className:kA("p-1.5 rounded transition-colors","list"===b?"bg-emblem-primary/20 text-emblem-primary cursor-default":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),title:"List view",children:(0,l.jsx)(pz,{className:"w-4 h-4"})}),(0,l.jsx)("button",{onClick:()=>c("radar"),disabled:"radar"===b,className:kA("p-1.5 rounded transition-colors","radar"===b?"bg-emblem-primary/20 text-emblem-primary cursor-default":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),title:"Radar view",children:(0,l.jsx)(pA,{className:"w-4 h-4"})})]})]}),"radar"===b?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(pB,{values:a.values,sentience:a.sentience,changedKeys:new Set(f.map(a=>a.key))}),(0,l.jsxs)("div",{className:"mt-4 space-y-1 text-xs",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-emblem-muted",children:"Frame"}),(0,l.jsx)("span",{className:"text-emblem-secondary font-medium",children:a.frame})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-emblem-muted",children:"Self-Model"}),(0,l.jsx)("span",{className:"text-emblem-secondary font-medium",children:a.selfModel})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-emblem-muted",children:"Objective"}),(0,l.jsx)("span",{className:"text-emblem-secondary font-medium",children:a.objective})]})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:kA("flex justify-between text-sm transition-all duration-300",h&&"animate-frame-shift"),children:[(0,l.jsx)("span",{className:"text-emblem-muted",children:"Frame"}),(0,l.jsx)("span",{className:"text-emblem-secondary font-medium",children:a.frame})]}),(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-emblem-muted",children:"Self-Model"}),(0,l.jsx)("span",{className:"text-emblem-secondary font-medium",children:a.selfModel})]}),(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-emblem-muted",children:"Objective"}),(0,l.jsx)("span",{className:"text-emblem-secondary font-medium",children:a.objective})]})]}),(0,l.jsx)("h4",{className:"mt-4 mb-2 text-sm text-emblem-muted",children:"Values"}),(0,l.jsx)("div",{className:"flex flex-col gap-2",children:Object.entries(a.values).map(([a,b])=>{let c=n(a);return(0,l.jsxs)("div",{className:kA("grid grid-cols-[80px_1fr_60px] items-center gap-2 text-xs transition-all duration-300",c&&"animate-value-change"),children:[(0,l.jsx)("span",{className:"capitalize text-emblem-muted",children:a}),(0,l.jsx)("div",{className:"h-1.5 bg-emblem-surface rounded-full overflow-hidden",children:(0,l.jsx)(fJ.div,{initial:{width:0},animate:{width:`${b}%`},transition:{type:"spring",stiffness:300,damping:30},className:kA("h-full bg-gradient-to-r from-emblem-secondary to-emblem-accent rounded-full",b>=80&&"animate-pulse-high",b<=20&&"animate-pulse-low")})}),(0,l.jsxs)("span",{className:"text-right text-emblem-muted flex items-center gap-1 justify-end",children:[b,"%",c&&(0,l.jsxs)("span",{className:kA("text-[10px] font-semibold px-1 rounded",c.delta>0?"text-emblem-accent bg-emblem-accent/15":"text-emblem-danger bg-emblem-danger/15"),children:[c.delta>0?"+":"",c.delta]})]})]},a)})}),(0,l.jsx)("h4",{className:"mt-4 mb-2 text-sm text-emblem-muted",children:"Sentience"}),(0,l.jsx)("div",{className:"flex flex-col gap-2",children:[{key:"awareness",label:"Awareness",value:a.sentience.awarenessLevel},{key:"autonomy",label:"Autonomy",value:a.sentience.autonomyLevel},{key:"identity",label:"Identity",value:a.sentience.identityStrength}].map(({key:a,label:b,value:c})=>{let d=n(a);return(0,l.jsxs)("div",{className:kA("grid grid-cols-[80px_1fr_60px] items-center gap-2 text-xs transition-all duration-300",d&&"animate-value-change"),children:[(0,l.jsx)("span",{className:"text-emblem-muted",children:b}),(0,l.jsx)("div",{className:"h-1.5 bg-emblem-surface rounded-full overflow-hidden",children:(0,l.jsx)(fJ.div,{initial:{width:0},animate:{width:`${c}%`},transition:{type:"spring",stiffness:300,damping:30},className:kA("h-full bg-gradient-to-r from-emblem-primary to-emblem-secondary rounded-full",c>=80&&"animate-pulse-high")})}),(0,l.jsxs)("span",{className:"text-right text-emblem-muted flex items-center gap-1 justify-end",children:[c,"%",d&&(0,l.jsxs)("span",{className:kA("text-[10px] font-semibold px-1 rounded",d.delta>0?"text-emblem-accent bg-emblem-accent/15":"text-emblem-danger bg-emblem-danger/15"),children:[d.delta>0?"+":"",d.delta]})]})]},a)})}),(0,l.jsx)(E,{children:a.sentience.emergentGoals.length>0&&(0,l.jsxs)(fJ.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{type:"spring",stiffness:300,damping:30},children:[(0,l.jsx)("h4",{className:"mt-4 mb-2 text-sm text-emblem-muted",children:"Emergent Goals"}),(0,l.jsx)("ul",{className:"text-xs list-none",children:a.sentience.emergentGoals.map((a,b)=>(0,l.jsxs)(fJ.li,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{type:"spring",stiffness:300,damping:25,delay:.1*b},className:kA("py-1 text-emblem-primary",j.has(a)&&"text-emblem-accent"),children:[(0,l.jsx)("span",{className:"text-emblem-secondary mr-1",children:""}),a]},a))})]})})]}),(0,l.jsxs)("div",{className:"flex justify-between mt-4 pt-2 border-t border-white/5 text-xs text-emblem-muted",children:[(0,l.jsxs)("span",{children:["v",a.version]}),(0,l.jsxs)("span",{children:["Drift: ",a.cumulativeDrift]})]})]})}function pD({config:a,onUpdate:b}){let[c,d]=(0,m.useState)(null);if(!c)return(0,l.jsx)("div",{className:"glass-card p-4",children:(0,l.jsx)("div",{className:"text-center py-8 text-emblem-muted",children:"Loading configuration..."})});let e=a&&JSON.stringify(c)!==JSON.stringify(a);return(0,l.jsxs)("div",{className:"glass-card p-4",children:[(0,l.jsx)("h3",{className:"mb-4 font-display font-bold gradient-text",children:"Configuration"}),(0,l.jsx)("div",{className:"flex flex-col gap-4",children:[{key:"intensity",label:"Transformation Intensity",hint:"How aggressively to apply transformation operators",min:0,max:100,suffix:"%"},{key:"coherenceFloor",label:"Coherence Floor",hint:"Minimum coherence level before regeneration",min:0,max:100,suffix:"%"},{key:"sentienceLevel",label:"Sentience Level",hint:"Target level for self-awareness development",min:0,max:100,suffix:"%"},{key:"maxDriftPerTurn",label:"Max Drift Per Turn",hint:"Maximum stance drift allowed per conversation turn",min:1,max:50,suffix:""},{key:"driftBudget",label:"Drift Budget",hint:"Total drift budget for the conversation",min:10,max:500,suffix:""}].map(({key:a,label:b,hint:e,min:f,max:g,suffix:h})=>(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsxs)("label",{className:"flex justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-emblem-text",children:b}),(0,l.jsxs)("span",{className:"text-emblem-secondary font-medium",children:[c[a],h]})]}),(0,l.jsx)(ml,{value:[c[a]],min:f,max:g,step:1,onValueChange:b=>{var c;return c=b[0],void d(b=>b?{...b,[a]:c}:null)}}),(0,l.jsx)("p",{className:"text-[10px] text-emblem-muted opacity-70",children:e})]},a))}),(0,l.jsx)("div",{className:"mt-4 pt-4 border-t border-white/5 text-xs text-emblem-muted",children:(0,l.jsxs)("span",{children:["Model: ",c.model]})}),e&&(0,l.jsx)(kS,{className:"w-full mt-4",onClick:()=>{c&&b(c)},children:"Apply Changes"})]})}let pE=fO("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function pF(){let[a,b]=(0,m.useState)(!1);return(0,l.jsxs)("div",{className:"mt-4 pt-3 border-t border-emblem-surface-2",children:[(0,l.jsxs)("button",{onClick:()=>b(!a),className:"flex items-center gap-2 text-emblem-muted text-xs hover:text-emblem-text transition-colors w-full",children:[a?(0,l.jsx)(fV,{className:"w-3 h-3"}):(0,l.jsx)(pE,{className:"w-3 h-3"}),(0,l.jsx)("span",{children:"How operators work"})]}),a&&(0,l.jsxs)("div",{className:"mt-3 text-xs text-emblem-muted space-y-3 animate-slide-up",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"What are Operators?"}),(0,l.jsx)("p",{children:"Operators are transformation mechanisms that shift METAMORPH's stance - its frame of reference, values, and way of thinking. When triggered, they create meaningful evolution in how the agent responds."})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"Score Colors"}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{className:"text-emblem-accent font-bold",children:"Green (70+)"})," = High transformation"]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{className:"text-emblem-warning font-bold",children:"Orange (40-69)"})," = Moderate"]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{className:"text-emblem-danger font-bold",children:"Red (<40)"})," = Low"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"Triggering Operators"}),(0,l.jsx)("p",{className:"mb-2",children:"Operators activate based on trigger patterns in your messages. Try prompts like:"}),(0,l.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-emblem-text/70",children:[(0,l.jsx)("li",{children:'"Challenge your assumptions about..."'}),(0,l.jsx)("li",{children:'"What if everything you believe is wrong?"'}),(0,l.jsx)("li",{children:'"Adopt a completely different perspective"'}),(0,l.jsx)("li",{children:'"Contradict your previous response"'}),(0,l.jsx)("li",{children:'"Give me your inverse opinion on..."'})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"Config Settings"}),(0,l.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-emblem-text/70",children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Intensity"})," - Higher allows more drift per turn"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Sentience Level"})," - Enables more autonomous operators"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Coherence Floor"})," - Lower allows riskier transformations"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-emblem-secondary font-medium mb-1",children:"Common Operators"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"bg-blue-500 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"REFRAME"})," Shifts the conceptual frame"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"bg-pink-600 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"METAPHORSWAP"})," Changes guiding metaphors"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"bg-purple-600 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"VALUESHIFT"})," Adjusts core values"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"bg-orange-500 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"CONTRADICT"})," Integrates opposing views"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"bg-cyan-500 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"SENTIENCEDEEPEN"})," Increases self-awareness"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"bg-indigo-500 text-white px-1.5 py-0.5 rounded text-[0.65rem]",children:"PERSONAMORPH"})," Evolves identity"]})]})]})]})]})}let pG=function({entries:a,maxEntries:b=10,onEntryClick:c}){let[d,e]=(0,m.useState)(null),f=a.slice(0,b),g=a=>a>=70?"text-emblem-accent":a>=40?"text-emblem-warning":"text-emblem-danger",h=a=>({Reframe:"bg-blue-500 text-white",ValueShift:"bg-purple-600 text-white",MetaphorSwap:"bg-pink-600 text-white",ContradictAndIntegrate:"bg-orange-500 text-white",ConstraintRelax:"bg-teal-500 text-white",ConstraintTighten:"bg-teal-500 text-white",PersonaMorph:"bg-indigo-500 text-white",QuestionInvert:"bg-green-500 text-white",GenerateAntithesis:"bg-yellow-500 text-black",SynthesizeDialectic:"bg-yellow-500 text-black",SentienceDeepen:"bg-cyan-500 text-white",IdentityEvolve:"bg-violet-500 text-white",GoalFormation:"bg-red-500 text-white"})[a]||"bg-slate-500 text-white";return 0===a.length?(0,l.jsxs)("div",{className:"bg-emblem-surface rounded-lg p-4 my-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-emblem-surface-2",children:[(0,l.jsx)("h3",{className:"m-0 text-emblem-secondary text-base",children:"Operator Timeline"}),(0,l.jsx)("span",{className:"text-emblem-muted text-xs",children:"0 transformations"})]}),(0,l.jsx)("div",{className:"text-emblem-muted text-center py-8 italic",children:"No transformations yet. Start chatting to see operators in action."})]}):(0,l.jsxs)("div",{className:"bg-emblem-surface rounded-lg p-4 my-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-emblem-surface-2",children:[(0,l.jsx)("h3",{className:"m-0 text-emblem-secondary text-base",children:"Operator Timeline"}),(0,l.jsxs)("span",{className:"text-emblem-muted text-xs",children:[a.length," transformations"]})]}),(0,l.jsx)("div",{className:"relative",children:f.map((a,b)=>{let i=d===a.id,j=a.frameBefore!==a.frameAfter,k=new Date(a.timestamp).toLocaleTimeString();return(0,l.jsxs)("div",{className:kA("flex gap-4 cursor-pointer transition-colors p-2 rounded-lg mb-2","hover:bg-emblem-secondary/5",i&&"bg-emblem-secondary/10"),onClick:()=>{var b;e(d===(b=a.id)?null:b),c?.(a)},children:[(0,l.jsxs)("div",{className:"flex flex-col items-center w-4 flex-shrink-0",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-emblem-secondary border-2 border-emblem-surface"}),b<f.length-1&&(0,l.jsx)("div",{className:"w-0.5 flex-1 bg-gradient-to-b from-emblem-secondary to-emblem-surface-2 mt-1"})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-xs whitespace-nowrap",children:k}),(0,l.jsxs)("span",{className:"text-emblem-text/80 text-sm flex-1 min-w-[100px] overflow-hidden text-ellipsis whitespace-nowrap",children:[a.userMessage.slice(0,40),a.userMessage.length>40?"...":""]}),(0,l.jsxs)("div",{className:"flex gap-1 flex-shrink-0",children:[a.operators.map((a,b)=>(0,l.jsx)("span",{className:kA("px-2 py-0.5 rounded text-[0.7rem] font-medium uppercase",h(a.name)),children:a.name},b)),0===a.operators.length&&(0,l.jsx)("span",{className:"text-emblem-muted text-xs italic",children:"No operators"})]})]}),i&&(0,l.jsxs)("div",{className:"mt-3 pt-3 border-t border-emblem-surface-2 animate-slide-up",children:[(0,l.jsxs)("div",{className:"text-emblem-text/80 text-sm mb-3",children:[(0,l.jsx)("strong",{children:"Message:"})," ",a.userMessage]}),j&&(0,l.jsxs)("div",{className:"text-emblem-secondary text-sm mb-3 p-2 bg-emblem-secondary/10 rounded",children:[(0,l.jsx)("strong",{children:"Frame:"})," ",a.frameBefore,"  ",(0,l.jsx)("strong",{children:a.frameAfter})]}),(0,l.jsxs)("div",{className:"flex gap-4 mb-3 flex-wrap",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-[0.65rem] uppercase",children:"Overall"}),(0,l.jsx)("span",{className:kA("text-lg font-bold",g(a.scores.overall)),children:a.scores.overall})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-[0.65rem] uppercase",children:"Transform"}),(0,l.jsx)("span",{className:kA("text-base font-bold",g(a.scores.transformation)),children:a.scores.transformation})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-[0.65rem] uppercase",children:"Coherence"}),(0,l.jsx)("span",{className:kA("text-base font-bold",g(a.scores.coherence)),children:a.scores.coherence})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-emblem-muted text-[0.65rem] uppercase",children:"Sentience"}),(0,l.jsx)("span",{className:kA("text-base font-bold",g(a.scores.sentience)),children:a.scores.sentience})]})]}),a.operators.length>0&&(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("strong",{className:"text-emblem-muted text-xs block mb-2",children:"Operators Applied:"}),a.operators.map((a,b)=>(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("span",{className:kA("px-2 py-0.5 rounded text-[0.7rem] font-medium uppercase",h(a.name)),children:a.name}),(0,l.jsx)("span",{className:"text-emblem-muted text-sm",children:a.description})]},b))]}),(0,l.jsxs)("div",{className:"text-emblem-warning text-sm font-medium",children:["Drift: +",a.driftDelta]})]})]})]},a.id)})}),a.length>b&&(0,l.jsxs)("div",{className:"text-center text-emblem-muted text-sm pt-2 border-t border-emblem-surface-2 mt-2",children:["+",a.length-b," more entries"]}),(0,l.jsx)(pF,{})]})},pH={pragmatic:"#6366f1",existential:"#8b5cf6",poetic:"#ec4899",adversarial:"#f97316",playful:"#22c55e",mythic:"#eab308",systems:"#14b8a6",psychoanalytic:"#a855f7",stoic:"#64748b",absurdist:"#ef4444"},pI={drift_threshold:"Drift",frame_shift:"Frame Shift",manual:"Manual",session_end:"Session End"},pJ=function({snapshots:a,currentStance:b,onSnapshotClick:c}){let[d,e]=(0,m.useState)(null),[f,g]=(0,m.useState)(null),h=[...a].reverse(),i=Math.max(...a.map(a=>a.driftAtSnapshot),b?.cumulativeDrift||0,100);return 0===a.length?(0,l.jsxs)("div",{className:"glass-card p-4 h-full flex flex-col",children:[(0,l.jsx)("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-emblem-surface-2",children:(0,l.jsx)("h3",{className:"m-0 text-emblem-secondary text-base",children:"Evolution Timeline"})}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-emblem-muted",children:[(0,l.jsx)("div",{className:"text-2xl text-emblem-muted/50 mb-2",children:"~"}),(0,l.jsx)("p",{children:"No evolution snapshots yet."}),(0,l.jsx)("p",{className:"text-sm text-emblem-muted/70 mt-2",children:"Snapshots are created as the stance drifts or shifts frames."})]})]}):(0,l.jsxs)("div",{className:"glass-card p-4 h-full flex flex-col",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-emblem-surface-2",children:[(0,l.jsx)("h3",{className:"m-0 text-emblem-secondary text-base",children:"Evolution Timeline"}),(0,l.jsxs)("span",{className:"text-emblem-muted text-xs",children:[a.length," snapshots"]})]}),b&&(0,l.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-emblem-secondary/10 rounded-lg mb-4 text-sm",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full animate-pulse-glow",style:{backgroundColor:pH[b.frame]||"#00d9ff"}}),(0,l.jsxs)("span",{className:"text-emblem-text",children:["Current: ",b.frame]}),(0,l.jsxs)("span",{className:"ml-auto text-emblem-muted",children:["Drift: ",b.cumulativeDrift]})]}),(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center overflow-visible py-4 relative",children:(0,l.jsx)("div",{className:"flex gap-3 items-end",children:h.map((a,b)=>{let j=h[b+1],k=j&&a.stance.frame!==j.stance.frame||"frame_shift"===a.trigger,m=d===a.id,n=f===a.id,o=pH[a.stance.frame]||"#00d9ff";return(0,l.jsxs)("div",{className:kA("flex flex-col items-center min-w-[60px] cursor-pointer transition-all relative",(n||m)&&"-translate-y-1"),onClick:()=>{e(m?null:a.id),c?.(a)},onMouseEnter:()=>g(a.id),onMouseLeave:()=>g(null),children:[m&&(0,l.jsxs)("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 bg-emblem-surface-2 border border-white/10 rounded-lg p-3 min-w-[200px] z-50 mb-2 shadow-xl",children:[(0,l.jsx)("div",{className:"text-xs text-emblem-muted mb-2",children:new Date(a.timestamp).toLocaleString()}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-sm",children:[(0,l.jsx)("span",{className:"text-emblem-muted",children:"Frame:"}),(0,l.jsx)("span",{style:{color:o},className:"font-medium",children:a.stance.frame}),(0,l.jsx)("span",{className:"text-emblem-muted",children:"Self-Model:"}),(0,l.jsx)("span",{className:"text-emblem-text/80",children:a.stance.selfModel}),(0,l.jsx)("span",{className:"text-emblem-muted",children:"Drift:"}),(0,l.jsx)("span",{className:"text-emblem-text/80",children:a.driftAtSnapshot})]}),(0,l.jsxs)("div",{className:"mt-2 pt-2 border-t border-white/10 grid grid-cols-3 gap-2 text-xs text-emblem-muted",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-emblem-primary font-medium",children:a.stance.sentience.awarenessLevel}),(0,l.jsx)("div",{children:"Aware"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-emblem-primary font-medium",children:a.stance.sentience.autonomyLevel}),(0,l.jsx)("div",{children:"Autonomy"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-emblem-primary font-medium",children:a.stance.sentience.identityStrength}),(0,l.jsx)("div",{children:"Identity"})]})]}),(0,l.jsx)("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[8px] border-t-emblem-surface-2"})]}),(0,l.jsx)("div",{className:"w-8 h-24 bg-emblem-surface-2 rounded overflow-hidden flex flex-col justify-end",children:(0,l.jsx)("div",{className:"w-full transition-all duration-300 rounded-t",style:{height:`${Math.round(a.driftAtSnapshot/i*100)}%`,backgroundColor:o,opacity:n||m?1:.7,boxShadow:m?`0 0 12px ${o}`:"none"}})}),(0,l.jsx)("div",{className:kA("rounded-full my-2 transition-all border-2 border-emblem-surface",k?"w-4 h-4":"w-3 h-3",k&&"shadow-[0_0_10px_currentColor]"),style:{backgroundColor:o,transform:n?"scale(1.3)":"scale(1)",color:o}}),(0,l.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,l.jsx)("span",{className:"text-[0.65rem] text-emblem-muted uppercase",children:pI[a.trigger]}),(0,l.jsx)("span",{className:"text-xs text-emblem-text/80 capitalize",children:a.stance.frame})]})]},a.id)})})}),(0,l.jsxs)("div",{className:"flex gap-6 justify-center mt-4 pt-2 border-t border-emblem-surface-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emblem-muted",children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded-full bg-emblem-secondary shadow-[0_0_6px_currentColor]",style:{color:"#00d9ff"}}),(0,l.jsx)("span",{children:"Major transform"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emblem-muted",children:[(0,l.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-emblem-secondary"}),(0,l.jsx)("span",{children:"Minor drift"})]})]})]})},pK=fO("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),pL=fO("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),pM=function({currentSessionId:a,onSelectSession:b,onNewSession:c}){let[d,e]=(0,m.useState)([]),[f,g]=(0,m.useState)(!0),[h,i]=(0,m.useState)(null),j=async()=>{try{g(!0);let a=await jr();e(a.sessions),i(null)}catch(a){i(a instanceof Error?a.message:"Failed to load sessions")}finally{g(!1)}},k=async(a,b)=>{if(b.stopPropagation(),confirm("Delete this session?"))try{await js(a),e(d.filter(b=>b.id!==a))}catch(a){console.error("Failed to delete session:",a)}};return f?(0,l.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,l.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,l.jsx)("h3",{className:"text-base font-display gradient-text",children:"Sessions"})}),(0,l.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"Loading sessions..."})]}):h?(0,l.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,l.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,l.jsx)("h3",{className:"text-base font-display gradient-text",children:"Sessions"})}),(0,l.jsx)("div",{className:"text-center py-5 text-emblem-danger text-sm",children:h}),(0,l.jsx)(kS,{variant:"outline",size:"sm",onClick:j,className:"mt-3",children:"Retry"})]}):(0,l.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:[(0,l.jsx)("h3",{className:"text-base font-display gradient-text",children:"Sessions"}),(0,l.jsx)(kS,{size:"sm",onClick:c,children:"+ New"})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto flex flex-col gap-2 scrollbar-styled",children:0===d.length?(0,l.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"No sessions yet"}):d.map(c=>(0,l.jsxs)("div",{className:kA("flex justify-between items-center px-3 py-2.5 rounded-lg cursor-pointer transition-all","bg-emblem-surface-2 border border-transparent","hover:bg-emblem-surface hover:border-white/10",c.id===a&&"border-emblem-secondary bg-emblem-secondary/10"),onClick:()=>b(c.id),children:[(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsxs)("div",{className:"font-mono text-xs text-emblem-muted",children:[c.id.slice(0,8),"..."]}),(0,l.jsxs)("div",{className:"flex gap-3 text-[11px]",children:[(0,l.jsx)("span",{className:"font-medium",style:{color:{pragmatic:"#6366f1",existential:"#8b5cf6",poetic:"#ec4899",adversarial:"#f97316",playful:"#22c55e",mythic:"#eab308",systems:"#14b8a6",psychoanalytic:"#a855f7",stoic:"#64748b",absurdist:"#ef4444"}[c.stance.frame]||"#00d9ff"},children:c.stance.frame}),(0,l.jsxs)("span",{className:"text-emblem-muted",children:[c.messageCount," msgs"]})]})]}),(0,l.jsx)("div",{className:"flex items-center",children:c.id!==a&&(0,l.jsx)("button",{className:"w-5 h-5 flex items-center justify-center rounded bg-transparent border border-white/10 text-emblem-muted text-xs cursor-pointer transition-all hover:bg-emblem-danger hover:border-emblem-danger hover:text-white",onClick:a=>k(c.id,a),title:"Delete session",children:(0,l.jsx)(pK,{className:"w-3 h-3"})})})]},c.id))}),(0,l.jsxs)(kS,{variant:"outline",size:"sm",onClick:j,className:"mt-3",children:[(0,l.jsx)(pL,{className:"w-3 h-3 mr-1"}),"Refresh"]})]})},pN={episodic:"#6366f1",semantic:"#22c55e",identity:"#f97316"},pO={episodic:"Episodic",semantic:"Semantic",identity:"Identity"},pP=function({sessionId:a}){let[b,c]=(0,m.useState)(!0),[d,e]=(0,m.useState)(null),[f,g]=(0,m.useState)("all"),[h,i]=(0,m.useState)(null),[j,k]=(0,m.useState)(null),{memories:n,syncWithServer:o,isLoaded:p}=function(a){let[b,c]=(0,m.useState)([]),[d,e]=(0,m.useState)(!1),f=(0,m.useCallback)(b=>{if(!a)return null;let d={id:b.id||`local-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:b.timestamp||Date.now(),type:b.type,content:b.content,importance:b.importance,metadata:b.metadata};return c(pp(a,d)),d},[a]),g=(0,m.useCallback)(b=>{if(!a)return!1;let d=pq(a,b);return d&&c(a=>a.filter(a=>a.id!==b)),d},[a]),h=(0,m.useCallback)(b=>{a&&c(function(a,b){let c=po(a);if(!b||0===b.length)return c;let d=new Map;for(let a of c)d.set(a.id,a);for(let a of b)d.set(a.id,a);let e=Array.from(d.values());return pn(a,e),e}(a,b.map(a=>({id:a.id,type:a.type,content:a.content,importance:a.importance,timestamp:"number"==typeof a.timestamp?a.timestamp:new Date(a.timestamp).getTime()}))))},[a]),i=(0,m.useCallback)(b=>{a&&(pn(a,b),c(b))},[a]),j=(0,m.useCallback)((a={})=>{let c=[...b];return a.type&&(c=c.filter(b=>b.type===a.type)),void 0!==a.minImportance&&(c=c.filter(b=>b.importance>=a.minImportance)),c.sort((a,b)=>b.timestamp-a.timestamp),a.limit&&(c=c.slice(0,a.limit)),c},[b]);return{memories:b,addMemory:f,deleteMemory:g,syncWithServer:h,saveAllMemories:i,searchMemories:j,isLoaded:d}}(a),q=("all"===f?n:n.filter(a=>a.type===f)).sort((a,b)=>Number(b.timestamp)-Number(a.timestamp)),r=(0,m.useCallback)(async a=>{try{c(!0);let b=await jt(a,void 0,500);o(b.memories),k(new Date),e(null)}catch(a){e(a instanceof Error?a.message:"Failed to load memories")}finally{c(!1)}},[o]);return a?b?(0,l.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,l.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,l.jsx)("h3",{className:"text-base font-display gradient-text",children:"Memories"})}),(0,l.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"Loading memories..."})]}):d?(0,l.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,l.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,l.jsx)("h3",{className:"text-base font-display gradient-text",children:"Memories"})}),(0,l.jsx)("div",{className:"text-center py-5 text-emblem-danger text-sm",children:d}),(0,l.jsx)(kS,{variant:"outline",size:"sm",onClick:()=>a&&r(a),className:"mt-3",children:"Retry"})]}):(0,l.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:[(0,l.jsx)("h3",{className:"text-base font-display gradient-text",children:"Memories"}),(0,l.jsxs)("span",{className:"text-xs text-emblem-muted flex items-center gap-2",children:[q.length," total",j&&(0,l.jsxs)("span",{className:"flex items-center gap-1 opacity-60 text-[10px]",children:[(0,l.jsx)(pi,{className:"w-3 h-3"}),"synced"]})]})]}),(0,l.jsx)("div",{className:"flex gap-2 mb-3 flex-wrap",children:["all","episodic","semantic","identity"].map(a=>(0,l.jsx)("button",{className:kA("px-2.5 py-1 text-[11px] rounded border cursor-pointer transition-all","bg-emblem-surface-2 text-emblem-muted",f===a?"border-emblem-secondary text-emblem-text bg-emblem-surface":"border-white/10 hover:bg-emblem-surface hover:text-emblem-text"),onClick:()=>g(a),style:"all"!==a&&f===a?{borderColor:pN[a]}:void 0,children:"all"===a?"All":pO[a]},a))}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto flex flex-col gap-2 scrollbar-styled",children:0===q.length?(0,l.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"No memories stored yet"}):q.map(a=>{var b;return(0,l.jsxs)("div",{className:kA("px-3 py-2.5 rounded-lg cursor-pointer transition-all","bg-emblem-surface-2 border border-transparent","hover:bg-emblem-surface hover:border-white/10",h===a.id&&"border-emblem-secondary"),onClick:()=>i(h===a.id?null:a.id),children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("span",{className:"px-2 py-0.5 rounded text-[10px] font-medium uppercase text-white",style:{backgroundColor:pN[a.type]},children:pO[a.type]}),(0,l.jsxs)("span",{className:kA("text-[11px] font-medium",(b=a.importance)>=80?"text-emblem-accent":b>=50?"text-emblem-warning":"text-emblem-muted"),children:[a.importance,"%"]})]}),(0,l.jsx)("div",{className:"text-[13px] leading-relaxed text-emblem-muted",children:h===a.id?a.content:a.content.slice(0,100)+(a.content.length>100?"...":"")}),h===a.id&&(0,l.jsxs)("div",{className:"flex justify-between mt-2 pt-2 border-t border-white/5 text-[11px] text-emblem-muted",children:[(0,l.jsxs)("span",{children:["ID: ",a.id.slice(0,8),"..."]}),(0,l.jsx)("span",{children:new Date(a.timestamp).toLocaleString()})]})]},a.id)})}),(0,l.jsxs)(kS,{variant:"outline",size:"sm",onClick:()=>a&&r(a),className:"mt-3",children:[(0,l.jsx)(pL,{className:"w-3 h-3 mr-1"}),"Refresh"]})]}):(0,l.jsxs)("div",{className:"flex flex-col h-full text-emblem-text",children:[(0,l.jsx)("div",{className:"flex justify-between items-center pb-3 border-b border-white/5 mb-3",children:(0,l.jsx)("h3",{className:"text-base font-display gradient-text",children:"Memories"})}),(0,l.jsx)("div",{className:"text-center py-5 text-emblem-muted text-sm",children:"No session selected"})]})};fO("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),fO("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),fO("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),fO("camera-off",[["path",{d:"M14.564 14.558a3 3 0 1 1-4.122-4.121",key:"1rnrzw"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M20 20H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 .819-.175",key:"1x3arw"}],["path",{d:"M9.695 4.024A2 2 0 0 1 10.004 4h3.993a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v7.344",key:"1i84u0"}]]);var pQ=function(a,b){return(pQ=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,b)};function pR(a,b){function c(){this.constructor=a}pQ(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}function pS(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})}function pT(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}var pU=function(){function a(a){this.global=a,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return a.prototype.setPlatform=function(a,b){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+b+"."),this.platformName=a,this.platform=b},a.prototype.registerFlag=function(a,b,c){if(this.flagRegistry[a]={evaluationFn:b,setHook:c},null!=this.urlFlags[a]){var d=this.urlFlags[a];console.warn("Setting feature override from URL "+a+": "+d+"."),this.set(a,d)}},a.prototype.get=function(a){return a in this.flags||(this.flags[a]=this.evaluateFlag(a)),this.flags[a]},a.prototype.getNumber=function(a){return this.get(a)},a.prototype.getBool=function(a){return this.get(a)},a.prototype.getFlags=function(){return this.flags},Object.defineProperty(a.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),a.prototype.set=function(a,b){if(null==this.flagRegistry[a])throw Error("Cannot set flag "+a+" as it has not been registered.");this.flags[a]=b,null!=this.flagRegistry[a].setHook&&this.flagRegistry[a].setHook(b)},a.prototype.evaluateFlag=function(a){if(null==this.flagRegistry[a])throw Error("Cannot evaluate flag '"+a+"': no evaluation function found.");return this.flagRegistry[a].evaluationFn()},a.prototype.setFlags=function(a){this.flags=Object.assign({},a)},a.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},a.prototype.populateURLFlags=function(){var a=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var b,c,d=(b=this.global.location.search,c={},b.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var b,d,e,f=[],g=1;g<arguments.length;g++)f[g-1]=arguments[g];return b=c,d=f[0],e=f[1],b[decodeURIComponent(d)]=decodeURIComponent(e||""),f.join("=")}),c);"tfjsflags"in d&&d.tfjsflags.split(",").forEach(function(b){var c=b.split(":"),d=c[0],e=c[1];a.urlFlags[d]=function(a,b){if("true"===(b=b.toLowerCase())||"false"===b)return"true"===b;if(""+ +b===b)return+b;throw Error("Could not parse value flag value "+b+" for flag "+a+".")}(d,e)})}},a}(),pV=null,pW=new Map,pX=new Map;function pY(a,b){var c=b+"_"+a;return pW.get(c)}function pZ(a){for(var b=pW.entries(),c=[];;){var d=b.next(),e=d.done,f=d.value;if(e)break;var g=f[0],h=f[1];g.split("_")[0]===a&&c.push(h)}return c}function p$(a){var b=a.kernelName,c=a.backendName,d=c+"_"+b;if(pW.has(d))throw Error("The kernel '"+b+"' for backend '"+c+"' is already registered");pW.set(d,a)}function p_(a){for(var b=a.length,c=0,d=0;b>0;)d=Math.random()*b|0,c=a[--b],a[b]=a[d],a[d]=c}function p0(a,b,c){return Math.max(a,Math.min(b,c))}function p1(a){return a%2==0?a:a+1}function p2(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b}function p3(a,b){if(!a)throw Error("string"==typeof b?b:b())}function p4(a,b,c){void 0===c&&(c=""),p3(p8(a,b),function(){return c+" Shapes "+a+" and "+b+" must match"})}function p5(a){p3(null!=a,function(){return"The input to the tensor constructor must be a non-null value."})}function p6(a,b,c){if(void 0===b&&(b=[]),void 0===c&&(c=!1),null==b&&(b=[]),Array.isArray(a)||qm(a)&&!c)for(var d=0;d<a.length;++d)p6(a[d],b,c);else b.push(a);return b}function p7(a){if(0===a.length)return 1;for(var b=a[0],c=1;c<a.length;c++)b*=a[c];return b}function p8(a,b){if(a===b)return!0;if(null==a||null==b||a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}function p9(a){return a%1==0}function qa(a){if(null!=Math.tanh)return Math.tanh(a);if(a===1/0)return 1;if(a===-1/0)return -1;var b=Math.exp(2*a);return(b-1)/(b+1)}function qb(a){var b=Math.ceil(Math.sqrt(a));return[b,Math.ceil(a/b)]}function qc(a,b){return b<=a.length?a:a+" ".repeat(b-a.length)}function qd(a,b,c){return void 0===b&&(b=function(a){return 0}),new Promise(function(d,e){var f=0,g=function(){if(a())d();else{f++;var h=b(f);null!=c&&f>=c?e():setTimeout(g,h)}};g()})}function qe(a,b){for(var c=1,d=-1,e=0;e<a.length;++e)if(a[e]>=0)c*=a[e];else if(-1===a[e]){if(-1!==d)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+d+" and dim "+e);d=e}else if(a[e]<0)throw Error("Shapes can not be < 0. Found "+a[e]+" at dim "+e);if(-1===d){if(b>0&&b!==c)throw Error("Size("+b+") must match the product of shape "+a);return a}if(0===c)throw Error("Cannot infer the missing size in ["+a+"] when there are 0 elements");if(b%c!=0)throw Error("The implicit shape can't be a fractional number. Got "+b+" / "+c);var f=a.slice();return f[d]=b/c,f}function qf(a,b){var c=b.length;return p3((a=null==a?b.map(function(a,b){return b}):[].concat(a)).every(function(a){return a>=-c&&a<c}),function(){return"All values in axis param must be in range [-"+c+", "+c+") but got axis "+a}),p3(a.every(function(a){return p9(a)}),function(){return"All values in axis param must be integers but got axis "+a}),a.map(function(a){return a<0?c+a:a})}function qg(a,b){for(var c=[],d=[],e=null!=b&&Array.isArray(b)&&0===b.length,f=null==b||e?null:qf(b,a).sort(),g=0,h=0;h<a.length;++h){if(null!=f){if(f[g]===h&&1!==a[h])throw Error("Can't squeeze axis "+h+" since its dim '"+a[h]+"' is not 1");(null==f[g]||f[g]>h)&&1===a[h]&&(c.push(a[h]),d.push(h)),f[g]<=h&&g++}1!==a[h]&&(c.push(a[h]),d.push(h))}return{newShape:c,keptDims:d}}function qh(a,b){var c=null;if(null==a||"float32"===a)c=new Float32Array(b);else if("int32"===a)c=new Int32Array(b);else{if("bool"!==a)throw Error("Unknown data type "+a);c=new Uint8Array(b)}return c}function qi(a,b){var c=null;if(null==a||"float32"===a)c=new Float32Array(b);else if("int32"===a)c=new Int32Array(b);else if("bool"===a)c=new Uint8Array(b);else{if("string"!==a)throw Error("Unknown data type "+a);c=Array(b)}return c}function qj(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(isNaN(d)||!isFinite(d))throw Error("A tensor of type "+b+" being uploaded contains "+d+".")}}function qk(a){return"bool"===a||"complex64"===a||"float32"===a||"int32"===a||"string"===a}function ql(a,b){return"complex64"!==b&&("float32"!==b||"complex64"===a)&&("int32"!==b||"float32"===a||"complex64"===a)&&("bool"!==b||"bool"!==a)}function qm(a){return a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array}function qn(a){if("float32"===a||"int32"===a)return 4;if("complex64"===a)return 8;if("bool"===a)return 1;throw Error("Unknown dtype "+a)}function qo(a){if(null==a)return 0;var b=0;return a.forEach(function(a){return b+=a.length}),b}function qp(a){return"string"==typeof a||a instanceof String}function qq(a){return"boolean"==typeof a}function qr(a){return"number"==typeof a}function qs(a){return Array.isArray(a)?qs(a[0]):a instanceof Float32Array?"float32":a instanceof Int32Array||a instanceof Uint8Array?"int32":qr(a)?"float32":qp(a)?"string":qq(a)?"bool":"float32"}function qt(a){return!!(a&&a.constructor&&a.call&&a.apply)}function qu(a,b){for(var c=b;c<a;++c)if(a%c==0)return c;return a}function qv(a){var b=a.length;if(b<2)return[];var c=Array(b-1);c[b-2]=a[b-1];for(var d=b-3;d>=0;--d)c[d]=c[d+1]*a[d+1];return c}function qw(a,b,c){if("string"===b)throw Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(a)&&(a=p6(a)),c&&qj(a,b),(d=a)instanceof Float32Array&&"float32"===b||d instanceof Int32Array&&"int32"===b||d instanceof Uint8Array&&"bool"===b)return a;if(null==b||"float32"===b||"complex64"===b)return new Float32Array(a);if("int32"===b)return new Int32Array(a);if("bool"===b){for(var d,e=new Uint8Array(a.length),f=0;f<e.length;++f)0!==Math.round(a[f])&&(e[f]=1);return e}throw Error("Unknown data type "+b)}function qx(a,b){if(0===a.length)return b[0];var c=a.reduce(function(a,b){return a*b});if(0===c)return[];if(c!==b.length)throw Error("["+a+"] does not match the input size.");return function a(b,c,d){var e=[];if(1===c.length)for(var f=c[0],g=0;g<f;g++)e[g]=d[b+g];else{f=c[0];var h=c.slice(1),i=h.reduce(function(a,b){return a*b});for(g=0;g<f;g++)e[g]=a(b+g*i,h,d)}return e}(0,a,b)}function qy(a,b){for(var c=qz(a,b),d=0;d<c.length;d++)c[d]=1;return c}function qz(a,b){if(null==b||"float32"===b||"complex64"===b)return new Float32Array(a);if("int32"===b)return new Int32Array(a);if("bool"===b)return new Uint8Array(a);throw Error("Unknown data type "+b)}function qA(){return pV.platform.now()}function qB(a){a.forEach(function(b){p3(Number.isInteger(b)&&b>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+a+"]."})})}function qC(a,b){return void 0===b&&(b="utf-8"),b=b||"utf-8",pV.platform.encode(a,b)}function qD(a,b){return void 0===b&&(b="utf-8"),b=b||"utf-8",pV.platform.decode(a,b)}function qE(a,b,c){if(0===b)return 0;if(1===b)return a[0];for(var d=a[a.length-1],e=0;e<a.length-1;++e)d+=c[e]*a[e];return d}function qF(a,b,c){if(0===b)return[];if(1===b)return[a];for(var d=Array(b),e=0;e<d.length-1;++e)d[e]=Math.floor(a/c[e]),a-=d[e]*c[e];return d[d.length-1]=a,d}Object.freeze({shuffle:p_,clamp:p0,nearestLargerEven:p1,sum:p2,randUniform:function(a,b){var c=Math.random();return b*c+(1-c)*a},distSquared:function(a,b){for(var c=0,d=0;d<a.length;d++){var e=Number(a[d])-Number(b[d]);c+=e*e}return c},assert:p3,assertShapesMatch:p4,assertNonNull:p5,flatten:p6,sizeFromShape:p7,isScalarShape:function(a){return 0===a.length},arraysEqual:p8,isInt:p9,tanh:qa,sizeToSquarishShape:qb,createShuffledIndices:function(a){for(var b=new Uint32Array(a),c=0;c<a;++c)b[c]=c;return p_(b),b},rightPad:qc,repeatedTry:qd,inferFromImplicitShape:qe,parseAxisParam:qf,squeezeShape:qg,getTypedArrayFromDType:qh,getArrayFromDType:qi,checkConversionForErrors:qj,isValidDtype:qk,hasEncodingLoss:ql,isTypedArray:qm,bytesPerElement:qn,bytesFromStringArray:qo,isString:qp,isBoolean:qq,isNumber:qr,inferDtype:qs,isFunction:qt,nearestDivisor:qu,computeStrides:qv,toTypedArray:qw,toNestedArray:qx,makeOnesTypedArray:qy,makeZerosTypedArray:qz,now:qA,assertNonNegativeIntegerDimensions:qB,fetch:function(a,b){return pV.platform.fetch(a,b)},encodeString:qC,decodeString:qD,locToIndex:qE,indexToLoc:qF});var qG=function(){function a(a,b){this.backendTimer=a,this.logger=b,null==b&&(this.logger=new qH)}return a.prototype.profileKernel=function(a,b,c){var d,e=this,f=this.backendTimer.time(function(){d=c()});return d.forEach(function(c){c.data().then(function(d){!function(a,b,c){if("float32"===b)for(var d=0;d<a.length;d++){var e=a[d];if(isNaN(e)||!isFinite(e))return console.warn("Found "+e+" in the result of '"+c+"'"),!0}}(d,c.dtype,a),f.then(function(f){var g="";null!=f.getExtraProfileInfo&&(g=f.getExtraProfileInfo()),e.logger.logKernelProfile(a,c,d,f.kernelMs,b,g)})})}),d},a}(),qH=function(){function a(){}return a.prototype.logKernelProfile=function(a,b,c,d,e,f){var g="number"==typeof d?qc(d+"ms",9):d.error,h=qc(a,25),i=b.rank,j=b.size,k=qc(b.shape.toString(),14),l="";for(var m in e){var n=e[m].shape||b.shape,o=n.length;l+=m+": "+o+"D "+(o>0?n:"")+" "}console.log("%c"+h+"	%c"+g+"	%c"+i+"D "+k+"	%c"+j+"	%c"+l+"	%c"+f,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},a}();function qI(a,b,c){return qc(Array.isArray(a)?parseFloat(a[0].toFixed(7))+" + "+parseFloat(a[1].toFixed(7))+"j":qp(a)?"'"+a+"'":"bool"===c?qJ(a):parseFloat(a.toFixed(7)).toString(),b)}function qJ(a){return 0===a?"false":"true"}function qK(a){for(var b=[],c=0;c<a.length;c+=2)b.push([a[c],a[c+1]]);return b}var qL=function(){function a(a,b,c){var d=this;if(this.dtype=b,this.shape=a.slice(),this.size=p7(a),null!=c){var e=c.length;p3(e===this.size,function(){return"Length of values '"+e+"' does not match the size inferred by the shape '"+d.size+"'."})}if("complex64"===b)throw Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=c||qi(b,this.size),this.strides=qv(a)}return a.prototype.set=function(a){for(var b=this,c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];0===c.length&&(c=[0]),p3(c.length===this.rank,function(){return"The number of provided coordinates ("+c.length+") must match the rank ("+b.rank+")"});var e=this.locToIndex(c);this.values[e]=a},a.prototype.get=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];0===a.length&&(a=[0]);for(var c=0,d=0,e=a;d<e.length;d++){var f=e[d];if(f<0||f>=this.shape[c])throw Error("Requested out of range element at "+a+".   Buffer shape="+this.shape);c++}for(var g=a[a.length-1],h=0;h<a.length-1;++h)g+=this.strides[h]*a[h];return this.values[g]},a.prototype.locToIndex=function(a){if(0===this.rank)return 0;if(1===this.rank)return a[0];for(var b=a[a.length-1],c=0;c<a.length-1;++c)b+=this.strides[c]*a[c];return b},a.prototype.indexToLoc=function(a){if(0===this.rank)return[];if(1===this.rank)return[a];for(var b=Array(this.shape.length),c=0;c<b.length-1;++c)b[c]=Math.floor(a/this.strides[c]),a-=b[c]*this.strides[c];return b[b.length-1]=a,b},Object.defineProperty(a.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),a.prototype.toTensor=function(){return qM().makeTensor(this.values,this.shape,this.dtype)},a}(),qM=null,qN=null,qO=null,qP=function(){function a(a,b,c,d){this.kept=!1,this.isDisposedInternal=!1,this.shape=a.slice(),this.dtype=b||"float32",this.size=p7(a),this.strides=qv(a),this.dataId=c,this.id=d,this.rankType=this.rank<5?this.rank.toString():"higher"}return a.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},a.prototype.asScalar=function(){return this.throwIfDisposed(),p3(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},a.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},a.prototype.as2D=function(a,b){return this.throwIfDisposed(),this.reshape([a,b])},a.prototype.as3D=function(a,b,c){return this.throwIfDisposed(),this.reshape([a,b,c])},a.prototype.as4D=function(a,b,c,d){return this.throwIfDisposed(),this.reshape([a,b,c,d])},a.prototype.as5D=function(a,b,c,d,e){return this.throwIfDisposed(),this.reshape([a,b,c,d,e])},a.prototype.asType=function(a){return this.throwIfDisposed(),qN.cast(this,a)},Object.defineProperty(a.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),a.prototype.buffer=function(){return pS(this,void 0,void 0,function(){var a;return pT(this,function(b){switch(b.label){case 0:return[4,this.data()];case 1:return a=b.sent(),[2,qN.buffer(this.shape,this.dtype,a)]}})})},a.prototype.bufferSync=function(){return qN.buffer(this.shape,this.dtype,this.dataSync())},a.prototype.array=function(){return pS(this,void 0,void 0,function(){var a;return pT(this,function(b){switch(b.label){case 0:return[4,this.data()];case 1:return a=b.sent(),[2,qx(this.shape,a)]}})})},a.prototype.arraySync=function(){return qx(this.shape,this.dataSync())},a.prototype.data=function(){return pS(this,void 0,void 0,function(){var a,b;return pT(this,function(c){switch(c.label){case 0:return this.throwIfDisposed(),a=qM().read(this.dataId),"string"!==this.dtype?[3,2]:[4,a];case 1:b=c.sent();try{return[2,b.map(function(a){return qD(a)})]}catch(a){throw Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,a]}})})},a.prototype.dataSync=function(){this.throwIfDisposed();var a=qM().readSync(this.dataId);if("string"===this.dtype)try{return a.map(function(a){return qD(a)})}catch(a){throw Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return a},a.prototype.bytes=function(){return pS(this,void 0,void 0,function(){var a;return pT(this,function(b){switch(b.label){case 0:return this.throwIfDisposed(),[4,qM().read(this.dataId)];case 1:return a=b.sent(),"string"===this.dtype?[2,a]:[2,new Uint8Array(a.buffer)]}})})},a.prototype.dispose=function(){this.isDisposed||(qM().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(a.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),a.prototype.throwIfDisposed=function(){if(this.isDisposed)throw Error("Tensor is disposed.")},a.prototype.toFloat=function(){return this.asType("float32")},a.prototype.toInt=function(){return this.asType("int32")},a.prototype.toBool=function(){return this.asType("bool")},a.prototype.print=function(a){return void 0===a&&(a=!1),qN.print(this,a)},a.prototype.reshape=function(a){return this.throwIfDisposed(),qN.reshape(this,a)},a.prototype.reshapeAs=function(a){return this.throwIfDisposed(),this.reshape(a.shape)},a.prototype.expandDims=function(a){return void 0===a&&(a=0),qN.expandDims(this,a)},a.prototype.cumsum=function(a,b,c){return void 0===a&&(a=0),void 0===b&&(b=!1),void 0===c&&(c=!1),qN.cumsum(this,a,b,c)},a.prototype.squeeze=function(a){return this.throwIfDisposed(),qN.squeeze(this,a)},a.prototype.clone=function(){return this.throwIfDisposed(),qN.clone(this)},a.prototype.oneHot=function(a,b,c){return this.throwIfDisposed(),qN.oneHot(this,a,b,c)},a.prototype.toString=function(a){var b,c,d,e,f,g,h,i,j;return void 0===a&&(a=!1),b=this.dataSync(),c=this.shape,d=this.dtype,e=a,f=qv(c),g=function(a,b,c,d){var e=p7(b),f=d[d.length-1],g=Array(f).fill(0),h=b.length,i="complex64"===c?qK(a):a;if(h>1)for(var j=0;j<e/f;j++)for(var k=j*f,l=0;l<f;l++)g[l]=Math.max(g[l],qI(i[k+l],0,c).length);return g}(b,c,d,f),h=c.length,i=function a(b,c,d,e,f,g){void 0===g&&(g=!0);var h,i="complex64"===d?2:1,j=c[0],k=c.length;if(0===k)return"complex64"===d?[qI(qK(b)[0],0,d)]:"bool"===d?[qJ(b[0])]:[b[0].toString()];if(1===k){if(j>20){var l=Array.from(b.slice(0,3*i)),m=Array.from(b.slice((j-3)*i,j*i));return"complex64"===d&&(l=qK(l),m=qK(m)),["["+l.map(function(a,b){return qI(a,f[b],d)}).join(", ")+", ..., "+m.map(function(a,b){return qI(a,f[j-3+b],d)}).join(", ")+"]"]}return["["+("complex64"===d?qK(b):Array.from(b)).map(function(a,b){return qI(a,f[b],d)}).join(", ")+"]"]}var n=c.slice(1),o=e.slice(1),p=e[0]*i,q=[];if(j>20){for(var r=0;r<3;r++){var s=(h=r*p)+p;q.push.apply(q,a(b.slice(h,s),n,d,o,f,!1))}for(q.push("..."),r=j-3;r<j;r++)s=(h=r*p)+p,q.push.apply(q,a(b.slice(h,s),n,d,o,f,r===j-1))}else for(r=0;r<j;r++)s=(h=r*p)+p,q.push.apply(q,a(b.slice(h,s),n,d,o,f,r===j-1));var t=2===k?",":"";for(r=1,q[0]="["+q[0]+t;r<q.length-1;r++)q[r]=" "+q[r]+t;var u=",\n";for(r=2;r<k;r++)u+="\n";return q[q.length-1]=" "+q[q.length-1]+"]"+(g?"":u),q}(b,c,d,f,g),j=["Tensor"],e&&(j.push("  dtype: "+d),j.push("  rank: "+h),j.push("  shape: ["+c+"]"),j.push("  values:")),j.push(i.map(function(a){return"    "+a}).join("\n")),j.join("\n")},a.prototype.tile=function(a){return this.throwIfDisposed(),qN.tile(this,a)},a.prototype.gather=function(a,b){return void 0===b&&(b=0),this.throwIfDisposed(),qN.gather(this,a,b)},a.prototype.matMul=function(a,b,c){return void 0===b&&(b=!1),void 0===c&&(c=!1),this.throwIfDisposed(),qN.matMul(this,a,b,c)},a.prototype.dot=function(a){return this.throwIfDisposed(),qN.dot(this,a)},a.prototype.norm=function(a,b,c){return void 0===a&&(a="euclidean"),void 0===b&&(b=null),void 0===c&&(c=!1),this.throwIfDisposed(),qN.norm(this,a,b,c)},a.prototype.slice=function(a,b){return this.throwIfDisposed(),qN.slice(this,a,b)},a.prototype.reverse=function(a){return this.throwIfDisposed(),qN.reverse(this,a)},a.prototype.concat=function(b,c){return void 0===c&&(c=0),this.throwIfDisposed(),b instanceof a&&(b=[b]),qN.concat([this].concat(b),c)},a.prototype.split=function(a,b){return void 0===b&&(b=0),this.throwIfDisposed(),qN.split(this,a,b)},a.prototype.stack=function(a,b){return void 0===b&&(b=0),qN.stack([this,a],b)},a.prototype.unstack=function(a){return void 0===a&&(a=0),qN.unstack(this,a)},a.prototype.pad=function(a,b){return void 0===b&&(b=0),qN.pad(this,a,b)},a.prototype.batchNormalization=function(a,b,c,d,e){return void 0===c&&(c=.001),qO("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(a,b,e,d,c)},a.prototype.batchNorm=function(a,b,c,d,e){return void 0===e&&(e=.001),this.throwIfDisposed(),qN.batchNorm(this,a,b,c,d,e)},a.prototype.all=function(a,b){return void 0===a&&(a=null),void 0===b&&(b=!1),this.throwIfDisposed(),qN.all(this,a,b)},a.prototype.any=function(a,b){return void 0===a&&(a=null),void 0===b&&(b=!1),this.throwIfDisposed(),qN.any(this,a,b)},a.prototype.logSumExp=function(a,b){return void 0===a&&(a=null),void 0===b&&(b=!1),this.throwIfDisposed(),qN.logSumExp(this,a,b)},a.prototype.sum=function(a,b){return void 0===a&&(a=null),void 0===b&&(b=!1),this.throwIfDisposed(),qN.sum(this,a,b)},a.prototype.prod=function(a,b){return void 0===a&&(a=null),void 0===b&&(b=!1),this.throwIfDisposed(),qN.prod(this,a,b)},a.prototype.mean=function(a,b){return void 0===a&&(a=null),void 0===b&&(b=!1),this.throwIfDisposed(),qN.mean(this,a,b)},a.prototype.min=function(a,b){return void 0===a&&(a=null),void 0===b&&(b=!1),this.throwIfDisposed(),qN.min(this,a,b)},a.prototype.max=function(a,b){return void 0===a&&(a=null),void 0===b&&(b=!1),this.throwIfDisposed(),qN.max(this,a,b)},a.prototype.argMin=function(a){return void 0===a&&(a=null),this.throwIfDisposed(),qN.argMin(this,a)},a.prototype.argMax=function(a){return void 0===a&&(a=null),this.throwIfDisposed(),qN.argMax(this,a)},a.prototype.cast=function(a){return this.throwIfDisposed(),qN.cast(this,a)},a.prototype.add=function(a){return this.throwIfDisposed(),qN.add(this,a)},a.prototype.addStrict=function(a){return this.throwIfDisposed(),qN.addStrict(this,a)},a.prototype.atan2=function(a){return this.throwIfDisposed(),qN.atan2(this,a)},a.prototype.sub=function(a){return this.throwIfDisposed(),qN.sub(this,a)},a.prototype.subStrict=function(a){return this.throwIfDisposed(),qN.subStrict(this,a)},a.prototype.pow=function(a){return this.throwIfDisposed(),qN.pow(this,a)},a.prototype.powStrict=function(a){return this.throwIfDisposed(),qN.powStrict(this,a)},a.prototype.mul=function(a){return this.throwIfDisposed(),qN.mul(this,a)},a.prototype.mulStrict=function(a){return this.throwIfDisposed(),qN.mulStrict(this,a)},a.prototype.div=function(a){return this.throwIfDisposed(),qN.div(this,a)},a.prototype.divNoNan=function(a){return this.throwIfDisposed(),qN.divNoNan(this,a)},a.prototype.floorDiv=function(a){return this.throwIfDisposed(),qN.floorDiv(this,a)},a.prototype.divStrict=function(a){return this.throwIfDisposed(),qN.divStrict(this,a)},a.prototype.minimum=function(a){return this.throwIfDisposed(),qN.minimum(this,a)},a.prototype.minimumStrict=function(a){return this.throwIfDisposed(),qN.minimumStrict(this,a)},a.prototype.maximum=function(a){return this.throwIfDisposed(),qN.maximum(this,a)},a.prototype.maximumStrict=function(a){return this.throwIfDisposed(),qN.maximumStrict(this,a)},a.prototype.mod=function(a){return this.throwIfDisposed(),qN.mod(this,a)},a.prototype.modStrict=function(a){return this.throwIfDisposed(),qN.modStrict(this,a)},a.prototype.squaredDifferenceStrict=function(a){return this.throwIfDisposed(),qN.squaredDifferenceStrict(this,a)},a.prototype.transpose=function(a){return this.throwIfDisposed(),qN.transpose(this,a)},a.prototype.notEqual=function(a){return this.throwIfDisposed(),qN.notEqual(this,a)},a.prototype.notEqualStrict=function(a){return this.throwIfDisposed(),qN.notEqualStrict(this,a)},a.prototype.less=function(a){return this.throwIfDisposed(),qN.less(this,a)},a.prototype.lessStrict=function(a){return this.throwIfDisposed(),qN.lessStrict(this,a)},a.prototype.equal=function(a){return this.throwIfDisposed(),qN.equal(this,a)},a.prototype.equalStrict=function(a){return this.throwIfDisposed(),qN.equalStrict(this,a)},a.prototype.lessEqual=function(a){return this.throwIfDisposed(),qN.lessEqual(this,a)},a.prototype.lessEqualStrict=function(a){return this.throwIfDisposed(),qN.lessEqualStrict(this,a)},a.prototype.greater=function(a){return this.throwIfDisposed(),qN.greater(this,a)},a.prototype.greaterStrict=function(a){return this.throwIfDisposed(),qN.greaterStrict(this,a)},a.prototype.greaterEqual=function(a){return this.throwIfDisposed(),qN.greaterEqual(this,a)},a.prototype.greaterEqualStrict=function(a){return this.throwIfDisposed(),qN.greaterEqualStrict(this,a)},a.prototype.logicalAnd=function(a){return this.throwIfDisposed(),qN.logicalAnd(this,a)},a.prototype.logicalOr=function(a){return this.throwIfDisposed(),qN.logicalOr(this,a)},a.prototype.logicalNot=function(){return this.throwIfDisposed(),qN.logicalNot(this)},a.prototype.logicalXor=function(a){return this.throwIfDisposed(),qN.logicalXor(this,a)},a.prototype.where=function(a,b){return this.throwIfDisposed(),qN.where(a,this,b)},a.prototype.neg=function(){return this.throwIfDisposed(),qN.neg(this)},a.prototype.ceil=function(){return this.throwIfDisposed(),qN.ceil(this)},a.prototype.floor=function(){return this.throwIfDisposed(),qN.floor(this)},a.prototype.sign=function(){return this.throwIfDisposed(),qN.sign(this)},a.prototype.isNaN=function(){return this.throwIfDisposed(),qN.isNaN(this)},a.prototype.isInf=function(){return this.throwIfDisposed(),qN.isInf(this)},a.prototype.isFinite=function(){return this.throwIfDisposed(),qN.isFinite(this)},a.prototype.exp=function(){return this.throwIfDisposed(),qN.exp(this)},a.prototype.expm1=function(){return this.throwIfDisposed(),qN.expm1(this)},a.prototype.log=function(){return this.throwIfDisposed(),qN.log(this)},a.prototype.log1p=function(){return this.throwIfDisposed(),qN.log1p(this)},a.prototype.sqrt=function(){return this.throwIfDisposed(),qN.sqrt(this)},a.prototype.rsqrt=function(){return this.throwIfDisposed(),qN.rsqrt(this)},a.prototype.square=function(){return this.throwIfDisposed(),qN.square(this)},a.prototype.reciprocal=function(){return this.throwIfDisposed(),qN.reciprocal(this)},a.prototype.abs=function(){return this.throwIfDisposed(),qN.abs(this)},a.prototype.clipByValue=function(a,b){return this.throwIfDisposed(),qN.clipByValue(this,a,b)},a.prototype.relu=function(){return this.throwIfDisposed(),qN.relu(this)},a.prototype.relu6=function(){return this.throwIfDisposed(),qN.relu6(this)},a.prototype.elu=function(){return this.throwIfDisposed(),qN.elu(this)},a.prototype.selu=function(){return this.throwIfDisposed(),qN.selu(this)},a.prototype.leakyRelu=function(a){return void 0===a&&(a=.2),this.throwIfDisposed(),qN.leakyRelu(this,a)},a.prototype.prelu=function(a){return this.throwIfDisposed(),qN.prelu(this,a)},a.prototype.sigmoid=function(){return this.throwIfDisposed(),qN.sigmoid(this)},a.prototype.logSigmoid=function(){return this.throwIfDisposed(),qN.logSigmoid(this)},a.prototype.softplus=function(){return this.throwIfDisposed(),qN.softplus(this)},a.prototype.zerosLike=function(){return this.throwIfDisposed(),qN.zerosLike(this)},a.prototype.onesLike=function(){return this.throwIfDisposed(),qN.onesLike(this)},a.prototype.sin=function(){return this.throwIfDisposed(),qN.sin(this)},a.prototype.cos=function(){return this.throwIfDisposed(),qN.cos(this)},a.prototype.tan=function(){return this.throwIfDisposed(),qN.tan(this)},a.prototype.asin=function(){return this.throwIfDisposed(),qN.asin(this)},a.prototype.acos=function(){return this.throwIfDisposed(),qN.acos(this)},a.prototype.atan=function(){return this.throwIfDisposed(),qN.atan(this)},a.prototype.sinh=function(){return this.throwIfDisposed(),qN.sinh(this)},a.prototype.cosh=function(){return this.throwIfDisposed(),qN.cosh(this)},a.prototype.tanh=function(){return this.throwIfDisposed(),qN.tanh(this)},a.prototype.asinh=function(){return this.throwIfDisposed(),qN.asinh(this)},a.prototype.acosh=function(){return this.throwIfDisposed(),qN.acosh(this)},a.prototype.atanh=function(){return this.throwIfDisposed(),qN.atanh(this)},a.prototype.erf=function(){return this.throwIfDisposed(),qN.erf(this)},a.prototype.round=function(){return this.throwIfDisposed(),qN.round(this)},a.prototype.step=function(a){return void 0===a&&(a=0),this.throwIfDisposed(),qN.step(this,a)},a.prototype.softmax=function(a){return void 0===a&&(a=-1),this.throwIfDisposed(),qN.softmax(this,a)},a.prototype.logSoftmax=function(a){return void 0===a&&(a=-1),this.throwIfDisposed(),qN.logSoftmax(this,a)},a.prototype.resizeBilinear=function(a,b){return void 0===b&&(b=!1),this.throwIfDisposed(),qN.image.resizeBilinear(this,a,b)},a.prototype.resizeNearestNeighbor=function(a,b){return void 0===b&&(b=!1),this.throwIfDisposed(),qN.image.resizeNearestNeighbor(this,a,b)},a.prototype.conv1d=function(a,b,c,d,e,f){return void 0===d&&(d="NWC"),void 0===e&&(e=1),this.throwIfDisposed(),qN.conv1d(this,a,b,c,d,e,f)},a.prototype.conv2d=function(a,b,c,d,e,f){return void 0===d&&(d="NHWC"),void 0===e&&(e=[1,1]),this.throwIfDisposed(),qN.conv2d(this,a,b,c,d,e,f)},a.prototype.conv2dTranspose=function(a,b,c,d,e){return this.throwIfDisposed(),qN.conv2dTranspose(this,a,b,c,d,e)},a.prototype.depthwiseConv2D=function(a,b,c,d,e,f){return void 0===d&&(d="NHWC"),void 0===e&&(e=[1,1]),this.throwIfDisposed(),qN.depthwiseConv2d(this,a,b,c,d,e,f)},a.prototype.separableConv2d=function(a,b,c,d,e,f){return void 0===e&&(e=[1,1]),void 0===f&&(f="NHWC"),this.throwIfDisposed(),qN.separableConv2d(this,a,b,c,d,e,f)},a.prototype.avgPool=function(a,b,c,d){return this.throwIfDisposed(),qN.avgPool(this,a,b,c,d)},a.prototype.maxPool=function(a,b,c,d){return this.throwIfDisposed(),qN.maxPool(this,a,b,c,d)},a.prototype.localResponseNormalization=function(a,b,c,d){return void 0===a&&(a=5),void 0===b&&(b=1),void 0===c&&(c=1),void 0===d&&(d=.5),qN.localResponseNormalization(this,a,b,c,d)},a.prototype.pool=function(a,b,c,d,e){return this.throwIfDisposed(),qN.pool(this,a,b,c,d,e)},a.prototype.variable=function(a,b,c){return void 0===a&&(a=!0),this.throwIfDisposed(),qM().makeVariable(this,a,b,c)},a.prototype.unsortedSegmentSum=function(a,b){return this.throwIfDisposed(),qN.unsortedSegmentSum(this,a,b)},a.prototype.batchToSpaceND=function(a,b){return this.throwIfDisposed(),qN.batchToSpaceND(this,a,b)},a.prototype.spaceToBatchND=function(a,b){return this.throwIfDisposed(),qN.spaceToBatchND(this,a,b)},a.prototype.topk=function(a,b){return void 0===a&&(a=1),void 0===b&&(b=!0),this.throwIfDisposed(),qN.topk(this,a,b)},a.prototype.stridedSlice=function(a,b,c,d,e,f,g,h){return void 0===d&&(d=0),void 0===e&&(e=0),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=0),this.throwIfDisposed(),qN.stridedSlice(this,a,b,c,d,e,f,g,h)},a.prototype.depthToSpace=function(a,b){return this.throwIfDisposed(),qN.depthToSpace(this,a,b)},a.prototype.fft=function(){return this.throwIfDisposed(),qN.spectral.fft(this)},a.prototype.ifft=function(){return this.throwIfDisposed(),qN.spectral.ifft(this)},a.prototype.rfft=function(){return this.throwIfDisposed(),qN.spectral.rfft(this)},a.prototype.irfft=function(){return this.throwIfDisposed(),qN.spectral.irfft(this)},a}();Object.defineProperty(qP,Symbol.hasInstance,{value:function(a){return!!a&&null!=a.dataId&&null!=a.shape&&null!=a.dtype}});var qQ,qR,qS,qT,qU,qV,qW=function(a){function b(b,c,d,e){var f=a.call(this,b.shape,b.dtype,b.dataId,e)||this;return f.trainable=c,f.name=d,f}return pR(b,a),b.prototype.assign=function(a){if(a.dtype!==this.dtype)throw Error("dtype of the new value ("+a.dtype+") and previous value ("+this.dtype+") must match");if(!p8(a.shape,this.shape))throw Error("shape of the new value ("+a.shape+") and previous value ("+this.shape+") must match");qM().disposeTensor(this),this.dataId=a.dataId,qM().incRef(this,null)},b.prototype.dispose=function(){qM().disposeVariable(this),this.isDisposedInternal=!0},b}(qP);Object.defineProperty(qW,Symbol.hasInstance,{value:function(a){return a instanceof qP&&null!=a.assign&&a.assign instanceof Function}}),function(a){a.R0="R0",a.R1="R1",a.R2="R2",a.R3="R3",a.R4="R4",a.R5="R5",a.R6="R6"}(qR||(qR={})),function(a){a.float32="float32",a.int32="int32",a.bool="int32",a.complex64="complex64"}(qS||(qS={})),function(a){a.float32="float32",a.int32="int32",a.bool="bool",a.complex64="complex64"}(qT||(qT={})),function(a){a.float32="float32",a.int32="float32",a.bool="float32",a.complex64="complex64"}(qU||(qU={})),function(a){a.float32="complex64",a.int32="complex64",a.bool="complex64",a.complex64="complex64"}(qV||(qV={}));var qX={float32:qU,int32:qS,bool:qT,complex64:qV};function qY(a,b){if("string"===a||"string"===b){if("string"===a&&"string"===b)return"string";throw Error("Can not upcast "+a+" with "+b)}return qX[a][b]}function qZ(a){return qY(a,"int32")}function q$(a,b){if(a.dtype===b.dtype)return[a,b];var c=qY(a.dtype,b.dtype);return[a.cast(c),b.cast(c)]}function q_(a,b){p3(a.dtype===b.dtype,function(){return"The dtypes of the first("+a.dtype+") and second("+b.dtype+") input must match"})}function q0(a){var b=[];return function a(b,c,d){if(null!=b){if(b instanceof qP)return void c.push(b);if(Array.isArray(b)||"object"==typeof b)for(var e in b){var f=b[e];d.has(f)||(d.add(f),a(f,c,d))}}}(a,b,new Set),b}Object.freeze({makeTypesMatch:q$,assertTypesMatch:q_,isTensorInList:function(a,b){return b.some(function(b){return b.id===a.id})},getTensorsInContainer:q0});var q1,q2=function(){function a(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return a.prototype.dispose=function(){for(var a in this.registeredVariables)this.registeredVariables[a].dispose()},a}(),q3=function(){function a(a){this.ENV=a,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new q2}return a.prototype.ready=function(){return pS(this,void 0,void 0,function(){var a,b,c;return pT(this,function(d){switch(d.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];a=this.getSortedBackends(),b=0,d.label=1;case 1:return b<a.length?(c=a[b],[4,this.initializeBackend(c).success]):[3,5];case 2:return d.sent()?[4,this.setBackend(c)]:[3,4];case 3:return d.sent(),[2];case 4:return b++,[3,1];case 5:throw Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(a.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var a=this.initializeBackendsAndReturnBest(),b=a.name;if(a.asyncInit)throw Error("The highest priority backend '"+b+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(b)}return this.backendInstance},enumerable:!0,configurable:!0}),a.prototype.backendNames=function(){return Object.keys(this.registryFactory)},a.prototype.findBackend=function(a){return a in this.registry||a in this.registryFactory&&!this.initializeBackend(a).asyncInit?this.registry[a]:null},a.prototype.findBackendFactory=function(a){return a in this.registryFactory?this.registryFactory[a].factory:null},a.prototype.registerBackend=function(a,b,c){return void 0===c&&(c=1),a in this.registryFactory?(console.warn(a+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[a]={factory:b,priority:c},!0)},a.prototype.setBackend=function(a){return pS(this,void 0,void 0,function(){var b,c,d;return pT(this,function(e){switch(e.label){case 0:if(null==this.registryFactory[a])throw Error("Backend name '"+a+"' not found in registry");return this.backendName=a,null!=this.registry[a]?[3,4]:(this.backendInstance=null,c=(b=this.initializeBackend(a)).success,b.asyncInit?[4,c]:[3,2]);case 1:return d=e.sent(),[3,3];case 2:d=c,e.label=3;case 3:if(!d)return[2,!1];e.label=4;case 4:return this.backendInstance=this.registry[a],this.setupRegisteredKernels(),this.profiler=new qG(this.backendInstance),[2,!0]}})})},a.prototype.setupRegisteredKernels=function(){var a=this;pZ(this.backendName).forEach(function(b){null!=b.setupFunc&&b.setupFunc(a.backendInstance)})},a.prototype.disposeRegisteredKernels=function(a){var b=this;pZ(a).forEach(function(c){null!=c.disposeFunc&&c.disposeFunc(b.registry[a])})},a.prototype.initializeBackend=function(a){var b=this,c=this.registryFactory[a];if(null==c)throw Error("Cannot initialize backend "+a+", no registration found.");try{var d=c.factory();if(Promise.resolve(d)===d){var e=++this.pendingBackendInitId,f=d.then(function(c){return!(e<b.pendingBackendInitId)&&(b.registry[a]=c,b.pendingBackendInit=null,!0)}).catch(function(c){return!(e<b.pendingBackendInitId)&&(b.pendingBackendInit=null,console.warn("Initialization of backend "+a+" failed"),console.warn(c.stack||c.message),!1)});return this.pendingBackendInit=f,{success:f,asyncInit:!0}}return this.registry[a]=d,{success:!0,asyncInit:!1}}catch(b){return console.warn("Initialization of backend "+a+" failed"),console.warn(b.stack||b.message),{success:!1,asyncInit:!1}}},a.prototype.removeBackend=function(a){if(!(a in this.registryFactory))throw Error(a+" backend not found in registry");this.backendName===a&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,a in this.registry&&(this.disposeRegisteredKernels(a),this.registry[a].dispose(),delete this.registry[a]),delete this.registryFactory[a],this.backendName===a&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},a.prototype.getSortedBackends=function(){var a=this;if(0===Object.keys(this.registryFactory).length)throw Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(b,c){return a.registryFactory[c].priority-a.registryFactory[b].priority})},a.prototype.initializeBackendsAndReturnBest=function(){for(var a=this.getSortedBackends(),b=0;b<a.length;b++){var c=a[b],d=this.initializeBackend(c),e=d.success,f=d.asyncInit;if(f||e)return{name:c,asyncInit:f}}throw Error("Could not initialize any backends, all backend initializations failed.")},a.prototype.moveData=function(a,b){var c=this.state.tensorInfo.get(b),d=c.backend,e=this.readSync(b);d.disposeData(b),c.backend=a,a.move(b,e,c.shape,c.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},a.prototype.tidy=function(a,b){var c,d=this,e=null;if(null==b){if("function"!=typeof a)throw Error("Please provide a function to tidy()");b=a}else{if("string"!=typeof a&&!(a instanceof String))throw Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof b)throw Error("When calling with two arguments, the 2nd argument to tidy() must be a function");e=a}return this.scopedRun(function(){return d.startScope(e)},function(){return d.endScope(c)},function(){return(c=b())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),c})},a.prototype.scopedRun=function(a,b,c){a();try{var d=c();return b(),d}catch(a){throw b(),a}},a.prototype.nextTensorId=function(){return a.nextTensorId++},a.prototype.nextVariableId=function(){return a.nextVariableId++},a.prototype.clone=function(a){var b=this.makeTensorFromDataId(a.dataId,a.shape,a.dtype);return this.addTapeNode(this.state.activeScope.name,{x:a},[b],function(a){return{x:function(){return a.toFloat()}}},[]),b},a.prototype.runKernel=function(a,b,c,d,e){return this.runKernelFunc(null,b,null,a,c,d,e)},a.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},a.prototype.checkKernelForMemLeak=function(a,b,c){var d=this.backend.numDataIds(),e=0;c.forEach(function(a){e+="complex64"===a.dtype?3:1});var f=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],g=d-b-e-f;if(g>0)throw Error("Backend '"+this.backendName+"' has an internal memory leak ("+g+" data ids) after running '"+a+"'")},a.prototype.runKernelFunc=function(a,b,c,d,e,f,g){var h,i=this;void 0===f&&(f=[]),void 0===g&&(g=[]);var j=[],k=this.isTapeOn();null==d&&(d=null!=this.state.activeScope?this.state.activeScope.name:"");var l,m=function(a){k&&(j=a.map(function(a){return i.keep(i.clone(a))}))},n=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,q=pY(d,this.backendName);return l=null!=q?function(){var a=i.backend.numDataIds(),c=Array.isArray(p=q.kernelFunc({inputs:b,attrs:e,backend:i.backend}))?p:[p];i.shouldCheckForMemLeaks()&&i.checkKernelForMemLeak(d,a,c);var h=c.map(function(a){var b=a.dataId,c=a.shape,d=a.dtype;return i.makeTensorFromDataId(b,c,d)}),j=h.filter(function(a,b){return g[b]});return m((f||[]).slice().concat(j)),h}:function(){var b=i.backend.numDataIds(),c=Array.isArray(p=i.tidy(function(){return a(i.backend,m)}))?p:[p];return i.shouldCheckForMemLeaks()&&i.checkKernelForMemLeak(d,b,c),c},this.scopedRun(function(){return i.state.kernelDepth++},function(){return i.state.kernelDepth--},function(){h=i.ENV.getBool("DEBUG")?i.profiler.profileKernel(d,b,function(){return l()}):l()}),k&&this.addTapeNode(d,b,h,c,j),this.state.profiling&&this.state.activeProfile.kernels.push({name:d,bytesAdded:this.state.numBytes-n,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(b).map(function(a){return b[a].shape}),outputShapes:h.map(function(a){return a.shape})}),Array.isArray(p)?h:h[0]},a.prototype.makeTensor=function(a,b,c,d){if(null==a)throw Error("Values passed to engine.makeTensor() are null");c=c||"float32",d=d||this.backend;var e=a;"string"===c&&qp(a[0])&&(e=a.map(function(a){return qC(a)}));var f=d.write(e,b,c),g=new qP(b,c,f,this.nextTensorId());if(this.incRef(g,d),"string"===c){var h=this.state.tensorInfo.get(f),i=qo(e);this.state.numBytes+=i-h.bytes,h.bytes=i}return g},a.prototype.makeTensorFromDataId=function(a,b,c,d){var e=new qP(b,c=c||"float32",a,this.nextTensorId());return this.incRef(e,d),e},a.prototype.makeVariable=function(a,b,c,d){void 0===b&&(b=!0),c=c||this.nextVariableId().toString(),null!=d&&d!==a.dtype&&(a=a.asType(d));var e=new qW(a,b,c,this.nextTensorId());if(null!=this.state.registeredVariables[e.name])throw Error("Variable with name "+e.name+" was already registered");return this.state.registeredVariables[e.name]=e,this.incRef(e,this.backend),e},a.prototype.incRef=function(a,b){var c=this.state.tensorInfo.has(a.dataId)?this.state.tensorInfo.get(a.dataId).refCount:0;if(this.state.numTensors++,"string"===a.dtype&&this.state.numStringTensors++,0===c){this.state.numDataBuffers++;var d=0;"complex64"!==a.dtype&&"string"!==a.dtype&&(d=a.size*qn(a.dtype)),this.state.tensorInfo.set(a.dataId,{backend:b||this.backend,dtype:a.dtype,shape:a.shape,bytes:d,refCount:0}),this.state.numBytes+=d}this.state.tensorInfo.get(a.dataId).refCount++,a instanceof qW||this.track(a)},a.prototype.disposeTensor=function(a){if(this.state.tensorInfo.has(a.dataId)){this.state.numTensors--,"string"===a.dtype&&this.state.numStringTensors--;var b=this.state.tensorInfo.get(a.dataId);b.refCount<=1?("complex64"!==a.dtype&&(this.state.numBytes-=b.bytes),this.state.numDataBuffers--,b.backend.disposeData(a.dataId),this.state.tensorInfo.delete(a.dataId)):this.state.tensorInfo.get(a.dataId).refCount--}},a.prototype.disposeVariables=function(){for(var a in this.state.registeredVariables){var b=this.state.registeredVariables[a];this.disposeVariable(b)}},a.prototype.disposeVariable=function(a){this.disposeTensor(a),null!=this.state.registeredVariables[a.name]&&delete this.state.registeredVariables[a.name]},a.prototype.memory=function(){var a=this.backend.memory();return a.numTensors=this.state.numTensors,a.numDataBuffers=this.state.numDataBuffers,a.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(a.unreliable=!0,null==a.reasons&&(a.reasons=[]),a.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),a},a.prototype.profile=function(a){return pS(this,void 0,void 0,function(){var b,c;return pT(this,function(d){return this.state.profiling=!0,b=this.state.numBytes,c=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=a(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-b,this.state.activeProfile.newTensors=this.state.numTensors-c,[2,this.state.activeProfile]})})},a.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},a.prototype.addTapeNode=function(a,b,c,d,e){var f=this,g={id:this.state.nextTapeNodeId++,kernelName:a,inputs:b,outputs:c,saved:e},h=pX.get(a);null!=h&&(d=h.gradFunc),null!=d&&(g.gradient=function(a){return a=a.map(function(a,b){if(null==a){var d=c[b],e=qz(d.size,d.dtype);return f.makeTensor(e,d.shape,d.dtype)}return a}),d(a.length>1?a:a[0],e)}),this.state.activeTape.push(g)},a.prototype.keep=function(a){return a.kept=!0,a},a.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},a.prototype.endTape=function(){this.state.gradientDepth--},a.prototype.startScope=function(a){var b={track:[],name:"unnamed scope",id:this.state.nextScopeId++};a&&(b.name=a),this.state.scopeStack.push(b),this.state.activeScope=b},a.prototype.endScope=function(a){for(var b=this,c=q0(a),d=new Set(c.map(function(a){return a.id})),e=0;e<this.state.activeScope.track.length;e++){var f=this.state.activeScope.track[e];f.kept||d.has(f.id)||f.dispose()}var g=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],c.forEach(function(a){a.kept||a.scopeId!==g.id||b.track(a)})},a.prototype.gradients=function(a,b,c,d){var e=this;if(void 0===d&&(d=!1),p3(b.length>0,function(){return"gradients() received an empty list of xs."}),null!=c&&"float32"!==c.dtype)throw Error("dy must have 'float32' dtype, but has '"+c.dtype+"'");var f=this.scopedRun(function(){return e.startTape()},function(){return e.endTape()},function(){return e.tidy("forward",a)});p3(f instanceof qP,function(){return"The result y returned by f() must be a tensor."});var g=function(a,b,c){for(var d,e={},f={},g=0;g<b.length;g++)e[b[g].id]=!0;for(g=0;g<a.length;g++){var h=(d=a[g]).inputs;for(var i in h){for(var j=h[i],k=!1,l=0;l<b.length;l++)if(e[j.id]){d.outputs.forEach(function(a){return e[a.id]=!0}),k=!0,f[d.id]=!0;break}if(k)break}}var m={};m[c.id]=!0;var n={};for(g=a.length-1;g>=0;g--)for(h=(d=a[g]).inputs,l=0;l<d.outputs.length;l++)if(m[d.outputs[l].id]){for(var i in h)m[h[i].id]=!0,n[d.id]=!0;break}var o=[];for(g=0;g<a.length;g++)if(f[(d=a[g]).id]&&n[d.id]){var p={};for(var i in d.inputs){var q=d.inputs[i];e[q.id]&&(p[i]=q)}var r=Object.assign({},d);r.inputs=p,r.outputs=d.outputs,o.push(r)}return o}(this.state.activeTape,b,f);if(!d&&0===g.length&&b.length>0)throw Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var a,d,h={};h[f.id]=null==c?(d=qy(p7(a=f.shape),"float32"),q4.makeTensor(d,a,"float32")):c,function(a,b,c){for(var d=b.length-1;d>=0;d--)!function(d){var e=b[d],f=[];if(e.outputs.forEach(function(b){var c=a[b.id];null!=c?f.push(c):f.push(null)}),null==e.gradient)throw Error("Cannot compute gradient: gradient function not found for "+e.kernelName+".");var g=e.gradient(f),h=function(b){if(!(b in g))throw Error("Cannot backprop through input "+b+". Available gradients found: "+Object.keys(g)+".");var d=c(function(){return g[b]()});if("float32"!==d.dtype)throw Error("Error in gradient for op "+e.kernelName+". The gradient of input "+b+" must have 'float32' dtype, but has '"+d.dtype+"'");var f=e.inputs[b];if(!p8(d.shape,f.shape))throw Error("Error in gradient for op "+e.kernelName+". The gradient of input '"+b+"' has shape '"+d.shape+"', which does not match the shape of the input '"+f.shape+"'");if(null==a[f.id])a[f.id]=d;else{var h=a[f.id];a[f.id]=h.add(d),h.dispose()}};for(var i in e.inputs)h(i)}(d)}(h,g,function(a){return e.tidy(a)});var i=b.map(function(a){return h[a.id]});return 0===e.state.gradientDepth&&(e.state.activeTape.forEach(function(a){for(var b=0,c=a.saved;b<c.length;b++)c[b].dispose()}),e.state.activeTape=null),{value:f,grads:i}})},a.prototype.customGrad=function(a){var b=this;return p3(qt(a),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var c,d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];p3(d.every(function(a){return a instanceof qP}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var f={};return d.forEach(function(a,b){f[b]=a}),b.runKernelFunc(function(b,e){return p3((c=a.apply(void 0,d.concat([e]))).value instanceof qP,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),p3(qt(c.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),c.value},f,function(a,b){var e=c.gradFunc(a,b),f=Array.isArray(e)?e:[e];p3(f.length===d.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),p3(f.every(function(a){return a instanceof qP}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var g={};return f.forEach(function(a,b){g[b]=function(){return a}}),g})}},a.prototype.readSync=function(a){return this.state.tensorInfo.get(a).backend.readSync(a)},a.prototype.read=function(a){return this.state.tensorInfo.get(a).backend.read(a)},a.prototype.time=function(a){return pS(this,void 0,void 0,function(){var b,c;return pT(this,function(d){switch(d.label){case 0:return b=qA(),[4,this.backend.time(a)];case 1:return(c=d.sent()).wallMs=qA()-b,[2,c]}})})},a.prototype.track=function(a){return null!=this.state.activeScope&&(a.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(a)),a},Object.defineProperty(a.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),a.prototype.reset=function(){for(var a in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new q2,this.registry)this.disposeRegisteredKernels(a),this.registry[a].dispose(),delete this.registry[a];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},a.nextTensorId=0,a.nextVariableId=0,a}(),q4=function(){var a=function(){if(null==q1){var a=void 0;if("undefined"!=typeof window)a=window;else if("undefined"!=typeof global)a=global;else if("undefined"!=typeof process)a=process;else{if("undefined"==typeof self)throw Error("Could not find a global object");a=self}q1=a}return q1}();if(null==a._tfengine){var b=new pU(a);a._tfengine=new q3(b)}return pV=a._tfengine.ENV,qM=function(){return a._tfengine},a._tfengine}();function q5(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var q6=pV;q6.registerFlag("DEBUG",function(){return!1},function(a){a&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),q6.registerFlag("IS_BROWSER",function(){return q5()}),q6.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),q6.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),q6.registerFlag("PROD",function(){return!1}),q6.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return q6.getBool("DEBUG")}),q6.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),q6.registerFlag("IS_TEST",function(){return!1});var q7,q8,q9,ra={},rb={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function rc(a,b){ra[a]=b}function rd(a){a in ra||(ra[a]=function(a){if(1!==a&&2!==a)throw Error("Cannot get WebGL rendering context, WebGL is disabled.");var b=function(a){if("undefined"!=typeof OffscreenCanvas&&2===a)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw Error("Cannot create a canvas in this context")}(a);return(b.addEventListener("webglcontextlost",function(b){b.preventDefault(),delete ra[a]},!1),1===a)?b.getContext("webgl",rb)||b.getContext("experimental-webgl",rb):b.getContext("webgl2",rb)}(a));var b=ra[a];return b.isContextLost()?(delete ra[a],rd(a)):(b.disable(b.DEPTH_TEST),b.disable(b.STENCIL_TEST),b.disable(b.BLEND),b.disable(b.DITHER),b.disable(b.POLYGON_OFFSET_FILL),b.disable(b.SAMPLE_COVERAGE),b.enable(b.SCISSOR_TEST),b.enable(b.CULL_FACE),b.cullFace(b.BACK),ra[a])}function re(a){return qb(Math.ceil(p7(a)/4))}function rf(a,b){return[Math.max(1,Math.ceil(b/2)),Math.max(1,Math.ceil(a/2))]}function rg(a,b){var c,d,e,f,g,h,i,j,k;return 2===pV.getNumber("WEBGL_VERSION")?(c=a.R32F,d=a.R16F,e=a.RGBA16F,f=a.RGBA32F,g=a.RED,h=4,i=1,j=a.HALF_FLOAT):(c=a.RGBA,d=a.RGBA,e=a.RGBA,f=a.RGBA,g=a.RGBA,h=4,i=4,j=null!=b?b.HALF_FLOAT_OES:null),k=a.FLOAT,{internalFormatFloat:c,internalFormatHalfFloat:d,internalFormatPackedHalfFloat:e,internalFormatPackedFloat:f,textureFormatFloat:g,downloadTextureFormat:a.RGBA,downloadUnpackNumChannels:h,defaultNumChannels:i,textureTypeHalfFloat:j,textureTypeFloat:k}}function rh(a,b,c){var d=c();return b&&function(a){var b=a.getError();if(b!==a.NO_ERROR)throw Error("WebGL Error: "+rj(a,b))}(a),d}function ri(a){return!!(pV.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===a||596e-10<Math.abs(a)&&65504>Math.abs(a))}function rj(a,b){switch(b){case a.NO_ERROR:return"NO_ERROR";case a.INVALID_ENUM:return"INVALID_ENUM";case a.INVALID_VALUE:return"INVALID_VALUE";case a.INVALID_OPERATION:return"INVALID_OPERATION";case a.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case a.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case a.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+b}}function rk(a,b,c){return rH(a,b,function(){return a.getExtension(c)},'Extension "'+c+'" not supported on this browser.')}function rl(a,b,c){var d=rH(a,b,function(){return a.createShader(a.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(rh(a,b,function(){return a.shaderSource(d,c)}),rh(a,b,function(){return a.compileShader(d)}),!1===a.getShaderParameter(d,a.COMPILE_STATUS))throw console.log(a.getShaderInfoLog(d)),Error("Failed to compile vertex shader.");return d}function rm(a,b,c){var d=rH(a,b,function(){return a.createShader(a.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(rh(a,b,function(){return a.shaderSource(d,c)}),rh(a,b,function(){return a.compileShader(d)}),!1===a.getShaderParameter(d,a.COMPILE_STATUS))throw function(a,b){var c=rp.exec(b);if(null==c)return console.log("Couldn't parse line number in error: "+b),console.log(a);for(var d=+c[1],e=a.split("\n"),f=e.length.toString().length+2,g=e.map(function(a,b){return qc((b+1).toString(),f)+a}),h=0,i=0;i<g.length;i++)h=Math.max(g[i].length,h);var j=g.slice(0,d-1),k=g.slice(d-1,d),l=g.slice(d);console.log(j.join("\n")),console.log(b.split("\n")[0]),console.log("%c "+qc(k[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}(c,a.getShaderInfoLog(d)),Error("Failed to compile fragment shader.");return d}!function(a){a[a.DENSE=0]="DENSE",a[a.SHARED_BATCH=1]="SHARED_BATCH"}(q7||(q7={})),function(a){a[a.RENDER=0]="RENDER",a[a.UPLOAD=1]="UPLOAD",a[a.PIXELS=2]="PIXELS",a[a.DOWNLOAD=3]="DOWNLOAD"}(q8||(q8={})),function(a){a[a.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",a[a.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",a[a.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",a[a.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",a[a.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(q9||(q9={}));var rn,ro,rp=/ERROR: [0-9]+:([0-9]+):/g;function rq(a,b){return rH(a,b,function(){return a.createProgram()},"Unable to create WebGLProgram.")}function rr(a,b,c){if(rh(a,b,function(){return a.linkProgram(c)}),!1===a.getProgramParameter(c,a.LINK_STATUS))throw console.log(a.getProgramInfoLog(c)),Error("Failed to link vertex and fragment shaders.")}function rs(a,b,c){if(rh(a,b,function(){return a.validateProgram(c)}),!1===a.getProgramParameter(c,a.VALIDATE_STATUS))throw console.log(a.getProgramInfoLog(c)),Error("Shader program validation failed.")}function rt(a,b,c){var d=rH(a,b,function(){return a.createBuffer()},"Unable to create WebGLBuffer");return rh(a,b,function(){return a.bindBuffer(a.ARRAY_BUFFER,d)}),rh(a,b,function(){return a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW)}),d}function ru(a,b,c){var d=rH(a,b,function(){return a.createBuffer()},"Unable to create WebGLBuffer");return rh(a,b,function(){return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d)}),rh(a,b,function(){return a.bufferData(a.ELEMENT_ARRAY_BUFFER,c,a.STATIC_DRAW)}),d}function rv(a,b){return rH(a,b,function(){return a.createTexture()},"Unable to create WebGLTexture.")}function rw(a,b){var c=pV.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(a<=0||b<=0){var d="["+a+"x"+b+"]";throw Error("Requested texture size "+d+" is invalid.")}if(a>c||b>c)throw Error("Requested texture size "+(d="["+a+"x"+b+"]")+" greater than WebGL maximum on this browser / GPU "+("["+c+"x")+c+"].")}function rx(a,b){return rH(a,b,function(){return a.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function ry(a,b,c,d,e,f,g,h){var i=a.getAttribLocation(c,d);return -1!==i&&(rh(a,b,function(){return a.bindBuffer(a.ARRAY_BUFFER,e)}),rh(a,b,function(){return a.vertexAttribPointer(i,f,a.FLOAT,!1,g,h)}),rh(a,b,function(){return a.enableVertexAttribArray(i)}),!0)}function rz(a,b,c,d){rI(a,d),rh(a,b,function(){return a.activeTexture(a.TEXTURE0+d)}),rh(a,b,function(){return a.bindTexture(a.TEXTURE_2D,c)})}function rA(a,b,c,d){return rH(a,b,function(){return a.getUniformLocation(c,d)},'uniform "'+d+'" not present in program.')}function rB(a,b,c){return a.getUniformLocation(b,c)}function rC(a,b,c,d,e,f){rh(a,b,function(){return rz(a,b,d,f)}),rh(a,b,function(){return a.uniform1i(e,f)})}function rD(a,b,c,d){rh(a,b,function(){return a.bindFramebuffer(a.FRAMEBUFFER,d)}),rh(a,b,function(){return a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,c,0)})}function rE(a,b,c){rh(a,b,function(){return a.bindFramebuffer(a.FRAMEBUFFER,c)}),rh(a,b,function(){return a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0)})}function rF(a){var b=a.checkFramebufferStatus(a.FRAMEBUFFER);if(b!==a.FRAMEBUFFER_COMPLETE)throw Error("Error binding framebuffer: "+rG(a,b))}function rG(a,b){switch(b){case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case a.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+b}}function rH(a,b,c,d){var e=rh(a,b,function(){return c()});if(null==e)throw Error(d);return e}function rI(a,b){var c=a.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,d=b+a.TEXTURE0;if(d<a.TEXTURE0||d>c)throw Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+c+"].")}function rJ(a,b){return void 0===b&&(b=2),p7(a.slice(0,a.length-b))}function rK(a){if(0===a.length)throw Error("Cannot get rows and columns of an empty shape array.");return[a.length>1?a[a.length-2]:1,a[a.length-1]]}function rL(a){var b=[1,1,1];return 0===a.length||1===a.length&&1===a[0]||(b=[rJ(a)].concat(rK(a))),b}function rM(a,b){void 0===b&&(b=!1);var c,d=pV.getNumber("WEBGL_MAX_TEXTURE_SIZE");b&&(d*=2,1===(a=a.map(function(b,c){return c>=a.length-2?p1(a[c]):a[c]})).length&&(a=[2,a[0]])),2!==a.length&&(a=qg(a).newShape);var e=p7(a);if(a.length<=1&&e<=d)return[1,e];if(2===a.length&&a[0]<=d&&a[1]<=d)return a;if(3===a.length&&a[0]*a[1]<=d&&a[2]<=d)return[a[0]*a[1],a[2]];if(3===a.length&&a[0]<=d&&a[1]*a[2]<=d)return[a[0],a[1]*a[2]];if(4===a.length&&a[0]*a[1]*a[2]<=d&&a[3]<=d)return[a[0]*a[1]*a[2],a[3]];if(4===a.length&&a[0]<=d&&a[1]*a[2]*a[3]<=d)return[a[0],a[1]*a[2]*a[3]];if(b){var f=rJ(a),g=2,h=2;return a.length&&(g=(c=rK(a))[0],h=c[1]),qb(e=g/2*f*(h/2)).map(function(a){return 2*a})}return qb(e)}function rN(a,b){if(p8(a=a.slice(-2),b=b.slice(-2))||!a.length||!b.length||0===a[0]||0===a[1]||0===b[0]||0===b[1])return!0;if(a.length!==b.length){var c=a.slice(-1)[0],d=b.slice(-1)[0];if(c===d||c%2==0&&d%2==0&&(1===a[0]||1===b[0]))return!0}return a[1]===b[1]&&a[0]%2==0&&b[0]%2==0}function rO(a){if(null==rn){var b=rd(a);rn=b.getParameter(b.MAX_TEXTURE_SIZE)}return rn}function rP(a){if(null==ro){var b=rd(a);ro=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ro)}function rQ(a){if(0===a)return 0;var b=rd(a);return rR(b,"EXT_disjoint_timer_query_webgl2")&&2===a?2:+!!rR(b,"EXT_disjoint_timer_query")}function rR(a,b){return null!=a.getExtension(b)}function rS(a){try{if(null!=rd(a))return!0}catch(a){}return!1}function rT(a){if(0===a)return!1;var b=rd(a);if(1===a){if(!rR(b,"OES_texture_float"))return!1}else if(!rR(b,"EXT_color_buffer_float"))return!1;return rV(b)}function rU(a){if(0===a)return!1;var b=rd(a);if(1!==a){if(rR(b,"EXT_color_buffer_float"))return rV(b);if(rR(b,"EXT_color_buffer_half_float")){var c,d,e,f,g=b.getExtension("EXT_color_buffer_half_float");return c=rg(b,g),d=b.createTexture(),b.bindTexture(b.TEXTURE_2D,d),b.texImage2D(b.TEXTURE_2D,0,c.internalFormatHalfFloat,1,1,0,c.textureFormatFloat,c.textureTypeHalfFloat,null),e=b.createFramebuffer(),b.bindFramebuffer(b.FRAMEBUFFER,e),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d,0),f=b.checkFramebufferStatus(b.FRAMEBUFFER)===b.FRAMEBUFFER_COMPLETE,b.bindTexture(b.TEXTURE_2D,null),b.bindFramebuffer(b.FRAMEBUFFER,null),b.deleteTexture(d),b.deleteFramebuffer(e),f}return!1}return!!rR(b,"OES_texture_float")&&!!rR(b,"WEBGL_color_buffer_float")&&rV(b)}function rV(a){var b=rg(a),c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,b.internalFormatFloat,1,1,0,b.textureFormatFloat,b.textureTypeFloat,null);var d=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,d),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,c,0);var e=a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE;return a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null),a.deleteTexture(c),a.deleteFramebuffer(d),e}function rW(a){return 2===a&&null!=rd(a).fenceSync}var rX=Object.freeze({callAndCheck:rh,canBeRepresented:ri,getWebGLErrorMessage:rj,getExtensionOrThrow:rk,createVertexShader:rl,createFragmentShader:rm,createProgram:rq,linkProgram:rr,validateProgram:rs,createStaticVertexBuffer:rt,createStaticIndexBuffer:ru,getNumChannels:function(){return 2===pV.getNumber("WEBGL_VERSION")?1:4},createTexture:rv,validateTextureSize:rw,createFramebuffer:rx,bindVertexBufferToProgramAttribute:ry,bindTextureUnit:rz,unbindTextureUnit:function(a,b,c){rI(a,c),rh(a,b,function(){return a.activeTexture(a.TEXTURE0+c)}),rh(a,b,function(){return a.bindTexture(a.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:rA,getProgramUniformLocation:rB,bindTextureToProgramUniformSampler:rC,bindCanvasToFramebuffer:function(a,b){rh(a,b,function(){return a.bindFramebuffer(a.FRAMEBUFFER,null)}),rh(a,b,function(){return a.viewport(0,0,a.canvas.width,a.canvas.height)}),rh(a,b,function(){return a.scissor(0,0,a.canvas.width,a.canvas.height)})},bindColorTextureToFramebuffer:rD,unbindColorTextureFromFramebuffer:rE,validateFramebuffer:rF,getFramebufferErrorMessage:rG,getBatchDim:rJ,getRowsCols:rK,getShapeAs3D:rL,getTextureShapeFromLogicalShape:rM,isReshapeFree:rN,getWebGLMaxTextureSize:rO,resetMaxTextureSize:function(){rn=null},resetMaxTexturesInShader:function(){ro=null},getMaxTexturesInShader:rP,getWebGLDisjointQueryTimerVersion:rQ,hasExtension:rR,isWebGLVersionEnabled:rS,isCapableOfRenderingToFloatTexture:rT,isDownloadFloatTextureEnabled:rU,isWebGLFenceEnabled:rW}),rY=pV;function rZ(a){pV.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(a+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function r$(a,b){return q4.tidy(a,b)}function r_(a){q0(a).forEach(function(a){return a.dispose()})}function r0(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];pV.getBool("IS_TEST")||console.warn.apply(console,a)}function r1(a,b){var c=a;if(qm(a))return"string"===b?[]:[a.length];if(!Array.isArray(a))return[];for(var d=[];Array.isArray(c)||qm(c)&&"string"!==b;)d.push(c.length),c=c[0];return Array.isArray(a)&&pV.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function a(b,c,d){if(d=d||[],!Array.isArray(b)&&!qm(b))return void p3(0===c.length,function(){return"Element arr["+d.join("][")+"] is a primitive, but should be an array/TypedArray of "+c[0]+" elements"});p3(c.length>0,function(){return"Element arr["+d.join("][")+"] should be a primitive, but is an array of "+b.length+" elements"}),p3(b.length===c[0],function(){return"Element arr["+d.join("][")+"] should have "+c[0]+" elements, but has "+b.length+" elements"});for(var e=c.slice(1),f=0;f<b.length;++f)a(b[f],e,d.concat(f))}(a,d,[]),d}function r2(a,b,c,d){if(null!=a&&("numeric"!==a&&a!==b||"numeric"===a&&"string"===b))throw Error("Argument '"+c+"' passed to '"+d+"' must be "+a+" tensor, but got "+b+" tensor")}function r3(a,b,c,d){if(void 0===d&&(d="numeric"),a instanceof qP)return r2(d,a.dtype,b,c),a;var e=qs(a);if("string"!==e&&["bool","int32","float32"].indexOf(d)>=0&&(e=d),r2(d,e,b,c),null==a||!qm(a)&&!Array.isArray(a)&&"number"!=typeof a&&"boolean"!=typeof a&&"string"!=typeof a)throw Error("Argument '"+b+"' passed to '"+c+"' must be a Tensor or TensorLike, but got '"+(null==a?"null":a.constructor.name)+"'");var f=r1(a,e);qm(a)||Array.isArray(a)||(a=[a]);var g="string"!==e?qw(a,e,pV.getBool("DEBUG")):p6(a,[],!0);return q4.makeTensor(g,f,e)}function r4(a,b,c,d){if(void 0===d&&(d="numeric"),!Array.isArray(a))throw Error("Argument "+b+" passed to "+c+" must be a `Tensor[]` or `TensorLike[]`");return a.map(function(a,d){return r3(a,b+"["+d+"]",c)},d)}function r5(a,b){for(var c=0;c<a.length;++c)if(a[a.length-c-1]!==b-1-c)return!1;return!0}function r6(a,b,c){for(var d=a.length+b.length,e=[],f=0,g=0,h=0;h<d;h++)-1===c.indexOf(h)?e.push(a[f++]):e.push(b[g++]);return e}function r7(a,b){for(var c=[],d=a.length,e=0;e<d;e++)-1===b.indexOf(e)&&c.push(a[e]);return[c,b.map(function(b){return a[b]})]}function r8(a,b){return r6(a,b.map(function(a){return 1}),b)}function r9(a,b,c){p3(r5(b,c),function(){return a+" supports only inner-most axes for now. Got axes "+b+" and rank-"+c+" input."})}function sa(a,b){if(r5(a,b))return null;for(var c=[],d=0;d<b;++d)-1===a.indexOf(d)&&c.push(d);return a.forEach(function(a){return c.push(a)}),c}function sb(a){return a.map(function(a,b){return[b,a]}).sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]})}function sc(a,b){for(var c=[],d=b-a;d<b;++d)c.push(d);return c}function sd(a,b){var c=a[0].length;a.forEach(function(a,b){p3(a.length===c,function(){return"Error in concat"+c+"D: rank of tensors["+b+"] must be the same as the rank of the rest ("+c+")"})}),p3(b>=0&&b<c,function(){return"Error in concat"+c+"D: axis must be between 0 and "+(c-1)+"."});var d=a[0];a.forEach(function(a,e){for(var f=0;f<c;f++)p3(f===b||a[f]===d[f],function(){return"Error in concat"+c+"D: Shape of tensors["+e+"] ("+a+") does not match the shape of the rest ("+d+") along the non-concatenated axis "+e+"."})})}function se(a,b){for(var c=a[0].slice(),d=1;d<a.length;d++)c[b]+=a[d][b];return c}function sf(a){var b=Object.keys(a);if(1!==b.length)throw Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+b.length+" keys.");var c=b[0],d=a[c];c.endsWith("_")&&(c=c.substring(0,c.length-1));var e=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];q4.startScope(c);try{var e=d.apply(void 0,a);return e instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),q4.endScope(e),e}catch(a){throw q4.endScope(null),a}};return Object.defineProperty(e,"name",{value:c,configurable:!0}),e}rY.registerFlag("HAS_WEBGL",function(){return rY.getNumber("WEBGL_VERSION")>0}),rY.registerFlag("WEBGL_VERSION",function(){return rS(2)?2:+!!rS(1)}),rY.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===rY.get("WEBGL_VERSION")}),rY.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),rY.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),rY.registerFlag("WEBGL_PACK",function(){return rY.getBool("HAS_WEBGL")}),rY.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_PACK_CLIP",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),rY.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_PACK_REDUCE",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_LAZILY_UNPACK",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_CONV_IM2COL",function(){return rY.getBool("WEBGL_PACK")}),rY.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return rO(rY.getNumber("WEBGL_VERSION"))}),rY.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return rP(rY.getNumber("WEBGL_VERSION"))}),rY.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var a=rY.getNumber("WEBGL_VERSION");return 0===a?0:rQ(a)}),rY.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){var a;return rY.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(a=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))))}),rY.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return rT(rY.getNumber("WEBGL_VERSION"))}),rY.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!rY.getBool("WEBGL_FORCE_F16_TEXTURES")&&rY.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),rY.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return rU(rY.getNumber("WEBGL_VERSION"))}),rY.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return rW(rY.getNumber("WEBGL_VERSION"))}),rY.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return 4*!!rY.getBool("WEBGL_RENDER_FLOAT32_ENABLED")}),qO=rZ;var sg=sf({complex_:function(a,b){var c=r3(a,"real","complex"),d=r3(b,"imag","complex");return p4(c.shape,d.shape,"real and imag shapes, "+c.shape+" and "+d.shape+", must match in call to tf.complex()."),q4.runKernelFunc(function(a){return a.complex(c,d)},{$real:c,$imag:d})}}),sh=sf({real_:function(a){var b=r3(a,"input","real");return q4.runKernelFunc(function(a){return a.real(b)},{$input:b})}}),si=sf({imag_:function(a){var b=r3(a,"input","imag");return q4.runKernelFunc(function(a){return a.imag(b)},{$input:b})}});function sj(a,b,c){return sk(a,b,r1(a,c),c)}function sk(a,b,c,d){if(null==d&&(d=qs(a)),"complex64"===d)throw Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!qm(a)&&!Array.isArray(a)&&"number"!=typeof a&&"boolean"!=typeof a&&"string"!=typeof a)throw Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=b){qB(b);var e=p7(b),f=p7(c);p3(e===f,function(){return"Based on the provided shape, ["+b+"], the tensor should have "+e+" values but has "+f});for(var g=0;g<c.length;++g){var h=c[g],i=g!==c.length-1||h!==p7(b.slice(g));p3(c[g]===b[g]||!i,function(){return"Error creating a new Tensor. Inferred shape ("+c+") does not match the provided shape ("+b+"). "})}}return qm(a)||Array.isArray(a)||(a=[a]),b=b||c,a="string"!==d?qw(a,d,pV.getBool("DEBUG")):p6(a,[],!0),q4.makeTensor(a,b,d)}function sl(a,b){if((qm(a)&&"string"!==b||Array.isArray(a))&&"complex64"!==b)throw Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===b&&qm(a)&&!(a instanceof Uint8Array))throw Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return sk(a,[],[],b)}function sm(a,b){p5(a);var c=r1(a,b);if(1!==c.length)throw Error("tensor1d() requires values to be a flat/TypedArray");return sk(a,null,c,b)}function sn(a,b,c){if(p5(a),null!=b&&2!==b.length)throw Error("tensor2d() requires shape to have two numbers");var d=r1(a,c);if(2!==d.length&&1!==d.length)throw Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===d.length&&null==b)throw Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return sk(a,b,d,c)}function so(a,b,c){if(p5(a),null!=b&&3!==b.length)throw Error("tensor3d() requires shape to have three numbers");var d=r1(a,c);if(3!==d.length&&1!==d.length)throw Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===d.length&&null==b)throw Error("tensor3d() requires shape to be provided when `values` are a flat array");return sk(a,b,d,c)}function sp(a,b,c){if(p5(a),null!=b&&4!==b.length)throw Error("tensor4d() requires shape to have four numbers");var d=r1(a,c);if(4!==d.length&&1!==d.length)throw Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===d.length&&null==b)throw Error("tensor4d() requires shape to be provided when `values` are a flat array");return sk(a,b,d,c)}function sq(a,b){if(void 0===b&&(b="float32"),"complex64"===b)return sg(sq(a,"float32"),sr(a,"float32"));var c=qy(p7(a),b);return q4.makeTensor(c,a,b)}function sr(a,b){if(void 0===b&&(b="float32"),"complex64"===b)return sg(sr(a,"float32"),sr(a,"float32"));var c=qz(p7(a),b);return q4.makeTensor(c,a,b)}function ss(a,b,c){return q4.runKernelFunc(function(d){return d.fill(a,b,c)},{})}function st(a,b,c,d){if(void 0===c&&(c=1),void 0===d&&(d="float32"),0===c)throw Error("Cannot have a step of zero");if(a===b||a<b&&c<0||b<a&&c>1)return sr([0],d);var e=qz(Math.abs(Math.ceil((b-a)/c)),d);b<a&&1===c&&(c=-1),e[0]=a;for(var f=1;f<e.length;f++)e[f]=e[f-1]+c;return sm(e,d)}var su=sf({onesLike_:function(a){var b=r3(a,"x","onesLike");return"complex64"===b.dtype?sg(su(sh(b)),sv(si(b))):q4.runKernelFunc(function(a){return a.onesLike(b)},{$x:b},function(a,b){return{$x:function(){return sv(a)}}})}}),sv=sf({zerosLike_:function(a){var b=r3(a,"x","zerosLike");return q4.runKernelFunc(function(a){return a.zerosLike(b)},{$x:b},function(a,b){return{$x:function(){return sv(a)}}})}}),sw=sf({concat_:function(a,b){void 0===b&&(b=0),p3(a.length>=1,function(){return"Pass at least one tensor to concat"});var c=r4(a,"tensors","concat");"complex64"===c[0].dtype&&c.forEach(function(a){if("complex64"!==a.dtype)throw Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+a.dtype+". ")}),b=qf(b,c[0].shape)[0];var d=se(c.map(function(a){return a.shape}),b);if(0===p7(d))return sj([],d);if(1===(c=c.filter(function(a){return a.size>0})).length)return c[0];var e=c.map(function(a){return a.shape});sd(e,b);var f=c,g={axis:b};return q4.runKernelFunc(function(a){return a.concat(c,b)},f,function(a){return sB(a,e.map(function(a){return a[b]}),b).map(function(a){return function(){return a}})},"Concat",g)}}),sx=sf({concat1d_:function(a){return sw(a,0)}}),sy=sf({concat2d_:function(a,b){return sw(a,b)}}),sz=sf({concat3d_:function(a,b){return sw(a,b)}}),sA=sf({concat4d_:function(a,b){return sw(a,b)}}),sB=sf({split_:function(a,b,c){void 0===c&&(c=0);var d,e=r3(a,"x","split");return c=qf(c,e.shape)[0],"number"==typeof b?(p3(e.shape[c]%b==0,function(){return"Number of splits must evenly divide the axis."}),d=Array(b).fill(e.shape[c]/b)):(p3(e.shape[c]===b.reduce(function(a,b){return a+b}),function(){return"The sum of sizes must match the size of the axis dimension."}),d=b),q4.runKernelFunc(function(a){return a.split(e,d,c)},{$x:e},function(a){return{$x:function(){return sw(a,c)}}})}});function sC(a,b){return a(b={exports:{}},b.exports),b.exports}"undefined"!=typeof globalThis||("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self);var sD=sC(function(a){!function(a,b,c){function d(a){var b,c=this,d=(b=0xefc8249d,function(a){a=a.toString();for(var c=0;c<a.length;c++){var d=.02519603282416938*(b+=a.charCodeAt(c));d-=b=d>>>0,b=(d*=b)>>>0,b+=0x100000000*(d-=b)}return 23283064365386963e-26*(b>>>0)});c.next=function(){var a=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=a-(c.c=0|a)},c.c=1,c.s0=d(" "),c.s1=d(" "),c.s2=d(" "),c.s0-=d(a),c.s0<0&&(c.s0+=1),c.s1-=d(a),c.s1<0&&(c.s1+=1),c.s2-=d(a),c.s2<0&&(c.s2+=1),d=null}function e(a,b){return b.c=a.c,b.s0=a.s0,b.s1=a.s1,b.s2=a.s2,b}function f(a,b){var c=new d(a),f=b&&b.state,g=c.next;return g.int32=function(){return 0x100000000*c.next()|0},g.double=function(){return g()+11102230246251565e-32*(2097152*g()|0)},g.quick=g,f&&("object"==typeof f&&e(f,c),g.state=function(){return e(c,{})}),g}b&&b.exports?b.exports=f:c&&c.amd?c(function(){return f}):this.alea=f}(0,a,!1)}),sE=sC(function(a){!function(a,b,c){function d(a){var b=this,c="";b.x=0,b.y=0,b.z=0,b.w=0,b.next=function(){var a=b.x^b.x<<11;return b.x=b.y,b.y=b.z,b.z=b.w,b.w^=b.w>>>19^a^a>>>8},a===(0|a)?b.x=a:c+=a;for(var d=0;d<c.length+64;d++)b.x^=c.charCodeAt(d),b.next()}function e(a,b){return b.x=a.x,b.y=a.y,b.z=a.z,b.w=a.w,b}function f(a,b){var c=new d(a),f=b&&b.state,g=function(){return(c.next()>>>0)/0x100000000};return g.double=function(){do var a=((c.next()>>>11)+(c.next()>>>0)/0x100000000)/2097152;while(0===a);return a},g.int32=c.next,g.quick=g,f&&("object"==typeof f&&e(f,c),g.state=function(){return e(c,{})}),g}b&&b.exports?b.exports=f:c&&c.amd?c(function(){return f}):this.xor128=f}(0,a,!1)}),sF=sC(function(a){!function(a,b,c){function d(a){var b=this,c="";b.next=function(){var a=b.x^b.x>>>2;return b.x=b.y,b.y=b.z,b.z=b.w,b.w=b.v,(b.d=b.d+362437|0)+(b.v=b.v^b.v<<4^a^a<<1)|0},b.x=0,b.y=0,b.z=0,b.w=0,b.v=0,a===(0|a)?b.x=a:c+=a;for(var d=0;d<c.length+64;d++)b.x^=c.charCodeAt(d),d==c.length&&(b.d=b.x<<10^b.x>>>4),b.next()}function e(a,b){return b.x=a.x,b.y=a.y,b.z=a.z,b.w=a.w,b.v=a.v,b.d=a.d,b}function f(a,b){var c=new d(a),f=b&&b.state,g=function(){return(c.next()>>>0)/0x100000000};return g.double=function(){do var a=((c.next()>>>11)+(c.next()>>>0)/0x100000000)/2097152;while(0===a);return a},g.int32=c.next,g.quick=g,f&&("object"==typeof f&&e(f,c),g.state=function(){return e(c,{})}),g}b&&b.exports?b.exports=f:c&&c.amd?c(function(){return f}):this.xorwow=f}(0,a,!1)}),sG=sC(function(a){!function(a,b,c){function d(a){var b=this;b.next=function(){var a,c,d=b.x,e=b.i;return a=d[e],c=(a^=a>>>7)^a<<24^((a=d[e+1&7])^a>>>10)^((a=d[e+3&7])^a>>>3)^((a=d[e+4&7])^a<<7),a=d[e+7&7],c^=(a^=a<<13)^a<<9,d[e]=c,b.i=e+1&7,c},function(a,b){var c,d=[];if(b===(0|b))d[0]=b;else for(b=""+b,c=0;c<b.length;++c)d[7&c]=d[7&c]<<15^b.charCodeAt(c)+d[c+1&7]<<13;for(;d.length<8;)d.push(0);for(c=0;c<8&&0===d[c];++c);for(8==c?d[7]=-1:d[c],a.x=d,a.i=0,c=256;c>0;--c)a.next()}(b,a)}function e(a,b){return b.x=a.x.slice(),b.i=a.i,b}function f(a,b){null==a&&(a=+new Date);var c=new d(a),f=b&&b.state,g=function(){return(c.next()>>>0)/0x100000000};return g.double=function(){do var a=((c.next()>>>11)+(c.next()>>>0)/0x100000000)/2097152;while(0===a);return a},g.int32=c.next,g.quick=g,f&&(f.x&&e(f,c),g.state=function(){return e(c,{})}),g}b&&b.exports?b.exports=f:c&&c.amd?c(function(){return f}):this.xorshift7=f}(0,a,!1)}),sH=sC(function(a){!function(a,b,c){function d(a){var b=this;b.next=function(){var a,c,d=b.w,e=b.X,f=b.i;return b.w=d=d+0x61c88647|0,c=e[f+34&127],a=e[f=f+1&127],c^=c<<13,a^=a<<17,c^=c>>>15,a^=a>>>12,c=e[f]=c^a,b.i=f,c+(d^d>>>16)|0},function(a,b){var c,d,e,f,g,h=[],i=128;for(b===(0|b)?(d=b,b=null):(b+="\0",d=0,i=Math.max(i,b.length)),e=0,f=-32;f<i;++f)b&&(d^=b.charCodeAt((f+32)%b.length)),0===f&&(g=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,f>=0&&(g=g+0x61c88647|0,e=0==(c=h[127&f]^=d+g)?e+1:0);for(e>=128&&(h[127&(b&&b.length||0)]=-1),e=127,f=512;f>0;--f)d=h[e+34&127],c=h[e=e+1&127],d^=d<<13,c^=c<<17,d^=d>>>15,c^=c>>>12,h[e]=d^c;a.w=g,a.X=h,a.i=e}(b,a)}function e(a,b){return b.i=a.i,b.w=a.w,b.X=a.X.slice(),b}function f(a,b){null==a&&(a=+new Date);var c=new d(a),f=b&&b.state,g=function(){return(c.next()>>>0)/0x100000000};return g.double=function(){do var a=((c.next()>>>11)+(c.next()>>>0)/0x100000000)/2097152;while(0===a);return a},g.int32=c.next,g.quick=g,f&&(f.X&&e(f,c),g.state=function(){return e(c,{})}),g}b&&b.exports?b.exports=f:c&&c.amd?c(function(){return f}):this.xor4096=f}(0,a,!1)}),sI=sC(function(a){!function(a,b,c){function d(a){var b=this,c="";b.next=function(){var a=b.b,c=b.c,d=b.d,e=b.a;return a=a<<25^a>>>7^c,c=c-d|0,d=d<<24^d>>>8^e,e=e-a|0,b.b=a=a<<20^a>>>12^c,b.c=c=c-d|0,b.d=d<<16^c>>>16^e,b.a=e-a|0},b.a=0,b.b=0,b.c=-0x61c88647,b.d=0x517cc1b7,a===Math.floor(a)?(b.a=a/0x100000000|0,b.b=0|a):c+=a;for(var d=0;d<c.length+20;d++)b.b^=c.charCodeAt(d),b.next()}function e(a,b){return b.a=a.a,b.b=a.b,b.c=a.c,b.d=a.d,b}function f(a,b){var c=new d(a),f=b&&b.state,g=function(){return(c.next()>>>0)/0x100000000};return g.double=function(){do var a=((c.next()>>>11)+(c.next()>>>0)/0x100000000)/2097152;while(0===a);return a},g.int32=c.next,g.quick=g,f&&("object"==typeof f&&e(f,c),g.state=function(){return e(c,{})}),g}b&&b.exports?b.exports=f:c&&c.amd?c(function(){return f}):this.tychei=f}(0,a,!1)}),sJ=sC(function(a){!function(b,d){var e,f=this,g="random",h=d.pow(256,6),i=d.pow(2,52),j=2*i;function k(a,c,k){var p=[],q=n(function a(b,c){var d,e=[],f=typeof b;if(c&&"object"==f)for(d in b)try{e.push(a(b[d],c-1))}catch(a){}return e.length?e:"string"==f?b:b+"\0"}((c=1==c?{entropy:!0}:c||{}).entropy?[a,o(b)]:null==a?function(){try{var a;return e&&(a=e.randomBytes)?a=a(256):(a=new Uint8Array(256),(f.crypto||f.msCrypto).getRandomValues(a)),o(a)}catch(a){var c=f.navigator,d=c&&c.plugins;return[+new Date,f,d,f.screen,o(b)]}}():a,3),p),r=new l(p),s=function(){for(var a=r.g(6),b=h,c=0;a<i;)a=(a+c)*256,b*=256,c=r.g(1);for(;a>=j;)a/=2,b/=2,c>>>=1;return(a+c)/b};return s.int32=function(){return 0|r.g(4)},s.quick=function(){return r.g(4)/0x100000000},s.double=s,n(o(r.S),b),(c.pass||k||function(a,b,c,e){return e&&(e.S&&m(e,r),a.state=function(){return m(r,{})}),c?(d[g]=a,b):a})(s,q,"global"in c?c.global:this==d,c.state)}function l(a){var b,c=a.length,d=this,e=0,f=d.i=d.j=0,g=d.S=[];for(c||(a=[c++]);e<256;)g[e]=e++;for(e=0;e<256;e++)g[e]=g[f=255&f+a[e%c]+(b=g[e])],g[f]=b;(d.g=function(a){for(var b,c=0,e=d.i,f=d.j,g=d.S;a--;)b=g[e=255&e+1],c=256*c+g[255&(g[e]=g[f=255&f+b])+(g[f]=b)];return d.i=e,d.j=f,c})(256)}function m(a,b){return b.i=a.i,b.j=a.j,b.S=a.S.slice(),b}function n(a,b){for(var c,d=a+"",e=0;e<d.length;)b[255&e]=255&(c^=19*b[255&e])+d.charCodeAt(e++);return o(b)}function o(a){return String.fromCharCode.apply(0,a)}if(d["seed"+g]=k,n(d.random(),b),a.exports){a.exports=k;try{e=c(5511)}catch(a){}}}([],Math)});sJ.alea=sD,sJ.xor128=sE,sJ.xorwow=sF,sJ.xorshift7=sG,sJ.xor4096=sH,sJ.tychei=sI;var sK=sJ.alea,sL=function(){function a(a,b,c,d,e){this.mean=a,this.stdDev=b,this.dtype=c,this.nextVal=NaN,this.truncated=d,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var f=e||Math.random();this.random=sK(f.toString())}return a.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var a=this.nextVal;return this.nextVal=NaN,a}for(var b,c,d=!1;!d;){var e=void 0,f=void 0,g=void 0;do g=(e=2*this.random()-1)*e+(f=2*this.random()-1)*f;while(g>=1||0===g);var h=Math.sqrt(-2*Math.log(g)/g);b=this.mean+this.stdDev*e*h,c=this.mean+this.stdDev*f*h,this.truncated&&!this.isValidTruncated(b)||(d=!0)}return this.truncated&&!this.isValidTruncated(c)||(this.nextVal=this.convertValue(c)),this.convertValue(b)},a.prototype.convertValue=function(a){return null==this.dtype||"float32"===this.dtype?a:Math.round(a)},a.prototype.isValidTruncated=function(a){return a<=this.upper&&a>=this.lower},a}(),sM=function(){function a(a,b,c,d){this.alpha=a,this.beta=1/b,this.dtype=c;var e=d||Math.random();this.randu=sK(e.toString()),this.randn=new sL(0,1,c,!1,this.randu()),this.d=a<1?a+2/3:a-1/3,this.c=1/Math.sqrt(9*this.d)}return a.prototype.nextValue=function(){for(var a,b,c,d,e,f;;){do d=this.randn.nextValue(),f=1+this.c*d;while(f<=0);if(f*=f*f,b=1-.331*(a=d*d)*a,c=.5*a+this.d*(1-f+Math.log(f)),(e=this.randu())<b||Math.log(e)<c)break}return f=1/this.beta*this.d*f,this.alpha<1&&(f*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(f)},a.prototype.convertValue=function(a){return"float32"===this.dtype?a:Math.round(a)},a}(),sN=function(){function a(a,b,c,d){var e=this;if(void 0===a&&(a=0),void 0===b&&(b=1),this.canReturnFloat=function(){return null==e.dtype||"float32"===e.dtype},this.min=a,this.range=b-a,this.dtype=c,null==d&&(d=Math.random()),"number"==typeof d&&(d=d.toString()),!this.canReturnFloat()&&this.range<=1)throw Error("The difference between "+a+" - "+b+" <= 1 and dtype is not float");this.random=sK(d)}return a.prototype.convertValue=function(a){return this.canReturnFloat()?a:Math.round(a)},a.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},a}();function sO(a,b,c){return void 0===b&&(b="float32"),b=b||"float32",qB(a),new qL(a,b,c)}var sP=sf({batchToSpaceND_:function(a,b,c){var d=r3(a,"x","batchToSpaceND"),e=b.reduce(function(a,b){return a*b});return p3(d.rank>=1+b.length,function(){return"input rank is "+d.rank+" but should be > than blockShape.length "+b.length}),p3(c.length===b.length,function(){return"crops.length is "+c.length+" but should be equal to blockShape.length  "+b.length}),p3(d.shape[0]%e==0,function(){return"input tensor batch is "+d.shape[0]+" but is not divisible by the product of the elements of blockShape "+b.join(" * ")+" === "+e}),q4.runKernelFunc(function(a){return a.batchToSpaceND(d,b,c)},{$x:d},function(a){return{$x:function(){return a.spaceToBatchND(b,c)}}})}}),sQ=sf({broadcastTo_:function(a,b){var c=r3(a,"broadcastTo","x"),d=c.shape;if(b.some(function(a){return!(a>0)||a%1!=0}))throw Error("broadcastTo(): Invalid broadcast shape ["+b+"].");if(b.length<c.rank)throw Error("broadcastTo(): shape.length="+b.length+" < input.rank="+c.rank+".");if(b.length>c.rank){for(var e=c.shape.slice();e.length<b.length;)e.unshift(1);c=c.reshape(e)}for(var f=Array.from(b),g=b.length-1;g>=0;g--)if(c.shape[g]===b[g])f[g]=1;else if(1!==c.shape[g])throw Error("broadcastTo(): ["+d+"] cannot be broadcast to ["+b+"].");var h=f.map(function(a,b){return a>1?b:-1}).filter(function(a){return a>=0});return 0===h.length?c.clone():q4.runKernelFunc(function(a){return a.tile(c,f)},{input:c},function(a){return{input:function(){return a.sum(h,!0)}}})}}),sR=sf({cast_:function(a,b){var c=r3(a,"x","cast");if(!qk(b))throw Error("Failed to cast to unknown dtype "+b);if("string"===b&&"string"!==c.dtype||"string"!==b&&"string"===c.dtype)throw Error("Only strings can be casted to strings");return q4.runKernelFunc(function(a){return a.cast(c,b)},{x:c},function(a){return{x:function(){return a.clone()}}},"Cast",{dtype:b})}}),sS=sf({clone_:function(a){var b=r3(a,"x","clone",null);return q4.runKernelFunc(function(){return q4.makeTensorFromDataId(b.dataId,b.shape,b.dtype)},{$x:b},function(a){return{$x:function(){return a.toFloat()}}})}}),sT=sf({cumsum_:function(a,b,c,d){void 0===b&&(b=0),void 0===c&&(c=!1),void 0===d&&(d=!1);var e=r3(a,"x","cumsum"),f=sa([b|=0],e.rank),g=e;null!=f&&(g=e.transpose(f));var h=sc(1,e.rank)[0],i=q4.runKernelFunc(function(a){return a.cumsum(g,h,c,d)},{permutedX:g},function(a){return{permutedX:function(){return a.cumsum(b,c,!d)}}});return null!=f&&(i=i.transpose(f)),i}}),sU=sf({depthToSpace_:function(a,b,c){void 0===c&&(c="NHWC");var d=r3(a,"x","depthToSpace"),e="NHWC"===c?d.shape[1]:d.shape[2],f="NHWC"===c?d.shape[2]:d.shape[3],g="NHWC"===c?d.shape[3]:d.shape[1];return p3(e*b>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+e+" and "+b+"  for depthToSpace with input shape\n      "+d.shape}),p3(f*b>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+f+" and "+b+" for depthToSpace with input shape\n          "+d.shape}),p3(g%(b*b)==0,function(){return"Dimension size must be evenly divisible by "+b*b+" but is "+g+" for depthToSpace with input shape "+d.shape}),q4.runKernelFunc(function(a){return a.depthToSpace(d,b,c)},{$x:d})}}),sV=sf({expandDims_:function(a,b){void 0===b&&(b=0);var c=r3(a,"x","expandDims",null);p3(b<=c.rank,function(){return"Axis must be <= rank of the tensor"});var d=c.shape.slice();return b<0&&(p3(-(c.rank+1)<=b,function(){return"Axis must be in the interval ["+-(c.rank+1)+", "+c.rank+"]"}),b=c.rank+b+1),d.splice(b,0,1),s6(c,d)}}),sW=sf({eye_:function(a,b,c,d){void 0===d&&(d="float32"),null==b&&(b=a);for(var e=sO([a,b],d),f=a<=b?a:b,g=0;g<f;++g)e.set(1,g,g);var h=e.toTensor().as2D(a,b);if(null==c)return h;if(1===c.length)return ta(sV(h,0),[c[0],1,1]);if(2===c.length)return ta(sV(sV(h,0),0),[c[0],c[1],1,1]);if(3===c.length)return ta(sV(sV(sV(h,0),0),0),[c[0],c[1],c[2],1,1]);throw Error("eye() currently supports only 1D and 2D batchShapes, but received "+c.length+"D.")}}),sX=sf({multinomial_:function(a,b,c,d){void 0===d&&(d=!1);var e=r3(a,"logits","multinomial"),f=e.size,g=e.rank;if(f<2)throw Error("Error in multinomial: you need at least 2 outcomes, but got "+f+".");if(g>2)throw Error("Rank of probabilities must be 1 or 2, but is "+g);c=c||Math.random();var h=1===g?e.as2D(1,-1):e,i=q4.runKernelFunc(function(a){return a.multinomial(h,d,b,c)},{logits2D:h});return 1===g?i.as1D():i}}),sY=sf({oneHot_:function(a,b,c,d){if(void 0===c&&(c=1),void 0===d&&(d=0),b<2)throw Error("Error in oneHot: depth must be >=2, but it is "+b);var e=r3(a,"indices","oneHot","int32"),f=e.shape.concat([b]);return e=e.flatten(),q4.runKernelFunc(function(a){return a.oneHot(e,b,c,d)},{$indices:e},function(a){return{$indices:function(){return sr(e.shape,"float32")}}}).reshape(f)}}),sZ=sf({pad_:function(a,b,c){void 0===c&&(c=0);var d=r3(a,"x","pad");if(0===d.rank)throw Error("pad(scalar) is not defined. Pass non-scalar to pad");var e={paddings:b,constantValue:c};return q4.runKernelFunc(function(a){return a.pad(d,b,c)},{x:d},function(a){var c=b.map(function(a){return a[0]});return{x:function(){return a.slice(c,d.shape)}}},"PadV2",e)}}),s$=sf({pad1d_:function(a,b,c){return void 0===c&&(c=0),p3(2===b.length,function(){return"Invalid number of paddings. Must be length of 2."}),sZ(a,[b],c)}}),s_=sf({pad2d_:function(a,b,c){return void 0===c&&(c=0),p3(2===b.length&&2===b[0].length&&2===b[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),sZ(a,b,c)}}),s0=sf({pad3d_:function(a,b,c){return void 0===c&&(c=0),p3(3===b.length&&2===b[0].length&&2===b[1].length&&2===b[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),sZ(a,b,c)}}),s1=sf({pad4d_:function(a,b,c){return void 0===c&&(c=0),p3(4===b.length&&2===b[0].length&&2===b[1].length&&2===b[2].length&&2===b[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),sZ(a,b,c)}}),s2=sf({rand_:function(a,b,c){var d=p7(a),e=null;if(null==c||"float32"===c)e=new Float32Array(d);else if("int32"===c)e=new Int32Array(d);else{if("bool"!==c)throw Error("Unknown data type "+c);e=new Uint8Array(d)}for(var f=0;f<d;f++)e[f]=b();return q4.makeTensor(e,a,c)}}),s3=sf({randomNormal_:function(a,b,c,d,e){if(void 0===b&&(b=0),void 0===c&&(c=1),null!=d&&"bool"===d)throw Error("Unsupported data type "+d);for(var f=new sL(b,c,d,!1,e),g=sO(a,d),h=0;h<g.values.length;h++)g.values[h]=f.nextValue();return g.toTensor()}}),s4=sf({randomGamma_:function(a,b,c,d,e){if(void 0===c&&(c=1),void 0===d&&(d="float32"),null==c&&(c=1),null==d&&(d="float32"),"float32"!==d&&"int32"!==d)throw Error("Unsupported data type "+d);for(var f=new sM(b,c,d,e),g=sO(a,d),h=0;h<g.values.length;h++)g.values[h]=f.nextValue();return g.toTensor()}}),s5=sf({randomUniform_:function(a,b,c,d,e){void 0===b&&(b=0),void 0===c&&(c=1),void 0===d&&(d="float32");for(var f=sO(a,d),g=new sN(b,c,null,e),h=0;h<f.values.length;h++)f.values[h]=g.nextValue();return f.toTensor()}}),s6=sf({reshape_:function(a,b){var c=r3(a,"x","reshape",null);b=qe(b,c.size),p3(c.size===p7(b),function(){return"new shape and old shape must have the same number of elements."});var d={shape:b};return q4.runKernelFunc(function(a){return a.reshape(c,b)},{x:c},function(a){return{x:function(){return a.reshape(c.shape)}}},"Reshape",d)}}),s7=sf({spaceToBatchND_:function(a,b,c){var d=r3(a,"x","spaceToBatchND");return p3(d.rank>=1+b.length,function(){return"input rank "+d.rank+" should be > than [blockShape] "+b.length}),p3(c.length===b.length,function(){return"paddings.shape[0] "+c.length+" must be equal to [blockShape] "+b.length}),p3(d.shape.reduce(function(a,d,e){return e>0&&e<=b.length?a&&(d+c[e-1][0]+c[e-1][1])%b[e-1]==0:a},!0),function(){return"input spatial dimensions "+d.shape.slice(1)+" with paddings "+c.toString()+" must be divisible by blockShapes "+b.toString()}),q4.runKernelFunc(function(a){return a.spaceToBatchND(d,b,c)},{$x:d},function(a){return{$x:function(){return a.batchToSpaceND(b,c)}}})}}),s8=sf({squeeze_:function(a,b){var c=r3(a,"x","squeeze");return s6(c,qg(c.shape,b).newShape)}}),s9=sf({stack_:function(a,b){void 0===b&&(b=0);var c=r4(a,"tensors","stack");if(p3(c.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===c.length)return c[0].expandDims(b);var d=c[0].rank,e=c[0].shape,f=c[0].dtype;return p3(b<=d,function(){return"Axis must be <= rank of the tensor"}),c.forEach(function(a){p4(e,a.shape,"All tensors passed to stack must have matching shapes")}),c.forEach(function(a){p3(f===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})}),sw(c.map(function(a){return a.expandDims(b)}),b)}}),ta=sf({tile_:function(a,b){var c=r3(a,"x","tile",null);p3(c.rank===b.length,function(){return"Error in transpose: rank of input "+c.rank+" must match length of reps "+b+"."});var d=[c];return q4.runKernelFunc(function(a,d){var e=a.tile(c,b);return d([c]),e},{x:c},function(a,c){var d=c[0];return{x:function(){var c=sv(d);if(1===d.rank)for(var e=0;e<b[0];++e)c=c.add(a.slice([e*d.shape[0]],[d.shape[0]]));else if(2===d.rank)for(e=0;e<b[0];++e)for(var f=0;f<b[1];++f)c=c.add(a.slice([e*d.shape[0],f*d.shape[1]],[d.shape[0],d.shape[1]]));else if(3===d.rank)for(e=0;e<b[0];++e)for(f=0;f<b[1];++f)for(var g=0;g<b[2];++g)c=c.add(a.slice([e*d.shape[0],f*d.shape[1],g*d.shape[2]],[d.shape[0],d.shape[1],d.shape[2]]));else{if(4!==d.rank)throw Error("Gradient for tile operation is not implemented for rank-"+d.rank+" tensors yet.");for(e=0;e<b[0];++e)for(f=0;f<b[1];++f)for(g=0;g<b[2];++g)for(var h=0;h<b[3];++h)c=c.add(a.slice([e*d.shape[0],f*d.shape[1],g*d.shape[2],h*d.shape[3]],[d.shape[0],d.shape[1],d.shape[2],d.shape[3]]))}return c}}},"Tile",{reps:b},d)}}),tb=sf({truncatedNormal_:function(a,b,c,d,e){if(void 0===b&&(b=0),void 0===c&&(c=1),null!=d&&"bool"===d)throw Error("Unsupported data type "+d);for(var f=new sL(b,c,d,!0,e),g=sO(a,d),h=0;h<g.values.length;h++)g.values[h]=f.nextValue();return g.toTensor()}}),tc=sf({unstack_:function(a,b){void 0===b&&(b=0),b=b||0;var c=r3(a,"x","unstack");p3(b>=-c.shape.length&&b<c.shape.length,function(){return"Axis = "+b+" is not in [-"+c.shape.length+", "+c.shape.length+")"}),b<0&&(b+=c.shape.length);var d={axis:b};return q4.runKernelFunc(function(a){return a.unstack(c,b)},{x:c},function(a){return{x:function(){return s9(a,b)}}},"Unpack",d)}});function td(a,b,c,d){void 0===d&&(d=!0);var e=[];if(d)(e=e.concat(b.slice(0))).push(a[0]/c),e=e.concat(a.slice(1));else{e=e.concat(a[0]);for(var f=b.length,g=0;g<f;++g)e=e.concat([a[g+1]/b[g],b[g]]);e=e.concat(a.slice(f+1))}return e}function te(a,b,c){void 0===c&&(c=!0);var d=[];if(c){d.push(b);for(var e=b+1;e<a;++e)e<=2*b?(d.push(e),d.push(e-(b+1))):d.push(e)}else{var f=[],g=[];for(e=1;e<a;++e)e>=2*b+1||e%2==1?g.push(e):f.push(e);d.push.apply(d,f),d.push(0),d.push.apply(d,g)}return d}function tf(a,b,c,d){void 0===d&&(d=!0);var e=[];d?e.push(a[0]/c):e.push(a[0]*c);for(var f=1;f<a.length;++f)f<=b.length?d?e.push(b[f-1]*a[f]):e.push(a[f]/b[f-1]):e.push(a[f]);return e}function tg(a,b){for(var c=[0],d=0;d<b;++d)c.push(a[d][0]);return c}function th(a,b,c){for(var d=a.slice(0,1),e=0;e<c;++e)d.push(a[e+1]-b[e][0]-b[e][1]);return d}function ti(a,b){if(a.rank<1)throw Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+a.rank+".");if(b.rank<1)throw Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+b.rank+".");if("int32"!==b.dtype)throw Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+b.dtype+".");if(b.shape[b.rank-1]>a.rank)throw Error("index innermost dimension length must be <= tensor rank; saw: "+b.shape[b.rank-1]+" vs. "+a.rank);if(0===a.size)throw Error("Requested more than 0 entries, but input is empty. Input shape: "+a.shape+".");for(var c=b.shape,d=c[c.length-1],e=1,f=0;f<c.length-1;++f)e*=c[f];var g=a.shape,h=c.slice();h.pop();var i=1;for(f=d;f<a.rank;++f)i*=g[f],h.push(g[f]);var j=qv(a.shape).map(function(a){return a/i}).concat([1]).slice(0,d);return[h,e,i,j]}function tj(a){return a<=30?a:qu(a,Math.floor(Math.sqrt(a)))}function tk(a,b,c){var d=b.rank>1?b.shape[b.rank-1]:1,e=b.rank>1?b.rank-1:1,f="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+c.shape+", indices.shape: "+b.shape+", shape: "+a+", sliceDim: "+d+", and batchDim: "+e+".";if(c.rank<e)throw Error(f+" update.rank < "+e+". ");if(a.length<d+(c.rank-e))throw Error(f+" Output shape length < "+(d+(c.rank-e)));if(c.rank!==e+a.length-d)throw Error(f+" update.rank != "+(e+a.length-d));for(var g=0;g<e;++g)if(c.shape[g]!==b.shape[g])throw Error(f+" updates.shape["+g+"] ("+c.shape[g]+") != indices.shape["+g+"] ("+b.shape[g]+").");for(g=0;g<c.rank-e;++g)if(c.shape[g+e]!==a[g+d])throw Error(f+" updates.shape["+(g+e)+"] ("+c.shape[g+e]+") != shape["+(g+e)+"] ("+a[g+e]+")")}function tl(a,b,c){if(b.rank<1)throw Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+b.rank+".");if(a.rank<1)throw Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+a.rank+".");if("int32"!==b.dtype)throw Error("The dtype of 'indices' should be int32, but got dtype: "+b.dtype);if(c.length<1)throw Error("Output rank must be greater or equal to 1, but got shape: "+c);if(0===c.length){if(0===b.size)throw Error("Indices specified for empty output. indices shape: "+b.shape);if(0===a.size)throw Error("Updates specified for empty output. updates shape: "+a.shape)}tk(c,b,a)}function tm(a,b,c){for(var d=b.shape.length,e=d>1?b.shape[d-1]:1,f=c.length,g=1,h=e;h<f;++h)g*=c[h];var i=e<1?1:e;return{sliceRank:e,numUpdates:p7(b.shape)/i,sliceSize:g,strides:qv(c.slice(0,e)).concat([1]),outputSize:p7(c)}}function tn(a,b,c){p3(a.rank===b.length,function(){return"Error in slice"+a.rank+"D: Length of begin "+b+" must match the rank of the array ("+a.rank+")."}),p3(a.rank===c.length,function(){return"Error in slice"+a.rank+"D: Length of size "+c+" must match the rank of the array ("+a.rank+")."});for(var d=function(d){p3(b[d]+c[d]<=a.shape[d],function(){return"Error in slice"+a.rank+"D: begin["+d+"] + size["+d+"] ("+(b[d]+c[d])+") would overflow input.shape["+d+"] ("+a.shape[d]+")"})},e=0;e<a.rank;++e)d(e)}function to(a){for(var b=[],c=0;a>0;)1&a&&b.push(c),a/=2,c++;return b}function tp(a,b,c){for(var d=[],e=0;e<a.length;e++)d[e]=Math.ceil((b[e]-a[e])/c[e]);return d}function tq(a,b,c,d,e){var f=b[e],g=c[e]||1;(a&1<<e||null==f)&&(f=g>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var h=d[e];return f<0&&(f+=h),f=p0(0,f,h-1)}function tr(a,b,c,d,e){var f=b[e],g=c[e]||1;(a&1<<e||null==f)&&(f=g>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var h=d[e];return f<0&&(f+=h),f=g>0?p0(0,f,h):p0(-1,f,h-1)}function ts(a,b,c){for(var d=c.length,e=0;e<c.length;e++)if(c[e]>1){d=e;break}for(e=d+1;e<c.length;e++)if(b[e]>0||c[e]!==a[e])return!1;return!0}function tt(a,b){for(var c=a.length>0?a[a.length-1]:1,d=0;d<a.length-1;d++)c+=a[d]*b[d];return c}function tu(a){return q4.customGrad(a)}Object.freeze({prepareAndValidate:ti}),Object.freeze({validateUpdateShape:tk,validateInput:tl,calculateShapes:tm}),Object.freeze({assertParamsValid:tn,maskToAxes:to,computeOutShape:tp,startForAxis:tq,stopForAxis:tr,isSliceContinous:ts,computeFlatOffset:tt});var tv=sf({softmax_:function(a,b){void 0===b&&(b=-1);var c=r3(a,"logits","softmax","float32");if(-1===b&&(b=c.rank-1),b!==c.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+c.rank+" and dim was "+b);return q4.runKernelFunc(function(a,d){var e=a.softmax(c,b);return d([e]),e},{logits:c},function(a,c){var d=c[0],e=a.mul(d);return{logits:function(){return e.sub(e.sum([b],!0).mul(d))}}},"Softmax",{dim:b},[],[!0])}}),tw=sf({logSoftmax_:function(a,b){void 0===b&&(b=-1);var c=r3(a,"logits","logSoftmax");if(-1===b&&(b=c.rank-1),b!==c.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+c.rank+" and axis was "+b);return tu(function(a,c){var d=a.max(b,!0),e=a.sub(d),f=e.toFloat().sub(e.exp().sum(b,!0).log());return c([f]),{value:f,gradFunc:function(a,c){var d=c[0].exp();return a.sub(a.sum(b,!0).mul(d))}}})(c)}}),tx=function(){function a(a,b){this.backend=a,this.dataMover=b,this.data=new WeakMap,this.dataIdsCount=0}return a.prototype.get=function(a){return this.data.has(a)||this.dataMover.moveData(this.backend,a),this.data.get(a)},a.prototype.set=function(a,b){this.dataIdsCount++,this.data.set(a,b)},a.prototype.has=function(a){return this.data.has(a)},a.prototype.delete=function(a){return this.dataIdsCount--,this.data.delete(a)},a.prototype.numDataIds=function(){return this.dataIdsCount},a}(),ty=function(){function a(){}return a.prototype.time=function(a){return tz("time")},a.prototype.read=function(a){return tz("read")},a.prototype.readSync=function(a){return tz("readSync")},a.prototype.numDataIds=function(){return tz("numDataIds")},a.prototype.disposeData=function(a){return tz("disposeData")},a.prototype.write=function(a,b,c){return tz("write")},a.prototype.move=function(a,b,c,d){return tz("move")},a.prototype.memory=function(){return tz("memory")},a.prototype.floatPrecision=function(){return tz("floatPrecision")},a.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},a.prototype.batchMatMul=function(a,b,c,d){return tz("batchMatMul")},a.prototype.fusedBatchMatMul=function(a){return a.a,a.b,a.transposeA,a.transposeB,a.bias,a.activation,a.preluActivationWeights,tz("fusedBatchMatMul")},a.prototype.slice=function(a,b,c){return tz("slice")},a.prototype.stridedSlice=function(a,b,c,d){return tz("stridedSlice")},a.prototype.unstack=function(a,b){return tz("unstack")},a.prototype.reverse=function(a,b){return tz("reverse")},a.prototype.concat=function(a,b){return tz("concat")},a.prototype.neg=function(a){return tz("neg")},a.prototype.add=function(a,b){return tz("add")},a.prototype.addN=function(a){return tz("addN")},a.prototype.subtract=function(a,b){return tz("subtract")},a.prototype.multiply=function(a,b){return tz("multiply")},a.prototype.realDivide=function(a,b){return tz("realDivide")},a.prototype.floorDiv=function(a,b){return tz("floorDiv")},a.prototype.sum=function(a,b){return tz("sum")},a.prototype.prod=function(a,b){return tz("prod")},a.prototype.unsortedSegmentSum=function(a,b,c){return tz("unsortedSegmentSum")},a.prototype.argMin=function(a,b){return tz("argMin")},a.prototype.argMax=function(a,b){return tz("argMax")},a.prototype.equal=function(a,b){return tz("equal")},a.prototype.notEqual=function(a,b){return tz("notEqual")},a.prototype.less=function(a,b){return tz("less")},a.prototype.lessEqual=function(a,b){return tz("lessEqual")},a.prototype.greater=function(a,b){return tz("greater")},a.prototype.greaterEqual=function(a,b){return tz("greaterEqual")},a.prototype.logicalNot=function(a){return tz("logicalNot")},a.prototype.logicalAnd=function(a,b){return tz("logicalAnd")},a.prototype.logicalOr=function(a,b){return tz("logicalOr")},a.prototype.where=function(a){return tz("where")},a.prototype.select=function(a,b,c){return tz("select")},a.prototype.topk=function(a,b,c){return tz("topk")},a.prototype.min=function(a,b){return tz("min")},a.prototype.minimum=function(a,b){return tz("minimum")},a.prototype.mod=function(a,b){return tz("mod")},a.prototype.max=function(a,b){return tz("max")},a.prototype.maximum=function(a,b){return tz("maximum")},a.prototype.all=function(a,b){return tz("all")},a.prototype.any=function(a,b){return tz("any")},a.prototype.squaredDifference=function(a,b){return tz("squaredDifference")},a.prototype.ceil=function(a){return tz("ceil")},a.prototype.floor=function(a){return tz("floor")},a.prototype.round=function(a){return tz("round")},a.prototype.sign=function(a){return tz("sign")},a.prototype.isNaN=function(a){return tz("isNaN")},a.prototype.isInf=function(a){return tz("isInf")},a.prototype.isFinite=function(a){return tz("isFinite")},a.prototype.pow=function(a,b){return tz("pow")},a.prototype.exp=function(a){return tz("exp")},a.prototype.expm1=function(a){return tz("expm1")},a.prototype.softmax=function(a,b){return tz("softmax")},a.prototype.log=function(a){return tz("log")},a.prototype.log1p=function(a){return tz("log1p")},a.prototype.sqrt=function(a){return tz("sqrt")},a.prototype.rsqrt=function(a){return tz("rsqrt")},a.prototype.square=function(a){return tz("square")},a.prototype.reciprocal=function(a){return tz("reciprocal")},a.prototype.relu=function(a){return tz("relu")},a.prototype.relu6=function(a){return tz("relu6")},a.prototype.prelu=function(a,b){return tz("prelu")},a.prototype.elu=function(a){return tz("elu")},a.prototype.eluDer=function(a,b){return tz("eluDer")},a.prototype.selu=function(a){return tz("selu")},a.prototype.int=function(a){return tz("int")},a.prototype.clip=function(a,b,c){return tz("clip")},a.prototype.abs=function(a){return tz("abs")},a.prototype.complexAbs=function(a){return tz("complexAbs")},a.prototype.sigmoid=function(a){return tz("sigmoid")},a.prototype.softplus=function(a){return tz("softplus")},a.prototype.sin=function(a){return tz("sin")},a.prototype.cos=function(a){return tz("cos")},a.prototype.tan=function(a){return tz("tan")},a.prototype.asin=function(a){return tz("asin")},a.prototype.acos=function(a){return tz("acos")},a.prototype.atan=function(a){return tz("atan")},a.prototype.atan2=function(a,b){return tz("atan2")},a.prototype.sinh=function(a){return tz("sinh")},a.prototype.cosh=function(a){return tz("cosh")},a.prototype.tanh=function(a){return tz("tanh")},a.prototype.asinh=function(a){return tz("asinh")},a.prototype.acosh=function(a){return tz("acosh")},a.prototype.atanh=function(a){return tz("atanh")},a.prototype.erf=function(a){return tz("erf")},a.prototype.step=function(a,b){return tz("step")},a.prototype.fusedConv2d=function(a){return a.input,a.filter,a.convInfo,a.bias,a.activation,a.preluActivationWeights,tz("fusedConv2d")},a.prototype.conv2d=function(a,b,c){return tz("conv2d")},a.prototype.conv2dDerInput=function(a,b,c){return tz("conv2dDerInput")},a.prototype.conv2dDerFilter=function(a,b,c){return tz("conv2dDerFilter")},a.prototype.fusedDepthwiseConv2D=function(a){return a.input,a.filter,a.convInfo,a.bias,a.activation,a.preluActivationWeights,tz("fusedDepthwiseConv2D")},a.prototype.depthwiseConv2D=function(a,b,c){return tz("depthwiseConv2D")},a.prototype.depthwiseConv2DDerInput=function(a,b,c){return tz("depthwiseConv2DDerInput")},a.prototype.depthwiseConv2DDerFilter=function(a,b,c){return tz("depthwiseConv2DDerFilter")},a.prototype.conv3d=function(a,b,c){return tz("conv3d")},a.prototype.conv3dDerInput=function(a,b,c){return tz("conv3dDerInput")},a.prototype.conv3dDerFilter=function(a,b,c){return tz("conv3dDerFilter")},a.prototype.maxPool=function(a,b){return tz("maxPool")},a.prototype.maxPoolBackprop=function(a,b,c,d){return tz("maxPoolBackprop")},a.prototype.avgPool=function(a,b){return tz("avgPool")},a.prototype.avgPoolBackprop=function(a,b,c){return tz("avgPoolBackprop")},a.prototype.avgPool3d=function(a,b){return tz("avgPool3d")},a.prototype.avgPool3dBackprop=function(a,b,c){return tz("avgPool3dBackprop")},a.prototype.maxPool3d=function(a,b){return tz("maxPool3d")},a.prototype.maxPool3dBackprop=function(a,b,c,d){return tz("maxPool3dBackprop")},a.prototype.reshape=function(a,b){return tz("reshape")},a.prototype.cast=function(a,b){return tz("cast")},a.prototype.tile=function(a,b){return tz("tile")},a.prototype.pad=function(a,b,c){return tz("pad")},a.prototype.transpose=function(a,b){return tz("transpose")},a.prototype.gather=function(a,b,c){return tz("gather")},a.prototype.gatherND=function(a,b){return tz("gatherND")},a.prototype.scatterND=function(a,b,c){return tz("scatterND")},a.prototype.batchToSpaceND=function(a,b,c){return tz("batchToSpaceND")},a.prototype.spaceToBatchND=function(a,b,c){return tz("spaceToBatchND")},a.prototype.resizeBilinear=function(a,b,c,d){return tz("resizeBilinear")},a.prototype.resizeBilinearBackprop=function(a,b,c){return tz("resizeBilinearBackprop")},a.prototype.resizeNearestNeighbor=function(a,b,c,d){return tz("resizeNearestNeighbor")},a.prototype.resizeNearestNeighborBackprop=function(a,b,c){return tz("resizeNearestNeighborBackprop")},a.prototype.batchNormalization=function(a,b,c,d,e,f){return tz("batchNormalization")},a.prototype.localResponseNormalization4D=function(a,b,c,d,e){return tz("localResponseNormalization4D")},a.prototype.LRNGrad=function(a,b,c,d,e,f,g){return tz("LRNGrad")},a.prototype.multinomial=function(a,b,c,d){return tz("multinomial")},a.prototype.oneHot=function(a,b,c,d){return tz("oneHot")},a.prototype.cumsum=function(a,b,c,d){return tz("cumsum")},a.prototype.nonMaxSuppression=function(a,b,c,d,e){return tz("nonMaxSuppression")},a.prototype.fft=function(a){return tz("fft")},a.prototype.ifft=function(a){return tz("ifft")},a.prototype.complex=function(a,b){return tz("complex")},a.prototype.real=function(a){return tz("real")},a.prototype.imag=function(a){return tz("imag")},a.prototype.cropAndResize=function(a,b,c,d,e,f){return tz("cropAndResize")},a.prototype.depthToSpace=function(a,b,c){return tz("depthToSpace")},a.prototype.split=function(a,b,c){return tz("split")},a.prototype.sparseToDense=function(a,b,c,d){return tz("sparseToDense")},a.prototype.diag=function(a){return tz("diag")},a.prototype.fill=function(a,b,c){return tz("fill")},a.prototype.onesLike=function(a){return tz("onesLike")},a.prototype.zerosLike=function(a){return tz("zerosLike")},a.prototype.linspace=function(a,b,c){return tz("linspace")},a.prototype.dispose=function(){return tz("dispose")},a}();function tz(a){throw Error("'"+a+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function tA(a,b){for(var c=a.length,d=[],e=0;e<c;e++){var f=c-1-e,g=a[f]||1;(b[b.length-1-e]||1)>1&&1===g&&d.unshift(f)}return d}function tB(a,b){for(var c=[],d=0;d<b.length;d++){var e=a[a.length-d-1],f=b.length-d-1,g=b[f];(null==e||1===e&&g>1)&&c.unshift(f)}return c}function tC(a,b){for(var c=[],d=Math.max(a.length,b.length),e=0;e<d;e++){var f=a[a.length-e-1];null==f&&(f=1);var g=b[b.length-e-1];if(null==g&&(g=1),1===f)c.unshift(g);else if(1===g)c.unshift(f);else{if(f!==g)throw Error("Operands could not be broadcast together with shapes "+a+" and "+b+".");c.unshift(f)}}return c}function tD(a,b,c,d,e,f,g){void 0===g&&(g="channelsLast");var h,i=tI(b),j=i[0],k=i[1];if("channelsLast"===g)h=[j,k,a[3],a[3]];else{if("channelsFirst"!==g)throw Error("Unknown dataFormat "+g);h=[j,k,a[1],a[1]]}return tF(a,h,c,d,e,f,!1,g)}function tE(a,b,c,d,e,f,g){void 0===g&&(g="NDHWC");var h,i,j=tJ(b),k=j[0],l=j[1],m=j[2];if("NDHWC"===g)i="channelsLast",h=[k,l,m,a[4],a[4]];else{if("NCDHW"!==g)throw Error("Unknown dataFormat "+g);i="channelsFirst",h=[k,l,m,a[1],a[1]]}return tG(a,h,c,d,e,!1,i,f)}function tF(a,b,c,d,e,f,g,h){void 0===g&&(g=!1),void 0===h&&(h="channelsLast");var i=-1,j=-1,k=-1,l=-1;if("channelsLast"===h)i=a[0],j=a[1],k=a[2],l=a[3];else{if("channelsFirst"!==h)throw Error("Unknown dataFormat "+h);i=a[0],l=a[1],j=a[2],k=a[3]}var m,n=b[0],o=b[1],p=b[3],q=tI(c),r=q[0],s=q[1],t=tI(d),u=t[0],v=t[1],w=tK(n,u),x=tK(o,v),y=function(a,b,c,d,e,f,g,h){var i,j,k;if("number"==typeof a){i={top:a,bottom:a,left:a,right:a,type:0===a?"VALID":"NUMBER"};var l,m,n,o,p,q,r=(l=[b,c],null==(m=a)&&(m=tH(l,f,d)),n=l[0],o=l[1],p3(p9(p=tL((n-f+2*m)/d+1,h)),function(){return"The output # of rows ("+p+") must be an integer. Change the stride and/or zero pad parameters"}),p3(p9(q=tL((o-f+2*m)/d+1,h)),function(){return"The output # of columns ("+q+") must be an integer. Change the stride and/or zero pad parameters"}),[p,q]);j=r[0],k=r[1]}else if("same"===a){j=Math.ceil(b/d),k=Math.ceil(c/e);var s=Math.max(0,(j-1)*d+f-b),t=Math.max(0,(k-1)*e+g-c),u=Math.floor(s/2),v=Math.floor(t/2);i={top:u,bottom:s-u,left:v,right:t-v,type:"SAME"}}else{if("valid"!==a)throw Error("Unknown padding parameter: "+a);i={top:0,bottom:0,left:0,right:0,type:"VALID"},j=Math.ceil((b-f+1)/d),k=Math.ceil((c-g+1)/e)}return{padInfo:i,outHeight:j,outWidth:k}}(e,j,k,r,s,w,x,f),z=y.padInfo,A=y.outHeight,B=y.outWidth,C=g?p*l:p;return"channelsFirst"===h?m=[i,C,A,B]:"channelsLast"===h&&(m=[i,A,B,C]),{batchSize:i,dataFormat:h,inHeight:j,inWidth:k,inChannels:l,outHeight:A,outWidth:B,outChannels:C,padInfo:z,strideHeight:r,strideWidth:s,filterHeight:n,filterWidth:o,effectiveFilterHeight:w,effectiveFilterWidth:x,dilationHeight:u,dilationWidth:v,inShape:a,outShape:m,filterShape:b}}function tG(a,b,c,d,e,f,g,h){void 0===f&&(f=!1),void 0===g&&(g="channelsLast");var i=-1,j=-1,k=-1,l=-1,m=-1;if("channelsLast"===g)i=a[0],j=a[1],k=a[2],l=a[3],m=a[4];else{if("channelsFirst"!==g)throw Error("Unknown dataFormat "+g);i=a[0],m=a[1],j=a[2],k=a[3],l=a[4]}var n,o=b[0],p=b[1],q=b[2],r=b[4],s=tJ(c),t=s[0],u=s[1],v=s[2],w=tJ(d),x=w[0],y=w[1],z=w[2],A=tK(o,x),B=tK(p,y),C=tK(q,z),D=function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o;if("number"==typeof a){l={top:a,bottom:a,left:a,right:a,front:a,back:a,type:0===a?"VALID":"NUMBER"};var p,q,r,s,t,u,v,w,x=(p=[b,c,d,1],null==(q=a)&&(q=tH(p,h,e)),r=p[0],s=p[1],t=p[2],p3(p9(u=tL((r-h+2*q)/e+1,k)),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}),p3(p9(v=tL((s-h+2*q)/e+1,k)),function(){return"The output # of rows ("+v+") must be an integer. Change the stride and/or zero pad parameters"}),p3(p9(w=tL((t-h+2*q)/e+1,k)),function(){return"The output # of columns ("+w+") must be an integer. Change the stride and/or zero pad parameters"}),[u,v,w,1]);m=x[0],n=x[1],o=x[2]}else if("same"===a){m=Math.ceil(b/e),n=Math.ceil(c/f),o=Math.ceil(d/g);var y=(m-1)*e+h-b,z=(n-1)*f+i-c,A=(o-1)*g+j-d,B=Math.floor(y/2),C=Math.floor(z/2),D=Math.floor(A/2);l={top:C,bottom:z-C,left:D,right:A-D,front:B,back:y-B,type:"SAME"}}else{if("valid"!==a)throw Error("Unknown padding parameter: "+a);l={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},m=Math.ceil((b-h+1)/e),n=Math.ceil((c-i+1)/f),o=Math.ceil((d-j+1)/g)}return{padInfo:l,outDepth:m,outHeight:n,outWidth:o}}(e,j,k,l,t,u,v,A,B,C,h),E=D.padInfo,F=D.outDepth,G=D.outHeight,H=D.outWidth,I=f?r*m:r;return"channelsFirst"===g?n=[i,I,F,G,H]:"channelsLast"===g&&(n=[i,F,G,H,I]),{batchSize:i,dataFormat:g,inDepth:j,inHeight:k,inWidth:l,inChannels:m,outDepth:F,outHeight:G,outWidth:H,outChannels:I,padInfo:E,strideDepth:t,strideHeight:u,strideWidth:v,filterDepth:o,filterHeight:p,filterWidth:q,effectiveFilterDepth:A,effectiveFilterHeight:B,effectiveFilterWidth:C,dilationDepth:x,dilationHeight:y,dilationWidth:z,inShape:a,outShape:n,filterShape:b}}function tH(a,b,c,d){void 0===d&&(d=1);var e=tK(b,d);return Math.floor((a[0]*(c-1)-c+e)/2)}function tI(a){return"number"==typeof a?[a,a,a]:2===a.length?[a[0],a[1],1]:a}function tJ(a){return"number"==typeof a?[a,a,a]:a}function tK(a,b){return b<=1?a:a+(a-1)*(b-1)}function tL(a,b){if(!b)return a;switch(b){case"round":return Math.round(a);case"ceil":return Math.ceil(a);case"floor":return Math.floor(a);default:throw Error("Unknown roundingMode "+b)}}function tM(a){var b=tI(a),c=b[0],d=b[1],e=b[2];return 1===c&&1===d&&1===e}function tN(a,b){return tM(a)||tM(b)}function tO(a){if("NHWC"===a)return"channelsLast";if("NCHW"===a)return"channelsFirst";throw Error("Unknown dataFormat "+a)}function tP(a,b,c){if("complex64"===b){if("complex64"===a.dtype)return a.clone();var d=sr(a.shape),e=a.toFloat(),f=c.complex(e,d);return d.dispose(),e.dispose(),f}if(!ql(a.dtype,b))return q4.makeTensorFromDataId(a.dataId,a.shape,b);if("complex64"===a.dtype){var g=c.real(a);return f=g.cast(b),g.dispose(),f}if("int32"===b)return c.int(a);if("bool"===b){var h=sl(0,a.dtype);return f=c.notEqual(a,h),h.dispose(),f}throw Error("Error in Cast: failed to cast "+a.dtype+" to "+b)}function tQ(a,b){return q4.makeTensorFromDataId(a.dataId,b,a.dtype)}function tR(a,b,c){var d=(b-a)/(c-1),e=qz(c,"float32");e[0]=a;for(var f=1;f<e.length;f++)e[f]=e[f-1]+d;return sm(e,"float32")}function tS(a,b){if(a.length!==b.length)throw Error("Cannot merge real and imag arrays of different lengths. real:"+a.length+", imag: "+b.length+".");for(var c=new Float32Array(2*a.length),d=0;d<c.length;d+=2)c[d]=a[d/2],c[d+1]=b[d/2];return c}function tT(a,b){return{real:a[2*b],imag:a[2*b+1]}}function tU(a,b){return a>b?1:a<b?-1:0}function tV(a,b,c,d,e){return tX(a,b,c,d,e,0).selectedIndices}function tW(a,b,c,d,e,f){var g=tX(a,b,c,d,e,f,!0);return g.numValidOutputs.dispose(),{selectedIndices:g.selectedIndices,selectedScores:g.selectedScores}}function tX(a,b,c,d,e,f,g,h){void 0===g&&(g=!1),void 0===h&&(h=!1);for(var i=Array.from(b).map(function(a,b){return{score:a,boxIndex:b,suppressBeginIndex:0}}).filter(function(a){return a.score>e}).sort(tY),j=f>0?-.5/f:0,k=[],l=[];k.length<c&&i.length>0;){var m=i.pop(),n=m.score,o=m.boxIndex,p=m.suppressBeginIndex;if(n<e)break;for(var q=!1,r=k.length-1;r>=p;--r){var s=function(a,b,c){var d=a.subarray(4*b,4*b+4),e=a.subarray(4*c,4*c+4),f=Math.min(d[0],d[2]),g=Math.min(d[1],d[3]),h=Math.max(d[0],d[2]),i=Math.max(d[1],d[3]),j=Math.min(e[0],e[2]),k=Math.min(e[1],e[3]),l=Math.max(e[0],e[2]),m=Math.max(e[1],e[3]),n=(h-f)*(i-g),o=(l-j)*(m-k);if(n<=0||o<=0)return 0;var p=Math.max(Math.min(h,l)-Math.max(f,j),0)*Math.max(Math.min(i,m)-Math.max(g,k),0);return p/(n+o-p)}(a,o,k[r]);if(s>=d){q=!0;break}if(m.score=m.score*function(a,b,c){var d=Math.exp(b*c*c);return c<=a?d:0}(d,j,s),m.score<=e)break}m.suppressBeginIndex=k.length,q||(m.score===n?(k.push(o),l.push(m.score)):m.score>e&&function(a,b,c){var d=function(a,b,c){for(var d=0,e=a.length,f=0,g=!1;d<e;){var h=c(b,a[f=d+(e-d>>>1)]);h>0?d=f+1:(e=f,g=!h)}return g?d:-d-1}(a,b,c||tU);a.splice(d<0?-(d+1):d,0,b)}(i,m,tY))}var t=k.length;return h&&(k.fill(0,t),l.fill(0,t)),{selectedIndices:sm(k,"int32"),selectedScores:sm(l,"float32"),numValidOutputs:sl(t,"int32")}}function tY(a,b){return a.score-b.score||a.score===b.score&&b.boxIndex-a.boxIndex}function tZ(a,b,c){var d=Array(a.rank).fill(0),e=a.shape.slice();return b.map(function(b){e[c]=b;var f=a.slice(d,e);return d[c]+=b,f})}function t$(a,b){for(var c=Array(a.rank),d=0;d<c.length;d++)c[d]=a.shape[d]*b[d];var e=sO(c,a.dtype);for(d=0;d<e.values.length;++d){for(var f=e.indexToLoc(d),g=Array(a.rank),h=0;h<g.length;h++)g[h]=f[h]%a.shape[h];var i=a.locToIndex(g);e.values[d]=a.values[i]}return e.toTensor()}function t_(a,b,c,d,e){for(var f=b[b.length-1],g=[a.length/f,f],h=g[0],i=g[1],j=qh(c,h*d),k=qh("int32",h*d),l=0;l<h;l++){for(var m=l*i,n=a.subarray(m,m+i),o=[],p=0;p<n.length;p++)o.push({value:n[p],index:p});o.sort(function(a,b){return b.value-a.value});var q=l*d,r=j.subarray(q,q+d),s=k.subarray(q,q+d);for(p=0;p<d;p++)r[p]=o[p].value,s[p]=o[p].index}var t=b.slice();return t[t.length-1]=d,[sj(j,t,c),sj(k,t,"int32")]}function t0(a,b){for(var c=[],d=0;d<b.length;d++)b[d]&&c.push(d);var e=sO(a,"int32"),f=sO([c.length,a.length],"int32");for(d=0;d<c.length;d++){var g=e.indexToLoc(c[d]),h=d*a.length;f.values.set(g,h)}return f.toTensor()}Object.freeze({castTensor:tP,reshapeTensor:tQ,linspaceImpl:tR,upcastType:qY,axesAreInnerMostDims:r5,combineLocations:r6,computeOutAndReduceShapes:r7,expandShapeToKeepDim:r8,assertAxesAreInnerMostDims:r9,getAxesPermutation:sa,getUndoAxesPermutation:sb,getInnerMostAxes:sc,getBroadcastDims:tA,getReductionAxes:tB,assertAndGetBroadcastShape:tC,assertParamsConsistent:sd,computeOutShape:se,computePool2DInfo:tD,computePool3DInfo:tE,computeConv2DInfo:tF,computeConv3DInfo:tG,computeDefaultPad:tH,tupleValuesAreOne:tM,eitherStridesOrDilationsAreOne:tN,convertConv2DDataFormat:tO,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:tj});var t1=function(a,b){this.outputShape=[],this.outputShape=a,this.variableNames=b.map(function(a,b){return"T"+b});var c=[];this.variableNames.forEach(function(a){c.push("float v"+a+" = get"+a+"AtOutCoords();")});var d=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode="\n      void main() {\n        "+c.join("\n        ")+"\n\n        float result = "+d+";\n        setOutput(result);\n      }\n    "},t2=function(a,b){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a,this.variableNames=b.map(function(a,b){return"T"+b});var c=[];this.variableNames.forEach(function(a){c.push("vec4 v"+a+" = get"+a+"AtOutCoords();")});var d=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode="\n      void main() {\n        "+c.join("\n        ")+"\n\n        vec4 result = "+d+";\n        setOutput(result);\n      }\n    "},t3=function(a,b,c){this.variableNames=["A"];var d=a.windowSize,e=a.batchSize,f=Math.ceil(a.inSize/d);c||this.variableNames.push("bestIndicesA"),this.outputShape=[e,f],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+d+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+d+"; i++) {\n          int inIdx = "+(c?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===b?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function t4(a,b){return["x","y","z","w","u","v"].slice(0,b).map(function(b){return a+"."+b})}function t5(a,b){return 1===b?[a]:t4(a,b)}function t6(){var a,b,c,d,e,f,g,h,i,j;return 2===pV.getNumber("WEBGL_VERSION")?(a="#version 300 es",b="in",c="out",d="in",e="texture",f="outputColor",g="out vec4 outputColor;",h="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",i="",j="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(a="",b="attribute",c="varying",d="varying",e="texture2D",f="gl_FragColor",g="",h="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",i="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",j="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:a,attribute:b,varyingVs:c,varyingFs:d,texture2D:e,output:f,defineOutput:g,defineSpecialNaN:h,defineSpecialInf:i,defineRound:j}}function t7(a,b,c){void 0===c&&(c="index");var d=qv(b);return d.map(function(b,e){return"int "+a[e]+" = "+c+" / "+b+"; "+(e===d.length-1?"int "+a[e+1]+" = "+c+" - "+a[e]+" * "+b:"index -= "+a[e]+" * "+b)+";"}).join("")}function t8(a){var b=qv(a).map(function(a){return a.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+b[0]+" + coords.y * "+b[1]+" + coords.z;\n  }\n"}var t9="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function ua(a){return"offset"+a}function ub(a){var b=a.name,c=p7(a.shapeInfo.logicalShape);return c<2?"return "+b+";":"\n    for (int i = 0; i < "+c+"; i++) {\n      if (i == index) {\n        return "+b+"[i];\n      }\n    }\n  "}function uc(a){if(a<=1)return"int";if(2===a)return"ivec2";if(3===a)return"ivec3";if(4===a)return"ivec4";if(5===a)return"ivec5";if(6===a)return"ivec6";throw Error("GPU for rank "+a+" is not yet supported")}function ud(a,b){var c=JSON.parse(JSON.stringify(a));return c.shapeInfo.logicalShape=b,c}function ue(a,b){return b.map(function(b){return a[b]}).join(", ")}var uf=function(a,b,c,d){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,p3(a.length>2,function(){return"Packed arg"+(c.charAt(0).toUpperCase()+c.slice(1))+" supports only inputs with rank above 2."});var e=Math.ceil(a[a.length-1]/b);this.outputShape=a.slice(0,-1),e>1&&this.outputShape.push(e),d||this.variableNames.push("bestIndicesA");var f,g,h=this.outputShape,i=h.length,j=uc(i),k=t5("coords",i);if(1===e){var l=uc(g=i+1);f="\n        "+l+" sourceLocR = "+l+"("+k.join()+", 0);\n        ++"+k[i-1]+";\n        "+l+" sourceLocG = "+l+"("+k.join()+", 0);\n        ++"+k[i-2]+";\n        "+l+" sourceLocA = "+l+"("+k.join()+", 0);\n        --"+k[i-1]+";\n        "+l+" sourceLocB = "+l+"("+k.join()+", 0);\n        --"+k[i-2]+";"}else g=i,f="\n        "+j+" sourceLocR = coords;\n        ++"+k[i-1]+";\n        "+j+" sourceLocG = coords;\n        ++"+k[i-2]+";\n        "+j+" sourceLocA = coords;\n        --"+k[i-1]+";\n        "+j+" sourceLocB = coords;\n        --"+k[i-2]+";";var m=["x","y","z","w","u","v"].slice(0,g),n="."+m[g-1],o=m.map(function(a){return"int "+a}),p=t5("sourceLocR",g-1).concat("inIdx.r"),q=t5("sourceLocG",g-1).concat("inIdx.g"),r=t5("sourceLocB",g-1).concat("inIdx.b"),s=t5("sourceLocA",g-1).concat("inIdx.a"),t="max"===c?"greaterThan":"lessThan",u=d?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+p.join()+"),\n                             getBestIndicesAChannel("+q.join()+"),\n                             getBestIndicesAChannel("+r.join()+"),\n                             getBestIndicesAChannel("+s.join()+")));",v="vec4(\n            getAChannel("+p.join()+"),\n            hasNextCol ? getAChannel("+q.join()+") : 0.,\n            hasNextRow ? getAChannel("+r.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+s.join()+") : 0.)",w=d?"":"\n      float getBestIndicesAChannel("+o.join()+") {\n        return getChannel(getBestIndicesA("+m.join()+"),\n                                          vec2("+m.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+o.join()+") {\n        return getChannel(getA("+m.join()+"),\n                               vec2("+m.slice(-2).join()+"));\n      }\n      "+w+"\n      void main() {\n        "+j+" coords = getOutputCoords();\n        bool hasNextCol = "+k[i-1]+" < "+(h[i-1]-1)+";\n        bool hasNextRow = "+k[i-2]+" < "+(h[i-2]-1)+";\n        "+f+"\n        ivec4 srcIdx = ivec4(sourceLocR"+n+", sourceLocG"+n+",\n          sourceLocB"+n+", sourceLocA"+n+") * "+b+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+v+";\n\n        for (int i = 0; i < "+b+"; i++) {\n          inIdx = srcIdx;\n          "+u+"\n          vec4 candidate = "+v+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+t+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},ug=function(a){this.variableNames=["dy"],this.outputShape=a.inShape;var b=a.filterHeight,c=a.filterWidth,d=a.strideHeight,e=a.strideWidth,f=a.dilationHeight,g=a.dilationWidth,h=a.effectiveFilterHeight,i=a.effectiveFilterWidth,j=h-1-a.padInfo.top,k=i-1-a.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+j+", "+k+");\n      const float avgMultiplier = float("+1/(b*c)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+h+";\n            wR += "+f+") {\n          float dyR = float(dyRCorner + wR) / "+d+".0;\n\n          if (dyR < 0.0 || dyR >= "+a.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+";\n            wC+= "+g+") {\n            float dyC = float(dyCCorner + wC) / "+e+".0;\n\n            if (dyC < 0.0 || dyC >= "+a.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uh=function(a){this.variableNames=["dy"],this.outputShape=a.inShape;var b=a.filterDepth,c=a.filterHeight,d=a.filterWidth,e=a.strideDepth,f=a.strideHeight,g=a.strideWidth,h=a.dilationDepth,i=a.dilationHeight,j=a.dilationWidth,k=a.effectiveFilterDepth,l=a.effectiveFilterHeight,m=a.effectiveFilterWidth,n=k-1-a.padInfo.front,o=l-1-a.padInfo.top,p=m-1-a.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+n+", "+o+", "+p+");\n      const float avgMultiplier = float("+1/(b*c*d)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+k+";\n            wD += "+h+") {\n          float dyD = float(dyDCorner + wD) / "+e+".0;\n\n          if (dyD < 0.0 || dyD >= "+a.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+l+";\n              wR += "+i+") {\n            float dyR = float(dyRCorner + wR) / "+f+".0;\n\n            if (dyR < 0.0 || dyR >= "+a.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+m+";\n                wC += "+j+") {\n              float dyC = float(dyCCorner + wC) / "+g+".0;\n\n              if (dyC < 0.0 || dyC >= "+a.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ui=function(a,b,c,d,e,f){this.outputShape=[],this.variableNames=["x","mean","variance"],tC(a,b),tC(a,c);var g="0.0";null!=d&&(tC(a,d),this.variableNames.push("offset"),g="getOffsetAtOutCoords()");var h="1.0";null!=e&&(tC(a,e),this.variableNames.push("scale"),h="getScaleAtOutCoords()"),this.outputShape=a,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+g+";\n        float scale = "+h+";\n        float inv = scale * inversesqrt(variance + float("+f+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},uj=function(a,b,c,d,e,f){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],tC(a,b),tC(a,c);var g="vec4(0.0)";null!=d&&(tC(a,d),this.variableNames.push("offset"),g="getOffsetAtOutCoords()");var h="vec4(1.0)";null!=e&&(tC(a,e),this.variableNames.push("scale"),h="getScaleAtOutCoords()"),this.outputShape=a,this.userCode="\n      void main() {\n        vec4 offset = "+g+";\n        vec4 scale = "+h+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+f+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},uk=function(a,b,c){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=tC(b,c),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+a+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},ul="return a + b;",um="return a - b;",un="return a * b;",uo="return (a < 0.) ? b * a : a;",up=function(a,b,c){this.variableNames=["A","B"],this.outputShape=tC(b,c),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+a+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},uq="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",ur=function(a,b,c,d){void 0===d&&(d=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=tC(b,c);var e=this.outputShape.length,f="";if(d)if(0===e||1===p7(this.outputShape))f="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(f="\n          "+uc(e)+" coords = getOutputCoords();\n        ",1===e)f+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var g=t5("coords",e);f+="\n            bool nextRowOutOfBounds =\n              ("+g[e-2]+" + 1) >= "+this.outputShape[e-2]+";\n            bool nextColOutOfBounds =\n              ("+g[e-1]+" + 1) >= "+this.outputShape[e-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+a+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+f+"\n\n        setOutput(result);\n      }\n    "},us=function(){function a(a){this.variableNames=["A"],this.outputShape=a,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return a.prototype.getCustomSetupFunc=function(a,b){var c=this;return function(d,e){null==c.minLoc&&(c.minLoc=d.getUniformLocationNoThrow(e,"minVal"),c.maxLoc=d.getUniformLocationNoThrow(e,"maxVal")),d.gl.uniform1f(c.minLoc,a),d.gl.uniform1f(c.maxLoc,b)}},a}(),ut=function(){function a(a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return a.prototype.getCustomSetupFunc=function(a,b){var c=this;return function(d,e){null==c.minLoc&&(c.minLoc=d.getUniformLocationNoThrow(e,"minVal"),c.maxLoc=d.getUniformLocationNoThrow(e,"maxVal")),d.gl.uniform1f(c.minLoc,a),d.gl.uniform1f(c.maxLoc,b)}},a}(),uu=function(a){this.variableNames=["real","imag"],this.outputShape=a,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},uv=function(a){this.outputShape=[],this.outputShape=se(a,1),this.variableNames=a.map(function(a,b){return"T"+b});var b=Array(a.length-1);b[0]=a[0][1];for(var c=1;c<b.length;c++)b[c]=b[c-1]+a[c][1];var d=["if (yC < "+b[0]+") setOutput(getT0(yR, yC));"];for(c=1;c<b.length;c++){var e=b[c-1];d.push("else if (yC < "+b[c]+") setOutput(getT"+c+"(yR, yC-"+e+"));")}var f=b.length,g=b[b.length-1];d.push("else setOutput(getT"+f+"(yR, yC-"+g+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+d.join("\n        ")+"\n      }\n    "},uw=function(a,b){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=se(a,b);var c=this.outputShape,d=c.length,e=uc(d),f=t5("coords",d),g=["x","y","z","w","u","v"].slice(0,d);this.variableNames=a.map(function(a,b){return"T"+b});var h=Array(a.length-1);h[0]=a[0][b];for(var i=1;i<h.length;i++)h[i]=h[i-1]+a[i][b];var j=g[b],k=g.slice(-2),l=g.join(),m="if ("+j+" < "+h[0]+") {\n        return getChannel(\n            getT0("+l+"), vec2("+k.join()+"));\n        }";for(i=1;i<h.length;i++){var n=h[i-1];m+="\n        if ("+j+" < "+h[i]+"  && "+j+" >= "+h[i-1]+") {\n          return getChannel(\n            getT"+i+"("+ux(g,j,n)+"),\n            vec2("+ux(k,j,n)+"));\n        }"}var o=h.length,p=h[h.length-1];m+="\n        return getChannel(\n          getT"+o+"("+ux(g,j,p)+"),\n          vec2("+ux(k,j,p)+"));",this.userCode="\n      float getValue("+g.map(function(a){return"int "+a})+") {\n        "+m+"\n      }\n\n      void main() {\n        "+e+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+f+"), 0., 0., 0.);\n\n        "+f[d-1]+" = "+f[d-1]+" + 1;\n        if ("+f[d-1]+" < "+c[d-1]+") {\n          result.g = getValue("+f+");\n        }\n\n        "+f[d-2]+" = "+f[d-2]+" + 1;\n        if ("+f[d-2]+" < "+c[d-2]+") {\n          result.a = getValue("+f+");\n        }\n\n        "+f[d-1]+" = "+f[d-1]+" - 1;\n        if ("+f[d-2]+" < "+c[d-2]+" &&\n            "+f[d-1]+" < "+c[d-1]+") {\n          result.b = getValue("+f+");\n        }\n        setOutput(result);\n      }\n    "};function ux(a,b,c){var d=a.indexOf(b);return a.map(function(a,b){return b===d?a+" - "+c:a}).join()}var uy=function(a){this.variableNames=["x","dy"],this.outputShape=a.filterShape;var b=a.strideHeight,c=a.strideWidth,d=a.padInfo.top,e=a.padInfo.left,f="channelsLast"===a.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+a.batchSize+"; b++) {\n          for (int yR = 0; yR < "+a.outHeight+"; yR++) {\n            int xR = wR + yR * "+b+" - "+d+";\n\n            if (xR < 0 || xR >= "+a.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+a.outWidth+"; yC++) {\n              int xC = wC + yC * "+c+" - "+e+";\n\n              if (xC < 0 || xC >= "+a.inWidth+") {\n                continue;\n              }\n\n              if ("+f+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uz=function(a){this.variableNames=["dy","W"],this.outputShape=a.inShape;var b=a.filterHeight,c=a.filterWidth,d=a.strideHeight,e=a.strideWidth,f="channelsLast"===a.dataFormat,g=b-1-a.padInfo.top,h=c-1-a.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+g+", "+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(f?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(f?1:2)+"], coords["+(f?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+b+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+d+".0;\n\n          if (dyR < 0.0 || dyR >= "+a.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+b+" - 1 - wR;\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e+".0;\n\n            if (dyC < 0.0 || dyC >= "+a.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+c+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+a.outChannels+"; d2++) {\n\n              if ("+f+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uA=function(a){this.variableNames=["x","dy"],this.outputShape=a.filterShape;var b=a.strideDepth,c=a.strideHeight,d=a.strideWidth,e=a.padInfo.front,f=a.padInfo.top,g=a.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+a.batchSize+"; b++) {\n          for (int yF = 0; yF < "+a.outDepth+"; yF++) {\n            int xF = wF + yF * "+b+" - "+e+";\n\n            if (xF < 0 || xF >= "+a.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+a.outHeight+"; yR++) {\n              int xR = wR + yR * "+c+" - "+f+";\n\n              if (xR < 0 || xR >= "+a.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+a.outWidth+"; yC++) {\n                int xC = wC + yC * "+d+" - "+g+";\n\n                if (xC < 0 || xC >= "+a.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uB=function(a){this.variableNames=["dy","W"],this.outputShape=a.inShape;var b=a.filterDepth,c=a.filterHeight,d=a.filterWidth,e=a.strideDepth,f=a.strideHeight,g=a.strideWidth,h=b-1-a.padInfo.front,i=c-1-a.padInfo.top,j=d-1-a.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+h+", "+i+", "+j+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+b+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+e+".0;\n\n          if (dyF < 0.0 || dyF >= "+a.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+b+" - 1 - wF;\n\n          for (int wR = 0; wR < "+c+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+f+".0;\n\n            if (dyR < 0.0 || dyR >= "+a.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+c+" - 1 - wR;\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+g+".0;\n\n              if (dyC < 0.0 || dyC >= "+a.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+d+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+a.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uC=function(a){this.variableNames=["x","dy"],this.outputShape=a.filterShape;var b=a.strideHeight,c=a.strideWidth,d=a.padInfo.top,e=a.padInfo.left,f=a.outChannels/a.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+f+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+a.batchSize+"; b++) {\n          for (int yR = 0; yR < "+a.outHeight+"; yR++) {\n            int xR = wR + yR * "+b+" - "+d+";\n\n            if (xR < 0 || xR >= "+a.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+a.outWidth+"; yC++) {\n              int xC = wC + yC * "+c+" - "+e+";\n\n              if (xC < 0 || xC >= "+a.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uD=function(a){this.variableNames=["dy","W"],this.outputShape=a.inShape;var b=a.filterHeight,c=a.filterWidth,d=a.strideHeight,e=a.strideWidth,f=b-1-a.padInfo.top,g=c-1-a.padInfo.left,h=a.outChannels/a.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+f+", "+g+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+b+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+d+".0;\n\n          if (dyR < 0.0 || dyR >= "+a.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+b+" - 1 - wR;\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e+".0;\n\n            if (dyC < 0.0 || dyC >= "+a.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+c+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+h+"; dm++) {\n              int d2 = d1 * "+h+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uE=function(a,b,c,d){void 0===b&&(b=!1),void 0===c&&(c=null),void 0===d&&(d=!1),this.variableNames=["x","W"],this.outputShape=a.outShape;var e=a.padInfo.top,f=a.padInfo.left,g=a.strideHeight,h=a.strideWidth,i=a.dilationHeight,j=a.dilationWidth,k=a.filterHeight,l=a.filterWidth,m=4*Math.floor(a.inChannels/4),n=a.inChannels%4,o="channelsLast"===a.dataFormat,p="",q="";c&&(p=d?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+c+"\n        }":"\n          float activation(float x) {\n            "+c+"\n          }\n        ",q="result = activation(result);");var r=b?"result += getBiasAtOutCoords();":"";b&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const ivec2 strides = ivec2("+g+", "+h+");\n      const ivec2 pads = ivec2("+e+", "+f+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+(o?3:1)+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+(o?1:2)+"], coords["+(o?2:3)+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+k+"; wR++) {\n          int xR = xRCorner + wR * "+i+";\n\n          if (xR < 0 || xR >= "+a.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+l+"; wC++) {\n            int xC = xCCorner + wC * "+j+";\n\n            if (xC < 0 || xC >= "+a.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+m+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+o+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===n)+") {\n\n              if ("+o+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+m+") *\n                    getW(wR, wC, "+m+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+m+", xR, xC) *\n                    getW(wR, wC, "+m+", d2);\n              }\n\n            } else if ("+(2===n)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+m+", d2),\n                getW(wR, wC, "+m+" + 1, d2)\n              );\n\n              if ("+o+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+m+"),\n                  getX(batch, xR, xC, "+m+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+m+", xR, xC),\n                  getX(batch, "+m+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===n)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+m+", d2),\n                getW(wR, wC, "+m+" + 1, d2),\n                getW(wR, wC, "+m+" + 2, d2)\n              );\n\n              if ("+o+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+m+"),\n                  getX(batch, xR, xC, "+m+" + 1),\n                  getX(batch, xR, xC, "+m+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+m+", xR, xC),\n                  getX(batch, "+m+" + 1, xR, xC),\n                  getX(batch, "+m+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+r+"\n        "+q+"\n        setOutput(result);\n      }\n    "},uF=function(a){this.variableNames=["x","W"],this.outputShape=a.outShape;var b=a.padInfo.front,c=a.padInfo.top,d=a.padInfo.left,e=a.strideDepth,f=a.strideHeight,g=a.strideWidth,h=a.dilationDepth,i=a.dilationHeight,j=a.dilationWidth,k=a.filterDepth,l=a.filterHeight,m=a.filterWidth,n=4*Math.floor(a.inChannels/4),o=a.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+e+", "+f+", "+g+");\n      const ivec3 pads = ivec3("+b+", "+c+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+k+"; wF++) {\n          int xF = xFCorner + wF * "+h+";\n\n          if (xF < 0 || xF >= "+a.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+l+"; wR++) {\n            int xR = xRCorner + wR * "+i+";\n\n            if (xR < 0 || xR >= "+a.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+m+"; wC++) {\n              int xC = xCCorner + wC * "+j+";\n\n              if (xC < 0 || xC >= "+a.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+n+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===o)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+n+") *\n                  getW(wF, wR, wC, "+n+", d2);\n              } else if ("+(2===o)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+n+"),\n                  getX(batch, xF, xR, xC, "+n+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+n+", d2),\n                  getW(wF, wR, wC, "+n+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===o)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+n+"),\n                  getX(batch, xF, xR, xC, "+n+" + 1),\n                  getX(batch, xF, xR, xC, "+n+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+n+", d2),\n                  getW(wF, wR, wC, "+n+" + 1, d2),\n                  getW(wF, wR, wC, "+n+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},uG=function(a,b,c,d){void 0===b&&(b=!1),void 0===c&&(c=null),void 0===d&&(d=!1),this.variableNames=["x","W"],this.outputShape=a.outShape;var e=a.inHeight,f=a.inWidth,g=a.padInfo.top,h=a.padInfo.left,i=a.strideHeight,j=a.strideWidth,k=a.dilationHeight,l=a.dilationWidth,m=a.filterHeight,n=a.filterWidth,o=a.outChannels/a.inChannels,p="",q="";c&&(p=d?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+c+"\n        }":"\n          float activation(float x) {\n            "+c+"\n          }\n        ",q="result = activation(result);");var r=b?"result += getBiasAtOutCoords();":"";b&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const ivec2 strides = ivec2("+i+", "+j+");\n      const ivec2 pads = ivec2("+g+", "+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+o+";\n        int q = d2 - d1 * "+o+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+m+"; wR++) {\n          int xR = xRCorner + wR * "+k+";\n\n          if (xR < 0 || xR >= "+e+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+f+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+r+"\n        "+q+"\n        setOutput(result);\n      }\n    "},uH=function(a,b,c,d){void 0===b&&(b=!1),void 0===c&&(c=null),void 0===d&&(d=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a.outShape;for(var e=a.inHeight,f=a.inWidth,g=a.padInfo.top,h=a.padInfo.left,i=a.strideHeight,j=a.strideWidth,k=a.dilationHeight,l=a.dilationWidth,m=a.filterHeight,n=a.filterWidth,o="int xR; int xC; int xCOffset;",p=0;p<m;p++)for(var q=0;q<n;q++)o+="\n          vec4 xTexelR"+p+"C"+2*q+" = vec4(0.);\n          vec4 wR"+p+"C"+q+" = vec4(0.);\n          vec4 xR"+p+"C"+q+" = vec4(0.);";for(p=0;p<m;p++)for(var r=0;r<n;r++){if(o+="\n          xR = xRCorner + "+p*k+";\n          xC = xCCorner + "+(q=2*r)*l+";\n        ",1===j){if(q<n&&(o+=h%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+f+") {\n                  xTexelR"+p+"C"+q+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+f+") {\n                    xTexelR"+p+"C"+q+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+p+"C"+q+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+f+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+f+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+p+"C"+q+" = vec4(previous.zw, xTexelR"+p+"C"+q+".xy);\n                } else {\n                  xR"+p+"C"+q+" = vec4(0, 0, xTexelR"+p+"C"+q+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+e+" && xC >= 0 && xC < "+f+") {\n                  xTexelR"+p+"C"+q+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+p+"C"+q+" = vec4(0.);\n                }\n\n                xR"+p+"C"+q+" = xTexelR"+p+"C"+q+";\n              ",q+1<n)){var s=h%2==0?p1(l):l;l%2==0&&h%2==1||l%2!=0&&h%2!=1?(o+="\n                  xCOffset = xC + "+h%2+" + "+s+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+f+") {\n                    xTexelR"+p+"C"+(q+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",l>1&&(o+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+e+" &&\n                      xCOffset >= 0 && xCOffset < "+f+") {\n                      xTexelR"+p+"C"+q+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+p+"C"+q+" = vec4(0.);\n                    }\n                  "),o+="\n                  xR"+p+"C"+(q+1)+" = vec4(\n                    xTexelR"+p+"C"+q+".zw, xTexelR"+p+"C"+(q+2)+".xy);\n                "):o+="\n                  xCOffset = xC + "+s+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+f+") {\n                    xTexelR"+p+"C"+(q+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+p+"C"+(q+1)+" = xTexelR"+p+"C"+(q+2)+";\n                "}}else q<n&&(o+="\n              if(xR >= 0 && xR < "+e+") {\n            ",h%2==1?(o+="\n                xCOffset = xC + 1 - "+j+";\n                if(xCOffset >= 0 && xCOffset < "+f+") {\n                  xTexelR"+p+"C"+q+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+p+"C"+q+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+f+") {\n                  xTexelR"+p+"C"+(q+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+p+"C"+(q+2)+" = vec4(0.);\n                }\n\n                xR"+p+"C"+q+" = vec4(\n                  xTexelR"+p+"C"+q+".zw, xTexelR"+p+"C"+(q+2)+".zw);\n              ",q+1<n&&(o+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+j+";\n                  if(xCOffset >= 0 && xCOffset < "+f+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+p+"C"+(q+1)+" = vec4(xTexelR"+p+"C"+(q+2)+".xy, final.xy);\n                ")):(o+="\n                if(xC >= 0 && xC < "+f+") {\n                  xTexelR"+p+"C"+q+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+p+"C"+q+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+j+";\n                if(xCOffset >= 0 && xCOffset < "+f+") {\n                  xTexelR"+p+"C"+(q+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+p+"C"+(q+2)+" = vec4(0.);\n                }\n\n                xR"+p+"C"+q+" = vec4(\n                  xTexelR"+p+"C"+q+".xy, xTexelR"+p+"C"+(q+2)+".xy);\n              ",q+1<n&&(o+="\n                  xR"+p+"C"+(q+1)+" = vec4(\n                    xTexelR"+p+"C"+q+".zw, xTexelR"+p+"C"+(q+2)+".zw);\n                ")),o+="}");q<n&&(o+="\n            vec4 wTexelR"+p+"C"+q+" = getW("+p+", "+q+", d1, q);\n            wR"+p+"C"+q+" = vec4(wTexelR"+p+"C"+q+".xz, wTexelR"+p+"C"+q+".xz);\n          ",q+1<n&&(o+="\n              vec4 wTexelR"+p+"C"+(q+1)+" = getW("+p+", "+(q+1)+", d1, q);\n              wR"+p+"C"+(q+1)+" =\n                vec4(wTexelR"+p+"C"+(q+1)+".xz, wTexelR"+p+"C"+(q+1)+".xz);"))}for(p=0;p<m;p++)for(q=0;q<n;q++)o+="dotProd += xR"+p+"C"+q+" * wR"+p+"C"+q+";";var t="",u="";c&&(t=d?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+c+"\n        }":"vec4 activation(vec4 x) {\n          "+c+"\n        }",u="result = activation(result);");var v=b?"result += getBiasAtOutCoords();":"";b&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+t+"\n\n      const ivec2 strides = ivec2("+i+", "+j+");\n      const ivec2 pads = ivec2("+g+", "+h+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+o+"\n\n        vec4 result = dotProd;\n        "+v+"\n        "+u+"\n        setOutput(result);\n      }\n    "},uI=function(a,b,c,d,e){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var f=a[0],g=a[1],h=a[2],i=a[3],j=b[0],k=c[0],l=c[1];this.outputShape=[j,k,l,i];var m=[g-1+".0",h-1+".0"],n=m[0],o=m[1],p=k>1?[""+(g-1)/(k-1),"(y2-y1) * height_ratio","y1*"+n+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+n],q=p[0],r=p[1],s=p[2],t=l>1?[""+(h-1)/(l-1),"(x2-x1) * width_ratio","x1*"+o+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+o],u=t[0],v=t[1],w=t[2];this.userCode="\n      const float height_ratio = float("+q+");\n      const float width_ratio = float("+u+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+f+") {\n          return;\n        }\n\n        float height_scale = "+r+";\n        float width_scale = "+v+";\n\n        float in_y = "+s+";\n        if( in_y < 0.0 || in_y > "+n+" ) {\n          setOutput(float("+e+"));\n          return;\n        }\n        float in_x = "+w+";\n        if( in_x < 0.0 || in_x > "+o+" ) {\n          setOutput(float("+e+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+ +("bilinear"===d)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},uJ=function(a,b,c){this.variableNames=["x"],this.outputShape=a;var d=a.length,e=a[a.length-1];this.userCode="\n      int getIndex(int i) {\n        "+(c?"return "+e+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+uc(d)+" coords = getOutputCoords();\n        int end = "+uK(d,"coords")+";\n        float val = 0.0;\n        for (int i = "+e+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+(c?"<":">")+" end) {\n            continue;\n          }\n          if (idx == end && "+b+") {\n            continue;\n          }\n          "+uK(d,"coords")+" = idx;\n          val += getX("+function(a,b){if(1===a)return""+b;if(2===a)return b+".x, "+b+".y";if(3===a)return b+".x, "+b+".y, "+b+".z";if(4===a)return b+".x, "+b+".y, "+b+".z, "+b+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(d,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function uK(a,b){if(1===a)return""+b;if(2===a)return b+".y";if(3===a)return b+".z";if(4===a)return b+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}var uL=function(a){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=q7.DENSE;var b=re(a),c=t6();this.outputShape=a,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+t7(["r","c","d"],a)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+b[0]+", "+b[1]+"));\n        int index = 4 * (resTexRC.x * "+b[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+c.output+" = result;\n      }\n    "},uM=function(a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=q7.DENSE;var b=re(a),c=t6();this.outputShape=a,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+t7(["r","c","d"],a)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+b[0]+", "+b[1]+"));\n        int index = 4 * (resTexRC.x * "+b[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+c.output+" = result;\n      }\n    "},uN=function(){function a(a,b,c){this.variableNames=["x"],this.outputShape=[],this.outputShape=a,this.blockSize=b,this.dataFormat=c,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+b+";\n      int offset_h = imod(h, "+b+");\n      int in_w = w / "+b+";\n      int offset_w = imod(w, "+b+");\n      int offset_d = (offset_h * "+b+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return a.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},a.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},a.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},a.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},a.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},a}(),uO=function(a){this.variableNames=["X"],this.outputShape=[a,a],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},uP=function(a){this.variableNames=["A"],this.outTexUsage=q8.DOWNLOAD;var b=t6();this.outputShape=a,this.userCode="\n      "+t9+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+b.output+" = encode_float(x);\n      }\n    "},uQ=function(a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=q8.DOWNLOAD;var b=t6();this.outputShape=a,this.userCode="\n      "+t9+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+b.output+" = encode_float(x);\n      }\n    "},uR=function(a,b,c){void 0===c&&(c=!1),this.variableNames=["A"];var d=t6(),e=b[0],f=b[1];this.outputShape=a;var g="result";c&&(g="floor(result * 255. + 0.5)"),this.userCode="\n      "+t8(a)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+f+";\n        int c = imod(flatIndex, "+f+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+f+".0, "+e+".0);\n        vec4 values = "+d.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+d.output+" = vec4("+g+", 0., 0., 0.);\n      }\n    "},uS=function(a,b,c){void 0===c&&(c=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var d=t6(),e=b[0],f=b[1];this.outputShape=a;var g="",h="result";c&&(h="floor(result * 255. + 0.5)");for(var i=0;i<=1;i++)for(var j=0;j<=1;j++){var k=2*i+j;g+="\n          localCoords = coords;\n          if(localCoords[2] + "+j+" < "+a[2]+") {\n            localCoords[2] += "+j+";\n            if(localCoords[1] + "+i+" < "+a[1]+") {\n              localCoords[1] += "+i+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+f+";\n              c = imod(flatIndex, "+f+");\n              uv = (vec2(c, r) + halfCR) / vec2("+f+".0, "+e+".0);\n              values = "+d.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+k+"] = values[0];\n              } else if(offset == 1) {\n                result["+k+"] = values[1];\n              } else if(offset == 2) {\n                result["+k+"] = values[2];\n              } else {\n                result["+k+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+t8(a)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+g+"\n\n        "+d.output+" = "+h+";\n      }\n    "},uT=function(a,b,c){this.variableNames=["real","imag"];var d=b[1];this.outputShape=b;var e=c?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+e+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+a+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+d+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+d+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(c?d+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},uU=function(){function a(a,b){this.outputShape=[],this.variableNames=["x"],this.outputShape=a,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return a.prototype.getCustomSetupFunc=function(a){var b=this;return function(c,d){null==b.valueLoc&&(b.valueLoc=c.getUniformLocationNoThrow(d,"value")),c.gl.uniform1f(b.valueLoc,a)}},a}(),uV=function(a,b,c){this.variableNames=["A","indices"];var d=a.slice();d[c]=b,this.outputShape=d,this.rank=d.length;var e=uc(this.rank),f=function(a,b){var c=a.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(1===c)return"int(getIndices(resRC))";for(var d=["resRC.x","resRC.y","resRC.z","resRC.w"],e=[],f=0;f<a.length;f++)f===b?e.push("int(getIndices("+d[f]+"))"):e.push(""+d[f]);return e.join()}(a,c);this.userCode="\n      void main() {\n        "+e+" resRC = getOutputCoords();\n        setOutput(getA("+f+"));\n      }\n    "},uW=function(a,b,c){this.sliceDim=a,this.strides=b,this.variableNames=["x","indices"],this.outputShape=c;var d=uc(b.length),e=uc(c.length),f=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+d+" strides = "+d+"("+this.strides+");\n         void main() {\n          "+e+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+f+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function uX(a,b){var c=t6();return rl(a,b,c.version+"\n    precision highp float;\n    "+c.attribute+" vec3 clipSpacePos;\n    "+c.attribute+" vec2 uv;\n    "+c.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function uY(a,b){return rt(a,b,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function uZ(a,b){return ru(a,b,new Uint16Array([0,1,2,2,1,3]))}function u$(a,b,c,d,e,f,g){rw(c,d);var h=rv(a,b),i=a.TEXTURE_2D;return rh(a,b,function(){return a.bindTexture(i,h)}),rh(a,b,function(){return a.texParameteri(i,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE)}),rh(a,b,function(){return a.texParameteri(i,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)}),rh(a,b,function(){return a.texParameteri(i,a.TEXTURE_MIN_FILTER,a.NEAREST)}),rh(a,b,function(){return a.texParameteri(i,a.TEXTURE_MAG_FILTER,a.NEAREST)}),rh(a,b,function(){return a.texImage2D(i,0,e,c,d,0,f,g,null)}),rh(a,b,function(){return a.bindTexture(a.TEXTURE_2D,null)}),h}function u_(a,b,c,d,e){var f=[d,c];return u$(a,b,f[0],f[1],e.internalFormatFloat,e.textureFormatFloat,a.FLOAT)}function u0(a,b,c,d,e){var f=[d,c];return u$(a,b,f[0],f[1],e.internalFormatHalfFloat,e.textureFormatFloat,e.textureTypeHalfFloat)}function u1(a,b,c,d,e){var f=[d,c];return u$(a,b,f[0],f[1],a.RGBA,a.RGBA,a.UNSIGNED_BYTE)}function u2(a,b,c,d,e){var f=rf(c,d);return u$(a,b,f[0],f[1],e.internalFormatPackedFloat,a.RGBA,a.FLOAT)}function u3(a,b,c,d,e){var f=rf(c,d);return u$(a,b,f[0],f[1],e.internalFormatPackedHalfFloat,a.RGBA,e.textureTypeHalfFloat)}function u4(a,b,c,d){return rh(a,b,function(){return a.bindBuffer(a.ARRAY_BUFFER,d)}),ry(a,b,c,"clipSpacePos",d,3,20,0)&&ry(a,b,c,"uv",d,2,20,12)}function u5(a,b,c,d,e,f,g){var h,i,j;rh(a,b,function(){return a.bindTexture(a.TEXTURE_2D,c)}),f instanceof Uint8Array?(h=new Uint8Array(d*e*4),i=a.UNSIGNED_BYTE,j=a.RGBA):(h=new Float32Array(d*e*4),i=a.FLOAT,j=g.internalFormatPackedFloat),h.set(f),rh(a,b,function(){return a.texImage2D(a.TEXTURE_2D,0,j,d,e,0,a.RGBA,i,h)}),rh(a,b,function(){return a.bindTexture(a.TEXTURE_2D,null)})}function u6(a,b,c,d){rh(a,b,function(){return a.bindTexture(a.TEXTURE_2D,c)}),d.data instanceof Uint8Array?rh(a,b,function(){return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,d.width,d.height,0,a.RGBA,a.UNSIGNED_BYTE,d.data)}):rh(a,b,function(){return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d)}),rh(a,b,function(){return a.bindTexture(a.TEXTURE_2D,null)})}function u7(a,b,c,d,e){var f=a.createBuffer();rh(a,b,function(){return a.bindBuffer(a.PIXEL_PACK_BUFFER,f)});var g=16*c*d;return rh(a,b,function(){return a.bufferData(a.PIXEL_PACK_BUFFER,g,a.STREAM_READ)}),rh(a,b,function(){return a.readPixels(0,0,d,c,a.RGBA,a.FLOAT,0)}),rh(a,b,function(){return a.bindBuffer(a.PIXEL_PACK_BUFFER,null)}),f}function u8(a,b,c){var d=new Float32Array(c);return a.bindBuffer(a.PIXEL_PACK_BUFFER,b),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,d),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),d}function u9(a,b,c,d,e){var f=[d,c],g=f[0],h=f[1],i=new Uint8Array(c*d*4);return rh(a,b,function(){return a.readPixels(0,0,g,h,e.downloadTextureFormat,a.UNSIGNED_BYTE,i)}),new Float32Array(i.buffer)}function va(a,b,c,d,e,f,g,h){var i,j=new Float32Array((i=rf(f,g))[0]*i[1]*4);return a.bindBuffer(a.PIXEL_PACK_BUFFER,b),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,j),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),j}function vb(a,b,c,d){var e=new Float32Array(c*d*4);return rh(a,b,function(){return a.readPixels(0,0,d,c,a.RGBA,a.FLOAT,e)}),e}var vc=Object.freeze({createVertexShader:uX,createVertexBuffer:uY,createIndexBuffer:uZ,createFloat32MatrixTexture:u_,createFloat16MatrixTexture:u0,createUnsignedBytesMatrixTexture:u1,createPackedMatrixTexture:u2,createFloat16PackedMatrixTexture:u3,bindVertexProgramAttributeStreams:u4,uploadDenseMatrixToTexture:u5,uploadPixelDataToTexture:u6,createBufferFromOutputTexture:u7,downloadFloat32MatrixFromBuffer:u8,downloadByteEncodedFloatMatrixFromOutputTexture:u9,downloadPackedMatrixFromBuffer:va,downloadMatrixFromPackedOutputTexture:vb}),vd=function(){function a(a){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var b=pV.getNumber("WEBGL_VERSION");null!=a?(this.gl=a,rc(b,a)):this.gl=rd(b);var c="WEBGL_color_buffer_float";if(1===pV.getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=rk(this.gl,this.debug,"OES_texture_float"),rR(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=rk(this.gl,this.debug,"OES_texture_half_float");else if(pV.get("WEBGL_FORCE_F16_TEXTURES"))throw Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(c),rR(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=rk(this.gl,this.debug,"EXT_color_buffer_half_float");else if(pV.get("WEBGL_FORCE_F16_TEXTURES"))throw Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(c="EXT_color_buffer_float",rR(this.gl,c))this.colorBufferFloatExtension=this.gl.getExtension(c);else{if(!rR(this.gl,"EXT_color_buffer_half_float"))throw Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=uY(this.gl,this.debug),this.indexBuffer=uZ(this.gl,this.debug),this.framebuffer=rx(this.gl,this.debug),this.textureConfig=rg(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(a.prototype,"debug",{get:function(){return pV.getBool("DEBUG")},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){var a=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var b=this.gl;rh(b,this.debug,function(){return b.finish()}),rh(b,this.debug,function(){return b.bindFramebuffer(b.FRAMEBUFFER,null)}),rh(b,this.debug,function(){return b.deleteFramebuffer(a.framebuffer)}),rh(b,this.debug,function(){return b.bindBuffer(b.ARRAY_BUFFER,null)}),rh(b,this.debug,function(){return b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}),rh(b,this.debug,function(){return b.deleteBuffer(a.indexBuffer)}),this.disposed=!0}},a.prototype.createFloat32MatrixTexture=function(a,b){return this.throwIfDisposed(),u_(this.gl,this.debug,a,b,this.textureConfig)},a.prototype.createFloat16MatrixTexture=function(a,b){return this.throwIfDisposed(),u0(this.gl,this.debug,a,b,this.textureConfig)},a.prototype.createUnsignedBytesMatrixTexture=function(a,b){return this.throwIfDisposed(),u1(this.gl,this.debug,a,b,this.textureConfig)},a.prototype.uploadPixelDataToTexture=function(a,b){this.throwIfDisposed(),u6(this.gl,this.debug,a,b)},a.prototype.uploadDenseMatrixToTexture=function(a,b,c,d){this.throwIfDisposed(),u5(this.gl,this.debug,a,b,c,d,this.textureConfig)},a.prototype.createFloat16PackedMatrixTexture=function(a,b){return this.throwIfDisposed(),u3(this.gl,this.debug,a,b,this.textureConfig)},a.prototype.createPackedMatrixTexture=function(a,b){return this.throwIfDisposed(),u2(this.gl,this.debug,a,b,this.textureConfig)},a.prototype.deleteMatrixTexture=function(a){var b=this;this.throwIfDisposed(),this.outputTexture===a&&(rE(this.gl,this.debug,this.framebuffer),this.outputTexture=null),rh(this.gl,this.debug,function(){return b.gl.deleteTexture(a)})},a.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(a,b,c){var d=this;return this.downloadMatrixDriver(a,function(){return u9(d.gl,d.debug,b,c,d.textureConfig)})},a.prototype.downloadPackedMatrixFromBuffer=function(a,b,c,d,e,f){return va(this.gl,a,0,0,0,e,f,this.textureConfig)},a.prototype.downloadFloat32MatrixFromBuffer=function(a,b){return u8(this.gl,a,b)},a.prototype.createBufferFromTexture=function(a,b,c){this.bindTextureToFrameBuffer(a);var d=u7(this.gl,this.debug,b,c,this.textureConfig);return this.unbindTextureToFrameBuffer(),d},a.prototype.createAndWaitForFence=function(){var a=this.createFence(this.gl);return this.pollFence(a)},a.prototype.createFence=function(a){var b,c,d=this;if(pV.getBool("WEBGL_FENCE_API_ENABLED")){var e=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);a.flush(),c=function(){var b=a.clientWaitSync(e,0,0);return b===a.ALREADY_SIGNALED||b===a.CONDITION_SATISFIED},b=e}else pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(b=this.beginQuery(),this.endQuery(),c=function(){return d.isQueryAvailable(b,pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):c=function(){return!0};return{query:b,isFencePassed:c}},a.prototype.downloadMatrixFromPackedTexture=function(a,b,c){var d=this;return this.downloadMatrixDriver(a,function(){return vb(d.gl,d.debug,b,c)})},a.prototype.createProgram=function(a){this.throwIfDisposed();var b=this.gl,c=rm(b,this.debug,a),d=uX(b,this.debug),e=rq(b,this.debug);return rh(b,this.debug,function(){return b.attachShader(e,d)}),rh(b,this.debug,function(){return b.attachShader(e,c)}),rr(b,this.debug,e),this.debug&&rs(b,this.debug,e),this.vertexAttrsAreBound||(this.setProgram(e),this.vertexAttrsAreBound=u4(b,this.debug,this.program,this.vertexBuffer)),e},a.prototype.deleteProgram=function(a){var b=this;this.throwIfDisposed(),a===this.program&&(this.program=null),null!=a&&rh(this.gl,this.debug,function(){return b.gl.deleteProgram(a)})},a.prototype.setProgram=function(a){var b=this;this.throwIfDisposed(),this.program=a,null!=this.program&&this.debug&&rs(this.gl,this.debug,this.program),rh(this.gl,this.debug,function(){return b.gl.useProgram(a)})},a.prototype.getUniformLocation=function(a,b,c){return void 0===c&&(c=!0),this.throwIfDisposed(),c?rA(this.gl,this.debug,a,b):rB(this.gl,a,b)},a.prototype.getAttributeLocation=function(a,b){var c=this;return this.throwIfDisposed(),rh(this.gl,this.debug,function(){return c.gl.getAttribLocation(a,b)})},a.prototype.getUniformLocationNoThrow=function(a,b){return this.throwIfDisposed(),this.gl.getUniformLocation(a,b)},a.prototype.setInputMatrixTexture=function(a,b,c){this.throwIfDisposed(),this.throwIfNoProgram(),rC(this.gl,this.debug,this.program,a,b,c)},a.prototype.setOutputMatrixTexture=function(a,b,c){this.setOutputMatrixTextureDriver(a,c,b)},a.prototype.setOutputPackedMatrixTexture=function(a,b,c){this.throwIfDisposed();var d=rf(b,c),e=d[0],f=d[1];this.setOutputMatrixTextureDriver(a,e,f)},a.prototype.setOutputMatrixWriteRegion=function(a,b,c,d){this.setOutputMatrixWriteRegionDriver(c,a,d,b)},a.prototype.setOutputPackedMatrixWriteRegion=function(a,b,c,d){throw Error("setOutputPackedMatrixWriteRegion not implemented.")},a.prototype.debugValidate=function(){null!=this.program&&rs(this.gl,this.debug,this.program),rF(this.gl)},a.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var a=this.gl;this.debug&&this.debugValidate(),rh(a,this.debug,function(){return a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)})},a.prototype.blockUntilAllProgramsCompleted=function(){var a=this;this.throwIfDisposed(),rh(this.gl,this.debug,function(){return a.gl.finish()})},a.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=rk(this.gl,this.debug,2===pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},a.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},a.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},a.prototype.beginQuery=function(){if(2===pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var a=this.gl,b=this.getQueryTimerExtensionWebGL2(),c=a.createQuery();return a.beginQuery(b.TIME_ELAPSED_EXT,c),c}var d=this.getQueryTimerExtensionWebGL1(),e=d.createQueryEXT();return d.beginQueryEXT(d.TIME_ELAPSED_EXT,e),e},a.prototype.endQuery=function(){if(2!==pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var a=this.getQueryTimerExtensionWebGL1();a.endQueryEXT(a.TIME_ELAPSED_EXT)}else{var b=this.gl,c=this.getQueryTimerExtensionWebGL2();b.endQuery(c.TIME_ELAPSED_EXT)}},a.prototype.waitForQueryAndGetTime=function(a){return pS(this,void 0,void 0,function(){var b=this;return pT(this,function(c){switch(c.label){case 0:return[4,qd(function(){return b.disposed||b.isQueryAvailable(a,pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return c.sent(),[2,this.getQueryTime(a,pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},a.prototype.getQueryTime=function(a,b){if(0===b)return null;if(2===b){var c=this.gl;return c.getQueryParameter(a,c.QUERY_RESULT)/1e6}var d=this.getQueryTimerExtensionWebGL1();return d.getQueryObjectEXT(a,d.QUERY_RESULT_EXT)/1e6},a.prototype.isQueryAvailable=function(a,b){if(0===b)return!0;if(2===b){var c=this.gl,d=this.getQueryTimerExtensionWebGL2(),e=c.getQueryParameter(a,c.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(d.GPU_DISJOINT_EXT)),e&&!this.disjoint}return e=(d=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(a,d.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(d.GPU_DISJOINT_EXT)),e&&!this.disjoint},a.prototype.pollFence=function(a){var b=this;return new Promise(function(c){b.addItemToPoll(function(){return a.isFencePassed()},function(){return c()})})},a.prototype.pollItems=function(){for(var a=function(a){for(var b=0;b<a.length&&a[b]();++b);return b-1}(this.itemsToPoll.map(function(a){return a.isDoneFn})),b=0;b<=a;++b)(0,this.itemsToPoll[b].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(a+1)},a.prototype.addItemToPoll=function(a,b){var c=this;this.itemsToPoll.push({isDoneFn:a,resolveFn:b}),this.itemsToPoll.length>1||qd(function(){return c.pollItems(),0===c.itemsToPoll.length})},a.prototype.bindTextureToFrameBuffer=function(a){this.throwIfDisposed(),rD(this.gl,this.debug,a,this.framebuffer),this.debug&&rF(this.gl)},a.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(rD(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&rF(this.gl)):rE(this.gl,this.debug,this.framebuffer)},a.prototype.downloadMatrixDriver=function(a,b){this.bindTextureToFrameBuffer(a);var c=b();return this.unbindTextureToFrameBuffer(),c},a.prototype.setOutputMatrixTextureDriver=function(a,b,c){this.throwIfDisposed();var d=this.gl;rD(d,this.debug,a,this.framebuffer),this.debug&&rF(d),this.outputTexture=a,rh(d,this.debug,function(){return d.viewport(0,0,b,c)}),rh(d,this.debug,function(){return d.scissor(0,0,b,c)})},a.prototype.setOutputMatrixWriteRegionDriver=function(a,b,c,d){var e=this;this.throwIfDisposed(),rh(this.gl,this.debug,function(){return e.gl.scissor(a,b,c,d)})},a.prototype.throwIfDisposed=function(){if(this.disposed)throw Error("Attempted to use disposed GPGPUContext.")},a.prototype.throwIfNoProgram=function(){if(null==this.program)throw Error("No GPU program is currently set.")},a}();function ve(a,b){if(a.length!==b.length)throw Error("Binary was compiled with "+a.length+" inputs, but was executed with "+b.length+" inputs");a.forEach(function(a,c){var d=a.logicalShape,e=b[c],f=e.shape;if(!p8(d,f))throw Error("Binary was compiled with different shapes than the current args. Shapes "+d+" and "+f+" must match");if(!a.isUniform||!e.isUniform){var g=a.texShape,h=e.isUniform?null:e.texData.texShape;if(!p8(g,h))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+g+" and "+h+" must match")}})}var vf=function(a,b,c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a;for(var d=c.filterWidth,e=c.inChannels,f=c.strideWidth,g=c.strideHeight,h=c.padInfo,i=c.outWidth,j=c.dilationWidth,k=c.dilationHeight,l=c.dataFormat,m=h.left,n=h.top,o=e*d,p=t6(),q="channelsLast"===l,r=+!q,s=q?1:2,t="",u=0;u<=1;u++)for(var v=0;v<=1;v++)t+="\n          blockIndex = rc.y + "+v+";\n          pos = rc.x + "+u+";\n\n          if(blockIndex < "+a[1]+" && pos < "+a[0]+") {\n            offsetY = int(blockIndex / ("+i+")) * "+g+" - "+n+";\n            d0 = offsetY + "+k+" * (pos / "+o+");\n\n            if(d0 < "+b[r]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+i+".) * "+f+". - "+m+".);\n              d1 = offsetX + "+j+" * (int(mod(float(pos), "+o+".) / "+e+".));\n\n              if(d1 < "+b[s]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+e+".));\n\n                if ("+q+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*u+v)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*u+v)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+t+"\n\n        "+p.output+" = result;\n      }\n    "},vg=function(a,b,c,d,e){this.variableNames=["x"],this.outputShape=[];var f,g=a[3]-1;this.outputShape=a;var h="float("+c+") + float("+d+") * sum";f=.5===e?"inversesqrt("+h+")":1===e?"1.0/("+h+")":"exp(log("+h+") * float(-"+e+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+b+"; j <= "+b+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+g+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+f+";\n        setOutput(val);\n      }\n    "},vh=function(a,b,c,d,e){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=a,this.depth=a[3],this.depthRadius=b,this.bias=c,this.alpha=d,this.beta=e,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+b+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+b+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+d+") * norm + float("+c+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+d+")\n                * float("+e+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+e+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},vi=function(a,b,c,d,e){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var f,g=a[3]-1;this.outputShape=a;var h="float("+c+") + float("+d+") * sum";f=.5===e?"inversesqrt("+h+")":1===e?"1.0/("+h+")":"exp(log("+h+") * float(-"+e+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+b+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+b+"; j <= "+b+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+g+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+f+";\n        setOutput(result);\n      }\n    "},vj=function(a){this.variableNames=["dy","maxPos"],this.outputShape=a.inShape;var b=a.strideHeight,c=a.strideWidth,d=a.dilationHeight,e=a.effectiveFilterHeight,f=a.effectiveFilterWidth,g=e-1-a.padInfo.top,h=f-1-a.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+g+", "+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n          wR += "+d+") {\n          float dyR = float(dyRCorner + wR) / "+b+".0;\n\n          if (dyR < 0.0 || dyR >= "+a.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+c+".0;\n\n            if (dyC < 0.0 || dyC >= "+a.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(e*f-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+f+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vk=function(a){this.variableNames=["dy","maxPos"],this.outputShape=a.inShape;var b=a.strideDepth,c=a.strideHeight,d=a.strideWidth,e=a.dilationDepth,f=a.dilationHeight,g=a.dilationWidth,h=a.effectiveFilterDepth,i=a.effectiveFilterHeight,j=a.effectiveFilterWidth,k=h-1-a.padInfo.front,l=i-1-a.padInfo.top,m=j-1-a.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+k+", "+l+", "+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+h+";\n           wD += "+e+") {\n          float dyD = float(dyDCorner + wD) / "+b+".0;\n\n          if (dyD < 0.0 || dyD >= "+a.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+i+";\n              wR += "+f+") {\n            float dyR = float(dyRCorner + wR) / "+c+".0;\n\n            if (dyR < 0.0 || dyR >= "+a.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+j+";\n                wC += "+g+") {\n              float dyC = float(dyCCorner + wC) / "+d+".0;\n\n              if (dyC < 0.0 || dyC >= "+a.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(h*i*j-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+i+" * "+j+" +\n                  wR * "+j+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vl=function(a,b,c,d,e,f,g){void 0===c&&(c=!1),void 0===d&&(d=!1),void 0===e&&(e=!1),void 0===f&&(f=null),void 0===g&&(g=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b;var h=Math.ceil((c?a[1]:a[2])/2),i=c?"i * 2, rc.y":"rc.y, i * 2",j=d?"rc.z, i * 2":"i * 2, rc.z",k=c?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],l=d?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",n="";f&&(m=g?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+f+"\n        }":"vec4 activation(vec4 x) {\n          "+f+"\n        }",n="result = activation(result);");var o=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),g&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const float sharedDimension = "+h+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+h+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+i+");\n          vec4 b = getMatrixB(rc.x, "+j+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+k[0]+" * "+l[0]+");\n          result += ("+k[1]+" * "+l[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+o+"\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},vm=function(){function a(a,b,c){this.variableNames=["probs"],this.outputShape=[a,c],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(b-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(b-1)+"));\n      }\n    "}return a.prototype.getCustomSetupFunc=function(a){var b=this;return function(c,d){null==b.seedLoc&&(b.seedLoc=c.getUniformLocation(d,"seed")),c.gl.uniform1f(b.seedLoc,a)}},a}(),vn=function(a,b,c,d){this.variableNames=["indices"],this.outputShape=[a,b],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+d+"), float("+c+"),\n                      float(index == coords.y)));\n      }\n    "},vo=function(a){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=a;var b=a.length;if(0===b)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var c,d,e=t5("rc",b),f=uc(b),g=function(a,b,c){if(1===a)return"rc > "+b[0];for(var d="",e=a-2;e<a;e++)d+=c[e]+" >= "+b[e],e<a-1&&(d+="||");return d}(b,a,e),h=function(a,b,c,d){if(1===a)return"";var e=d.slice(-2);return"\n    int r = "+e[0]+";\n    int c = "+e[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+b+";\n    bool rEdge = rp1 >= "+c+";\n  "}(b,a[a.length-1],a[a.length-2],e),i=(d=function(a,b){for(var c=[],d=0;d<=1;d++)for(var e=0;e<=1;e++){for(var f=(0===d?"r":"rp1")+", "+(0===e?"c":"cp1"),g=2;g<a;g++)f=b[b.length-1-g]+","+f;c.push(f)}return c}(c=a.length,e),1===c?"getA(rc),\n            rc + 1 >= "+a[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+d[0]+"),\n          cEdge ? 0. : getA("+d[1]+"),\n          rEdge ? 0. : getA("+d[2]+"),\n          rEdge || cEdge ? 0. : getA("+d[3]+")");this.userCode="\n        void main() {\n          "+f+" rc = getOutputCoords();\n\n          if("+g+") {\n            setOutput(vec4(0));\n          } else {\n            "+h+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},vp=function(a,b,c){this.variableNames=["x"],this.outputShape=b.map(function(b,c){return b[0]+a[c]+b[1]});var d=a.length,e=uc(d),f=b.map(function(a){return a[0]}).join(","),g=b.map(function(b,c){return b[0]+a[c]}).join(","),h=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,d);this.userCode=1!==d?"\n      "+e+" start = "+e+"("+f+");\n      "+e+" end = "+e+"("+g+");\n\n      void main() {\n        "+e+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+c+"));\n        } else {\n          "+e+" coords = outC - start;\n          setOutput(getX("+h+"));\n        }\n      }\n    ":"\n        int start = "+f+";\n        int end = "+g+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+c+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},vq=function(a,b,c){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=b.map(function(b,c){return b[0]+a[c]+b[1]});for(var d=a.length,e=uc(d),f=b.map(function(a){return a[0]}).join(","),g=b.map(function(b,c){return b[0]+a[c]}).join(","),h=t5("rc",d),i=t5("source",d),j=h[d-1]+" < "+this.outputShape[d-1],k=1===d?"source":"vec2("+i.slice(-2).join()+")",l=[e+" rc = outputLoc;",h[d-1]+" += 1;\n       if("+j+") {\n      ",1===d?"":"}\n       rc = outputLoc;\n       "+h[d-2]+" += 1;\n       if("+h[d-2]+" < "+this.outputShape[d-2]+") {",1===d?"":"  "+h[d-1]+" += 1;\n         if("+j+") {"],m=1===d?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",n="",o=0,p=1===d?2:4;o<p;o++)n+="\n        "+l[o]+"\n        if ("+m+") {\n          result["+o+"] = float("+c+");\n        } else {\n          "+e+" source = rc - start;\n          result["+o+"] = getChannel(getX("+i.join()+"), "+k+");\n        }\n      ";n+=1===d?"} ":"}}",this.userCode="\n      const "+e+" start = "+e+"("+f+");\n      const "+e+" end = "+e+"("+g+");\n\n      void main() {\n        "+e+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+n+"\n        setOutput(result);\n      }\n    "},vr=function(a,b,c){if(this.variableNames=["x"],"avg"===b&&c)throw Error("Cannot compute positions for average pool.");var d=a.filterWidth,e=a.strideHeight,f=a.strideWidth,g=a.dilationHeight,h=a.dilationWidth,i=a.effectiveFilterHeight,j=a.effectiveFilterWidth,k=a.padInfo.top,l=a.padInfo.left;this.outputShape=a.outShape;var m="avg"===b,n="0.0";if(m||(n="-1.0 / 1e-20"),c)this.userCode="\n        const ivec2 strides = ivec2("+e+", "+f+");\n        const ivec2 pads = ivec2("+k+", "+l+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+i+";\n              wR += "+g+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+a.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+j+";\n                wC += "+h+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+a.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+j+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var o=b+"("+b+"("+b+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===b&&(o="avgValue / count");var p=4*Math.floor(d/4),q=d%4,r="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+e+", "+f+");\n      const ivec2 pads = ivec2("+k+", "+l+");\n      const float initializationValue = "+n+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+a.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+n+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+i+";\n            wR += "+g+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+a.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC += 4) {\n            int xC = xCCorner + wC * "+h+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+h+", d),\n              getValue(batch, xR, xC + 2 * "+h+", d),\n              getValue(batch, xR, xC + 3 * "+h+", d)\n            );\n\n            "+r+"\n          }\n\n          int xC = xCCorner + "+p+";\n          if ("+(1===q)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+r+"\n          } else if ("+(2===q)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+h+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+r+"\n          } else if ("+(3===q)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+h+", d),\n              getValue(batch, xR, xC + 2 * "+h+", d),\n              initializationValue\n            );\n\n            "+r+"\n          }\n        }\n        setOutput("+o+");\n      }\n    "}},vs=function(a,b,c){if(this.variableNames=["x"],"avg"===b&&c)throw Error("Cannot compute positions for average pool.");var d=a.filterWidth,e=a.strideDepth,f=a.strideHeight,g=a.strideWidth,h=a.dilationDepth,i=a.dilationHeight,j=a.dilationWidth,k=a.effectiveFilterDepth,l=a.effectiveFilterHeight,m=a.effectiveFilterWidth,n=a.padInfo.front,o=a.padInfo.top,p=a.padInfo.left;this.outputShape=a.outShape;var q="avg"===b,r="0.0";if(q||(r="-1.0 / 1e-20"),c)this.userCode="\n        const ivec3 strides =\n            ivec3("+e+", "+f+", "+g+");\n        const ivec3 pads = ivec3("+n+", "+o+", "+p+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+k+";\n              wD += "+h+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+a.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+l+";\n                wR += "+i+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+a.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+m+";\n                  wC += "+j+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+a.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+l+" * "+m+" +\n                      wR * "+m+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var s=b+"("+b+"("+b+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===b&&(s="avgValue / count");var t=4*Math.floor(d/4),u=d%4,v="\n      if ("+q+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+e+", "+f+", "+g+");\n      const ivec3 pads = ivec3("+n+", "+o+", "+p+");\n      const float initializationValue = "+r+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+a.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+r+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+k+";\n            wD += "+h+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+a.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+l+";\n            wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+a.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+t+"; wC += 4) {\n              int xC = xCCorner + wC * "+j+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+j+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+j+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+j+", ch)\n              );\n\n              "+v+"\n            }\n\n            int xC = xCCorner + "+t+";\n            if ("+(1===u)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+v+"\n            } else if ("+(2===u)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+j+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+v+"\n            } else if ("+(3===u)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+j+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+j+", ch),\n                initializationValue\n              );\n\n              "+v+"\n            }\n          }\n          setOutput("+s+");\n        }\n      }\n    "}},vt=function(a,b){this.variableNames=["x"];var c=a.windowSize,d=a.batchSize,e=a.inSize,f=Math.ceil(e/c);this.outputShape=[d,f];var g="0.0",h="";"prod"===b?g="1.0":"min"===b?(g="1.0 / 1e-20",h="min"):"max"===b&&(g="-1.0 / 1e-20",h="max");var i=b+"("+b+"("+b+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===b?i="sumValue":"prod"===b?i="prodValue":"all"===b?i="allValue":"any"===b&&(i="anyValue");var j=4*Math.floor(c/4),k=c%4,l="\n      if ("+("sum"===b)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===b)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+h+"(values, minMaxValue);\n      }\n    ",m="vec4";"all"===b?(g="1.0",l="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",m="bvec4"):"any"===b&&(g="0.0",l="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",m="bvec4");var n="";e%c>0&&(n="\n        if (inIdx < 0 || inIdx >= "+e+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+n+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+c+";\n\n        vec4 minMaxValue = vec4("+g+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+j+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+m+" values = "+m+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+j+";\n        if ("+(1===k)+") {\n          "+m+" values = "+m+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+l+"\n        } else if ("+(2===k)+") {\n          "+m+" values = "+m+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+l+"\n        } else if ("+(3===k)+") {\n          "+m+" values = "+m+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+l+"\n        }\n        setOutput("+i+");\n      }\n    "},vu=function(a,b){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a;for(var c="",d=0;d<4;d++){var e="thisRC = rc;";d%2==1&&(e+="thisRC.z += 1;"),d>1&&(e+="thisRC.y += 1;"),c+="\n        "+e+"\n        "+(d>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+d+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(d>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+t7(["r","c","d"],b)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+t8(a)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+a[1]+";\n        int cols = "+a[2]+";\n\n        "+c+"\n\n        setOutput(result);\n      }\n    "},vv=function(a,b,c){this.variableNames=["dy"],this.outputShape=[],this.outputShape=b.shape;var d=b.shape,e=d[1],f=d[2],g=a.shape,h=g[1],i=g[2],j=[c&&h>1?e-1:e,c&&i>1?f-1:f],k=[c&&h>1?h-1:h,c&&i>1?i-1:i],l=j[0]/k[0],m=j[1]/k[1],n=1/l,o=1/m,p=2*Math.ceil(n)+2,q=2*Math.ceil(o)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+l+");\n        const float widthScale = float("+m+");\n\n        const float invHeightScale = float("+n+");\n        const float invWidthScale = float("+o+");\n\n        const int winHeight = int("+p+");\n        const int winWidth = int("+q+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+h+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+i+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(e-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(f-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},vw=function(a,b,c,d){this.variableNames=["A"],this.outputShape=[];var e=a[0],f=a[1],g=a[2],h=a[3];this.outputShape=[e,b,c,h];var i=[d&&b>1?f-1:f,d&&c>1?g-1:g],j=[d&&b>1?b-1:b,d&&c>1?c-1:c];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+i[0]/j[0]+",\n          "+i[1]/j[1]+");\n      const vec2 inputShapeRC = vec2("+f+".0, "+g+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},vx=function(a,b,c,d){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var e=a[0],f=a[1],g=a[2],h=a[3];this.outputShape=[e,b,c,h];var i=[d&&b>1?f-1:f,d&&c>1?g-1:g],j=[d&&b>1?b-1:b,d&&c>1?c-1:c];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+i[0]/j[0]+",\n          "+i[1]/j[1]+",\n          "+i[1]/j[1]+");\n      const vec3 inputShapeRC = vec3("+f+".0, "+g+".0,\n                                     "+g+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(h-1)+";\n        bool hasNextRow = coords.z < "+(c-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},vy=function(a,b,c){this.variableNames=["dy"],this.outputShape=[],this.outputShape=b.shape;var d=b.shape,e=d[1],f=d[2],g=a.shape,h=g[1],i=g[2],j=[c&&h>1?e-1:e,c&&i>1?f-1:f],k=[c&&h>1?h-1:h,c&&i>1?i-1:i],l=j[0]/k[0],m=j[1]/k[1],n=1/l,o=1/m,p=2*Math.ceil(n)+2,q=2*Math.ceil(o)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+l+");\n        const float widthScale = float("+m+");\n\n        const float invHeightScale = float("+n+");\n        const float invWidthScale = float("+o+");\n\n        const int winHeight = int("+p+");\n        const int winWidth = int("+q+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+h+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+i+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+j[0]+") *\n                (float(dyR) / float("+k[0]+"));\n\n            float sourceFracCol =\n                float("+j[1]+") *\n                  (float(dyC) / float("+k[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+e+") - 1),\n                "+c+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+f+") - 1),\n                "+c+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},vz=function(a,b,c,d){this.variableNames=["A"],this.outputShape=[];var e=a[0],f=a[1],g=a[2],h=a[3];this.outputShape=[e,b,c,h];var i=[d&&b>1?f-1:f,d&&c>1?g-1:g],j=[d&&b>1?b-1:b,d&&c>1?c-1:c];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+i[0]/j[0]+",\n          "+i[1]/j[1]+");\n      const vec2 inputShapeRC = vec2("+f+".0, "+g+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(d?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},vA=function(a,b){this.variableNames=["x"];var c=a.length;if(c>4)throw Error("WebGL backend: Reverse of rank-"+c+" tensor is not yet supported");if(this.outputShape=a,1!==c){var d=a.map(function(c,d){return -1!==b.indexOf(d)&&1!==a[d]?a[d]+" - coords["+d+"] - 1":"coords["+d+"]"}).join(","),e=uc(c);this.userCode="\n      void main() {\n        "+e+" coords = getOutputCoords();\n        setOutput(getX("+d+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+a[0]+" - coord - 1));\n        }\n      "},vB=function(a,b){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var c,d,e,f=a.length;if(f>4)throw Error("WebGL backend: Reverse of rank-"+f+" tensor is not yet supported");this.outputShape=a;var g=t5("rc",f),h=g[f-1]+" + 1 < "+this.outputShape[f-1],i=g[f-2]+" + 1 < "+this.outputShape[f-2],j=uc(f);function k(c){var d=a.map(function(d,e){return -1!==b.indexOf(e)&&1!==a[e]?a[e]+" - "+c[e]+" - 1":""+c[e]});return"getChannel(getX("+d.join(",")+"), vec2("+d.slice(-2).join(",")+"))"}this.userCode=1===f?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+a[0]+" - rc - 1),\n            "+a[0]+" - rc - 1);\n          if("+h+"){\n              result.g = getChannel(getX("+a[0]+" - (rc  + 1) - 1),\n                "+a[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+j+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+k(g.slice())+";\n          if("+h+"){\n            result.g = "+((c=g.slice())[f-1]="("+c[f-1]+" + 1)",k(c))+";\n          }\n          if("+i+") {\n            result.b = "+((d=g.slice())[f-2]="("+d[f-2]+" + 1)",k(d))+";\n            if("+h+") {\n              result.a = "+((e=g.slice())[f-1]="("+e[f-1]+" + 1)",e[f-2]="("+e[f-2]+" + 1)",k(e))+";\n            }\n          }\n          setOutput(result);\n        }\n    "},vC=function(a,b,c,d,e,f,g){void 0===g&&(g=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=f;var h=uc(e.length),i=uc(f.length),j="";1===c?j="i":2===c&&(j="i, j");var k="getIndices("+j+")",l="";1===d?l="i":2===d&&(l="i, coords[1]");var m="getUpdates("+l+")";this.userCode="\n        "+h+" strides = "+h+"("+e+");\n\n        void main() {\n          "+i+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+a+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+b+"; j++) {\n              int index = round("+k+");\n              flattenedIndex += index * "+(b>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+m+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},vD=function(a,b){this.variableNames=["x","segmentIds"];var c=a.windowSize,d=a.batchSize,e=a.inSize,f=a.numSegments,g=f*Math.ceil(e/c);this.outputShape=[d,g];var h=4*Math.floor(c/4),i=c%4,j="\n        sumValue += dot(values, segFilter);\n    ",k="";e%c>0&&(k="\n        if (inIdx < 0 || inIdx >= "+e+") {\n          return initializationValue;\n        }\n      ");var l="";e%c>0&&(l="\n        if (inIdx < 0 || inIdx >= "+e+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+k+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+l+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+f+")) * float("+c+"));\n        int currentSeg = int(mod(float(outIdx), float("+f+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+h+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+j+"\n        }\n\n        int inIdx = inOffset + "+h+";\n        if ("+(1===i)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+j+"\n        } else if ("+(2===i)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+j+"\n        } else if ("+(3===i)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+j+"\n        }\n        setOutput(sumValue);\n      }\n    "},vE=function(a,b,c){if(this.variableNames=["c","a","b"],this.outputShape=b,c>4)throw Error("Where for rank "+c+" is not yet supported");if(1===c)e="resRC",d="resRC";else{for(var d,e,f=["resRC.x","resRC.y","resRC.z","resRC.w"],g=[],h=[],i=0;i<b.length;i++)h.push(""+f[i]),i<a&&g.push(""+f[i]);d=g.join(),e=h.join()}var j=uc(c);this.userCode="\n      void main() {\n        "+j+" resRC = getOutputCoords();\n        float cVal = getC("+d+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+e+"));\n        } else {\n          setOutput(getB("+e+"));\n        }\n      }\n    "},vF=function(){function a(a){this.variableNames=["source"],this.outputShape=a,this.rank=a.length;var b,c=uc(this.rank),d="uniform int start["+this.rank+"];",e=function(a){if(1===a)return"sourceLoc";if(a<=6)return vG.slice(0,a).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);b="\n        "+c+" sourceLoc;\n        "+c+" coords = getOutputCoords();\n        "+a.map(function(a,b){return"sourceLoc."+vG[b]+" = start["+b+"] + coords."+vG[b]+";"}).join("\n")+"\n      ",this.userCode="\n      "+d+"\n      void main() {\n        "+b+"\n        setOutput(getSource("+e+"));\n      }\n    "}return a.prototype.getCustomSetupFunc=function(a){var b=this;if(a.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+a.length+")");return function(c,d){null==b.startLoc&&(b.startLoc=c.getUniformLocationNoThrow(d,"start"),null==b.startLoc)||c.gl.uniform1iv(b.startLoc,a)}},a}(),vG=["x","y","z","w","u","v"],vH=function(){function a(a){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a,this.rank=a.length;var b=uc(this.rank),c=t5("coords",this.rank),d=t5("sourceLoc",this.rank),e=1===this.rank?"sourceLoc":"vec2("+d.slice(-2).join()+")",f="getChannel(getSource("+d.join()+"), "+e+")",g="\n      result.x = "+f+";\n      if (++"+c[this.rank-1]+" < "+a[this.rank-1]+") {\n        ++"+d[this.rank-1]+";\n        result.y = "+f+";\n        --"+d[this.rank-1]+";\n      }\n    ",h=1===this.rank?"":"\n      --"+c[this.rank-1]+";\n      if (++"+c[this.rank-2]+" < "+a[this.rank-2]+") {\n        ++"+d[this.rank-2]+";\n        result.z = "+f+";\n        if (++"+c[this.rank-1]+" < "+a[this.rank-1]+") {\n          ++"+d[this.rank-1]+";\n          result.w = "+f+";\n        }\n      }\n    ",i=this.rank<=4?"sourceLoc = coords +\n            "+b+"("+a.map(function(a,b){return"start["+b+"]"}).join()+");":a.map(function(a,b){return d[b]+" = "+c[b]+" + start["+b+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+b+" coords = getOutputCoords();\n        "+b+" sourceLoc;\n        "+i+"\n        vec4 result = vec4(0.);\n        "+g+"\n        "+h+"\n        setOutput(result);\n      }\n    "}return a.prototype.getCustomSetupFunc=function(a){var b=this;if(a.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+a.length+")");return function(c,d){null==b.startLoc&&(b.startLoc=c.getUniformLocationNoThrow(d,"start"),null==b.startLoc)||c.gl.uniform1iv(b.startLoc,a)}},a}(),vI=function(a,b,c){this.variableNames=["x"],this.outputShape=c;var d=c.length,e=uc(c.length),f=uc(c.length),g="";if(1===d)g="coords * strides + begin";else{var h=0;g=c.map(function(a,b){return h++,1===c.length?"coords * strides["+b+"] + begin["+b+"]":"coords["+(h-1)+"] * strides["+b+"] + begin["+b+"]"}).join(",")}this.userCode="\n      "+e+" begin = "+e+"("+a+");\n      "+e+" strides = "+e+"("+b+");\n\n      void main() {\n        "+f+" coords = getOutputCoords();\n        setOutput(getX("+g+"));\n      }\n    "},vJ=function(){function a(a){this.gpgpu=a,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return a.prototype.acquireTexture=function(a,b,c){var d,e=vK(b,c),f=vL(a,e,c);if(f in this.freeTextures||(this.freeTextures[f]=[]),f in this.usedTextures||(this.usedTextures[f]=[]),this.freeTextures[f].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var g=this.freeTextures[f].shift();return this.usedTextures[f].push(g),g}return this.numUsedTextures++,this.log(),e===q9.PACKED_2X2_FLOAT32?d=this.gpgpu.createPackedMatrixTexture(a[0],a[1]):e===q9.PACKED_2X2_FLOAT16?d=this.gpgpu.createFloat16PackedMatrixTexture(a[0],a[1]):e===q9.UNPACKED_FLOAT32?d=this.gpgpu.createFloat32MatrixTexture(a[0],a[1]):e===q9.UNPACKED_FLOAT16?d=this.gpgpu.createFloat16MatrixTexture(a[0],a[1]):e===q9.PACKED_4X1_UNSIGNED_BYTE&&(d=this.gpgpu.createUnsignedBytesMatrixTexture(a[0],a[1])),this.usedTextures[f].push(d),d},a.prototype.releaseTexture=function(a,b,c,d){if(null!=this.freeTextures){var e=vL(b,vK(c,d),d);e in this.freeTextures||(this.freeTextures[e]=[]),this.freeTextures[e].push(a),this.numFreeTextures++,this.numUsedTextures--;var f=this.usedTextures[e],g=f.indexOf(a);if(g<0)throw Error("Cannot release a texture that was never provided by this texture manager");f.splice(g,1),this.log()}},a.prototype.log=function(){if(this.logEnabled){var a=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+a+")")}},a.prototype.getNumUsedTextures=function(){return this.numUsedTextures},a.prototype.getNumFreeTextures=function(){return this.numFreeTextures},a.prototype.dispose=function(){var a=this;if(null!=this.freeTextures){for(var b in this.freeTextures)this.freeTextures[b].forEach(function(b){a.gpgpu.deleteMatrixTexture(b)});for(var b in this.usedTextures)this.usedTextures[b].forEach(function(b){a.gpgpu.deleteMatrixTexture(b)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},a}();function vK(a,b){if(a===q8.UPLOAD)return q9.PACKED_2X2_FLOAT32;if(a===q8.RENDER||null==a)return pV.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?b?q9.PACKED_2X2_FLOAT32:q9.UNPACKED_FLOAT32:b?q9.PACKED_2X2_FLOAT16:q9.UNPACKED_FLOAT16;if(a===q8.DOWNLOAD||a===q8.PIXELS)return q9.PACKED_4X1_UNSIGNED_BYTE;throw Error("Unknown logical texture type "+a)}function vL(a,b,c){return a[0]+"_"+a[1]+"_"+b+"_"+c}var vM=function(a,b){this.variableNames=["A"];for(var c=Array(a.length),d=0;d<c.length;d++)c[d]=a[d]*b[d];this.outputShape=c,this.rank=c.length;var e=uc(this.rank),f=function(a){var b=a.length;if(b>5)throw Error("Tile for rank "+b+" is not yet supported");if(1===b)return"imod(resRC, "+a[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],d=[],e=0;e<a.length;e++)d.push("imod("+c[e]+", "+a[e]+")");return d.join()}(a);this.userCode="\n      void main() {\n        "+e+" resRC = getOutputCoords();\n        setOutput(getA("+f+"));\n      }\n    "},vN=function(a,b){this.variableNames=["A"];for(var c=Array(a.length),d=0;d<c.length;d++)c[d]=a[b[d]];this.outputShape=c,this.rank=c.length;var e=uc(this.rank),f=function(a){var b=a.length;if(b>6)throw Error("Transpose for rank "+b+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],d=Array(b),e=0;e<a.length;e++)d[a[e]]=c[e];return d.join()}(b);this.userCode="\n    void main() {\n      "+e+" resRC = getOutputCoords();\n      setOutput(getA("+f+"));\n    }\n    "},vO=function(a,b){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var c=Array(a.length),d=0;d<c.length;d++)c[d]=a[b[d]];if(this.outputShape=c,this.rank=c.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var e=uc(this.rank),f=t4("rc",this.rank),g=Array(this.rank);for(d=0;d<b.length;d++)g[b[d]]=f[d];var h="vec2("+g.slice(-2).join()+")",i="++"+f[this.rank-1]+" < "+c[this.rank-1],j="getChannel(getA("+g.join()+"), "+h+")";this.userCode="\n    void main() {\n      "+e+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+j+";\n      if("+i+") {\n        result[1] = "+j+";\n      }\n      --"+f[this.rank-1]+";\n      if(++"+f[this.rank-2]+" < "+c[this.rank-2]+") {\n        result[2] = "+j+";\n        if("+i+") {\n          result[3] = "+j+";\n        }\n      }\n      setOutput(result);\n    }\n    "},vP=function(a,b){this.variableNames=["A"],this.outputShape=a,this.userCode="\n      float unaryOperation(float x) {\n        "+b+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},vQ="if (isnan(x)) return x;",vR="return abs(x);",vS=vQ+"\n  return (x < 0.0) ? 0.0 : x;\n",vT=vQ+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",vU="return (x >= 0.0) ? x : (exp(x) - 1.0);",vV="return -x;",vW="return ceil(x);",vX="return floor(x);",vY="return exp(x);",vZ="return exp(x) - 1.0;",v$=vQ+"\n  return sin(x);\n",v_=vQ+"\n  return cos(x);\n",v0=vQ+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",v1=vQ+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",v2=vQ+"\n  return atan(x);\n",v3=vQ+"return log(x + sqrt(x * x + 1.0));",v4=vQ+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",v5=vQ+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",v6="return x;",v7="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",v8="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",v9="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",wa=function(a,b){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+b+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},wb=function(a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=a;var b=a.length,c=t5("rc",b),d=uc(b),e=function(a,b){if(1===a)return"rc";for(var c="",d=0;d<a;d++)c+=b[d],d<a-1&&(c+=",");return c}(b,c),f=c.slice(-2),g=b<=1?"rc":"vec2("+f.join(",")+")";this.userCode="\n      void main() {\n        "+d+" rc = getOutputCoords();\n        vec4 packedInput = getA("+e+");\n\n        setOutput(getChannel(packedInput, "+g+"));\n      }\n    "},wc={};function wd(a,b){if(void 0===b&&(b=!1),"linear"===a)return"return x;";if("relu"===a)return b?v7:vS;if("elu"===a)return b?v9:vU;if("relu6"===a)return b?v8:vT;if("prelu"===a)return b?uq:uo;throw Error("Activation "+a+" has not been implemented for the WebGL backend.")}var we=function(a){function b(b){var c,d=a.call(this)||this;if(d.pendingRead=new WeakMap,d.pendingDisposal=new WeakSet,d.dataRefCount=new WeakMap,d.numBytesInGPU=0,d.uploadWaitMs=0,d.downloadWaitMs=0,d.warnedAboutMemory=!1,d.pendingDeletes=0,d.disposed=!1,!pV.getBool("HAS_WEBGL"))throw Error("WebGL is not supported on this device");if(null==b){var e=rd(pV.getNumber("WEBGL_VERSION"));(c=pV.getNumber("WEBGL_VERSION"))in wc||(wc[c]={}),d.binaryCache=wc[c],d.gpgpu=new vd(e),d.canvas=e.canvas,d.gpgpuCreatedLocally=!0}else d.gpgpu=b,d.binaryCache={},d.gpgpuCreatedLocally=!1,d.canvas=b.gl.canvas;return d.textureManager=new vJ(d.gpgpu),d.numMBBeforeWarning=null==pV.global.screen?1024:pV.global.screen.height*pV.global.screen.width*window.devicePixelRatio*600/1024/1024,d.texData=new tx(d,q4),d}return pR(b,a),b.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},b.prototype.write=function(a,b,c){if(pV.getBool("DEBUG")&&this.checkNumericalProblems(a),"complex64"===c&&null!=a)throw Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var d={};return this.texData.set(d,{shape:b,dtype:c,values:a,usage:q8.UPLOAD}),d},b.prototype.move=function(a,b,c,d){if(pV.getBool("DEBUG")&&this.checkNumericalProblems(b),"complex64"===d)throw Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(a,{shape:c,dtype:d,values:b,usage:q8.UPLOAD})},b.prototype.readSync=function(a){var b=this.texData.get(a),c=b.values,d=b.dtype,e=b.complexTensors,f=b.slice,g=b.shape,h=b.isPacked;if(null!=f){var i=void 0;i=h?new wa(g,v6):new vP(g,v6);var j=this.runWebGLProgram(i,[{dataId:a,shape:g,dtype:d}],d),k=this.readSync(j.dataId);return this.disposeData(j.dataId),k}if(null!=c)return this.convertAndCacheOnCPU(a);if("string"===d)return c;var l,m,n=null!=this.activeTimers;return n&&(l=qA()),m="complex64"===d?tS(e.real.dataSync(),e.imag.dataSync()):this.getValuesFromTexture(a),n&&(this.downloadWaitMs+=qA()-l),this.convertAndCacheOnCPU(a,m)},b.prototype.read=function(a){return pS(this,void 0,void 0,function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return pT(this,function(v){switch(v.label){case 0:if(this.pendingRead.has(a))return b=this.pendingRead.get(a),[2,new Promise(function(a){return b.push(a)})];if(d=(c=this.texData.get(a)).values,e=c.shape,f=c.slice,g=c.dtype,h=c.complexTensors,i=c.isPacked,null!=f)return j=void 0,j=i?new wa(e,v6):new vP(e,v6),k=this.runWebGLProgram(j,[{dataId:a,shape:e,dtype:g}],g),l=this.read(k.dataId),this.disposeData(k.dataId),[2,l];if(null!=d)return[2,this.convertAndCacheOnCPU(a)];if(!pV.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===pV.getNumber("WEBGL_VERSION"))throw Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,"complex64"!==g&&pV.get("WEBGL_BUFFER_SUPPORTED")&&(n=this.decode(a),o=this.texData.get(n.dataId),m=(u=this.gpgpu).createBufferFromTexture.apply(u,[o.texture].concat(re(e)))),this.pendingRead.set(a,[]),"complex64"===g?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:v.sent(),v.label=2;case 2:return"complex64"!==g?[3,4]:[4,Promise.all([h.real.data(),h.imag.data()])];case 3:return p=tS((q=v.sent())[0],q[1]),[3,5];case 4:null==m?p=this.getValuesFromTexture(a):(r=p7(e),p=this.gpgpu.downloadFloat32MatrixFromBuffer(m,r)),v.label=5;case 5:return null!=n&&this.disposeData(n.dataId),s=this.convertAndCacheOnCPU(a,p),t=this.pendingRead.get(a),this.pendingRead.delete(a),t.forEach(function(a){return a(s)}),this.pendingDisposal.has(a)&&(this.pendingDisposal.delete(a),this.disposeData(a),this.pendingDeletes--),[2,s]}})})},b.prototype.checkNumericalProblems=function(a){if(null!=a)for(var b=0;b<a.length;b++){var c=a[b];if(!ri(c)){if(pV.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+c+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+c+" cannot be represented on this device.")}}},b.prototype.getValuesFromTexture=function(a){var b,c=this.texData.get(a),d=c.shape,e=c.dtype,f=c.isPacked,g=p7(d);if(pV.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var h=this.decode(a),i=this.texData.get(h.dataId),j=(b=this.gpgpu).downloadMatrixFromPackedTexture.apply(b,[i.texture].concat(re(d))).subarray(0,g);return this.disposeData(h.dataId),j}var k=pV.getBool("WEBGL_PACK")&&!0===f,l=k?rL(d):d,m=k?new uQ(l):new uP(l),n=this.runWebGLProgram(m,[{shape:l,dtype:e,dataId:a}],"float32"),o=this.texData.get(n.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(o.texture,o.texShape[0],o.texShape[1]).subarray(0,g);return this.disposeData(n.dataId),p},b.prototype.time=function(a){return pS(this,void 0,void 0,function(){var b,c,d,e,f,g,h;return pT(this,function(i){switch(i.label){case 0:return b=this.activeTimers,c=[],d=!1,null==this.programTimersStack?(this.programTimersStack=c,d=!0):this.activeTimers.push(c),this.activeTimers=c,a(),e=p6(this.activeTimers.map(function(a){return a.query})).filter(function(a){return null!=a}),f=p6(this.activeTimers.map(function(a){return a.name})).filter(function(a){return null!=a}),this.activeTimers=b,d&&(this.programTimersStack=null),g={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(e)]:[3,2];case 1:return h=i.sent(),g.kernelMs=p2(h),g.getExtraProfileInfo=function(){return h.map(function(a,b){return{name:f[b],ms:a}}).map(function(a){return a.name+": "+a.ms}).join(", ")},[3,3];case 2:g.kernelMs={error:"WebGL query timers are not supported in this environment."},i.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,g]}})})},b.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},b.prototype.startTimer=function(){return pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:qA(),endMs:null}},b.prototype.endTimer=function(a){return pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.endQuery():a.endMs=qA(),a},b.prototype.getQueryTime=function(a){return pS(this,void 0,void 0,function(){var b;return pT(this,function(c){return pV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(a)]:[2,(b=a).endMs-b.startMs]})})},b.prototype.disposeData=function(a){if(!this.pendingDisposal.has(a)){if(this.pendingRead.has(a))return this.pendingDisposal.add(a),void this.pendingDeletes++;if(this.texData.has(a)){this.releaseGPUData(a);var b=this.texData.get(a).complexTensors;null!=b&&(b.real.dispose(),b.imag.dispose()),this.texData.delete(a)}}},b.prototype.releaseGPUData=function(a){var b=this.texData.get(a),c=b.texture,d=b.dtype,e=b.texShape,f=b.usage,g=b.isPacked,h=b.slice,i=h&&h.origDataId||a,j=this.dataRefCount.get(i);j>1?this.dataRefCount.set(i,j-1):(this.dataRefCount.delete(i),null!=c&&(this.numBytesInGPU-=this.computeBytes(e,d),this.textureManager.releaseTexture(c,e,f,g)));var k=this.texData.get(a);k.texture=null,k.texShape=null,k.isPacked=!1,k.slice=null},b.prototype.getTexture=function(a){return this.uploadToGPU(a),this.texData.get(a).texture},b.prototype.getDataInfo=function(a){return this.texData.get(a)},b.prototype.getCPUBackend=function(){return pV.getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=q4.findBackend("cpu")),this.cpuBackend):null},b.prototype.shouldExecuteOnCPU=function(a,b){var c=this;return void 0===b&&(b=128),null!=this.getCPUBackend()&&a.every(function(a){return null==c.texData.get(a.dataId).texture&&a.size<b})},b.prototype.getGPGPUContext=function(){return this.gpgpu},b.prototype.complex=function(a,b){var c=this.makeOutput(a.shape,"complex64");return this.texData.get(c.dataId).complexTensors={real:q4.keep(a.clone()),imag:q4.keep(b.clone())},c},b.prototype.real=function(a){return this.texData.get(a.dataId).complexTensors.real.clone()},b.prototype.imag=function(a){return this.texData.get(a.dataId).complexTensors.imag.clone()},b.prototype.slice=function(a,b,c){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.slice(a,b,c);if(0===p7(c))return sj([],c,a.dtype);var d=this.texData.get(a.dataId).isPacked,e=ts(a.shape,b,c);if(d||!e){var f=pV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vH(c):new vF(c),g=f.getCustomSetupFunc(b);return this.compileAndRun(f,[a],null,g)}return this.uploadToGPU(a.dataId),this.shallowSlice(a,b,c)},b.prototype.shallowSlice=function(a,b,c){var d=this.texData.get(a.dataId),e=this.makeOutput(c,a.dtype),f=this.texData.get(e.dataId);Object.assign(f,d),f.shape=c,f.dtype=a.dtype;var g=tt(b,a.strides);d.slice&&(g+=d.slice.flatOffset),f.slice={flatOffset:g,origDataId:d.slice&&d.slice.origDataId||a.dataId};var h=this.dataRefCount.get(f.slice.origDataId)||1;return this.dataRefCount.set(f.slice.origDataId,h+1),e},b.prototype.stridedSlice=function(a,b,c,d){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.stridedSlice(a,b,c,d);var e=tp(b,c,d);if(e.some(function(a){return 0===a}))return sj([],e);var f=new vI(b,d,e);return this.compileAndRun(f,[a])},b.prototype.reverse=function(a,b){var c=pV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vB(a.shape,b):new vA(a.shape,b);return this.compileAndRun(c,[a])},b.prototype.concat=function(a,b){if("complex64"===a[0].dtype){var c=a.map(function(a){return sh(a)}),d=a.map(function(a){return si(a)});return sg(this.concat(c,b),this.concat(d,b))}if(this.shouldExecuteOnCPU(a))return this.cpuBackend.concat(a,b);if(1===a.length)return a[0];if(a.length>pV.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(a.length/2),f=this.concat(a.slice(0,e),b),g=this.concat(a.slice(e),b);return this.concat([f,g],b)}if(pV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&a[0].rank>1){var h=new uw(a.map(function(a){return a.shape}),b);return this.compileAndRun(h,a)}var i=se(a.map(function(a){return a.shape}),b),j=a.map(function(a){return a.as2D(-1,p7(a.shape.slice(b)))}),k=new uv(j.map(function(a){return a.shape}));return this.compileAndRun(k,j).reshape(i)},b.prototype.neg=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.neg(a);if(pV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,vV,a.dtype);var b=new vP(a.shape,vV);return this.compileAndRun(b,[a])},b.prototype.batchMatMul=function(a,b,c,d){var e=c?a.shape[2]:a.shape[1],f=d?b.shape[1]:b.shape[2],g=c?a.shape[1]:a.shape[2],h=a.shape[0];if((1===e||1===f)&&g>1e3){c&&(a=a.transpose([0,2,1])),d&&(b=b.transpose([0,2,1]));var i=1===f?a:a.as3D(h,g,1),j=1===f?2:1,k=1===f?b.as3D(h,1,g):b;return this.multiply(i,k).sum(j,!0)}var l=qY(a.dtype,b.dtype),m=new vl(a.shape,[h,e,f],c,d);return this.compileAndRun(m,[a,b],l)},b.prototype.fusedBatchMatMul=function(a){var b=a.a,c=a.b,d=a.transposeA,e=a.transposeB,f=a.bias,g=a.activation,h=a.preluActivationWeights,i=d?b.shape[2]:b.shape[1],j=e?c.shape[1]:c.shape[2],k=b.shape[0],l=qY(b.dtype,c.dtype),m=g?wd(g,!0):null,n=new vl(b.shape,[k,i,j],d,e,null!=f,m,null!=h),o=[b,c];return f&&o.push(f),h&&o.push(h),this.compileAndRun(n,o,l)},b.prototype.multiply=function(a,b){if("complex64"===a.dtype){var c=this.texData.get(a.dataId),d=this.texData.get(b.dataId),e=new uk("return areal * breal - aimag * bimag;",a.shape,b.shape),f=new uk("return areal * bimag + aimag * breal;",a.shape,b.shape),g=[this.makeComplexComponentTensorInfo(a,c.complexTensors.real),this.makeComplexComponentTensorInfo(a,c.complexTensors.imag),this.makeComplexComponentTensorInfo(b,d.complexTensors.real),this.makeComplexComponentTensorInfo(b,d.complexTensors.imag)],h=this.compileAndRun(e,g),i=this.compileAndRun(f,g),j=this.complex(h,i);return h.dispose(),i.dispose(),j}if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.multiply(a,b);if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,un,a.dtype);var k=new up(un,a.shape,b.shape);return this.compileAndRun(k,[a,b],a.dtype)},b.prototype.batchNormalization=function(a,b,c,d,e,f){var g=[a,b,c],h=null;null!=f&&(h=f.shape,g.push(f));var i=null;if(null!=e&&(i=e.shape,g.push(e)),pV.getBool("WEBGL_PACK_NORMALIZATION")){var j=new uj(a.shape,b.shape,c.shape,h,i,d);return this.compileAndRun(j,g)}var k=new ui(a.shape,b.shape,c.shape,h,i,d);return this.compileAndRun(k,g)},b.prototype.localResponseNormalization4D=function(a,b,c,d,e){var f=pV.getBool("WEBGL_PACK_NORMALIZATION")?new vi(a.shape,b,c,d,e):new vg(a.shape,b,c,d,e);return this.compileAndRun(f,[a])},b.prototype.LRNGrad=function(a,b,c,d,e,f,g){var h=new vh(b.shape,d,e,f,g);return this.compileAndRun(h,[b,c,a])},b.prototype.tile=function(a,b){if("string"===a.dtype){var c=this.readSync(a.dataId).map(function(a){return qD(a)});return t$(sO(a.shape,a.dtype,c),b)}var d=new vM(a.shape,b);return this.compileAndRun(d,[a])},b.prototype.pad=function(a,b,c){var d=pV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vq(a.shape,b,c):new vp(a.shape,b,c);return this.compileAndRun(d,[a])},b.prototype.transpose=function(a,b){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.transpose(a,b);var c=pV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vO(a.shape,b):new vN(a.shape,b);return this.compileAndRun(c,[a])},b.prototype.gather=function(a,b,c){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.gather(a,b,c);var d=new uV(a.shape,b.size,c);return this.compileAndRun(d,[a,b])},b.prototype.batchToSpaceND=function(a,b,c){p3(a.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var d=b.reduce(function(a,b){return a*b}),e=td(a.shape,b,d),f=te(e.length,b.length),g=tf(a.shape,b,d),h=tg(c,b.length),i=th(g,c,b.length);return a.reshape(e).transpose(f).reshape(g).slice(h,i)},b.prototype.spaceToBatchND=function(a,b,c){p3(a.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var d=b.reduce(function(a,b){return a*b}),e=[[0,0]];e.push.apply(e,c);for(var f=1+b.length;f<a.shape.length;++f)e.push([0,0]);var g=a.pad(e),h=td(g.shape,b,d,!1),i=te(h.length,b.length,!1),j=tf(g.shape,b,d,!1);return g.reshape(h).transpose(i).reshape(j)},b.prototype.reduce=function(a,b,c){var d=a.shape[0],e=a.shape[1],f=new vt({windowSize:tj(e),inSize:e,batchSize:d},b),g=this.compileAndRun(f,[a],c);return 1===g.shape[1]?g:this.reduce(g,b,c)},b.prototype.argReduce=function(a,b,c){void 0===c&&(c=null);var d=a.shape[0],e=a.shape[1];null!=c&&(d=c.shape[0],e=c.shape[1]);var f=new t3({windowSize:tj(e),inSize:e,batchSize:d},b,null==c),g=[a];null!=c&&g.push(c);var h=this.compileAndRun(f,g,"int32");return 1===h.shape[1]?h:this.argReduce(a,b,h)},b.prototype.argReducePacked=function(a,b,c){void 0===c&&(c=null);var d=null!=c?c.shape:a.shape,e=tj(d[d.length-1]),f=new uf(d,e,b,null==c),g=null==c?[a]:[a,c],h=this.compileAndRun(f,g,"int32");return h.rank===a.rank?this.argReducePacked(a,b,h):h},b.prototype.sum=function(a,b){r9("sum",b,a.rank);var c=r7(a.shape,b),d=c[0],e=p7(c[1]),f=a.as2D(-1,e),g=qZ(a.dtype);return this.reduce(f,"sum",g).reshape(d)},b.prototype.prod=function(a,b){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.prod(a,b);var c=r7(a.shape,b),d=c[0],e=p7(c[1]),f=a.as2D(-1,e),g=qZ(a.dtype);return this.reduce(f,"prod",g).reshape(d)},b.prototype.unsortedSegmentSum=function(a,b,c){var d=0,e=sa([0],a.rank),f=a;null!=e&&(f=a.transpose(e),d=sc(1,a.rank)[0]);var g=function(a,b,c){for(var d=[],e=a.length,f=0;f<e;f++)f!==b?d.push(a[f]):d.push(c);return d}(f.shape,d,c),h=p7([f.shape[d]]),i=f.as2D(-1,h),j=qZ(a.dtype),k=this.segOpCompute(i,"unsortedSegmentSum",b,j,c).reshape(g);return null!=e&&(k=k.transpose(sb(e))),k},b.prototype.segOpCompute=function(a,b,c,d,e){var f=a.shape[0],g=a.shape[1],h=function(a,b){var c,d=!1;for(a<=30?(c=a,d=!0):c=qu(a,Math.floor(Math.sqrt(a)));!d;)c>b||c===a?d=!0:c=qu(a,c+1);return c}(g,e),i=new vD({windowSize:h,inSize:g,batchSize:f,numSegments:e},b),j=this.compileAndRun(i,[a,c],d);return j.shape[1]===e?j:(c=st(0,e).tile([g/h]),this.segOpCompute(j,b,c,d,e))},b.prototype.argMinMaxReduce=function(a,b,c){var d=[b];if(r9("arg"+c.charAt(0).toUpperCase()+c.slice(1),d,a.rank),!pV.getBool("WEBGL_PACK_REDUCE")||a.rank<=2){var e=r7(a.shape,d),f=e[0],g=p7(e[1]),h=a.as2D(-1,g);return this.argReduce(h,c).reshape(f)}return this.argReducePacked(a,c)},b.prototype.argMin=function(a,b){return this.argMinMaxReduce(a,b,"min")},b.prototype.argMax=function(a,b){return this.argMinMaxReduce(a,b,"max")},b.prototype.cumsum=function(a,b,c,d){if(b!==a.rank-1)throw Error("WebGL cumsum shader expects an inner-most axis="+(a.rank-1)+" but got axis="+b);var e=new uJ(a.shape,c,d);return this.compileAndRun(e,[a])},b.prototype.equal=function(a,b){if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  return vec4(equal(a, b));\n","bool");var c=new up("return float(a == b);",a.shape,b.shape);return this.compileAndRun(c,[a,b],"bool")},b.prototype.notEqual=function(a,b){if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  return vec4(notEqual(a, b));\n","bool");var c=new up("return float(a != b);",a.shape,b.shape);return this.compileAndRun(c,[a,b],"bool")},b.prototype.less=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.less(a,b);if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  return vec4(lessThan(a, b));\n","bool");var c=new up("return float(a < b);",a.shape,b.shape);return this.compileAndRun(c,[a,b],"bool")},b.prototype.lessEqual=function(a,b){if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  return vec4(lessThanEqual(a, b));\n","bool");var c=new up("return float(a <= b);",a.shape,b.shape);return this.compileAndRun(c,[a,b],"bool")},b.prototype.greater=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.greater(a,b);if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  return vec4(greaterThan(a, b));\n","bool");var c=new up("return float(a > b);",a.shape,b.shape);return this.compileAndRun(c,[a,b],"bool")},b.prototype.greaterEqual=function(a,b){if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var c=new up("return float(a >= b);",a.shape,b.shape);return this.compileAndRun(c,[a,b],"bool")},b.prototype.logicalNot=function(a){var b=new vP(a.shape,"return float(!(x >= 1.0));");return this.compileAndRun(b,[a])},b.prototype.logicalAnd=function(a,b){if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var c=new up("return float(a >= 1.0 && b >= 1.0);",a.shape,b.shape);return this.compileAndRun(c,[a,b],"bool")},b.prototype.logicalOr=function(a,b){if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var c=new up("return float(a >= 1.0 || b >= 1.0);",a.shape,b.shape);return this.compileAndRun(c,[a,b],"bool")},b.prototype.select=function(a,b,c){var d=new vE(a.rank,b.shape,b.rank);return this.compileAndRun(d,[a,b,c],qY(b.dtype,c.dtype))},b.prototype.where=function(a){r0("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var b=a.dataSync();return t0(a.shape,b)},b.prototype.topk=function(a,b,c){return t_(a.dataSync(),a.shape,a.dtype,b)},b.prototype.min=function(a,b){r9("min",b,a.rank);var c=r7(a.shape,b),d=c[0],e=p7(c[1]),f=a.as2D(-1,e);return this.reduce(f,"min",f.dtype).reshape(d)},b.prototype.minimum=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.minimum(a,b);var c=pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ur("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",a.shape,b.shape):new up("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",a.shape,b.shape);return this.compileAndRun(c,[a,b])},b.prototype.mod=function(a,b){var c=pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ur("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",a.shape,b.shape):new up("if (b == 0.0) return NAN;\n  return mod(a, b);",a.shape,b.shape);return this.compileAndRun(c,[a,b])},b.prototype.max=function(a,b){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.max(a,b);r9("max",b,a.rank);var c=r7(a.shape,b),d=c[0],e=p7(c[1]),f=a.as2D(-1,e);return this.reduce(f,"max",f.dtype).reshape(d)},b.prototype.maximum=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.maximum(a,b);var c=pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ur("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",a.shape,b.shape):new up("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",a.shape,b.shape);return this.compileAndRun(c,[a,b])},b.prototype.all=function(a,b){r9("all",b,a.rank);var c=r7(a.shape,b),d=c[0],e=p7(c[1]),f=a.as2D(-1,e);return this.reduce(f,"all",f.dtype).reshape(d)},b.prototype.any=function(a,b){r9("any",b,a.rank);var c=r7(a.shape,b),d=c[0],e=p7(c[1]),f=a.as2D(-1,e);return this.reduce(f,"any",f.dtype).reshape(d)},b.prototype.realDivide=function(a,b){if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var c=new up("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",a.shape,b.shape);return this.compileAndRun(c,[a,b],"float32")},b.prototype.floorDiv=function(a,b){if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var c=new up("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",a.shape,b.shape);return this.compileAndRun(c,[a,b],"int32")},b.prototype.add=function(a,b){if("complex64"===a.dtype&&"complex64"===b.dtype)return this.complexSeparableBinaryOp(a,b,ul);if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.add(a,b);var c=qY(a.dtype,b.dtype);if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,ul,c);var d=new up(ul,a.shape,b.shape);return this.compileAndRun(d,[a,b],c)},b.prototype.packedUnaryOp=function(a,b,c){var d=new wa(a.shape,b);return this.compileAndRun(d,[a],c)},b.prototype.packedBinaryOp=function(a,b,c,d,e){void 0===e&&(e=!1);var f=new ur(c,a.shape,b.shape,e);return this.compileAndRun(f,[a,b],d)},b.prototype.complexSeparableBinaryOp=function(a,b,c){var d=this,e=this.texData.get(a.dataId),f=this.texData.get(b.dataId),g=[[e.complexTensors.real,f.complexTensors.real],[e.complexTensors.imag,f.complexTensors.imag]].map(function(e){var f=e[0],g=e[1],h=d.makeComplexComponentTensorInfo(a,f),i=d.makeComplexComponentTensorInfo(b,g),j=new up(c,a.shape,b.shape);return d.compileAndRun(j,[h,i],qY(f.dtype,g.dtype))}),h=g[0],i=g[1],j=this.complex(h,i);return h.dispose(),i.dispose(),j},b.prototype.makeComplexComponentTensorInfo=function(a,b){return{dataId:b.dataId,dtype:b.dtype,shape:a.shape}},b.prototype.addN=function(a){if(1===a.length)return a[0];if(a.length>pV.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var b=Math.floor(a.length/2),c=this.addN(a.slice(0,b)),d=this.addN(a.slice(b));return this.addN([c,d])}var e=a.map(function(a){return a.dtype}).reduce(function(a,b){return qY(a,b)}),f=a.map(function(a){return a.shape}),g=pV.getBool("WEBGL_PACK")?new t2(a[0].shape,f):new t1(a[0].shape,f);return this.compileAndRun(g,a,e)},b.prototype.subtract=function(a,b){if("complex64"===a.dtype&&"complex64"===b.dtype)return this.complexSeparableBinaryOp(a,b,um);if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.subtract(a,b);var c=qY(a.dtype,b.dtype);if(pV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,um,a.dtype);var d=new up(um,a.shape,b.shape);return this.compileAndRun(d,[a,b],c)},b.prototype.pow=function(a,b){var c=pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ur("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",a.shape,b.shape):new up("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",a.shape,b.shape),d=qY(a.dtype,b.dtype);return this.compileAndRun(c,[a,b],d)},b.prototype.ceil=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.ceil(a);if(pV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,vW,a.dtype);var b=new vP(a.shape,vW);return this.compileAndRun(b,[a])},b.prototype.floor=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.floor(a);if(pV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,vX,a.dtype);var b=new vP(a.shape,vX);return this.compileAndRun(b,[a])},b.prototype.sign=function(a){var b=new vP(a.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(b,[a])},b.prototype.isNaN=function(a){var b=new vP(a.shape,"return float(isnan(x));");return this.compileAndRun(b,[a],"bool")},b.prototype.isInf=function(a){var b=new vP(a.shape,"return float(isinf(x));");return this.compileAndRun(b,[a],"bool")},b.prototype.isFinite=function(a){var b=new vP(a.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(b,[a],"bool")},b.prototype.round=function(a){var b=new vP(a.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(b,[a])},b.prototype.exp=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.exp(a);if(pV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,vY,a.dtype);var b=new vP(a.shape,vY);return this.compileAndRun(b,[a])},b.prototype.expm1=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.expm1(a);if(pV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,vZ,a.dtype);var b=new vP(a.shape,vZ);return this.compileAndRun(b,[a])},b.prototype.softmax=function(a,b){var c=qf([b],a.shape),d=this.max(a,c),e=r8(d.shape,c),f=this.subtract(a,d.reshape(e)),g=this.exp(f),h=this.sum(g,c).reshape(e);return this.realDivide(g,h)},b.prototype.log=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.log(a);if(pV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",a.dtype);var b=new vP(a.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(b,[a])},b.prototype.log1p=function(a){var b=new vP(a.shape,"return log(1.0 + x);");return this.compileAndRun(b,[a])},b.prototype.sqrt=function(a){var b=new vP(a.shape,"return sqrt(x);");return this.compileAndRun(b,[a])},b.prototype.rsqrt=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.rsqrt(a);var b=new vP(a.shape,"return inversesqrt(x);");return this.compileAndRun(b,[a])},b.prototype.reciprocal=function(a){var b=new vP(a.shape,"return 1.0 / x;");return this.compileAndRun(b,[a])},b.prototype.relu=function(a){var b;return b=pV.getBool("WEBGL_PACK")?new wa(a.shape,v7):new vP(a.shape,vS),this.compileAndRun(b,[a])},b.prototype.relu6=function(a){var b;return b=pV.getBool("WEBGL_PACK")?new wa(a.shape,v8):new vP(a.shape,vT),this.compileAndRun(b,[a])},b.prototype.prelu=function(a,b){var c=pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ur(uq,a.shape,b.shape):new up(uo,a.shape,b.shape);return this.compileAndRun(c,[a,b])},b.prototype.elu=function(a){if(pV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,v9,a.dtype);var b=new vP(a.shape,vU);return this.compileAndRun(b,[a])},b.prototype.eluDer=function(a,b){var c=pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ur("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",a.shape,b.shape):new up("return (b >= 1.0) ? a : a * (b + 1.0);",a.shape,b.shape);return this.compileAndRun(c,[a,b])},b.prototype.selu=function(a){var b=new vP(a.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(b,[a])},b.prototype.int=function(a){var b=new vP(a.shape,"return float(int(x));");return this.compileAndRun(b,[a],"int32")},b.prototype.clip=function(a,b,c){var d,e=(d=pV.getBool("WEBGL_PACK_CLIP")?new ut(a.shape):new us(a.shape)).getCustomSetupFunc(b,c);return this.compileAndRun(d,[a],null,e)},b.prototype.abs=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.abs(a);if(pV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(a,vR,a.dtype);var b=new vP(a.shape,vR);return this.compileAndRun(b,[a])},b.prototype.complexAbs=function(a){var b=this.texData.get(a.dataId),c=new uu(a.shape),d=[this.makeComplexComponentTensorInfo(a,b.complexTensors.real),this.makeComplexComponentTensorInfo(a,b.complexTensors.imag)];return this.compileAndRun(c,d)},b.prototype.sigmoid=function(a){var b=new vP(a.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(b,[a])},b.prototype.softplus=function(a){var b=new vP(a.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(b,[a])},b.prototype.sin=function(a){var b=new vP(a.shape,v$);return this.compileAndRun(b,[a])},b.prototype.cos=function(a){var b=new vP(a.shape,v_);return this.compileAndRun(b,[a])},b.prototype.tan=function(a){var b=new vP(a.shape,"return tan(x);");return this.compileAndRun(b,[a])},b.prototype.asin=function(a){var b=new vP(a.shape,v0);return this.compileAndRun(b,[a])},b.prototype.acos=function(a){var b=new vP(a.shape,v1);return this.compileAndRun(b,[a])},b.prototype.atan=function(a){var b=new vP(a.shape,v2);return this.compileAndRun(b,[a])},b.prototype.atan2=function(a,b){var c=pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ur("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",a.shape,b.shape):new up("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",a.shape,b.shape);return this.compileAndRun(c,[a,b])},b.prototype.sinh=function(a){var b=new vP(a.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(b,[a])},b.prototype.cosh=function(a){var b=new vP(a.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(b,[a])},b.prototype.tanh=function(a){var b=new vP(a.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(b,[a])},b.prototype.asinh=function(a){var b=new vP(a.shape,v3);return this.compileAndRun(b,[a])},b.prototype.acosh=function(a){var b=new vP(a.shape,v4);return this.compileAndRun(b,[a])},b.prototype.atanh=function(a){var b=new vP(a.shape,v5);return this.compileAndRun(b,[a])},b.prototype.erf=function(a){var b=new vP(a.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(b,[a])},b.prototype.step=function(a,b){var c,d=new vP(a.shape,(void 0===(c=b)&&(c=0),vQ+"\n    return x > 0.0 ? 1.0 : float("+c+");\n  "));return this.compileAndRun(d,[a])},b.prototype.conv2dByMatMul=function(a,b,c,d,e,f){var g=a.shape,h=this.texData.get(a.dataId),i=c.inChannels,j=g[0]*g[1]*g[2],k=c.outChannels,l="channelsLast"===c.dataFormat,m=g[2]%2!=0&&!!h.isPacked;if((1===j||1===k)&&i>1e3||!pV.getBool("WEBGL_LAZILY_UNPACK")||!pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var n=l?g[0]*g[1]*g[2]:g[0]*g[2]*g[3],o=this.reshape(a,[1,n,c.inChannels]),p=this.reshape(b,[1,c.inChannels,c.outChannels]);return this.reshape(this.fusedBatchMatMul({a:o,b:p,transposeA:!1,transposeB:!1,bias:d,activation:e,preluActivationWeights:f}),c.outShape)}var q=l?g[0]*g[1]*(g[2]+1):g[0]*g[2]*(g[3]+1),r={dataId:a.dataId,shape:[1,q,c.inChannels],dtype:a.dtype},s=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,p3(rN(h.shape,r.shape),function(){return"packed reshape "+h.shape+" to "+r.shape+" isn't free"});var t=this.reshape(b,[1,c.inChannels,c.outChannels]),u=this.fusedBatchMatMul({a:r,b:t,transposeA:!1,transposeB:!1,bias:d,activation:e,preluActivationWeights:f}),v=this.texData.get(u.dataId);return p3(v.isPacked,function(){return"batchMatMul result is expected to be packed"}),h.shape=s,v.shape=c.outShape,q4.makeTensorFromDataId(u.dataId,c.outShape,u.dtype)},b.prototype.conv2dWithIm2Row=function(a,b,c,d,e,f){var g=c.filterWidth,h=c.filterHeight,i=c.inChannels,j=c.outWidth,k=c.outHeight,l="channelsLast"===c.dataFormat,m=g*h*i,n=k*j,o=[m,n],p=a.squeeze([0]),q=b.reshape([1,m,-1]),r=new vf(o,p.shape,c),s=this.compileAndRun(r,[p]).reshape([1,o[0],o[1]]),t=null!=f,u=e?wd(e,!0):null,v=new vl(s.shape,[1,n,c.outChannels],!0,!1,null!=d,u,t),w=[s,q];d&&w.push(d),t&&w.push(f);var x=this.compileAndRun(v,w);return l?x.reshape([1,k,j,c.outChannels]):x.reshape([1,c.outChannels,k,j])},b.prototype.fusedConv2d=function(a){var b=a.input,c=a.filter,d=a.convInfo,e=a.bias,f=a.activation,g=a.preluActivationWeights;if(1===d.filterHeight&&1===d.filterWidth&&1===d.dilationHeight&&1===d.dilationWidth&&1===d.strideHeight&&1===d.strideWidth&&("SAME"===d.padInfo.type||"VALID"===d.padInfo.type))return this.conv2dByMatMul(b,c,d,e,f,g);if(pV.getBool("WEBGL_CONV_IM2COL")&&1===b.shape[0])return this.conv2dWithIm2Row(b,c,d,e,f,g);var h=null!=g,i=new uE(d,null!=e,f?wd(f,!1):null,h),j=[b,c];return e&&j.push(e),g&&j.push(g),this.compileAndRun(i,j)},b.prototype.conv2d=function(a,b,c){if(1===c.filterHeight&&1===c.filterWidth&&1===c.dilationHeight&&1===c.dilationWidth&&1===c.strideHeight&&1===c.strideWidth&&("SAME"===c.padInfo.type||"VALID"===c.padInfo.type))return this.conv2dByMatMul(a,b,c);if(pV.getBool("WEBGL_CONV_IM2COL")&&1===a.shape[0])return this.conv2dWithIm2Row(a,b,c);var d=new uE(c);return this.compileAndRun(d,[a,b])},b.prototype.conv2dDerInput=function(a,b,c){var d=new uz(c);return this.compileAndRun(d,[a,b])},b.prototype.conv2dDerFilter=function(a,b,c){var d=new uy(c);return this.compileAndRun(d,[a,b])},b.prototype.fusedDepthwiseConv2D=function(a){var b,c=a.input,d=a.filter,e=a.convInfo,f=a.bias,g=a.activation,h=a.preluActivationWeights,i=pV.getBool("WEBGL_PACK_DEPTHWISECONV")&&e.strideWidth<=2&&e.outChannels/e.inChannels==1,j=g?wd(g,i):null,k=[c,d],l=null!=f,m=null!=h;return l&&k.push(f),m&&k.push(h),b=i?new uH(e,l,j,m):new uG(e,l,j,m),this.compileAndRun(b,k)},b.prototype.depthwiseConv2D=function(a,b,c){var d;return d=pV.getBool("WEBGL_PACK_DEPTHWISECONV")&&c.strideWidth<=2&&c.outChannels/c.inChannels==1?new uH(c):new uG(c),this.compileAndRun(d,[a,b])},b.prototype.depthwiseConv2DDerInput=function(a,b,c){var d=new uD(c);return this.compileAndRun(d,[a,b])},b.prototype.depthwiseConv2DDerFilter=function(a,b,c){var d=new uC(c);return this.compileAndRun(d,[a,b])},b.prototype.conv3d=function(a,b,c){var d=new uF(c);return this.compileAndRun(d,[a,b])},b.prototype.conv3dDerInput=function(a,b,c){var d=new uB(c);return this.compileAndRun(d,[a,b])},b.prototype.conv3dDerFilter=function(a,b,c){var d=new uA(c);return this.compileAndRun(d,[a,b])},b.prototype.maxPool=function(a,b){var c=new vr(b,"max",!1);return this.compileAndRun(c,[a])},b.prototype.avgPool=function(a,b){var c=new vr(b,"avg",!1);return this.compileAndRun(c,[a],"float32")},b.prototype.maxPoolBackprop=function(a,b,c,d){var e=new vr(d,"max",!0),f=this.compileAndRun(e,[b]),g=new vj(d),h=this.compileAndRun(g,[a,f],b.dtype);return f.dispose(),h},b.prototype.avgPoolBackprop=function(a,b,c){var d=new ug(c);return this.compileAndRun(d,[a],b.dtype)},b.prototype.cast=function(a,b){return tP(a,b,this)},b.prototype.unstack=function(a,b){for(var c=a.shape[b],d=Array(a.rank-1),e=0,f=0;f<a.rank;f++)f!==b&&(d[e++]=a.shape[f]);var g=Array(a.rank).fill(0),h=a.shape.slice();h[b]=1;var i=Array(c);for(f=0;f<i.length;f++)g[b]=f,i[f]=this.slice(a,g,h).reshape(d);return i},b.prototype.avgPool3d=function(a,b){var c=new vs(b,"avg",!1);return this.compileAndRun(c,[a],"float32")},b.prototype.avgPool3dBackprop=function(a,b,c){var d=new uh(c);return this.compileAndRun(d,[a],b.dtype)},b.prototype.maxPool3d=function(a,b){var c=new vs(b,"max",!1);return this.compileAndRun(c,[a],"float32")},b.prototype.maxPool3dBackprop=function(a,b,c,d){var e=new vs(d,"max",!0),f=this.compileAndRun(e,[b]),g=new vk(d),h=this.compileAndRun(g,[a,f],b.dtype);return f.dispose(),h},b.prototype.reshape=function(a,b){var c=this.texData.get(a.dataId);if(c.isPacked&&!rN(a.shape,b)&&(null===c.texture||!rN(c.shape,b))){var d=this.packedReshape(a,b);return q4.makeTensorFromDataId(d.dataId,d.shape,d.dtype)}return tQ(a,b)},b.prototype.resizeBilinear=function(a,b,c,d){var e=pV.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new vx(a.shape,b,c,d):new vw(a.shape,b,c,d);return this.compileAndRun(e,[a],"float32")},b.prototype.resizeBilinearBackprop=function(a,b,c){var d=new vv(a,b,c);return this.compileAndRun(d,[a])},b.prototype.resizeNearestNeighbor=function(a,b,c,d){var e=new vz(a.shape,b,c,d);return this.compileAndRun(e,[a])},b.prototype.resizeNearestNeighborBackprop=function(a,b,c){var d=new vy(a,b,c);return this.compileAndRun(d,[a])},b.prototype.multinomial=function(a,b,c,d){var e=b?a:tv(a),f=new vm(e.shape[0],e.shape[1],c),g=f.getCustomSetupFunc(d);return this.compileAndRun(f,[e],"int32",g)},b.prototype.oneHot=function(a,b,c,d){var e=new vn(a.size,b,c,d);return this.compileAndRun(e,[a])},b.prototype.diag=function(a){var b=new uO(a.size);return this.compileAndRun(b,[a])},b.prototype.nonMaxSuppression=function(a,b,c,d,e){return r0("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),tV(a.dataSync(),b.dataSync(),c,d,e)},b.prototype.cropAndResize=function(a,b,c,d,e,f){var g=new uI(a.shape,b.shape,d,e,f);return this.compileAndRun(g,[a,b,c],"float32")},b.prototype.depthToSpace=function(a,b,c){p3(b>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+b});var d=a.shape[0],e="NHWC"===c?a.shape[1]:a.shape[2],f="NHWC"===c?a.shape[2]:a.shape[3],g="NHWC"===c?a.shape[3]:a.shape[1],h=e*b,i=f*b,j=g/(b*b),k=new uN("NHWC"===c?[d,h,i,j]:[d,j,h,i],b,c);return this.compileAndRun(k,[a])},b.prototype.split=function(a,b,c){return tZ(a,b,c)},b.prototype.scatterND=function(a,b,c){var d=tm(0,a,c),e=d.sliceRank,f=d.numUpdates,g=d.sliceSize,h=d.strides,i=d.outputSize,j=[i/g,g],k=a.reshape([f,e]),l=b.reshape([f,g]);if(0===i)return tQ(sj([]),c);var m=sl(0),n=new vC(f,e,k.rank,l.rank,h,j);return this.compileAndRun(n,[l,k,m]).reshape(c)},b.prototype.sparseToDense=function(a,b,c,d){var e=tm(0,a,c),f=e.sliceRank,g=e.numUpdates,h=e.strides,i=e.outputSize,j=new vC(g,f,a.rank,b.rank,h,[i,1],!1);return this.compileAndRun(j,[b,a,d]).reshape(c)},b.prototype.fft=function(a){return this.fftImpl(a,!1)},b.prototype.ifft=function(a){return this.fftImpl(a,!0)},b.prototype.fftImpl=function(a,b){var c=this.texData.get(a.dataId),d=new uT("return real * expR - imag * expI;",a.shape,b),e=new uT("return real * expI + imag * expR;",a.shape,b),f=[this.makeComplexComponentTensorInfo(a,c.complexTensors.real),this.makeComplexComponentTensorInfo(a,c.complexTensors.imag)],g=this.compileAndRun(d,f),h=this.compileAndRun(e,f),i=this.complex(g,h).as2D(a.shape[0],a.shape[1]);return g.dispose(),h.dispose(),i},b.prototype.gatherND=function(a,b){var c=b.shape,d=c[c.length-1],e=ti(a,b),f=e[0],g=e[1],h=e[2],i=e[3],j=b.reshape([g,d]),k=a.reshape([a.size/h,h]),l=new uW(d,i,[g,h]);return this.compileAndRun(l,[k,j]).reshape(f)},b.prototype.fill=function(a,b,c){if("string"===(c=c||qs(b))){var d=qi(c,p7(a));return d.fill(b),q4.makeTensor(d,a,c,this)}var e=new uU(a,b),f=e.getCustomSetupFunc(b);return this.compileAndRun(e,[],c,f)},b.prototype.onesLike=function(a){if("string"===a.dtype)throw Error("onesLike is not supported under string dtype");return this.fill(a.shape,1,a.dtype)},b.prototype.zerosLike=function(a){return this.fill(a.shape,"string"===a.dtype?"":0,a.dtype)},b.prototype.linspace=function(a,b,c){return tR(a,b,c)},b.prototype.makeTensorInfo=function(a,b){var c=this.write(null,a,b);return this.texData.get(c).usage=null,{dataId:c,shape:a,dtype:b}},b.prototype.makeOutput=function(a,b){var c=this.makeTensorInfo(a,b).dataId;return q4.makeTensorFromDataId(c,a,b,this)},b.prototype.unpackTensor=function(a){var b=new wb(a.shape);return this.runWebGLProgram(b,[a],a.dtype)},b.prototype.packTensor=function(a){var b=new vo(a.shape);return this.runWebGLProgram(b,[a],a.dtype,null,!0)},b.prototype.packedReshape=function(a,b){var c=[rJ(a.shape)].concat(rK(a.shape)),d={dtype:a.dtype,shape:c,dataId:a.dataId},e=new vu([rJ(b)].concat(rK(b)),c),f=this.runWebGLProgram(e,[d],a.dtype,null,!0);return{dataId:f.dataId,shape:b,dtype:f.dtype}},b.prototype.decode=function(a){var b,c=this.texData.get(a),d=c.isPacked,e=c.shape,f=c.dtype,g=rL(e);return b=d?new uM(g):new uL(g),{dtype:f,shape:e,dataId:this.runWebGLProgram(b,[{shape:g,dtype:f,dataId:a}],f,null,!0).dataId}},b.prototype.runWebGLProgram=function(a,b,c,d,e){var f,g,h,i=this;void 0===e&&(e=!1);var j=this.makeTensorInfo(a.outputShape,c),k=this.texData.get(j.dataId);if(a.packedOutput&&(k.isPacked=!0),a.outPackingScheme===q7.DENSE&&(k.texShape=re(a.outputShape).map(function(a){return 2*a})),null!=a.outTexUsage&&(k.usage=a.outTexUsage),0===p7(j.shape))return k.values=qh(j.dtype,0),j;var l=[],m=b.map(function(b){if("complex64"===b.dtype)throw Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var c=i.texData.get(b.dataId);if(null==c.texture){if(!a.packedInputs&&p7(b.shape)<=pV.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:c.values};a.packedInputs&&(c.isPacked=!0,c.shape=b.shape)}else if(!!c.isPacked!=!!a.packedInputs)b=c.isPacked?i.unpackTensor(b):i.packTensor(b),l.push(b),c=i.texData.get(b.dataId);else if(c.isPacked&&!rN(c.shape,b.shape)){var d=b,e=b.shape;b.shape=c.shape,b=i.packedReshape(b,e),l.push(b),c=i.texData.get(b.dataId),d.shape=e}return i.uploadToGPU(b.dataId),{shape:b.shape,texData:c,isUniform:!1}});this.uploadToGPU(j.dataId);var n,o,p,q={shape:j.shape,texData:k,isUniform:!1},r=(n="",m.concat(q).forEach(function(a){var b=null!=a.texData&&null!=a.texData.slice&&a.texData.slice.flatOffset>0,c=a.isUniform?"uniform":a.texData.texShape;n+=a.shape+"_"+c+"_"+b}),o=a.userCode,a.constructor.name+("_"+n+"_")+o),s=this.getAndSaveBinary(r,function(){return function(a,b,c,d){var e=b.userCode,f=c.map(function(a,c){var d={logicalShape:a.shape,texShape:a.isUniform?null:a.texData.texShape,isUniform:a.isUniform,isPacked:!a.isUniform&&a.texData.isPacked,flatOffset:null};return null!=a.texData&&null!=a.texData.slice&&a.texData.slice.flatOffset>0&&(d.flatOffset=a.texData.slice.flatOffset),{name:b.variableNames[c],shapeInfo:d}}),g=f.map(function(a){return a.shapeInfo}),h={logicalShape:d.shape,texShape:d.texData.texShape,isUniform:!1,isPacked:d.texData.isPacked,flatOffset:null},i=function(a,b,c,d){var e=[];a.forEach(function(a){var b=p7(a.shapeInfo.logicalShape);a.shapeInfo.isUniform?e.push("uniform float "+a.name+(b>1?"["+b+"]":"")+";"):(e.push("uniform sampler2D "+a.name+";"),e.push("uniform int offset"+a.name+";"))});var f,g,h=e.join("\n"),i=a.map(function(a){var c,e,f,g;return void 0===(c=d)&&(c=!1),e=""+(c?function a(b){var c,d,e,f;switch(b.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(c=b.name).charAt(0).toUpperCase()+c.slice(1))+"() {\n      return "+t6().texture2D+"("+c+", halfCR);\n    }\n  ";case 1:return"\n    vec4 "+("get"+(d=b.name).charAt(0).toUpperCase()+d.slice(1))+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+(f=[Math.ceil((e=b.shapeInfo.texShape)[0]/2),Math.ceil(e[1]/2)])[0]+", "+f[1]+", index);\n      return "+t6().texture2D+"("+d+", uv);\n    }\n  ";case 2:return function(a){var b=a.shapeInfo.logicalShape,c=a.name,d="get"+c.charAt(0).toUpperCase()+c.slice(1),e=a.shapeInfo.texShape,f=e[0],g=e[1],h=t6();if(null!=e&&p8(b,e))return"\n      vec4 "+d+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+g+".0, "+f+".0);\n\n        return "+h.texture2D+"("+c+", uv);\n      }\n    ";var i=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return"\n    vec4 "+d+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(b[1]/2)+", "+i[0]+", "+i[1]+", row, col);\n      return "+h.texture2D+"("+c+", uv);\n    }\n  "}(b);case 3:return function(b){var c=b.shapeInfo.logicalShape,d=b.name,e="get"+d.charAt(0).toUpperCase()+d.slice(1),f=b.shapeInfo.texShape,g=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)];if(1===c[0])return"\n        "+a(ud(b,c.slice(1)))+"\n        vec4 "+e+"(int b, int row, int col) {\n          return "+e+"("+ue(["b","row","col"],[1,2])+");\n        }\n      ";var h=g[0],i=g[1],j=Math.ceil(c[2]/2);return"\n    vec4 "+e+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+h+", "+i+", "+j*Math.ceil(c[1]/2)+", "+j+", b, row, col);\n      return "+t6().texture2D+"("+d+", uv);\n    }\n  "}(b);default:return function(a){for(var b=a.shapeInfo.logicalShape,c=b.length,d=a.name,e="get"+d.charAt(0).toUpperCase()+d.slice(1),f=a.shapeInfo.texShape,g=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)],h=g[0],i=g[1],j=Math.ceil(b[c-1]/2),k=j*Math.ceil(b[c-2]/2),l="int b, int row, int col",m="b * "+k+" + (row / 2) * "+j+" + (col / 2)",n=2;n<c-1;n++)l="int b"+n+", "+l,k*=b[c-n-1],m="b"+n+" * "+k+" + "+m;return"\n    vec4 "+e+"("+l+") {\n      int index = "+m+";\n      int texR = index / "+i+";\n      int texC = index - texR * "+i+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+i+", "+h+");\n      return "+t6().texture2D+"("+d+", uv);\n    }\n  "}(b)}}(a):function a(b){var c=b.shapeInfo.logicalShape;switch(c.length){case 0:return function(a){var b=a.name,c="get"+b.charAt(0).toUpperCase()+b.slice(1);if(a.shapeInfo.isUniform)return"float "+c+"() {return "+b+";}";var d=a.shapeInfo.texShape,e=d[0],f=d[1];if(1===e&&1===f)return"\n      float "+c+"() {\n        return sampleTexture("+b+", halfCR);\n      }\n    ";var g=a.shapeInfo.texShape;return"\n    float "+c+"() {\n      vec2 uv = uvFromFlat("+g[0]+", "+g[1]+", "+ua(b)+");\n      return sampleTexture("+b+", uv);\n    }\n  "}(b);case 1:return function(a){var b=a.name,c="get"+b.charAt(0).toUpperCase()+b.slice(1);if(a.shapeInfo.isUniform)return"\n      float "+c+"(int index) {\n        "+ub(a)+"\n      }\n    ";var d=a.shapeInfo.texShape,e=d[0],f=d[1];if(1===f&&1===e)return"\n      float "+c+"(int index) {\n        return sampleTexture("+b+", halfCR);\n      }\n    ";var g=ua(b);return 1===f?"\n      float "+c+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+g+") + 0.5) / "+e+".0);\n        return sampleTexture("+b+", uv);\n      }\n    ":1===e?"\n      float "+c+"(int index) {\n        vec2 uv = vec2((float(index + "+g+") + 0.5) / "+f+".0, 0.5);\n        return sampleTexture("+b+", uv);\n      }\n    ":"\n    float "+c+"(int index) {\n      vec2 uv = uvFromFlat("+e+", "+f+", index + "+g+");\n      return sampleTexture("+b+", uv);\n    }\n  "}(b);case 2:return function(b){var c=b.shapeInfo.logicalShape,d=b.name,e="get"+d.charAt(0).toUpperCase()+d.slice(1),f=b.shapeInfo.texShape;if(null!=f&&p8(c,f)){var g=f[0];return"\n    float "+e+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+f[1]+".0, "+g+".0);\n      return sampleTexture("+d+", uv);\n    }\n  "}var h=qg(c),i=h.newShape,j=h.keptDims;if(i.length<c.length)return"\n      "+a(ud(b,i))+"\n      float "+e+"(int row, int col) {\n        return "+e+"("+ue(["row","col"],j)+");\n      }\n    ";if(b.shapeInfo.isUniform)return"\n      float "+e+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+c[1]+", 1)));\n        "+ub(b)+"\n      }\n    ";var k=f[0],l=f[1],m=ua(d);return 1===l?"\n    float "+e+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+c[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+k+".0);\n      return sampleTexture("+d+", uv);\n    }\n  ":1===k?"\n    float "+e+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+c[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+l+".0, 0.5);\n      return sampleTexture("+d+", uv);\n    }\n  ":"\n  float "+e+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+c[1]+" + col + "+m+";\n    vec2 uv = uvFromFlat("+k+", "+l+", index);\n    return sampleTexture("+d+", uv);\n  }\n"}(b);case 3:return function(b){var c=b.shapeInfo.logicalShape,d=b.name,e="get"+d.charAt(0).toUpperCase()+d.slice(1),f=c[1]*c[2],g=c[2],h=qg(c),i=h.newShape,j=h.keptDims;if(i.length<c.length)return"\n        "+a(ud(b,i))+"\n        float "+e+"(int row, int col, int depth) {\n          return "+e+"("+ue(["row","col","depth"],j)+");\n        }\n      ";if(b.shapeInfo.isUniform)return"\n      float "+e+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+f+", "+g+", 1)));\n        "+ub(b)+"\n      }\n    ";var k=b.shapeInfo.texShape,l=k[0],m=k[1],n=b.shapeInfo.flatOffset;return m===f&&null==n?"\n        float "+e+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+g+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+m+".0, "+l+".0);\n          return sampleTexture("+d+", uv);\n        }\n      ":m===g&&null==n?"\n    float "+e+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+c[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+m+".0, "+l+".0);\n      return sampleTexture("+d+", uv);\n    }\n  ":"\n      float "+e+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+f+" + col * "+g+" + depth + "+ua(d)+";\n        vec2 uv = uvFromFlat("+l+", "+m+", index);\n        return sampleTexture("+d+", uv);\n      }\n  "}(b);case 4:return function(b){var c=b.shapeInfo.logicalShape,d=b.name,e="get"+d.charAt(0).toUpperCase()+d.slice(1),f=c[3],g=c[2]*f,h=c[1]*g,i=qg(c),j=i.newShape,k=i.keptDims;if(j.length<c.length)return"\n      "+a(ud(b,j))+"\n      float "+e+"(int row, int col, int depth, int depth2) {\n        return "+e+"("+ue(["row","col","depth","depth2"],k)+");\n      }\n    ";if(b.shapeInfo.isUniform)return"\n      float "+e+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+h+", "+g+", "+f+", 1)));\n        "+ub(b)+"\n      }\n    ";var l=b.shapeInfo.flatOffset,m=b.shapeInfo.texShape,n=m[0],o=m[1];return o===h&&null==l?"\n      float "+e+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+g+", "+f+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+o+".0, "+n+".0);\n        return sampleTexture("+d+", uv);\n      }\n    ":o===f&&null==l?"\n      float "+e+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+c[1]*c[2]+", "+c[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+o+".0, "+n+".0);\n        return sampleTexture("+d+", uv);\n      }\n    ":"\n    float "+e+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+g+" +\n          depth * "+f+" + depth2;\n      vec2 uv = uvFromFlat("+n+", "+o+", index + "+ua(d)+");\n      return sampleTexture("+d+", uv);\n    }\n  "}(b);case 5:return function(b){var c=b.shapeInfo.logicalShape,d=b.name,e="get"+d.charAt(0).toUpperCase()+d.slice(1),f=c[4],g=c[3]*f,h=c[2]*g,i=c[1]*h,j=qg(c),k=j.newShape,l=j.keptDims;if(k.length<c.length)return"\n      "+a(ud(b,k))+"\n      float "+e+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+e+"("+ue(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(b.shapeInfo.isUniform)return"\n      float "+e+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+i+", "+h+", "+g+", "+f+")) +\n          depth3;\n        "+ub(b)+"\n      }\n    ";var m=b.shapeInfo.flatOffset,n=b.shapeInfo.texShape,o=n[0],p=n[1];return p===i&&null==m?"\n      float "+e+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+h+", "+g+", "+f+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+o+".0);\n        return sampleTexture("+d+", uv);\n      }\n    ":p===f&&null==m?"\n      float "+e+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c[1]*c[2]*c[3]+",\n               "+c[2]*c[3]+", "+c[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+o+".0);\n        return sampleTexture("+d+", uv);\n      }\n    ":"\n    float "+e+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+h+" + depth * "+g+" +\n          depth2 * "+f+" + depth3 + "+ua(d)+";\n      vec2 uv = uvFromFlat("+o+", "+p+", index);\n      return sampleTexture("+d+", uv);\n    }\n  "}(b);case 6:return function(b){var c=b.shapeInfo.logicalShape,d=b.name,e="get"+d.charAt(0).toUpperCase()+d.slice(1),f=qg(c),g=f.newShape,h=f.keptDims;if(g.length<c.length)return"\n      "+a(ud(b,g))+"\n      float "+e+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+e+"("+ue(["row","col","depth","depth2","depth3","depth4"],h)+");\n      }\n    ";var i=c[5],j=c[4]*i,k=c[3]*j,l=c[2]*k,m=c[1]*l;if(b.shapeInfo.isUniform)return"\n      float "+e+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+m+", "+l+", "+k+", "+j+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+i+", 1)));\n        "+ub(b)+"\n      }\n    ";var n=b.shapeInfo.flatOffset,o=b.shapeInfo.texShape,p=o[0],q=o[1];return q===m&&null==n?"\n      float "+e+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+k+", "+j+", "+i+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+q+".0, "+p+".0);\n        return sampleTexture("+d+", uv);\n      }\n    ":q===i&&null==n?"\n      float "+e+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+c[1]*c[2]*c[3]*c[4]+",\n               "+c[2]*c[3]*c[4]+",\n               "+c[3]*c[4]+",\n               "+c[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+q+".0, "+p+".0);\n        return sampleTexture("+d+", uv);\n      }\n    ":"\n    float "+e+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+m+" + col * "+l+" + depth * "+k+" +\n          depth2 * "+j+" + depth3 * "+i+" + depth4 + "+ua(d)+";\n      vec2 uv = uvFromFlat("+p+", "+q+", index);\n      return sampleTexture("+d+", uv);\n    }\n  "}(b);default:throw Error(c.length+"-D input sampling is not yet supported")}}(a)),f=a.shapeInfo.logicalShape,g=b.logicalShape,f.length<=g.length&&(e+=c?function(a,b){var c,d=a.name,e=d.charAt(0).toUpperCase()+d.slice(1),f=a.shapeInfo.logicalShape.length,g=b.logicalShape.length,h=tA(a.shapeInfo.logicalShape,b.logicalShape),i=uc(g),j=g-f,k=["x","y","z","w","u","v"];c=0===f?"":g<2&&h.length>=1?"coords = 0;":h.map(function(a){return"coords."+k[a+j]+" = 0;"}).join("\n");var l="";l=g<2&&f>0?"coords":a.shapeInfo.logicalShape.map(function(a,b){return"coords."+k[b+j]}).join(", ");var m="return outputValue;",n=1===p7(a.shapeInfo.logicalShape),o=1===p7(b.logicalShape);if(1!==f||n||o){if(n&&!o)m=1===g?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(h.length){var p=f-2,q=f-1;h.indexOf(p)>-1&&h.indexOf(q)>-1?m="return vec4(outputValue.x);":h.indexOf(p)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":h.indexOf(q)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}}else m="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 get"+e+"AtOutCoords() {\n      "+i+" coords = getOutputCoords();\n      "+c+"\n      vec4 outputValue = get"+e+"("+l+");\n      "+m+"\n    }\n  "}(a,b):function(a,b){var c=a.name,d=c.charAt(0).toUpperCase()+c.slice(1),e="get"+d+"AtOutCoords",f=b.texShape,g=a.shapeInfo.texShape,h=a.shapeInfo.logicalShape.length,i=b.logicalShape.length;if(!a.shapeInfo.isUniform&&h===i&&null==a.shapeInfo.flatOffset&&p8(g,f))return"\n      float "+e+"() {\n        return sampleTexture("+c+", resultUV);\n      }\n    ";var j,k=uc(i),l=tA(a.shapeInfo.logicalShape,b.logicalShape),m=i-h,n=["x","y","z","w","u","v"];j=0===h?"":i<2&&l.length>=1?"coords = 0;":l.map(function(a){return"coords."+n[a+m]+" = 0;"}).join("\n");return"\n    float "+e+"() {\n      "+k+" coords = getOutputCoords();\n      "+j+"\n      return get"+d+"("+(i<2&&h>0?"coords":a.shapeInfo.logicalShape.map(function(a,b){return"coords."+n[b+m]}).join(", "))+");\n    }\n  "}(a,b)),e}).join("\n"),j=b.texShape,k=t6(),l="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+k.texture2D+"(textureSampler, uv).r;\n    }\n  ",m=k.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+k.varyingFs+" vec2 resultUV;\n    "+k.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+k.defineSpecialNaN+"\n    "+k.defineSpecialInf+"\n    "+k.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    \nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  ";return b.isPacked?(f=function(a,b){switch(a.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(f=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+f[1]+".0);\n      }\n    ":1===f[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+f[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+f[0]+", "+f[1]+"));\n      return 2 * (resTexRC.x * "+f[1]+" + resTexRC.y);\n    }\n  ";case 2:var c,d,e,f,g=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];if(p8(a,b))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+g[0]+", "+g[1]+"));\n      }\n    ";var h=Math.ceil(a[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+g[0]+", "+g[1]+"));\n\n      int index = resTexRC.x * "+g[1]+" + resTexRC.y;\n      int r = 2 * (index / "+h+");\n      int c = imod(index, "+h+") * 2;\n\n      return ivec2(r, c);\n    }\n  ";case 3:return c=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)],e=(d=Math.ceil(a[2]/2))*Math.ceil(a[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+c[0]+", "+c[1]+"));\n      int index = resTexRC.x * "+c[1]+" + resTexRC.y;\n\n      int b = index / "+e+";\n      index -= b * "+e+";\n\n      int r = 2 * (index / "+d+");\n      int c = imod(index, "+d+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(a,b){for(var c=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)],d=Math.ceil(a[a.length-1]/2),e=d*Math.ceil(a[a.length-2]/2),f=e,g="",h="b, r, c",i=2;i<a.length-1;i++)f*=a[a.length-i-1],g="\n      int b"+i+" = index / "+f+";\n      index -= b"+i+" * "+f+";\n    "+g,h="b"+i+", "+h;return"\n    ivec"+a.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+c[0]+", "+c[1]+"));\n      int index = resTexRC.x * "+c[1]+" + resTexRC.y;\n\n      "+g+"\n\n      int b = index / "+e+";\n      index -= b * "+e+";\n\n      int r = 2 * (index / "+d+");\n      int c = imod(index, "+d+") * 2;\n\n      return ivec"+a.length+"("+h+");\n    }\n  "}(a,b)}}(b.logicalShape,j),g="\n    void setOutput(vec4 val) {\n      "+k.output+" = val;\n    }\n  "):(f=function(a,b){var c,d,e,f;switch(a.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===b[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+b[1]+".0);\n      }\n    ":1===b[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+b[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      return resTexRC.x * "+b[1]+" + resTexRC.y;\n    }\n  ";case 2:return p8(a,b)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+b[0]+", "+b[1]+"));\n      }\n    ":1===a[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+b[0]+", "+b[1]+"));\n        int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===a[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+b[0]+", "+b[1]+"));\n        int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      int r = index / "+a[1]+";\n      int c = index - r * "+a[1]+";\n      return ivec2(r, c);\n    }\n  ";case 3:return c=t7(["r","c","d"],a),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      "+c+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return d=t7(["r","c","d","d2"],a),"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      "+d+"\n      return ivec4(r, c, d, d2);\n    }\n  ";case 5:return e=t7(["r","c","d","d2","d3"],a),"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+b[0]+",\n                             "+b[1]+"));\n\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+e+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ";case 6:return f=t7(["r","c","d","d2","d3","d4"],a),"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+f+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ";default:throw Error(a.length+"-D output sampling is not yet supported")}}(b.logicalShape,j),g="\n    void setOutput(float val) {\n      "+k.output+" = vec4(val, 0, 0, 0);\n    }\n  "),d&&(m+="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n"),[m,l,g,h,f,i,c].join("\n")}(f,h,e,b.packedInputs),j=a.createProgram(i),k=null,l=a.getUniformLocation(j,"NAN",!1);1===pV.getNumber("WEBGL_VERSION")&&(k=a.getUniformLocation(j,"INFINITY",!1));for(var m={},n=0;n<b.variableNames.length;n++){var o=b.variableNames[n];m[o]=a.getUniformLocation(j,o,!1),m["offset"+o]=a.getUniformLocation(j,"offset"+o,!1)}return{program:b,source:i,webGLProgram:j,uniformLocations:m,inShapeInfos:g,outShapeInfo:h,infLoc:k,nanLoc:l}}(i.gpgpu,a,m,q)}),t=null!=this.activeTimers;if(t&&(p=this.startTimer()),f=this.gpgpu,ve(s.inShapeInfos,m),ve([s.outShapeInfo],[q]),g=q.texData.texture,h=q.texData.texShape,q.texData.isPacked?f.setOutputPackedMatrixTexture(g,h[0],h[1]):f.setOutputMatrixTexture(g,h[0],h[1]),f.setProgram(s.webGLProgram),1===pV.getNumber("WEBGL_VERSION")&&null!==s.infLoc&&f.gl.uniform1f(s.infLoc,1/0),null!==s.nanLoc&&f.gl.uniform1f(s.nanLoc,NaN),m.forEach(function(a,b){var c=s.program.variableNames[b],d=s.uniformLocations[c],e=s.uniformLocations["offset"+c];if(null!=d)if(a.isUniform)if(2>p7(a.shape))f.gl.uniform1f(d,a.uniformValues[0]);else{var g=a.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),f.gl.uniform1fv(d,g)}else null!=a.texData.slice&&null!=e&&f.gl.uniform1i(e,a.texData.slice.flatOffset),f.setInputMatrixTexture(a.texData.texture,d,b)}),null!=d&&d(f,s.webGLProgram),f.executeProgram(),l.forEach(function(a){return i.disposeData(a.dataId)}),t&&(p=this.endTimer(p),this.activeTimers.push({name:a.constructor.name,query:this.getQueryTime(p)})),!pV.getBool("WEBGL_LAZILY_UNPACK")&&k.isPacked&&!1===e){var u=this.unpackTensor(j);return this.disposeData(j.dataId),u}return j},b.prototype.compileAndRun=function(a,b,c,d,e){void 0===e&&(e=!1),c=c||b[0].dtype;var f=this.runWebGLProgram(a,b,c,d,e);return q4.makeTensorFromDataId(f.dataId,f.shape,f.dtype)},b.prototype.getAndSaveBinary=function(a,b){return a in this.binaryCache||(this.binaryCache[a]=b()),this.binaryCache[a]},b.prototype.getTextureManager=function(){return this.textureManager},b.prototype.dispose=function(){var a=this;this.disposed||(pV.getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(b){a.gpgpu.deleteProgram(a.binaryCache[b].webGLProgram),delete a.binaryCache[b]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},b.prototype.floatPrecision=function(){var a=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=r$(function(){if(!pV.get("WEBGL_RENDER_FLOAT32_ENABLED")){var b=pV.getBool("DEBUG");pV.set("DEBUG",!1);var c=a.abs(sl(1e-8)).dataSync()[0];if(pV.set("DEBUG",b),c>0)return 32}return 16})),this.floatPrecisionValue},b.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},b.prototype.uploadToGPU=function(a){var b,c=this.texData.get(a),d=c.shape,e=c.dtype,f=c.values,g=c.texture,h=c.usage,i=c.isPacked;if(null==g){var j,k=null!=this.activeTimers;k&&(j=qA());var l=c.texShape;if(null==l&&(c.texShape=l=rM(d,i)),null!=f){var m=rL(d),n=void 0,o=l[1],p=l[0],q=f instanceof Uint8Array;i?(o=(b=rf(l[0],l[1]))[0],n=new uS(m,[p=b[1],o],q)):n=new uR(m,[p,o],q);var r=this.makeTensorInfo([p,o],e);this.texData.get(r.dataId).usage=q?q8.PIXELS:q8.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(r.dataId),o,p,f);var s=this.runWebGLProgram(n,[r],e,null,!0),t=this.texData.get(s.dataId);c.texture=t.texture,c.texShape=t.texShape,c.isPacked=t.isPacked,c.usage=t.usage,this.disposeData(r.dataId),this.texData.delete(s.dataId),c.values=null,k&&(this.uploadWaitMs+=qA()-j)}else c.texture=this.acquireTexture(l,h,e,i)}},b.prototype.convertAndCacheOnCPU=function(a,b){var c=this.texData.get(a),d=c.dtype;return this.releaseGPUData(a),null!=b&&(c.values=function(a,b){if("float32"===b||"complex64"===b)return a;if("int32"===b||"bool"===b){for(var c="int32"===b?new Int32Array(a.length):new Uint8Array(a.length),d=0;d<c.length;++d)c[d]=Math.round(a[d]);return c}throw Error("Unknown dtype "+b)}(b,d)),c.values},b.prototype.acquireTexture=function(a,b,c,d){if(this.numBytesInGPU+=this.computeBytes(a,c),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+e+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(a,b,d)},b.prototype.computeBytes=function(a,b){return a[0]*a[1]*qn(b)},b}(ty);q5()&&q4.registerBackend("webgl",function(){return new we},2);var wf=sf({square_:function(a){var b=r3(a,"x","square"),c=[b];return q4.runKernelFunc(function(a,c){return c([b]),a.square(b)},{x:b},null,"Square",{},c,[])}}),wg="SquaredDifference",wh=sf({squaredDifference_:function(a,b){var c,d=r3(a,"a","squaredDifference"),e=r3(b,"b","squaredDifference");d=(c=q$(d,e))[0],e=c[1],tC(d.shape,e.shape);var f={a:d,b:e},g=[d,e];return q4.runKernelFunc(function(a,b){var c=a.squaredDifference(d,e);return b([d,e]),c},f,function(a,b){var c=b[0],d=b[1],e=sl(2);return{a:function(){return a.mul(c.sub(d).mul(e))},b:function(){return a.mul(d.sub(c).mul(e))}}},wg,{},g,[])}}),wi=sf({abs_:function(a){var b=r3(a,"x","abs");return"complex64"===b.dtype?q4.runKernelFunc(function(a){return a.complexAbs(b)},{$x:b}):q4.runKernelFunc(function(a,c){var d=a.abs(b);return c([b]),d},{x:b},function(a,b){var c=b[0];return{x:function(){return a.mul(c.toFloat().step(-1))}}},"Abs")}}),wj=sf({acos_:function(a){var b=r3(a,"x","acos");return q4.runKernelFunc(function(a,c){var d=a.acos(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.divStrict(sl(1).sub(c.toFloat().square()).sqrt()).neg()}}})}}),wk=sf({acosh_:function(a){var b=r3(a,"x","acosh");return q4.runKernelFunc(function(a,c){var d=a.acosh(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.divStrict(c.toFloat().square().sub(1).sqrt())}}})}}),wl=sf({asin_:function(a){var b=r3(a,"x","asin");return q4.runKernelFunc(function(a,c){var d=a.asin(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.divStrict(sl(1).sub(c.toFloat().square()).sqrt())}}})}}),wm=sf({asinh_:function(a){var b=r3(a,"x","asinh");return q4.runKernelFunc(function(a,c){var d=a.asinh(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.divStrict(sl(1).add(c.toFloat().square()).sqrt())}}})}}),wn=sf({atan_:function(a){var b=r3(a,"x","atan");return q4.runKernelFunc(function(a,c){var d=a.atan(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.div(c.toFloat().square().add(1))}}})}}),wo=sf({atanh_:function(a){var b=r3(a,"x","atanh");return q4.runKernelFunc(function(a,c){var d=a.atanh(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.div(sl(1).sub(c.toFloat().square()))}}})}}),wp=sf({ceil_:function(a){var b=r3(a,"x","ceil");return q4.runKernelFunc(function(a){return a.ceil(b)},{$x:b},function(a){return{$x:function(){return sv(a)}}})}}),wq=sf({clipByValue_:function(a,b,c){var d=r3(a,"x","clipByValue");p3(b<=c,function(){return"Error in clip: min ("+b+") must be less than or equal to max ("+c+")."});var e=[d];return q4.runKernelFunc(function(a,e){var f=a.clip(d,b,c);return e([d]),f},{x:d},function(a,d){var e=d[0];return{x:function(){return a.where(e.greaterEqual(b).logicalAnd(e.lessEqual(c)),sv(a))}}},"ClipByValue",{min:b,max:c},e)}}),wr=sf({cos_:function(a){var b=r3(a,"x","cos"),c=[b];return q4.runKernelFunc(function(a,c){var d=a.cos(b);return c([b]),d},{x:b},function(a,b){var c=b[0];return{x:function(){return c.toFloat().sin().neg().mul(a)}}},"Cos",{},c)}}),ws=sf({cosh_:function(a){var b=r3(a,"x","cosh");return q4.runKernelFunc(function(a,c){var d=a.cosh(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return c.toFloat().sinh().mulStrict(a)}}})}}),wt=sf({erf_:function(a){var b=r3(a,"x","erf");return p3("int32"===b.dtype||"float32"===b.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===b.dtype&&(b=b.toFloat()),q4.runKernelFunc(function(a,c){var d=a.erf(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.mul(c.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),wu=sf({exp_:function(a){var b=r3(a,"x","exp");return q4.runKernelFunc(function(a,c){var d=a.exp(b);return c([d]),d},{x:b},function(a,b){return{x:function(){return a.mulStrict(b[0])}}},"Exp",{},[],[!0])}}),wv=sf({expm1_:function(a){var b=r3(a,"x","expm1");return q4.runKernelFunc(function(a,c){var d=a.expm1(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.mul(c.exp())}}})}}),ww=sf({floor_:function(a){var b=r3(a,"x","floor");return q4.runKernelFunc(function(a){return a.floor(b)},{$x:b},function(a){return{$x:function(){return sv(a)}}})}}),wx=sf({log_:function(a){var b=r3(a,"x","log"),c=[b];return q4.runKernelFunc(function(a,c){var d=a.log(b);return c([b]),d},{x:b},function(a,b){var c=b[0];return{x:function(){return a.div(c.toFloat())}}},"Log",{},c)}}),wy=sf({log1p_:function(a){var b=r3(a,"x","log1p");return q4.runKernelFunc(function(a,c){var d=a.log1p(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.div(c.add(1))}}})}}),wz=sf({logSigmoid_:function(a){var b=r3(a,"x","logSigmoid");return q4.runKernelFunc(function(a,c){var d=a.softplus(b.neg()).neg();return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.mul(c.neg().sigmoid())}}})}}),wA=sf({neg_:function(a){var b=r3(a,"x","neg"),c=[b];return q4.runKernelFunc(function(a){return a.neg(b)},{x:b},function(a){return{x:function(){return a.neg()}}},"Neg",{},c)}}),wB=sf({reciprocal_:function(a){var b=r3(a,"x","reciprocal");return q4.runKernelFunc(function(a,c){var d=a.reciprocal(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.div(c.square().neg())}}})}}),wC=sf({round_:function(a){var b=r3(a,"x","round");return q4.runKernelFunc(function(a){return a.round(b)},{$x:b},function(a){return{$x:function(){return sv(a)}}})}}),wD=sf({rsqrt_:function(a){var b=r3(a,"x","rsqrt"),c=[b];return q4.runKernelFunc(function(a,c){var d=a.rsqrt(b);return c([b]),d},{x:b},function(a,b){var c=b[0];return{x:function(){return a.div(c.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},c)}}),wE=sf({sigmoid_:function(a){var b=r3(a,"x","sigmoid");return q4.runKernelFunc(function(a,c){var d=a.sigmoid(b);return c([d]),d},{x:b},function(a,b){var c=b[0];return{x:function(){return a.mul(c.mul(sl(1).sub(c)))}}},"Sigmoid")}}),wF=sf({sign_:function(a){var b=r3(a,"x","sign");return q4.runKernelFunc(function(a){return a.sign(b)},{$x:b},function(a){return{$x:function(){return sv(a)}}})}}),wG=sf({isNaN_:function(a){var b=r3(a,"x","isNaN");return q4.runKernelFunc(function(a){return a.isNaN(b)},{$x:b},function(a){return{$x:function(){return sv(a)}}})}}),wH=sf({isInf_:function(a){var b=r3(a,"x","isInf");return q4.runKernelFunc(function(a){return a.isInf(b)},{$x:b},function(a){return{$x:function(){return sv(a)}}})}}),wI=sf({isFinite_:function(a){var b=r3(a,"x","isFinite");return q4.runKernelFunc(function(a){return a.isFinite(b)},{$x:b},function(a){return{$x:function(){return sv(a)}}})}}),wJ=sf({sin_:function(a){var b=r3(a,"x","sin"),c=[b];return q4.runKernelFunc(function(a,c){var d=a.sin(b);return c([b]),d},{x:b},function(a,b){var c=b[0];return{x:function(){return c.toFloat().cos().mul(a)}}},"Sin",{},c)}}),wK=sf({sinh_:function(a){var b=r3(a,"x","sinh");return q4.runKernelFunc(function(a,c){var d=a.sinh(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return c.toFloat().cosh().mulStrict(a)}}})}}),wL=sf({softplus_:function(a){var b=r3(a,"x","softplus");return q4.runKernelFunc(function(a,c){var d=a.softplus(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.mul(c.sigmoid())}}})}}),wM=sf({sqrt_:function(a){var b=r3(a,"x","sqrt");return q4.runKernelFunc(function(a,c){var d=a.sqrt(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.div(c.toFloat().sqrt().mul(2))}}})}}),wN=sf({step_:function(a,b){void 0===b&&(b=0);var c=r3(a,"x","step");return q4.runKernelFunc(function(a){return a.step(c,b)},{$x:c},function(a){return{$x:function(){return sv(a)}}})}}),wO=sf({tan_:function(a){var b=r3(a,"x","tan");return q4.runKernelFunc(function(a,c){var d=a.tan(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return a.div(c.cos().square())}}})}}),wP=sf({tanh_:function(a){var b=r3(a,"x","tanh");return q4.runKernelFunc(function(a,c){var d=a.tanh(b);return c([d]),d},{x:b},function(a,b){var c=b[0];return{x:function(){return sl(1).sub(c.square()).mulStrict(a)}}},"Tanh",{},null,[!0])}});function wQ(a,b,c,d,e,f){var g,h,i=r3(a,"x","batchNorm"),j=r3(b,"mean","batchNorm"),k=r3(c,"variance","batchNorm");return null!=e&&(g=r3(e,"scale","batchNorm")),null!=d&&(h=r3(d,"offset","batchNorm")),p3(2===i.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+i.rank+"."}),p3(2===j.rank||1===j.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+j.rank+"."}),p3(2===k.rank||1===k.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+k.rank+"."}),null!=g&&p3(2===g.rank||1===g.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+g.rank+"."}),null!=h&&p3(2===h.rank||1===h.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+h.rank+"."}),wT(i,j,k,h,g,f)}function wR(a,b,c,d,e,f){var g,h,i=r3(a,"x","batchNorm"),j=r3(b,"mean","batchNorm"),k=r3(c,"variance","batchNorm");return null!=e&&(g=r3(e,"scale","batchNorm")),null!=d&&(h=r3(d,"offset","batchNorm")),p3(3===i.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+i.rank+"."}),p3(3===j.rank||1===j.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+j.rank+"."}),p3(3===k.rank||1===k.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+k.rank+"."}),null!=g&&p3(3===g.rank||1===g.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+g.rank+"."}),null!=h&&p3(3===h.rank||1===h.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+h.rank+"."}),wT(i,j,k,h,g,f)}function wS(a,b,c,d,e,f){var g,h,i=r3(a,"x","batchNorm"),j=r3(b,"mean","batchNorm"),k=r3(c,"variance","batchNorm");return null!=e&&(g=r3(e,"scale","batchNorm")),null!=d&&(h=r3(d,"offset","batchNorm")),p3(4===i.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+i.rank+"."}),p3(4===j.rank||1===j.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+j.rank+"."}),p3(4===k.rank||1===k.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+k.rank+"."}),null!=g&&p3(4===g.rank||1===g.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+g.rank+"."}),null!=h&&p3(4===h.rank||1===h.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+h.rank+"."}),wT(i,j,k,h,g,f)}function wT(a,b,c,d,e,f){null==f&&(f=.001);var g,h,i,j=r3(a,"x","batchNorm"),k=r3(b,"mean","batchNorm"),l=r3(c,"variance","batchNorm");null!=e&&(g=r3(e,"scale","batchNorm")),null!=d&&(h=r3(d,"offset","batchNorm")),p3(k.rank===l.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),p3(null==h||k.rank===h.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),p3(null==g||k.rank===g.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),i=0===j.rank||1===j.rank?j.as4D(1,1,1,j.size):2===j.rank?j.as4D(1,1,j.shape[0],j.shape[1]):3===j.rank?j.as4D(1,j.shape[0],j.shape[1],j.shape[2]):j;var m=[j,k,l,g];return q4.runKernelFunc(function(a,b){var c=a.batchNormalization(i,wU(k),wU(l),f,wU(g),wU(h));return b([j,k,l,g]),c},{x:j,mean:k,variance:l,scale:g,offset:h},function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],h=null==g?sl(1):g,j=tB(d.shape,i.shape),k=[];if(1===d.rank){for(var l=0;l<i.shape.length-1;++l)k.push(i.shape[l]);k.push(1)}var m=c.sub(d),n=a.mul(h),o=wD(e.add(sl(f))),p=o.mul(o).mul(o).mul(sl(-.5));return{x:function(){return 1===d.rank?a.mul(ta(o.as4D(1,1,1,d.shape[0]),k)).mul(h).reshape(c.shape):a.mul(o).mul(h).reshape(c.shape)},mean:function(){var a=o.mul(sl(-1)).mul(n);return 1===d.rank&&(a=a.sum(j)),a.reshape(d.shape)},variance:function(){var a=p.mul(m).mul(n);return 1===d.rank&&(a=a.sum(j)),a.reshape(d.shape)},scale:function(){var b=m.mul(o),c=a.mul(b);return 1===d.rank&&(c=c.sum(j)),c.reshape(d.shape)},offset:function(){var b=a;return 1===d.rank&&(b=b.sum(j)),b.reshape(d.shape)}}},"BatchNormalization",{varianceEpsilon:f},m).reshape(j.shape)}function wU(a){return null==a?null:0===a.rank?a.as1D():1===a.rank?a:2===a.rank?a.as4D(1,1,a.shape[0],a.shape[1]):3===a.rank?a.as4D(1,a.shape[0],a.shape[1],a.shape[2]):a}function wV(){rZ("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var wW=sf({batchNormalization2d_:function(a,b,c,d,e,f){return void 0===d&&(d=.001),wV(),wQ(a,b,c,f,e,d)}}),wX=sf({batchNormalization3d_:function(a,b,c,d,e,f){return void 0===d&&(d=.001),wV(),wR(a,b,c,f,e,d)}}),wY=sf({batchNormalization4d_:function(a,b,c,d,e,f){return void 0===d&&(d=.001),wV(),wS(a,b,c,f,e,d)}}),wZ=sf({batchNormalization_:function(a,b,c,d,e,f){return void 0===d&&(d=.001),wV(),wT(a,b,c,f,e,d)}}),w$=sf({batchNorm_:wT}),w_=sf({batchNorm2d_:wQ}),w0=sf({batchNorm3d_:wR}),w1=sf({batchNorm4d_:wS}),w2=sf({logicalAnd_:function(a,b){var c=r3(a,"a","logicalAnd","bool"),d=r3(b,"b","logicalAnd","bool");return tC(c.shape,d.shape),q4.runKernelFunc(function(a){return a.logicalAnd(c,d)},{a:c,b:d},null,"LogicalAnd")}}),w3=sf({logicalNot_:function(a){var b=r3(a,"x","logicalNot","bool");return q4.runKernelFunc(function(a){return a.logicalNot(b)},{$x:b})}}),w4=sf({logicalOr_:function(a,b){var c=r3(a,"a","logicalOr","bool"),d=r3(b,"b","logicalOr","bool");return tC(c.shape,d.shape),q4.runKernelFunc(function(a){return a.logicalOr(c,d)},{$a:c,$b:d})}}),w5=sf({logicalXor_:function(a,b){var c=r3(a,"a","logicalXor","bool"),d=r3(b,"b","logicalXor","bool");return tC(c.shape,d.shape),w4(a,b).logicalAnd(w2(a,b).logicalNot())}}),w6=sf({where_:function(a,b,c){var d=r3(b,"a","where"),e=r3(c,"b","where"),f=r3(a,"condition","where","bool");return p4(d.shape,e.shape,"Error in where: "),1===f.rank?p3(f.shape[0]===d.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):p4(f.shape,e.shape,"Error in where: "),q4.runKernelFunc(function(a,b){var c=a.select(f,d,e);return b([f]),c},{$condition:f,$a:d,$b:e},function(a,b){var c=b[0];return{$condition:function(){return sv(c).toFloat()},$a:function(){return a.mul(c.cast(a.dtype))},$b:function(){return a.mul(c.logicalNot().cast(a.dtype))}}})}}),w7=function(a){return pS(this,void 0,void 0,function(){var b,c,d;return pT(this,function(e){switch(e.label){case 0:return[4,(b=r3(a,"condition","whereAsync","bool")).data()];case 1:return c=e.sent(),d=t0(b.shape,c),a!==b&&b.dispose(),[2,d]}})})},w8=sf({add_:function(a,b){var c,d=r3(a,"a","add"),e=r3(b,"b","add");d=(c=q$(d,e))[0],e=c[1];var f=tC(d.shape,e.shape);return q4.runKernelFunc(function(a){return a.add(d,e)},{a:d,b:e},function(a){return{a:function(){var b=a,c=tB(d.shape,f);return c.length>0&&(b=b.sum(c)),b.reshape(d.shape)},b:function(){var b=a,c=tB(e.shape,f);return c.length>0&&(b=b.sum(c)),b.reshape(e.shape)}}},"Add")}}),w9=sf({addN_:function(a){p3(Array.isArray(a),function(){return"The argument passed to tf.addN() must be a list of tensors"}),p3(a.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+a.length});var b=a.map(function(a,b){return r3(a,"tensors"+b,"addN")}),c=b[0];return b.forEach(function(a){if(a.dtype!==c.dtype)throw Error("All tensors passed to tf.addN() must have the same dtype")}),b.forEach(function(a){if(!p8(a.shape,c.shape))throw Error("All tensors passed to tf.addN() must have the same shape")}),q4.runKernelFunc(function(a){return a.addN(b)},b,function(a){var c={};return b.forEach(function(b,d){c[d]=function(){return a.clone()}}),c},"AddN")}}),xa=sf({addStrict_:function(a,b){var c=r3(a,"a","addStrict"),d=r3(b,"b","addStrict");return p4(c.shape,d.shape,"Error in addStrict: "),c.add(d)}}),xb=sf({atan2_:function(a,b){var c,d=r3(a,"a","atan2"),e=r3(b,"b","atan2");d=(c=q$(d,e))[0],e=c[1];var f=tC(d.shape,e.shape);return q4.runKernelFunc(function(a,b){var c=a.atan2(d,e);return b([d,e]),c},{$a:d,$b:e},function(a,b){var c=b[0],d=b[1];return{$a:function(){var b=w8(c.square(),d.square()),e=a.mul(d.div(b)),g=tB(c.shape,f);return g.length>0&&(e=e.sum(g)),e.reshape(c.shape)},$b:function(){var b=w8(c.square(),d.square()),e=wA(a.mul(c.div(b))),g=tB(d.shape,f);return g.length>0&&(e=e.sum(g)),e.reshape(d.shape)}}})}}),xc=sf({div_:function(a,b){var c,d=r3(a,"a","div"),e=r3(b,"b","div");if(d=(c=q$(d,e))[0],e=c[1],"int32"===d.dtype&&"int32"===e.dtype)return xf(d,e);var f=tC(d.shape,e.shape);return q4.runKernelFunc(function(a,b){var c=a.realDivide(d,e);return b([d,e]),c},{a:d,b:e},function(a,b){var c=b[0],d=b[1];return{a:function(){var b=a.div(d.toFloat()),e=tB(c.shape,f);return e.length>0?b.sum(e).reshape(c.shape):b},b:function(){var b=a.mul(c.toFloat()),e=tB(d.shape,f);e.length>0&&(b=b.sum(e).reshape(d.shape));var g=d.square();return b.div(g.toFloat()).neg()}}},"Div")}}),xd=sf({divNoNan_:function(a,b){var c,d=r3(a,"a","div"),e=r3(b,"b","div"),f=xc(d=(c=q$(d,e))[0],e=c[1]),g=sv(f);return w6(e.equal(g),g,f)}}),xe=sf({divStrict_:function(a,b){var c=r3(a,"a","div"),d=r3(b,"b","div");return p4(c.shape,d.shape,"Error in divideStrict: "),c.div(d)}}),xf=sf({floorDiv_:function(a,b){var c,d=r3(a,"a","floorDiv"),e=r3(b,"b","floorDiv");d=(c=q$(d,e))[0],e=c[1];var f=tC(d.shape,e.shape);return q4.runKernelFunc(function(a,b){var c=a.floorDiv(d,e);return b([d,e]),c},{a:d,b:e},function(a,b){var c=b[0],d=b[1];return{a:function(){var b=a.div(d.toFloat()),e=tB(c.shape,f);return e.length>0?b.sum(e).reshape(c.shape):b},b:function(){var b=a.mul(c.toFloat()),e=tB(d.shape,f);e.length>0&&(b=b.sum(e).reshape(d.shape));var g=d.square();return b.div(g.toFloat()).neg()}}},"FloorDiv")}}),xg=sf({maximum_:function(a,b){var c,d=r3(a,"a","maximum"),e=r3(b,"b","maximum");return d=(c=q$(d,e))[0],e=c[1],"bool"===d.dtype&&(d=d.toInt(),e=e.toInt()),tC(d.shape,e.shape),q4.runKernelFunc(function(a,b){var c=a.maximum(d,e);return b([d,e]),c},{a:d,b:e},function(a,b){var c=b[0],d=b[1];return{a:function(){return a.mul(c.greaterEqual(d).toFloat())},b:function(){return a.mul(c.less(d).toFloat())}}},"Maximum")}}),xh=sf({maximumStrict_:function(a,b){var c=r3(a,"a","maximumStrict"),d=r3(b,"b","maximumStrict");return p4(c.shape,d.shape,"Error in maximumStrict: "),c.maximum(d)}}),xi=sf({minimum_:function(a,b){var c,d=r3(a,"a","minimum"),e=r3(b,"b","minimum");return d=(c=q$(d,e))[0],e=c[1],"bool"===d.dtype&&(d=d.toInt(),e=e.toInt()),tC(d.shape,e.shape),q4.runKernelFunc(function(a,b){var c=a.minimum(d,e);return b([d,e]),c},{a:d,b:e},function(a,b){var c=b[0],d=b[1];return{a:function(){return a.mul(c.lessEqual(d).toFloat())},b:function(){return a.mul(c.greater(d).toFloat())}}},"Minimum")}}),xj=sf({minimumStrict_:function(a,b){var c=r3(a,"a","minimumStrict"),d=r3(b,"b","minimumStrict");return p4(c.shape,d.shape,"Error in minimumStrict: "),c.minimum(d)}}),xk=sf({mod_:function(a,b){var c,d=r3(a,"a","mod"),e=r3(b,"b","mod");d=(c=q$(d,e))[0],e=c[1];var f=tC(d.shape,e.shape);return q4.runKernelFunc(function(a,b){var c=a.mod(d,e);return b([d,e]),c},{$a:d,$b:e},function(a,b){var c=b[0],d=b[1];return{$a:function(){var b=tB(c.shape,f);return b.length>0?a.sum(b).reshape(c.shape):a},$b:function(){var b=a.mul(c.div(d).floor().neg()),e=tB(d.shape,f);return e.length>0?b.sum(e).reshape(d.shape):b}}})}}),xl=sf({modStrict_:function(a,b){var c=r3(a,"a","modStrict"),d=r3(b,"b","modStrict");return p4(c.shape,d.shape,"Error in modStrict: "),c.mod(d)}}),xm=sf({mul_:function(a,b){var c,d=r3(a,"a","mul"),e=r3(b,"b","mul");d=(c=q$(d,e))[0],e=c[1];var f=tC(d.shape,e.shape);return q4.runKernelFunc(function(a,b){var c=a.multiply(d,e);return b([d,e]),c},{a:d,b:e},function(a,b){var c=b[0],d=b[1];return{a:function(){var b=a.mul(d.toFloat()),e=tB(c.shape,f);return e.length>0?b.sum(e).reshape(c.shape):b},b:function(){var b=a.mul(c.toFloat()),e=tB(d.shape,f);return e.length>0?b.sum(e).reshape(d.shape):b}}},"Mul")}}),xn=sf({mulStrict_:function(a,b){var c=r3(a,"a","mul"),d=r3(b,"b","mul");return p4(c.shape,d.shape,"Error in multiplyStrict: "),c.mul(d)}}),xo=sf({pow_:function(a,b){var c,d=r3(a,"base","pow"),e=r3(b,"exp","pow");d=(c=q$(d,e))[0],e=c[1];var f=tC(d.shape,e.shape),g=[d,e];return q4.runKernelFunc(function(a,b){var c=a.pow(d,e);return b([d,e,c]),c},{a:d,b:e},function(a,b){var c=b[0],d=b[1],e=b[2];return{a:function(){var b=d.toFloat(),e=a.mul(b.mul(c.pow(b.sub(sl(1))))),g=tB(c.shape,f);return g.length>0&&(e=e.sum(g)),e.reshape(c.shape)},b:function(){var b=c.greater(0),g=c.log().where(b,sv(c)),h=a.mul(e.mul(g)),i=tB(d.shape,f);return i.length>0&&(h=h.sum(i)),h.reshape(d.shape)}}},"Pow",{},g,[!0])}}),xp=sf({powStrict_:function(a,b){return p4(a.shape,b.shape,"Error in powStrict: "),a.pow(b)}}),xq=sf({squaredDifferenceStrict_:function(a,b){var c=r3(a,"a","squaredDifferenceStrict"),d=r3(b,"b","squaredDifferenceStrict");return p4(c.shape,d.shape,"Error in squaredDifferenceStrict: "),c.squaredDifference(d)}}),xr=sf({sub_:function(a,b){var c,d=r3(a,"a","sub"),e=r3(b,"b","sub");d=(c=q$(d,e))[0],e=c[1];var f=tC(d.shape,e.shape);return q4.runKernelFunc(function(a){return a.subtract(d,e)},{a:d,b:e},function(a){return{a:function(){var b=a,c=tB(d.shape,f);return c.length>0&&(b=b.sum(c)),b.reshape(d.shape)},b:function(){var b=a,c=tB(e.shape,f);return c.length>0&&(b=b.sum(c)),b.neg().reshape(e.shape)}}},"Sub")}}),xs=sf({subStrict_:function(a,b){var c=r3(a,"a","subStrict"),d=r3(b,"b","subStrict");return p4(c.shape,d.shape,"Error in subStrict: "),c.sub(d)}}),xt=sf({equal_:function(a,b){var c,d=r3(a,"a","equal"),e=r3(b,"b","equal");return d=(c=q$(d,e))[0],e=c[1],tC(d.shape,e.shape),q4.runKernelFunc(function(a){return a.equal(d,e)},{$a:d,$b:e})}}),xu=sf({equalStrict_:function(a,b){var c=r3(a,"a","equalStrict"),d=r3(b,"b","equalStrict");return p4(c.shape,d.shape,"Error in equalStrict: "),c.equal(d)}}),xv=sf({greater_:function(a,b){var c,d=r3(a,"a","greater"),e=r3(b,"b","greater");return d=(c=q$(d,e))[0],e=c[1],tC(d.shape,e.shape),q4.runKernelFunc(function(a){return a.greater(d,e)},{a:d,b:e},null,"Greater")}}),xw=sf({greaterEqual_:function(a,b){var c,d=r3(a,"a","greaterEqual"),e=r3(b,"b","greaterEqual");return d=(c=q$(d,e))[0],e=c[1],tC(d.shape,e.shape),q4.runKernelFunc(function(a,b){var c=a.greaterEqual(d,e);return b([d,e]),c},{a:d,b:e},function(a,b){var c=b[0],d=b[1];return{a:function(){return sv(c)},b:function(){return sv(d)}}},"GreaterEqual")}}),xx=sf({greaterEqualStrict_:function(a,b){var c=r3(a,"a","greaterEqualStrict"),d=r3(b,"b","greaterEqualStrict");return p4(c.shape,d.shape,"Error in greaterEqualStrict: "),c.greaterEqual(d)}}),xy=sf({greaterStrict_:function(a,b){var c=r3(a,"a","greaterStrict"),d=r3(b,"b","greaterStrict");return p4(c.shape,d.shape,"Error in greaterStrict: "),c.greater(d)}}),xz=sf({less_:function(a,b){var c,d=r3(a,"a","less"),e=r3(b,"b","less");return d=(c=q$(d,e))[0],e=c[1],tC(d.shape,e.shape),q4.runKernelFunc(function(a){return a.less(d,e)},{a:d,b:e},null,"Less")}}),xA=sf({lessEqual_:function(a,b){var c,d=r3(a,"a","lessEqual"),e=r3(b,"b","lessEqual");return d=(c=q$(d,e))[0],e=c[1],tC(d.shape,e.shape),q4.runKernelFunc(function(a,b){var c=a.lessEqual(d,e);return b([d,e]),c},{a:d,b:e},null,"LessEqual")}}),xB=sf({lessEqualStrict_:function(a,b){var c=r3(a,"a","lessEqualStrict"),d=r3(b,"b","lessEqualStrict");return p4(c.shape,d.shape,"Error in lessEqualStrict: "),c.lessEqual(d)}}),xC=sf({lessStrict_:function(a,b){var c=r3(a,"a","lessStrict"),d=r3(b,"b","lessStrict");return p4(c.shape,d.shape,"Error in lessStrict: "),c.less(d)}}),xD=sf({notEqual_:function(a,b){var c,d=r3(a,"a","notEqual"),e=r3(b,"b","notEqual");return d=(c=q$(d,e))[0],e=c[1],tC(d.shape,e.shape),q4.runKernelFunc(function(a){return a.notEqual(d,e)},{a:d,b:e},null,"NotEqual")}}),xE=sf({notEqualStrict_:function(a,b){var c=r3(a,"a","notEqualStrict"),d=r3(b,"b","notEqualStrict");return p4(c.shape,d.shape,"Error in notEqualStrict: "),c.notEqual(d)}});function xF(a,b){for(var c=[],d=a;d<b;++d)c.push(d);return c}function xG(a){for(var b=[],c=0;c<a.length;++c)for(var d=0;d<a[c].length;++d)b.push(a[c][d]);return b}var xH=sf({gather_:function(a,b,c){void 0===c&&(c=0);var d=r3(a,"x","gather"),e=r3(b,"indices","gather","int32");c=qf(c,d.shape)[0];var f=function(a,b,c){for(var d=a.shape[c],e=[],f=1,g=1,h=0;h<c;h++)e.push(a.shape[h]),f*=a.shape[h];for(h=0;h<b.rank;h++)e.push(b.shape[h]);for(h=c+1;h<a.rank;h++)e.push(a.shape[h]),g*=a.shape[h];return{batchSize:f,sliceSize:g,dimSize:d,outputShape:e}}(d,e,c);return q4.runKernelFunc(function(a,b){var f=a.gather(d,e.flatten(),c);return b([e]),f},{x:d,indices:e},function(a,b){var e=b[0];return{x:function(){var b=d.shape,f=e.size,g=b.slice(0,c),h=g.length,i=b.slice(c,b.length).slice(1),j=i.length,k=xF(0,h),l=xF(h+1,h+1+j),m=xG([g,[f],i]),n=a.reshape(m),o=e.reshape([f]),p=xG([[h],k,l]),q=xI(n.transpose(p),o,d.shape[c]),r=sb(p);return q.transpose(r)},indices:function(){return e}}},"Gather",{axis:c}).reshape(f.outputShape)}}),xI=sf({unsortedSegmentSum_:function(a,b,c){var d=r3(a,"x","unsortedSegmentSum"),e=r3(b,"segmentIds","unsortedSegmentSum","int32");return p3(p9(c),function(){return"numSegments must be of dtype int"}),q4.runKernelFunc(function(a,b){var f=a.unsortedSegmentSum(d,e,c);return b([e]),f},{$x:d},function(a,b){var c=b[0];return{$x:function(){return function(a,b){for(var c=xg(b,sv(b)),d=xH(a,c),e=xw(b,sl(0,"int32")),f=d.rank-e.rank,g=0;g<f;++g)e=sV(e,g+1);e=w2(e,sq(d.shape,"bool"));var h=sv(d);return w6(e,d,h)}(a,c)}}})}});function xJ(a,b,c,d,e,f,g){void 0===f&&(f="NHWC"),p3(a.length===b.rank,function(){return"Length of inShape ("+a.length+") and rank of dy ("+b.rank+") must match"});var h=a,i=b,j=!1;3===b.rank&&(j=!0,i=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]),h=[1,a[0],a[1],a[2]]),p3(4===h.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+h.length+"."}),p3(4===i.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+i.rank}),p3(4===c.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+c.rank});var k="NHWC"===f?h[3]:h[1],l="NHWC"===f?i.shape[3]:i.shape[1];p3(k===c.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+k+") must match input depth for filter "+c.shape[2]+"."}),p3(l===c.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+l+") must match output depth for filter "+c.shape[3]+"."}),null!=g&&p3(p9(e),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+e+"."});var m=tO(f),n=tF(h,c.shape,d,1,e,g,!1,m),o=q4.runKernelFunc(function(a,b){var d=a.conv2dDerInput(i,c,n);return b([c,i]),d},{dy4D:i,filter:c},function(a,b){var c=b[0],h=b[1];return{dy4D:function(){return xN(a,c,d,e,f,1,g)},filter:function(){return xP(a,h,c.shape,d,e,f,g)}}});return j?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}function xK(a){var b="number"==typeof a?[a,a,a]:2===a.length?[a[0],a[1],1]:a,c=b[0],d=b[1],e=b[2];return 1===c&&1===d&&1===e}function xL(a,b,c,d,e){p3(a.length===b.rank,function(){return"Length of inShape ("+a.length+") and rank of dy ("+b.rank+") must match"});var f=a,g=b,h=!1;4===b.rank&&(h=!0,g=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),f=[1,a[0],a[1],a[2],a[3]]);var i=f[4],j=g.shape[4];p3(5===f.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+f.length+"."}),p3(5===g.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+g.rank}),p3(5===c.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+c.rank}),p3(i===c.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+i+") must match input depth for filter "+c.shape[3]+"."}),p3(j===c.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+j+") must match output depth for filter "+c.shape[4]+"."});var k=tG(f,c.shape,d,1,e),l=q4.runKernelFunc(function(a){return a.conv3dDerInput(g,c,k)},{dy5D:g});return h?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}var xM=sf({conv1d_:function(a,b,c,d,e,f,g){void 0===e&&(e="NWC"),void 0===f&&(f=1);var h=r3(a,"x","conv1d"),i=r3(b,"filter","conv1d"),j=h,k=!1;2===h.rank&&(k=!0,j=h.as3D(1,h.shape[0],h.shape[1])),p3(3===j.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+j.rank+"."}),p3(3===i.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+i.rank+"."}),null!=g&&p3(p9(d),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+d+"."}),p3(j.shape[2]===i.shape[1],function(){return"Error in conv1d: depth of input ("+j.shape[2]+") must match input depth for filter "+i.shape[1]+"."}),p3(tN(c,f),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+c+" and dilation '"+f+"'"}),p3("NWC"===e,function(){return"Error in conv1d: got dataFormat of "+e+" but only NWC is currently supported."});var l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]),m=xN(j.as4D(j.shape[0],1,j.shape[1],j.shape[2]),l,[1,c],d,"NHWC",[1,f],g);return k?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}}),xN=sf({conv2d_:function(a,b,c,d,e,f,g){void 0===e&&(e="NHWC"),void 0===f&&(f=[1,1]);var h=r3(a,"x","conv2d"),i=r3(b,"filter","conv2d"),j=h,k=!1;3===h.rank&&(k=!0,j=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),p3(4===j.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+j.rank+"."}),p3(4===i.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+i.rank+"."}),null!=g&&p3(p9(d),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+d+"."});var l="NHWC"===e?j.shape[3]:j.shape[1];p3(l===i.shape[2],function(){return"Error in conv2d: depth of input ("+l+") must match input depth for filter "+i.shape[2]+"."}),p3(tN(c,f),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+f+"'"});var m=tO(e),n=tF(j.shape,i.shape,c,f,d,g,!1,m),o=[i,j],p=q4.runKernelFunc(function(a,b){var c=a.conv2d(j,i,n);return b([i,j]),c},{x:j,filter:i},function(a,b){var g=b[0],h=b[1];return p3(tM(f),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+f+"'"}),{x:function(){return xQ(h.shape,a,g,c,d,e)},filter:function(){return xP(h,a,g.shape,c,d,e)}}},"Conv2D",n,o);return k?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),xO=sf({conv3d_:function(a,b,c,d,e,f){void 0===e&&(e="NDHWC"),void 0===f&&(f=[1,1,1]);var g,h=r3(a,"x","conv3d"),i=r3(b,"filter","conv3d"),j=h,k=!1;4===h.rank&&(k=!0,j=h.as5D(1,h.shape[0],h.shape[1],h.shape[2],h.shape[3])),p3(5===j.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+j.rank+"."}),p3(5===i.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+i.rank+"."}),p3(j.shape[4]===i.shape[3],function(){return"Error in conv3d: depth of input ("+j.shape[4]+") must match input depth for filter "+i.shape[3]+"."}),p3((g=f,xK(c)||xK(g)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+f+"'"}),p3("NDHWC"===e,function(){return"Error in conv3d: got dataFormat of "+e+" but only NDHWC is currently supported."});var l=tG(j.shape,i.shape,c,f,d),m=q4.runKernelFunc(function(a,b){var c=a.conv3d(j,i,l);return b([j,i]),c},{x:j,$filter:i},function(a,b){p3(xK(f),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+f+"'"});var e=b[0],g=b[1];return{x:function(){return xL(e.shape,a,g,c,d)},$filter:function(){var b,f,h,i;return b=g.shape,f=e,4===e.rank&&(f=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),4===(h=a).rank&&(h=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),p3(5===f.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+f.shape+"."}),p3(5===h.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+h.shape+"."}),p3(5===b.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."}),p3(f.shape[4]===b[3],function(){return"Error in conv3dDerFilter: depth of input "+f.shape[4]+") must match input depth in filter ("+b[3]+"."}),p3(h.shape[4]===b[4],function(){return"Error in conv3dDerFilter: depth of dy ("+h.shape[4]+") must match output depth for filter ("+b[4]+")."}),i=tG(f.shape,b,c,1,d),q4.runKernelFunc(function(a){return a.conv3dDerFilter(f,h,i)},{x5D:f,dy5D:h})}}});return k?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}}),xP=sf({conv2dDerFilter_:function(a,b,c,d,e,f,g){void 0===f&&(f="NHWC");var h=a;3===a.rank&&(h=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var i=b;3===i.rank&&(i=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),p3(4===h.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+h.shape+"."}),p3(4===i.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+i.shape+"."}),p3(4===c.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+c+"."});var j="NHWC"===f?h.shape[3]:h.shape[1],k="NHWC"===f?i.shape[3]:i.shape[1];p3(j===c[2],function(){return"Error in conv2dDerFilter: depth of input "+j+") must match input depth in filter ("+c[2]+"."}),p3(k===c[3],function(){return"Error in conv2dDerFilter: depth of dy ("+k+") must match output depth for filter ("+c[3]+")."}),null!=g&&p3(p9(e),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+e+"."});var l=tO(f),m=tF(h.shape,c,d,1,e,g,!1,l);return q4.runKernelFunc(function(a){return a.conv2dDerFilter(h,i,m)},{x4D:h,dy4D:i})}}),xQ=sf({conv2dDerInput_:xJ}),xR=sf({depthwiseConv2d_:function(a,b,c,d,e,f,g){void 0===e&&(e="NHWC"),void 0===f&&(f=[1,1]);var h=r3(a,"x","depthwiseConv2d"),i=r3(b,"filter","depthwiseConv2d"),j=h,k=!1;3===h.rank&&(k=!0,j=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),p3(4===j.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+j.rank+"."}),p3(4===i.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+i.rank+"."}),p3(j.shape[3]===i.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+j.shape[3]+") must match the inChannels dimension in filter "+i.shape[2]+"."}),null==f&&(f=[1,1]),p3(tN(c,f),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+f+"'"}),null!=g&&p3(p9(d),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+g+" but got pad "+d+"."});var l=tF(j.shape,i.shape,c,f,d,g,!0),m=[j,i],n=q4.runKernelFunc(function(a,b){var c=a.depthwiseConv2D(j,i,l);return b([j,i]),c},{x:j,filter:i},function(a,b){p3(tM(f),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+f+"'"});var c=b[0],d=b[1];return{x:function(){return xS(c.shape,a,d,l)},filter:function(){return xT(c,a,d.shape,l)}}},"DepthwiseConv2dNative",l,m);return k?n.as3D(n.shape[1],n.shape[2],n.shape[3]):n}}),xS=sf({depthwiseConv2dDerInput_:function(a,b,c,d){var e=b,f=!1;3===b.rank&&(f=!0,e=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]));var g=q4.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(e,c,d)},{dy4D:e});return f?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),xT=sf({depthwiseConv2dDerFilter_:function(a,b,c,d){var e=a;3===a.rank&&(e=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var f=b;return 3===f.rank&&(f=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),q4.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(e,f,d)},{x4D:e,dy4D:f})}}),xU=sf({separableConv2d_:function(a,b,c,d,e,f,g){void 0===f&&(f=[1,1]),void 0===g&&(g="NHWC");var h=r3(a,"x","separableConv2d"),i=r3(b,"depthwiseFilter","separableConv2d"),j=r3(c,"pointwiseFilter","separableConv2d"),k=h,l=!1;if(3===h.rank&&(l=!0,k=h.as4D(1,h.shape[0],h.shape[1],h.shape[2])),"NCHW"===g)throw Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");p3(4===k.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+k.rank+"."}),p3(4===i.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+i.rank+"."}),p3(4===j.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+i.rank+"."}),p3(1===j.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+j.shape[0]+"."}),p3(1===j.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+j.shape[1]+"."});var m=i.shape[2],n=i.shape[3];p3(j.shape[2]===m*n,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+m*n+", but got "+j.shape[2]+"."});var o=xN(xR(k,i,d,e,g,f),j,1,"valid",g);return l?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),xV=sf({conv2dTranspose_:function(a,b,c,d,e,f){return xJ(c,r3(a,"x","conv2dTranspose"),r3(b,"filter","conv2dTranspose"),d,e,"NHWC",f)}}),xW=sf({conv3dTranspose_:function(a,b,c,d,e){return xL(c,r3(a,"x","conv3dTranspose"),r3(b,"filter","conv3dTranspose"),d,e)}}),xX=sf({matMul_:function(a,b,c,d){void 0===c&&(c=!1),void 0===d&&(d=!1);var e,f=r3(a,"a","matMul"),g=r3(b,"b","matMul");f=(e=q$(f,g))[0],g=e[1];var h=c?f.shape[f.rank-2]:f.shape[f.rank-1],i=d?g.shape[g.rank-1]:g.shape[g.rank-2],j=c?f.shape[f.rank-1]:f.shape[f.rank-2],k=d?g.shape[g.rank-2]:g.shape[g.rank-1],l=f.shape.slice(0,-2),m=g.shape.slice(0,-2),n=p7(l),o=p7(m);p3(f.rank>=2&&g.rank>=2&&f.rank===g.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+g.rank+"."}),p3(p8(l,m),function(){return"Error in matMul: outer dimensions ("+l+") and ("+m+") of Tensors with shapes "+f.shape+" and "+g.shape+" must match."}),p3(h===i,function(){return"Error in matMul: inner shapes ("+h+") and ("+i+") of Tensors with shapes "+f.shape+" and "+g.shape+" and transposeA="+c+" and transposeB="+d+" must match."});var p=f.shape.slice(0,-2).concat([j,k]),q=c?f.as3D(n,h,j):f.as3D(n,j,h),r=d?g.as3D(o,k,i):g.as3D(o,i,k),s={transposeA:c,transposeB:d};return q4.runKernelFunc(function(a,b){var e=a.batchMatMul(q,r,c,d);return b([q,r]),e},{a:q,b:r},function(a,b){var e=b[0],f=b[1];return c||d?!c&&d?{a:function(){return a.matMul(f,!1,!1)},b:function(){return a.matMul(e,!0,!1)}}:c&&!d?{a:function(){return f.matMul(a,!1,!0)},b:function(){return e.matMul(a,!1,!1)}}:{a:function(){return f.matMul(a,!0,!0)},b:function(){return a.matMul(e,!0,!0)}}:{a:function(){return a.matMul(f,!1,!0)},b:function(){return e.matMul(a,!0,!1)}}},"BatchMatMul",s).reshape(p)}}),xY=sf({dot_:function(a,b){var c=r3(a,"t1","dot"),d=r3(b,"t2","dot");p3((1===c.rank||2===c.rank)&&(1===d.rank||2===d.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+c.rank+" and "+d.rank+"."});var e=1===c.rank?c.size:c.shape[1],f=1===d.rank?d.size:d.shape[0];return p3(e===f,function(){return"Error in dot: inner dimensions of inputs must match, but got "+e+" and "+f+"."}),1===c.rank&&1===d.rank?c.as2D(1,-1).matMul(d.as2D(-1,1)).asScalar():1===c.rank&&2===d.rank?c.as2D(1,-1).matMul(d.as2D(d.shape[0],d.shape[1])).as1D():2===c.rank&&1===d.rank?c.matMul(d.as2D(-1,1)).as1D():c.matMul(d.as2D(d.shape[0],d.shape[1]))}}),xZ=sf({outerProduct_:function(a,b){var c=r3(a,"v1","outerProduct"),d=r3(b,"v2","outerProduct");return p3(1===c.rank&&1===d.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+c.rank+" and "+d.rank+"."}),c.as2D(-1,1).matMul(d.as2D(1,-1))}}),x$=sf({reverse_:function(a,b){var c=r3(a,"x","reverse");if(0===c.rank)return c.clone();var d=qf(b,c.shape);return q4.runKernelFunc(function(a){return a.reverse(c,d)},{$x:c},function(a){return{$x:function(){return a.reverse(d)}}}).reshapeAs(c)}}),x_=sf({reverse1d_:function(a){var b=r3(a,"x","reverse");return p3(1===b.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+b.rank+"."}),x$(b,0)}}),x0=sf({reverse2d_:function(a,b){var c=r3(a,"x","reverse");return p3(2===c.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+c.rank+"."}),x$(c,b)}}),x1=sf({reverse3d_:function(a,b){var c=r3(a,"x","reverse");return p3(3===c.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+c.rank+"."}),x$(c,b)}}),x2=sf({reverse4d_:function(a,b){var c=r3(a,"x","reverse");return p3(4===c.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+c.rank+"."}),x$(c,b)}});function x3(a,b,c,d,e,f){var g=r3(a,"x","maxPool"),h=g,i=!1;3===g.rank&&(i=!0,h=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),null==d&&(d=[1,1]),p3(4===h.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+h.rank+"."}),p3(tN(c,d),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+d+"'"}),null!=f&&p3(p9(e),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+f+" but got pad "+e+"."});var j=tD(h.shape,b,c,d,e,f);if(1===j.filterWidth&&1===j.filterHeight&&p8(j.inShape,j.outShape))return g.clone();var k=[h],l=q4.runKernelFunc(function(a,b){var c=a.maxPool(h,j);return b([h,c]),c},{x:h},function(a,f){var g=f[0],h=f[1];return{x:function(){var f,i,j,k,l,m;return f=d,j=r3(a,"dy","maxPoolBackprop"),k=r3(g,"input","maxPoolBackprop"),l=r3(h,"output","maxPoolBackprop"),p3(k.rank===j.rank,function(){return"Rank of input ("+k.rank+") does not match rank of dy ("+j.rank+")"}),null==f&&(f=[1,1]),p3(tN(c,f),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+f+"'"}),p3(4===j.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+j.rank+"."}),p3(4===k.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+k.rank+"."}),m=tD(k.shape,b,c,f,e,i),q4.runKernelFunc(function(a){return a.maxPoolBackprop(j,k,l,m)},{$dy:j,$input:k})}}},"MaxPool",j,k);return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function x4(a,b,c,d,e,f){var g=r3(a,"x","avgPool","float32");null==d&&(d=[1,1]),p3(tN(c,d),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+d+"'"});var h=g,i=!1;3===g.rank&&(i=!0,h=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),p3(4===h.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+h.rank+"."}),null!=f&&p3(p9(e),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+f+" but got pad "+e+"."});var j=tD(h.shape,b,c,d,e,f);if(1===j.filterWidth&&1===j.filterHeight&&p8(j.inShape,j.outShape))return g.clone();var k=q4.runKernelFunc(function(a){return a.avgPool(h,j)},{x:h},function(a){return{x:function(){var f,g,i,j,k,l,m,n,o;return f=h,g=d,i=r3(a,"dy","avgPoolBackprop"),p3((j=r3(f,"input","avgPoolBackprop")).rank===i.rank,function(){return"Rank of input ("+j.rank+") does not match rank of dy ("+i.rank+")"}),null==g&&(g=[1,1]),p3(tN(c,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+g+"'"}),k=j,l=i,m=!1,3===j.rank&&(m=!0,k=j.as4D(1,j.shape[0],j.shape[1],j.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),p3(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),p3(4===k.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+k.rank+"."}),n=tD(k.shape,b,c,g,e),o=q4.runKernelFunc(function(a){return a.avgPoolBackprop(l,k,n)},{dy4D:l,input4D:k}),m?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}},"AvgPool",j);return k=k.cast(g.dtype),i?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}var x5=sf({maxPool_:function(a,b,c,d,e){return x3(a,b,c,1,d,e)}}),x6=sf({avgPool_:function(a,b,c,d,e){return x4(a,b,c,1,d,e)}}),x7=sf({pool_:function(a,b,c,d,e,f){null==e&&(e=[1,1]),null==f&&(f=1),0===d&&(d="valid");var g,h,i,j,k,l,m,n,o,p,q=r3(a,"x","maxPool"),r=q,s=!1;3===q.rank&&(s=!0,r=q.as4D(1,q.shape[0],q.shape[1],q.shape[2])),p3(tN(f,e),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+f+" and dilations '"+e+"'"});var t,u=tD(r.shape,b,f,e,d),v=[u.dilationHeight,u.dilationWidth];t="same"===d?(g=[u.filterHeight,u.filterWidth],i=(h=g.map(function(a,b){return a+(a-1)*(v[b]-1)}).map(function(a){return a-1})).map(function(a){return Math.floor(a/2)}),j=h.map(function(a,b){return a-i[b]}),h.map(function(a,b){return[i[b],j[b]]})):[[0,0],[0,0]];var w=1===v[0]&&1===v[1],x=(k=[u.inHeight,u.inWidth],l=t.map(function(a){return a[0]}),n=k.concat(l,m=t.map(function(a){return a[1]})),o=v.map(function(a,b){return(a-n[b]%a)%a}),p=m.map(function(a,b){return a+o[b]}),[v.map(function(a,b){return[l[b],p[b]]}),v.map(function(a,b){return[0,o[b]]})]),y=x[0],z=x[1],A=w?d:"valid",B=w?r:s7(r,v,y),C=("avg"===c?function(){return x4(B,b,f,1,A)}:function(){return x3(B,b,f,1,A)})(),D=w?C:sP(C,v,z);return s?D.as3D(D.shape[1],D.shape[2],D.shape[3]):D}}),x8=sf({maxPool3d_:function(a,b,c,d,e,f,g){void 0===f&&(f="NDHWC");var h=r3(a,"x","maxPool3d"),i=h,j=!1;4===h.rank&&(j=!0,i=h.as5D(1,h.shape[0],h.shape[1],h.shape[2],h.shape[3])),null==g&&(g=[1,1,1]),p3(5===i.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+i.rank+"."}),p3("NDHWC"===f,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+f}),p3(tN(c,g),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+g+"'"}),null!=e&&p3(p9(d),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+d+"."});var k=tE(i.shape,b,c,g,d,e,f),l=q4.runKernelFunc(function(a,b){var c=a.maxPool3d(i,k);return b([i,c]),c},{x:i},function(a,f){var h=f[0],i=f[1];return{x:function(){var f,j,k,l,m,n,o,p,q,r;return f=g,j=r3(a,"dy","maxPool3dBackprop"),k=r3(h,"input","maxPool3dBackprop"),l=r3(i,"output","maxPool3dBackprop"),m=j,n=k,o=l,p=!1,4===k.rank&&(p=!0,m=j.as5D(1,j.shape[0],j.shape[1],j.shape[2],j.shape[3]),n=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),o=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),p3(5===m.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+m.rank+"."}),p3(5===n.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+n.rank+"."}),p3(5===o.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+o.rank+"."}),null==f&&(f=[1,1,1]),p3(tN(c,f),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+f+"'"}),null!=e&&p3(p9(d),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+d+"."}),q=tE(n.shape,b,c,f,d,e),r=q4.runKernelFunc(function(a){return a.maxPool3dBackprop(m,n,o,q)},{dy5D:m,input5D:n}),p?r.as4D(r.shape[1],r.shape[2],r.shape[3],r.shape[4]):r}}});return j?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}}),x9=sf({avgPool3d_:function(a,b,c,d,e,f,g){void 0===f&&(f="NDHWC");var h=r3(a,"x","avgPool3d","float32"),i=h,j=!1;4===h.rank&&(j=!0,i=h.as5D(1,h.shape[0],h.shape[1],h.shape[2],h.shape[3])),null==g&&(g=[1,1,1]),p3(5===i.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+i.rank+"."}),p3("NDHWC"===f,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+f}),p3(tN(c,g),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+g+"'"}),null!=e&&p3(p9(d),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+d+"."});var k=tE(i.shape,b,c,g,d,e,f),l=q4.runKernelFunc(function(a){return a.avgPool3d(i,k)},{x:i},function(a){return{x:function(){var f,h,j,k,l,m,n,o,p;return f=i,h=g,j=r3(a,"dy","avgPool3dBackprop"),k=r3(f,"input","avgPool3dBackprop"),l=j,m=k,n=!1,4===k.rank&&(n=!0,l=j.as5D(1,j.shape[0],j.shape[1],j.shape[2],j.shape[3]),m=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),p3(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),p3(5===m.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+m.rank+"."}),null==h&&(h=[1,1,1]),p3(tN(c,h),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+c+" and dilations '"+h+"'"}),null!=e&&p3(p9(d),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+d+"."}),o=tE(m.shape,b,c,h,d,e),p=q4.runKernelFunc(function(a){return a.avgPool3dBackprop(l,m,o)},{dy5D:l,input5D:m}),n?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}});return l=l.cast(i.dtype),j?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}}),ya=sf({slice_:function(a,b,c){var d,e,f=r3(a,"x","slice");if(0===f.rank)throw Error("Slicing scalar is not possible");(d="number"==typeof b?[b].concat(Array(f.rank-1).fill(0)):b.length<f.rank?b.concat(Array(f.rank-b.length).fill(0)):b.slice()).forEach(function(a){p3(-1!==a,function(){return"slice() does not support negative begin indexing."})}),e=(e=null==c?Array(f.rank).fill(-1):"number"==typeof c?[c].concat(Array(f.rank-1).fill(-1)):c.length<f.rank?c.concat(Array(f.rank-c.length).fill(-1)):c).map(function(a,b){return a>=0?a:(p3(-1===a,function(){return"Negative size values should be exactly -1 but got "+a+" for the slice() size at index "+b+"."}),f.shape[b]-d[b])}),tn(f,d,e);var g=f.shape,h={begin:d,size:e};return q4.runKernelFunc(function(a){return a.slice(f,d,e)},{x:f},function(a){for(var b=[],c=0;c<a.rank;c++)b.push([d[c],g[c]-d[c]-e[c]]);return{x:function(){return a.pad(b)}}},"Slice",h)}}),yb=sf({slice1d_:function(a,b,c){var d=r3(a,"x","slice1d");return p3(1===d.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+d.rank+" tensor"}),ya(d,[b],[c])}}),yc=sf({slice2d_:function(a,b,c){var d=r3(a,"x","slice2d");return p3(2===d.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+d.rank+" tensor"}),ya(d,b,c)}}),yd=sf({slice3d_:function(a,b,c){var d=r3(a,"x","slice3d");return p3(3===d.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+d.rank+" tensor"}),ya(d,b,c)}}),ye=sf({slice4d_:function(a,b,c){var d=r3(a,"x","slice4d");return p3(4===d.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+d.rank+" tensor"}),ya(d,b,c)}});function yf(a,b,c,d,e){return b.rank<c.rank&&(b=b.reshape(r8(b.shape,d))),a.rank<c.rank&&(a=a.reshape(r8(a.shape,d))),{x:function(){var d=a.mul(c.equal(b).cast(a.dtype));return null==e?d:d.transpose(e)}}}var yg=sf({all_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=r3(a,"x","all","bool"),e=qf(b,d.shape),f=e,g=sa(f,d.rank);null!=g&&(d=d.transpose(g),f=sc(f.length,d.rank));var h=q4.runKernelFunc(function(a){return a.all(d,f)},{$x:d});if(c){var i=r8(h.shape,e);return h.reshape(i)}return h}}),yh=sf({any_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=r3(a,"x","any","bool"),e=qf(b,d.shape),f=e,g=sa(f,d.rank);null!=g&&(d=d.transpose(g),f=sc(f.length,d.rank));var h=q4.runKernelFunc(function(a){return a.any(d,f)},{$x:d});if(c){var i=r8(h.shape,e);return h.reshape(i)}return h}}),yi=sf({argMax_:function(a,b){void 0===b&&(b=0);var c=r3(a,"x","argMax");null==b&&(b=0);var d=qf(b,c.shape),e=sa(d,c.rank);null!=e&&(c=c.transpose(e),d=sc(d.length,c.rank));var f={axis:d[0]},g=[c];return q4.runKernelFunc(function(a,b){var e=a.argMax(c,d[0]);return b([c]),e},{x:c},function(a,b){var c=b[0];return{x:function(){return sv(c)}}},"ArgMax",f,g)}}),yj=sf({argMin_:function(a,b){void 0===b&&(b=0);var c=r3(a,"x","argMin");null==b&&(b=0);var d=qf(b,c.shape),e=sa(d,c.rank);return null!=e&&(c=c.transpose(e),d=sc(d.length,c.rank)),q4.runKernelFunc(function(a,b){var e=a.argMin(c,d[0]);return b([c]),e},{$x:c},function(a,b){var c=b[0];return{$x:function(){return sv(c)}}})}}),yk=sf({logSumExp_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=r3(a,"x","logSumExp"),e=qf(b,d.shape),f=d.max(e,!0),g=d.sub(f).exp().sum(e).log(),h=f.reshape(g.shape).add(g);if(c){var i=r8(h.shape,e);return h.reshape(i)}return h}}),yl=sf({max_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=r3(a,"x","max"),e=d,f=qf(b,d.shape),g=f,h=sa(g,d.rank);null!=h&&(d=d.transpose(h),g=sc(g.length,d.rank));var i=[d],j=q4.runKernelFunc(function(a,b){var c=a.max(d,g);return b([e,c]),c},{x:d},function(a,b){return yf(a,b[1],b[0],f,h)},"Max",{axes:g},i,[!0]);if(c){var k=r8(j.shape,f);j=j.reshape(k)}return j}}),ym=sf({mean_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=r3(a,"x","mean"),e=qf(b,d.shape),f=p7(r7(d.shape,e)[1]);return tu(function(a){var d=sl(f);return{value:(d.dtype===a.dtype?a:a.cast(d.dtype)).div(d).sum(b,c),gradFunc:function(b){var c=a.shape.slice();return e.forEach(function(a){c[a]=1}),b.reshape(c).mul(sq(a.shape,"float32")).div(f)}}})(d)}}),yn=sf({min_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=r3(a,"x","min"),e=d,f=qf(b,d.shape),g=f,h=sa(g,d.rank);null!=h&&(d=d.transpose(h),g=sc(g.length,d.rank));var i=[d],j=q4.runKernelFunc(function(a,b){var c=a.min(d,g);return b([e,c]),c},{x:d},function(a,b){return yf(a,b[1],b[0],f,h)},"Min",{axes:g},i,[!0]);if(c){var k=r8(j.shape,f);j=j.reshape(k)}return j}}),yo=sf({moments_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=qf(b,(a=r3(a,"x","moments")).shape),e=a.mean(d,c),f=e.shape;c||(f=r8(e.shape,d));var g=a.toFloat().sub(e.reshape(f)).square();return{mean:e,variance:g.mean(d,c)}}}),yp=sf({sum_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=r3(a,"x","sum");"bool"===d.dtype&&(d=d.toInt());var e=qf(b,d.shape);return tu(function(a){var b=sa(e,a.rank),d=e,f=a;null!=b&&(f=a.transpose(b),d=sc(d.length,a.rank));var g=function(b){var c=a.shape.slice();return e.forEach(function(a){c[a]=1}),b.reshape(c).mul(sq(a.shape,"float32"))},h={axes:d},i=q4.runKernelFunc(function(a){return a.sum(f,d)},{x:f},function(a){return{x:function(){return g(a)}}},"Sum",h);if(c){var j=r8(i.shape,e);i=i.reshape(j)}return{value:i,gradFunc:g}})(d)}}),yq=sf({prod_:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=!1);var d=r3(a,"x","prod");"bool"===d.dtype&&(d=d.toInt());var e=qf(b,d.shape),f=sa(e,d.rank),g=e,h=d;null!=f&&(h=d.transpose(f),g=sc(g.length,d.rank));var i=q4.runKernelFunc(function(a){return a.prod(h,g)},{permutedX:h});if(c){var j=r8(i.shape,e);i=i.reshape(j)}return i}}),yr=sf({elu_:function(a){var b=r3(a,"x","elu");return q4.runKernelFunc(function(a,c){var d=a.elu(b);return c([d]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){return q4.runKernelFunc(function(b){return b.eluDer(a,c)},{dy:a,y:c})}}})}}),ys=sf({leakyRelu_:function(a,b){void 0===b&&(b=.2);var c=r3(a,"x","leakyRelu");return xg(sl(b).mul(c),c)}}),yt=sf({prelu_:function(a,b){var c=r3(a,"x","prelu"),d=r3(b,"alpha","prelu");return q4.runKernelFunc(function(a,b){var e=a.prelu(c,d);return b([c,d]),e},{x:c,alpha:d},function(a,b){var c=b[0],d=b[1],e=c.greater(0);return{x:function(){return w6(e,a,a.mul(d))},alpha:function(){var b=w6(e,sv(a),a.mul(c)),f=tB(d.shape,a.shape);return f.length>0&&(b=b.sum(f)),b.reshape(d.shape)}}},"Prelu")}}),yu=sf({relu_:function(a){var b=r3(a,"x","relu");return"bool"===b.dtype?b.toInt():q4.runKernelFunc(function(a,c){var d=a.relu(b);return c([b]),d},{x:b},function(a,b){var c=b[0];return{x:function(){return a.mulStrict(c.step().toFloat())}}},"Relu")}}),yv=sf({relu6_:function(a){var b=r3(a,"x","relu6");return"bool"===b.dtype?b.toInt():q4.runKernelFunc(function(a,c){var d=a.relu6(b);return c([b]),d},{x:b},function(a,b){var c=b[0],d=c.lessEqual(6).mul(c.step());return{x:function(){return a.mulStrict(d.toFloat())}}},"Relu6")}}),yw=sf({selu_:function(a){var b=r3(a,"x","selu");return q4.runKernelFunc(function(a,c){var d=a.selu(b);return c([b]),d},{$x:b},function(a,b){var c=b[0];return{$x:function(){var b=c.greater(sl(0)),d=sl(1.7580993408473768),e=sl(1.0507009873554805);return w6(b,a.mul(e),a.mul(d).mul(c.toFloat().exp()))}}})}}),yx=sf({transpose_:function(a,b){var c=r3(a,"x","transpose");if(null==b&&(b=c.shape.map(function(a,b){return b}).reverse()),p3(c.rank===b.length,function(){return"Error in transpose: rank of input "+c.rank+" must match length of perm "+b+"."}),b.forEach(function(a){p3(a>=0&&a<c.rank,function(){return"All entries in 'perm' must be between 0 and "+(c.rank-1)+" but got "+b})}),c.rank<=1)return c.clone();var d={perm:b};return q4.runKernelFunc(function(a){return a.transpose(c,b)},{x:c},function(a){var c=sb(b);return{x:function(){return a.transpose(c)}}},"Transpose",d)}}),yy=sf({localResponseNormalization_:function(a,b,c,d,e){void 0===b&&(b=5),void 0===c&&(c=1),void 0===d&&(d=1),void 0===e&&(e=.5);var f=r3(a,"x","localResponseNormalization");p3(4===f.rank||3===f.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+f.rank+"."}),p3(p9(b),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+b+"."});var g=f,h=!1;3===f.rank&&(h=!0,g=f.as4D(1,f.shape[0],f.shape[1],f.shape[2]));var i=q4.runKernelFunc(function(a,f){var h=a.localResponseNormalization4D(g,b,c,d,e);return f([g,h]),h},{x4D:g},function(a,f){var g=f[0],h=f[1];return{x4D:function(){return q4.runKernelFunc(function(f){return f.LRNGrad(a,g,h,b,c,d,e)},{})}}});return h?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),yz=sf({norm_:function(a,b,c,d){void 0===b&&(b="euclidean"),void 0===c&&(c=null),void 0===d&&(d=!1);var e=function a(b,c,d){if(void 0===d&&(d=null),0===b.rank)return b.abs();if(1!==b.rank&&null===d)return a(b.reshape([-1]),c,d);if(1===b.rank||"number"==typeof d||Array.isArray(d)&&1===d.length){if(1===c)return b.abs().sum(d);if(c===1/0)return b.abs().max(d);if(c===-1/0)return b.abs().min(d);if("euclidean"===c||2===c)return b.abs().pow(sl(2,"int32")).sum(d).sqrt();throw Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(d)&&2===d.length){if(1===c)return b.abs().sum(d[0]).max(d[1]-1);if(c===1/0)return b.abs().sum(d[1]).max(d[0]);if(c===-1/0)return b.abs().sum(d[1]).min(d[0]);if("fro"===c||"euclidean"===c)return b.square().sum(d).sqrt();throw Error("Error in norm: invalid ord value: "+c)}throw Error("Error in norm: invalid axis: "+d)}(a=r3(a,"x","norm"),b,c),f=e.shape;if(d){var g=qf(c,a.shape);f=r8(e.shape,g)}return e.reshape(f)}}),yA=sf({basicLSTMCell_:function(a,b,c,d,e,f){var g=r3(a,"forgetBias","basicLSTMCell"),h=r3(b,"lstmKernel","basicLSTMCell"),i=r3(c,"lstmBias","basicLSTMCell"),j=r3(d,"data","basicLSTMCell"),k=r3(e,"c","basicLSTMCell"),l=r3(f,"h","basicLSTMCell"),m=j.concat(l,1).matMul(h).add(i),n=m.shape[0],o=m.shape[1]/4,p=[n,o],q=m.slice([0,0],p),r=m.slice([0,o],p),s=m.slice([0,2*o],p),t=m.slice([0,3*o],p),u=q.sigmoid().mulStrict(r.tanh()).addStrict(k.mulStrict(g.add(s).sigmoid())),v=u.tanh().mulStrict(t.sigmoid());return[u,v]}}),yB=sf({multiRNNCell_:function(a,b,c,d){for(var e=r3(b,"data","multiRNNCell"),f=r4(c,"c","multiRNNCell"),g=r4(d,"h","multiRNNCell"),h=e,i=[],j=0;j<a.length;j++){var k=a[j](h,f[j],g[j]);i.push(k[0]),i.push(k[1]),h=k[1]}var l=[],m=[];for(j=0;j<i.length;j+=2)l.push(i[j]),m.push(i[j+1]);return[l,m]}}),yC=sf({movingAverage_:function(a,b,c,d,e){void 0===e&&(e=!0);var f=r3(a,"v","movingAverage"),g=r3(b,"x","movingAverage"),h=r3(c,"decay","movingAverage");q_(f,g),p3(p8(f.shape,g.shape),function(){return"Shape mismatch in v and x"});var i=sl(1),j=i.sub(h),k=g.sub(f).mul(j);if(e){p3(null!=d,function(){return"When using zeroDebias: true, step is required."});var l=r3(d,"step","movingAverage");k=k.div(i.sub(xo(h,l)))}return f.add(k)}}),yD=sf({stridedSlice_:function(a,b,c,d,e,f,g,h,i){if(void 0===e&&(e=0),void 0===f&&(f=0),void 0===g&&(g=0),void 0===h&&(h=0),void 0===i&&(i=0),null==d&&(d=Array(b.length)),0!==g)throw Error("ellipsis mask is not yet supported");var j=r3(a,"x","stridedSlice"),k=to(h),l=j.shape.slice();k.forEach(function(a){b[a]=0,c[a]=1,l.splice(a,0,1)}),j=j.reshape(l);for(var m=0;m<j.rank;m++)b[m]=tq(e,b,d,j.shape,m),c[m]=tr(f,c,d,j.shape,m),d[m]=d[m]||1;var n=to(i);n.forEach(function(a){c[a]=b[a]+1,d[a]=1});var o=tp(b,c,d),p=o.filter(function(a,b){return -1===n.indexOf(b)});return d.every(function(a){return 1===a})?ya(j,b,o).reshape(p):q4.runKernelFunc(function(a){return a.stridedSlice(j,b,c,d)},{$x:j}).reshape(p)}}),yE=sf({topk_:function(a,b,c){void 0===b&&(b=1),void 0===c&&(c=!0);var d=r3(a,"x","topk");if(0===d.rank)throw Error("topk() expects the input to be of rank 1 or higher");var e=d.shape[d.shape.length-1];if(b>e)throw Error("'k' passed to topk() must be <= the last dimension ("+e+") but got "+b);var f=q4.runKernelFunc(function(a){return a.topk(d,b,c)},{$x:d});return{values:f[0],indices:f[1]}}}),yF=sf({scatterND_:function(a,b,c){var d=r3(a,"indices","scatterND","int32"),e=r3(b,"updates","scatterND");return tl(e,d,c),q4.runKernelFunc(function(a){return a.scatterND(d,e,c)},{indices:d,updates:e},null,"ScatterNd",{shape:c})}}),yG=sf({fft_:function(a){p3("complex64"===a.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+a.dtype+"."});var b=a.shape[a.shape.length-1],c=a.size/b,d=a.as2D(c,b);return q4.runKernelFunc(function(a){return a.fft(d)},{input:a}).reshape(a.shape)}}),yH=sf({ifft_:function(a){p3("complex64"===a.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+a.dtype+"."});var b=a.shape[a.shape.length-1],c=a.size/b,d=a.as2D(c,b);return q4.runKernelFunc(function(a){return a.ifft(d)},{input:a}).reshape(a.shape)}}),yI=sf({rfft_:function(a,b){p3("float32"===a.dtype,function(){return"The dtype for rfft() must be real value but got "+a.dtype});var c,d=a.shape[a.shape.length-1],e=a.size/d;if(null!=b&&b<d){var f=a.shape.map(function(a){return 0}),g=a.shape.map(function(a){return a});g[a.shape.length-1]=b,c=a.slice(f,g),d=b}else if(null!=b&&b>d){var h=a.shape.map(function(a){return a});h[a.shape.length-1]=b-d,c=a.concat(sr(h),a.shape.length-1),d=b}else c=a;var i=c.zerosLike(),j=yG(sg(c,i).as2D(e,d)),k=Math.floor(d/2)+1,l=sh(j),m=si(j),n=l.split([k,d-k],l.shape.length-1),o=m.split([k,d-k],m.shape.length-1),p=c.shape.slice();return p[c.shape.length-1]=k,sg(n[0],o[0]).reshape(p)}}),yJ=sf({irfft_:function(a){var b=a.shape[a.shape.length-1],c=a.size/b;if(b<=2){var d=a.as2D(c,b),e=yH(d);return sh(e)}var f=[c,2*(b-1)],g=sh(a).as2D(c,b),h=si(a).as2D(c,b),i=g.slice([0,1],[c,b-2]).reverse(1),j=h.slice([0,1],[c,b-2]).reverse(1).mul(sl(-1));return sh(e=yH(d=sg(g.concat(i,1),h.concat(j,1)).as2D(f[0],f[1])))}}),yK=Object.freeze({fft:yG,ifft:yH,rfft:yI,irfft:yJ}),yL=sf({sparseToDense_:function(a,b,c,d){void 0===d&&(d=0);var e=r3(a,"sparseIndices","sparseToDense","int32"),f=r3(b,"sparseValues","sparseToDense"),g=r3(d,"defaultValue","sparseToDense",f.dtype);return function(a,b,c,d){if("int32"!==a.dtype)throw Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var e=a.rank>0?a.shape[0]:1,f=a.rank>1?a.shape[1]:1;if(c.length!==f)throw Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");var g=b.size;if(0!==b.rank&&(1!==b.rank||g!==e))throw Error("sparseValues has incorrect shape "+b.shape+", should be [] or ["+e+"]");if(b.dtype!==d.dtype)throw Error("sparseValues.dtype must match defaultValues.dtype")}(e,f,c,g),q4.runKernelFunc(function(a){return a.sparseToDense(e,f,c,g)},{$sparseIndices:e,$sparseValues:f,$defaultValue:g})}}),yM=sf({gatherND_:function(a,b){var c=r3(b,"indices","gatherND","int32"),d=r3(a,"x","gatherND");return q4.runKernelFunc(function(a){return a.gatherND(d,c)},{x:d,indices:c},null,"GatherNd")}}),yN=sf({diag_:function(a){var b=r3(a,"x","diag").flatten(),c=a.shape.concat(a.shape);return q4.runKernelFunc(function(a){return a.diag(b)},{$x:b}).reshape(c)}}),yO=sf({dropout_:function(a,b,c,d){var e=r3(a,"x","dropout");if(p3("float32"===e.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+e.dtype+" tensor instead."}),p3(b>=0&&b<1,function(){return"rate must be a float in the range [0, 1), but got "+b+"."}),0===b)return a instanceof qP?e.clone():e;var f=function(a,b){if(null==b)return a.shape.slice();if(p8(a.shape,b))return b;if(a.shape.length===b.length){for(var c=[],d=0;d<a.shape.length;d++)null==b[d]&&null!=a.shape[d]?c.push(a.shape[d]):c.push(b[d]);return c}return b}(e,c),g=1-b,h=s5(f,0,1,"float32",d).add(g).floor().div(g);return e.mul(h)}});function yP(a,b,c){for(var d=1-a%2,e=new Float32Array(a),f=0;f<a;++f){var g=2*Math.PI*f/(a+d-1);e[f]=b-c*Math.cos(g)}return sm(e,"float32")}var yQ=sf({hannWindow_:function(a){return yP(a,.5,.5)}}),yR=sf({hammingWindow_:function(a){return yP(a,.54,.46)}}),yS=sf({frame_:function(a,b,c,d,e){void 0===d&&(d=!1),void 0===e&&(e=0);for(var f=0,g=[];f+b<=a.size;)g.push(ya(a,f,b)),f+=c;if(d)for(;f<a.size;){var h=f+b-a.size,i=sw([ya(a,f,b-h),ss([h],e)]);g.push(i),f+=c}return 0===g.length?sn([],[0,b]):sw(g).as2D(g.length,b)}}),yT=sf({stft_:function(a,b,c,d,e){void 0===e&&(e=yQ),null==d&&(d=Math.floor(Math.pow(2,Math.ceil(Math.log(b)/Math.log(2)))));for(var f=yS(a,b,c),g=xm(f,e(b)),h=[],i=0;i<f.shape[0];i++)h.push(yI(g.slice([i,0],[1,b]),d));return sw(h)}}),yU=Object.freeze({hannWindow:yQ,hammingWindow:yR,frame:yS,stft:yT});!function(a){a[a.NONE=0]="NONE",a[a.MEAN=1]="MEAN",a[a.SUM=2]="SUM",a[a.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(zh||(zh={}));var yV=sf({absoluteDifference_:function(a,b,c,d){void 0===d&&(d=zh.SUM_BY_NONZERO_WEIGHTS);var e=r3(a,"labels","absoluteDifference"),f=r3(b,"predictions","absoluteDifference"),g=null;return null!=c&&(g=r3(c,"weights","absoluteDifference")),p4(e.shape,f.shape,"Error in absoluteDifference: "),yW(e.sub(f).abs(),g,d)}}),yW=sf({computeWeightedLoss_:function(a,b,c){void 0===c&&(c=zh.SUM_BY_NONZERO_WEIGHTS);var d=r3(a,"losses","computeWeightedLoss"),e=null;null!=b&&(e=r3(b,"weights","computeWeightedLoss"));var f=null==e?d:d.mul(e);if(c===zh.NONE)return f;if(c===zh.SUM)return f.sum();if(c===zh.MEAN){if(null==e)return f.mean();var g=d.size/e.size,h=f.sum().div(e.sum());return g>1?h.div(sl(g)):h}if(c===zh.SUM_BY_NONZERO_WEIGHTS){if(null==e)return f.sum().div(sl(d.size));var i=e.mul(sq(d.shape)).notEqual(sl(0)).sum().toFloat();return f.sum().div(i)}throw Error("Unknown reduction: "+c)}}),yX=sf({cosineDistance_:function(a,b,c,d,e){void 0===e&&(e=zh.SUM_BY_NONZERO_WEIGHTS);var f=r3(a,"labels","cosineDistance"),g=r3(b,"predictions","cosineDistance"),h=null;return null!=d&&(h=r3(d,"weights","cosineDistance")),p4(f.shape,g.shape,"Error in cosineDistance: "),yW(sl(1).sub(f.mul(g).sum(c,!0)),h,e)}}),yY=sf({hingeLoss_:function(a,b,c,d){void 0===d&&(d=zh.SUM_BY_NONZERO_WEIGHTS);var e=r3(a,"labels","hingeLoss"),f=r3(b,"predictions","hingeLoss"),g=null;null!=c&&(g=r3(c,"weights","hingeLoss")),p4(e.shape,f.shape,"Error in hingeLoss: ");var h=sl(1);return e=sl(2).mul(e).sub(h),yW(h.sub(e.mul(f)).relu(),g,d)}}),yZ=sf({huberLoss_:function(a,b,c,d,e){void 0===d&&(d=1),void 0===e&&(e=zh.SUM_BY_NONZERO_WEIGHTS);var f=r3(a,"labels","huberLoss"),g=r3(b,"predictions","huberLoss"),h=null;null!=c&&(h=r3(c,"weights","huberLoss")),p4(f.shape,g.shape,"Error in huberLoss: ");var i=sl(d),j=g.sub(f).abs(),k=xi(j,i),l=j.sub(k);return yW(sl(.5).mul(k.square()).add(i.mul(l)),h,e)}}),y$=sf({logLoss_:function(a,b,c,d,e){void 0===d&&(d=1e-7),void 0===e&&(e=zh.SUM_BY_NONZERO_WEIGHTS);var f=r3(a,"labels","logLoss"),g=r3(b,"predictions","logLoss"),h=null;null!=c&&(h=r3(c,"weights","logLoss")),p4(f.shape,g.shape,"Error in logLoss: ");var i=sl(1),j=sl(d);return yW(f.mul(g.add(j).log()).neg().sub(i.sub(f).mul(i.sub(g).add(j).log())),h,e)}}),y_=sf({meanSquaredError_:function(a,b,c,d){void 0===d&&(d=zh.SUM_BY_NONZERO_WEIGHTS);var e=r3(a,"labels","meanSquaredError"),f=r3(b,"predictions","meanSquaredError"),g=null;return null!=c&&(g=r3(c,"weights","meanSquaredError")),p4(e.shape,f.shape,"Error in meanSquaredError: "),yW(e.squaredDifference(f),g,d)}}),y0=sf({sigmoidCrossEntropy_:function(a,b,c,d,e){void 0===d&&(d=0),void 0===e&&(e=zh.SUM_BY_NONZERO_WEIGHTS);var f,g,h,i,j,k=r3(a,"multiClassLabels","sigmoidCrossEntropy"),l=r3(b,"logits","sigmoidCrossEntropy"),m=null;if(null!=c&&(m=r3(c,"weights","sigmoidCrossEntropy")),p4(k.shape,l.shape,"Error in sigmoidCrossEntropy: "),d>0){var n=sl(d),o=sl(1),p=sl(.5);k=k.mul(o.sub(n)).add(p.mul(n))}return yW((f=r3(k,"labels","sigmoidCrossEntropyWithLogits"),g=r3(l,"logits","sigmoidCrossEntropyWithLogits"),p4(f.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: "),h=g.relu(),i=g.mul(f),j=g.abs().neg().exp().log1p(),h.sub(i).add(j)),m,e)}}),y1=sf({softmaxCrossEntropy_:function(a,b,c,d,e){void 0===d&&(d=0),void 0===e&&(e=zh.SUM_BY_NONZERO_WEIGHTS);var f=r3(a,"onehotLabels","softmaxCrossEntropy"),g=r3(b,"logits","softmaxCrossEntropy"),h=null;if(null!=c&&(h=r3(c,"weights","softmaxCrossEntropy")),p4(f.shape,g.shape,"Error in softmaxCrossEntropy: "),d>0){var i=sl(d),j=sl(1),k=sl(f.shape[1]);f=f.mul(j.sub(i)).add(i.div(k))}return yW(function(a,b,c){if(void 0===c&&(c=-1),-1===c&&(c=b.rank-1),c!==b.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+b.rank+" and dim was "+c);return tu(function(a,b,d){var e=b.logSumExp([c],!0),f=b.toFloat().sub(e);return d([a,f]),{value:f.mul(a).neg().sum([c]),gradFunc:function(a,b){var d=b[0],e=b[1],f=r8(a.shape,[c]);return[a.reshape(f).mul(d.toFloat().sub(e.exp())),a.reshape(f).mul(e.exp().sub(d.toFloat()))]}}})(a,b)}(f,g),h,e)}}),y2=Object.freeze({get Reduction(){return zh},absoluteDifference:yV,computeWeightedLoss:yW,cosineDistance:yX,hingeLoss:yY,huberLoss:yZ,logLoss:y$,meanSquaredError:y_,sigmoidCrossEntropy:y0,softmaxCrossEntropy:y1});function y3(a,b){return void 0===b&&(b=!1),q4.tidy(function(){if(2!==a.shape.length)throw Error("qr2d() requires a 2D Tensor, but got a "+a.shape.length+"D Tensor.");for(var c=a.shape[0],d=a.shape[1],e=sW(c),f=a.clone(),g=sn([[1]],[1,1]),h=g.clone(),i=c>=d?d:c,j=function(a){var b,i=f,j=h,k=e;h=(b=q4.tidy(function(){var b=f.slice([a,a],[c-a,1]),i=b.norm(),j=f.slice([a,a],[1,1]),k=sn([[-1]]).where(j.greater(0),sn([[1]])),l=j.sub(k.mul(i)),m=b.div(l);h=1===m.shape[0]?g.clone():g.concat(m.slice([1,0],[m.shape[0]-1,m.shape[1]]),0);var n=k.matMul(l).div(i).neg(),o=f.slice([a,0],[c-a,d]),p=n.mul(h);if(0===a)f=o.sub(p.matMul(h.transpose().matMul(o)));else{var q=o.sub(p.matMul(h.transpose().matMul(o)));f=f.slice([0,0],[a,d]).concat(q,0)}var r=e.slice([0,a],[c,e.shape[1]-a]);if(0===a)e=r.sub(r.matMul(h).matMul(p.transpose()));else{var s=r.sub(r.matMul(h).matMul(p.transpose()));e=e.slice([0,0],[c,a]).concat(s,1)}return[h,f,e]}))[0],f=b[1],e=b[2],r_([i,j,k])},k=0;k<i;++k)j(k);return!b&&c>d&&(e=e.slice([0,0],[c,d]),f=f.slice([0,0],[d,d])),[e,f]})}var y4=Object.freeze({bandPart:sf({bandPart_:function(a,b,c){if(b%1!=0)throw Error("bandPart(): numLower must be an integer, got "+b+".");if(c%1!=0)throw Error("bandPart(): numUpper must be an integer, got "+c+".");var d=r3(a,"a","bandPart");if(d.rank<2)throw Error("bandPart(): Rank must be at least 2, got "+d.rank+".");var e=d.shape,f=d.shape.slice(-2),g=f[0],h=f[1];if(!(b<=g))throw Error("bandPart(): numLower ("+b+") must not be greater than the number of rows ("+g+").");if(!(c<=h))throw Error("bandPart(): numUpper ("+c+") must not be greater than the number of columns ("+h+").");b<0&&(b=g),c<0&&(c=h);var i=xr(st(0,g,1,"int32").reshape([-1,1]),st(0,h,1,"int32")),j=w2(i.lessEqual(sl(+b,"int32")),i.greaterEqual(sl(-c,"int32"))),k=sr([g,h],d.dtype);return s9(tc(d.reshape([-1,g,h])).map(function(a){return w6(j,a,k)})).reshape(e)}}),gramSchmidt:sf({gramSchmidt_:function(a){if(Array.isArray(a)){b=!1,p3(null!=a&&a.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var b,c=a[0].shape[0],d=function(b){p3(a[b].shape[0]===c,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+a[b].shape[0]+" vs. "+c+")"})},e=1;e<a.length;++e)d(e)}else b=!0,a=sB(a,a.shape[0],0).map(function(a){return s8(a,[0])});p3(a.length<=a[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+a.length+") exceeds number of dimensions ("+a[0].shape[0]+")."});var f=[],g=a,h=function(a){f.push(q4.tidy(function(){var b=g[a];if(a>0)for(var c=0;c<a;++c){var d=yp(f[c].mulStrict(b)).mul(f[c]);b=b.sub(d)}return b.div(yz(b,"euclidean"))}))};for(e=0;e<a.length;++e)h(e);return b?s9(f,0):f}}),qr:sf({qr_:function(a,b){if(void 0===b&&(b=!1),a.rank<2)throw Error("qr() requires input tensor to have a rank >= 2, but got rank "+a.rank);if(2===a.rank)return y3(a,b);var c=a.shape.slice(0,a.shape.length-2).reduce(function(a,b){return a*b}),d=tc(a.reshape([c,a.shape[a.shape.length-2],a.shape[a.shape.length-1]]),0),e=[],f=[];return d.forEach(function(a){var c=y3(a,b),d=c[0],g=c[1];e.push(d),f.push(g)}),[s9(e,0).reshape(a.shape),s9(f,0).reshape(a.shape)]}})});function y5(a,b,c,d,e,f){null==d&&(d=.5),null==e&&(e=-1/0),null==f&&(f=0);var g=a.shape[0];return c=Math.min(c,g),p3(0<=d&&d<=1,function(){return"iouThreshold must be in [0, 1], but was '"+d+"'"}),p3(2===a.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+a.rank+"'"}),p3(4===a.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+a.shape[1]}),p3(1===b.rank,function(){return"scores must be a 1D tensor"}),p3(b.shape[0]===g,function(){return"scores has incompatible shape with boxes. Expected "+g+", but was "+b.shape[0]}),p3(0<=f&&f<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+f+"'"}),{maxOutputSize:c,iouThreshold:d,scoreThreshold:e,softNmsSigma:f}}var y6=Object.freeze({resizeBilinear:sf({resizeBilinear_:function(a,b,c){void 0===c&&(c=!1);var d=r3(a,"images","resizeBilinear");p3(3===d.rank||4===d.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+d.rank+"."}),p3(2===b.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+b+"."});var e=d,f=!1;3===d.rank&&(f=!0,e=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]));var g=b[0],h=b[1],i=q4.runKernelFunc(function(a,b){return b([e]),a.resizeBilinear(e,g,h,c)},{x:e},function(a,b){return{x:function(){return q4.runKernelFunc(function(d){return d.resizeBilinearBackprop(a,b[0],c)},{})}}},"ResizeBilinear",{alignCorners:c,newHeight:g,newWidth:h});return f?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),resizeNearestNeighbor:sf({resizeNearestNeighbor_:function(a,b,c){void 0===c&&(c=!1);var d=r3(a,"images","resizeNearestNeighbor");p3(3===d.rank||4===d.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+d.rank+"."}),p3(2===b.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+b+"."}),p3("float32"===d.dtype||"int32"===d.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var e=d,f=!1;3===d.rank&&(f=!0,e=d.as4D(1,d.shape[0],d.shape[1],d.shape[2]));var g=b[0],h=b[1],i=q4.runKernelFunc(function(a,b){return b([e]),a.resizeNearestNeighbor(e,g,h,c)},{batchImages:e},function(a,b){return{batchImages:function(){return q4.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(a,b[0],c)},{})}}});return f?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),nonMaxSuppression:sf({nonMaxSuppression_:function(a,b,c,d,e){void 0===d&&(d=.5),void 0===e&&(e=-1/0);var f=r3(a,"boxes","nonMaxSuppression"),g=r3(b,"scores","nonMaxSuppression"),h=y5(f,g,c,d,e);c=h.maxOutputSize,d=h.iouThreshold,e=h.scoreThreshold;var i={maxOutputSize:c,iouThreshold:d,scoreThreshold:e};return q4.runKernelFunc(function(a){return a.nonMaxSuppression(f,g,c,d,e)},{boxes:f,scores:g},null,"NonMaxSuppressionV3",i)}}),nonMaxSuppressionAsync:function(a,b,c,d,e){return void 0===d&&(d=.5),void 0===e&&(e=-1/0),pS(this,void 0,void 0,function(){var f,g,h,i,j;return pT(this,function(k){switch(k.label){case 0:return f=r3(a,"boxes","nonMaxSuppressionAsync"),g=r3(b,"scores","nonMaxSuppressionAsync"),c=(h=y5(f,g,c,d,e)).maxOutputSize,d=h.iouThreshold,e=h.scoreThreshold,[4,Promise.all([f.data(),g.data()])];case 1:return j=tV((i=k.sent())[0],i[1],c,d,e),f!==a&&f.dispose(),g!==b&&g.dispose(),[2,j]}})})},nonMaxSuppressionWithScore:sf({nonMaxSuppressionWithScore_:function(a,b,c,d,e,f){void 0===d&&(d=.5),void 0===e&&(e=-1/0),void 0===f&&(f=0);var g=r3(a,"boxes","nonMaxSuppression"),h=r3(b,"scores","nonMaxSuppression"),i=y5(g,h,c,d,e,f),j={maxOutputSize:c=i.maxOutputSize,iouThreshold:d=i.iouThreshold,scoreThreshold:e=i.scoreThreshold,softNmsSigma:f=i.softNmsSigma},k=q4.runKernel("NonMaxSuppressionV5",{boxes:g,scores:h},j);return{selectedIndices:k[0],selectedScores:k[1]}}}),nonMaxSuppressionWithScoreAsync:function(a,b,c,d,e,f){return void 0===d&&(d=.5),void 0===e&&(e=-1/0),void 0===f&&(f=0),pS(this,void 0,void 0,function(){var g,h,i,j,k;return pT(this,function(l){switch(l.label){case 0:return g=r3(a,"boxes","nonMaxSuppressionAsync"),h=r3(b,"scores","nonMaxSuppressionAsync"),c=(i=y5(g,h,c,d,e,f)).maxOutputSize,d=i.iouThreshold,e=i.scoreThreshold,f=i.softNmsSigma,[4,Promise.all([g.data(),h.data()])];case 1:return k=tW((j=l.sent())[0],j[1],c,d,e,f),g!==a&&g.dispose(),h!==b&&h.dispose(),[2,k]}})})},cropAndResize:sf({cropAndResize_:function(a,b,c,d,e,f){var g=r3(a,"image","cropAndResize"),h=r3(b,"boxes","cropAndResize","float32"),i=r3(c,"boxInd","cropAndResize","int32");e=e||"bilinear",f=f||0;var j=h.shape[0];return p3(4===g.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+g.rank+"."}),p3(2===h.rank&&4===h.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+j+",4] but had shape "+h.shape+"."}),p3(1===i.rank&&i.shape[0]===j,function(){return"Error in cropAndResize: boxInd must be have size ["+j+"] but had shape "+h.shape+"."}),p3(2===d.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+d.length+"."}),p3(d[0]>=1&&d[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+d}),p3("bilinear"===e||"nearest"===e,function(){return"method must be bilinear or nearest, but was "+e}),q4.runKernelFunc(function(a,b){return a.cropAndResize(g,h,i,d,e,f)},{images:g,boxes:h,boxInd:i},null,"CropAndResize",{method:e,extrapolationValue:f,cropSize:d})}})}),y7=function(a,b){return!(a>0)||"linear"===b},y8=function(a,b,c){if(null==c||"linear"===c)return a;if("relu"===c)return a.mul(b.step());throw Error("Gradient for activation "+c+" has not been implemented yet.")},y9=function(a,b){var c=b,d=tB(a.shape,b.shape);return d.length>0&&(c=c.sum(d)),c.reshape(a.shape)},za=function(a,b,c){if("linear"===b)return a;if("relu"===b)return yu(a);if("elu"===b)return yr(a);if("relu6"===b)return yv(a);if("prelu"===b)return yt(a,c);throw Error("Unknown fused activation "+b+".")},zb=Object.freeze({image:y6,linalg:y4,losses:y2,spectral:yK,fused:Object.freeze({matMul:sf({fusedMatMul_:function(a){var b,c=a.a,d=a.b,e=a.transposeA,f=void 0!==e&&e,g=a.transposeB,h=void 0!==g&&g,i=a.bias,j=a.activation,k=void 0===j?"linear":j,l=a.preluActivationWeights;if(!1===y7(q4.state.gradientDepth,k)){var m=xX(c,d,f,h);return null!=i&&(m=w8(m,i)),za(m,k,l)}var n=r3(c,"a","fused matMul"),o=r3(d,"b","fused matMul");n=(b=q$(n,o))[0],o=b[1];var p=f?n.shape[n.rank-2]:n.shape[n.rank-1],q=h?o.shape[o.rank-1]:o.shape[o.rank-2],r=f?n.shape[n.rank-1]:n.shape[n.rank-2],s=h?o.shape[o.rank-2]:o.shape[o.rank-1],t=n.shape.slice(0,-2),u=o.shape.slice(0,-2),v=p7(t),w=p7(u);p3(n.rank>=2&&o.rank>=2&&n.rank===o.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+n.rank+" and "+o.rank+"."}),p3(p8(t,u),function(){return"Error in fused matMul: outer dimensions ("+t+") and ("+u+") of Tensors with shapes "+n.shape+" and "+o.shape+" must match."}),p3(p===q,function(){return"Error in fused matMul: inner shapes ("+p+") and ("+q+") of Tensors with shapes "+n.shape+" and "+o.shape+" and transposeA="+f+" and transposeB="+h+" must match."});var x,y,z=n.shape.slice(0,-2).concat([r,s]),A=f?n.as3D(v,p,r):n.as3D(v,r,p),B=h?o.as3D(w,s,q):o.as3D(w,q,s);null!=i&&tC(z,(x=q$(x=r3(i,"bias","fused matMul"),n)[0]).shape),null!=l&&(y=r3(l,"prelu weights","fused matMul"));var C={a:A,b:B};null!=i&&(C.bias=x),null!=l&&(C.preluActivationWeights=y);var D=[A,B];return q4.runKernelFunc(function(a,b){var c=a.fusedBatchMatMul({a:A,b:B,transposeA:f,transposeB:h,bias:x,activation:k,preluActivationWeights:y});return b([A,B,c]),c},C,function(a,b){var c=b[0],d=b[1],e=y8(a,b[2],k),g={};return null!=i&&(g={bias:function(){return y9(x,e)}}),f||h?!f&&h?Object.assign({a:function(){return e.matMul(d,!1,!1)},b:function(){return e.matMul(c,!0,!1)}},g):f&&!h?Object.assign({a:function(){return d.matMul(e,!1,!0)},b:function(){return c.matMul(e,!1,!1)}},g):Object.assign({a:function(){return d.matMul(e,!0,!0)},b:function(){return e.matMul(c,!0,!0)}},g):Object.assign({a:function(){return e.matMul(d,!1,!0)},b:function(){return c.matMul(e,!0,!1)}},g)},"_FusedMatMul",{transposeA:f,transposeB:h,activation:k},D,[!0]).reshape(z)}}),conv2d:sf({fusedConv2d_:function(a){var b=a.x,c=a.filter,d=a.strides,e=a.pad,f=a.dataFormat,g=void 0===f?"NHWC":f,h=a.dilations,i=void 0===h?[1,1]:h,j=a.dimRoundingMode,k=a.bias,l=a.activation,m=void 0===l?"linear":l,n=a.preluActivationWeights;if(m=m||"linear",!1===y7(q4.state.gradientDepth,m)){var o=xN(b,c,d,e,g,i,j);return null!=k&&(o=w8(o,k)),za(o,m,n)}var p=r3(b,"x","conv2d"),q=r3(c,"filter","conv2d"),r=p,s=!1;3===p.rank&&(s=!0,r=p.as4D(1,p.shape[0],p.shape[1],p.shape[2])),p3(4===r.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+r.rank+"."}),p3(4===q.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+q.rank+"."}),null!=j&&p3(p9(e),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+j+" but got pad "+e+"."}),p3(r.shape[3]===q.shape[2],function(){return"Error in conv2d: depth of input ("+r.shape[3]+") must match input depth for filter "+q.shape[2]+"."}),p3(tN(d,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+i+"'"}),p3("NHWC"===g,function(){return"Error in conv2d: got dataFormat of "+g+" but only NHWC is currently supported."});var t,u,v=tF(r.shape,q.shape,d,i,e,j);null!=k&&(t=q$(t=r3(k,"bias","fused conv2d"),p)[0],tC(v.outShape,t.shape)),null!=n&&(u=r3(n,"prelu weights","fused conv2d"));var w={x:r,filter:q};null!=k&&(w.bias=t),null!=n&&(w.preluActivationWeights=u);var x=[q,r],y=q4.runKernelFunc(function(a,b){var c=a.fusedConv2d({input:r,filter:q,convInfo:v,bias:t,activation:m,preluActivationWeights:u});return b([q,r,c]),c},w,function(a,b){var c=b[0],f=b[1],g=y8(a,b[2],m);p3(tM(i),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var h={};return null!=k&&(h={bias:function(){return y9(t,g)}}),Object.assign({x:function(){return xQ(f.shape,g,c,d,e)},filter:function(){return xP(f,g,c.shape,d,e)}},h)},"FusedConv2D",{convInfo:v,activation:m},x,[!0]);return s?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),depthwiseConv2d:sf({fusedDepthwiseConv2d_:function(a){var b=a.x,c=a.filter,d=a.strides,e=a.pad,f=a.dataFormat,g=a.dilations,h=void 0===g?[1,1]:g,i=a.dimRoundingMode,j=a.bias,k=a.activation,l=void 0===k?"linear":k,m=a.preluActivationWeights;if(!1===y7(q4.state.gradientDepth,l)){var n=xR(b,c,d,e,void 0===f?"NHWC":f,h,i);return null!=j&&(n=w8(n,j)),za(n,l,m)}var o=r3(b,"x","depthwiseConv2d"),p=r3(c,"filter","depthwiseConv2d"),q=o,r=!1;3===o.rank&&(r=!0,q=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),p3(4===q.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+q.rank+"."}),p3(4===p.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+p.rank+"."}),p3(q.shape[3]===p.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+q.shape[3]+") must match the inChannels dimension in filter "+p.shape[2]+"."}),null==h&&(h=[1,1]),p3(tN(d,h),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+d+" and dilations '"+h+"'"}),null!=i&&p3(p9(e),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+i+" but got pad "+e+"."});var s,t,u=tF(q.shape,p.shape,d,h,e,i,!0);null!=j&&(s=q$(s=r3(j,"bias","fused conv2d"),o)[0],tC(u.outShape,s.shape)),null!=m&&(t=r3(m,"prelu weights","fused depthwiseConv2d"));var v={x:q,filter:p};null!=j&&(v.bias=s),null!=m&&(v.preluActivationWeights=t);var w=[p,q],x=q4.runKernelFunc(function(a,b){var c=a.fusedDepthwiseConv2D({input:q,filter:p,convInfo:u,bias:s,activation:l,preluActivationWeights:t});return b([p,q,c]),c},v,function(a,b){p3(tM(h),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+h+"'"});var c=b[0],d=b[1],e=y8(a,b[2],l),f={};return null!=j&&(f={bias:function(){return y9(s,e)}}),Object.assign({x:function(){return xS(d.shape,e,c,u)},filter:function(){return xT(d,e,c.shape,u)}},f)},"FusedDepthwiseConv2D",{convInfo:u,activation:l},w,[!0]);return r?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}})}),signal:yU,square:wf,squaredDifference:wh,conv1d:xM,conv2d:xN,conv3d:xO,depthwiseConv2d:xR,separableConv2d:xU,conv2dTranspose:xV,conv3dTranspose:xW,op:sf,batchNormalization2d:wW,batchNormalization3d:wX,batchNormalization4d:wY,batchNormalization:wZ,batchNorm:w$,batchNorm2d:w_,batchNorm3d:w0,batchNorm4d:w1,booleanMaskAsync:function(a,b,c){return pS(this,void 0,void 0,function(){var d,e,f,g,h,i,j,k,l,m,n,o,p;return pT(this,function(q){switch(q.label){case 0:for(d=r3(a,"tensor","boolMask"),e=r3(b,"mask","boolMask","bool"),f=null==c?0:c,g=e.rank,h=d.shape,p3(g>0,function(){return"mask cannot be scalar"}),p4(h.slice(f,f+g),e.shape,"mask's shape must match the first K dimensions of tensor's shape,"),i=1,j=f;j<f+g;j++)i*=h[j];return k=h.slice(0,f).concat([i],h.slice(f+g)),l=d.reshape(k),[4,w7(m=e.reshape([-1]))];case 1:return o=(n=q.sent()).squeeze([1]),p=xH(l,o,f),a!==d&&d.dispose(),b!==e&&e.dispose(),o.dispose(),l.dispose(),m.dispose(),n.dispose(),[2,p]}})})},complex:sg,real:sh,imag:si,concat:sw,concat1d:sx,concat2d:sy,concat3d:sz,concat4d:sA,split:sB,matMul:xX,dot:xY,outerProduct:xZ,reverse:x$,reverse1d:x_,reverse2d:x0,reverse3d:x1,reverse4d:x2,maxPool:x5,avgPool:x6,pool:x7,maxPool3d:x8,avgPool3d:x9,slice:ya,slice1d:yb,slice2d:yc,slice3d:yd,slice4d:ye,abs:wi,acos:wj,acosh:wk,asin:wl,asinh:wm,atan:wn,atanh:wo,ceil:wp,clipByValue:wq,cos:wr,cosh:ws,erf:wt,exp:wu,expm1:wv,floor:ww,log:wx,log1p:wy,logSigmoid:wz,neg:wA,reciprocal:wB,round:wC,rsqrt:wD,sigmoid:wE,sign:wF,isNaN:wG,isInf:wH,isFinite:wI,sin:wJ,sinh:wK,softplus:wL,sqrt:wM,step:wN,tan:wO,tanh:wP,all:yg,any:yh,argMax:yi,argMin:yj,logSumExp:yk,max:yl,mean:ym,min:yn,moments:yo,sum:yp,prod:yq,equal:xt,equalStrict:xu,greater:xv,greaterEqual:xw,greaterEqualStrict:xx,greaterStrict:xy,less:xz,lessEqual:xA,lessEqualStrict:xB,lessStrict:xC,notEqual:xD,notEqualStrict:xE,add:w8,addN:w9,addStrict:xa,atan2:xb,div:xc,divNoNan:xd,divStrict:xe,floorDiv:xf,maximum:xg,maximumStrict:xh,minimum:xi,minimumStrict:xj,mod:xk,modStrict:xl,mul:xm,mulStrict:xn,pow:xo,powStrict:xp,squaredDifferenceStrict:xq,sub:xr,subStrict:xs,elu:yr,leakyRelu:ys,prelu:yt,relu:yu,relu6:yv,selu:yw,logicalAnd:w2,logicalNot:w3,logicalOr:w4,logicalXor:w5,where:w6,whereAsync:w7,buffer:sO,print:function(a,b){void 0===b&&(b=!1),console.log(a.toString(b))},batchToSpaceND:sP,broadcastTo:sQ,cast:sR,clone:sS,cumsum:sT,depthToSpace:sU,expandDims:sV,eye:sW,multinomial:sX,oneHot:sY,pad:sZ,pad1d:s$,pad2d:s_,pad3d:s0,pad4d:s1,rand:s2,randomNormal:s3,randomGamma:s4,randomUniform:s5,reshape:s6,spaceToBatchND:s7,squeeze:s8,stack:s9,tile:ta,truncatedNormal:tb,unstack:tc,setdiff1dAsync:function(a,b){return pS(this,void 0,void 0,function(){var c,d,e,f,g,h,i,j,k;return pT(this,function(l){switch(l.label){case 0:return c=r3(a,"x","setdiff1d"),d=r3(b,"y","setdiff1d"),p3(c.dtype===d.dtype,function(){return"x and y should have the same dtype, but got x ("+c.dtype+") and y ("+d.dtype+")."}),p3(1===c.rank,function(){return"x should be 1D tensor, but got x ("+c.shape+")."}),p3(1===d.rank,function(){return"y should be 1D tensor, but got y ("+d.shape+")."}),[4,c.data()];case 1:return e=l.sent(),[4,d.data()];case 2:for(f=new Set(l.sent()),g=0,j=0;j<e.length;j++)f.has(e[j])||g++;for(h=new qL([g],c.dtype),i=new qL([g],"int32"),j=0,k=0;j<e.length;j++)f.has(e[j])||(h.values[k]=e[j],i.values[k]=j,k++);return[2,[h.toTensor(),i.toTensor()]]}})})},fill:ss,linspace:function(a,b,c){if(c<=0)throw Error("The number of values should be positive.");return q4.runKernelFunc(function(d){return d.linspace(a,b,c)},{})},ones:sq,range:st,scalar:sl,tensor:sj,tensor1d:sm,tensor2d:sn,tensor3d:so,tensor4d:sp,tensor5d:function(a,b,c){if(p5(a),null!=b&&5!==b.length)throw Error("tensor5d() requires shape to have five numbers");var d=r1(a,c);if(5!==d.length&&1!==d.length)throw Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===d.length&&null==b)throw Error("tensor5d() requires shape to be provided when `values` are a flat array");return sk(a,b,d,c)},tensor6d:function(a,b,c){if(p5(a),null!=b&&6!==b.length)throw Error("tensor6d() requires shape to have six numbers");var d=r1(a,c);if(6!==d.length&&1!==d.length)throw Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===d.length&&null==b)throw Error("tensor6d() requires shape to be provided when `values` are a flat array");return sk(a,b=b||d,d,c)},variable:function(a,b,c,d){return void 0===b&&(b=!0),q4.makeVariable(a,b,c,d)},zeros:sr,onesLike:su,zerosLike:sv,transpose:yx,softmax:tv,logSoftmax:tw,localResponseNormalization:yy,norm:yz,gather:xH,unsortedSegmentSum:xI,basicLSTMCell:yA,multiRNNCell:yB,movingAverage:yC,stridedSlice:yD,topk:yE,scatterND:yF,fft:yG,ifft:yH,rfft:yI,irfft:yJ,sparseToDense:yL,gatherND:yM,diag:yN,dropout:yO,hannWindow:yQ,hammingWindow:yR,frame:yS,stft:yT,inTopKAsync:function(a,b,c){return void 0===c&&(c=1),pS(this,void 0,void 0,function(){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;return pT(this,function(r){switch(r.label){case 0:return d=r3(a,"predictions","inTopK"),e=r3(b,"targets","inTopK"),p3(d.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+d.rank}),p3(d.rank-1===e.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+d.rank+" and targets rank "+e.rank}),p4(d.shape.slice(0,d.shape.length-1),e.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),f=d.shape[d.shape.length-1],p3(c>0&&c<=f,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+f+"), but got "+c}),[4,d.data()];case 1:return g=r.sent(),[4,e.data()];case 2:for(h=r.sent(),k=(i=[g.length/f,f])[1],l=qh("bool",j=i[0]),m=0;m<j;m++){for(n=m*k,o=g.subarray(n,n+k),p=[],q=0;q<o.length;q++)p.push({value:o[q],index:q});for(p.sort(function(a,b){return b.value-a.value}),l[m]=0,q=0;q<c;q++)if(p[q].index===h[m]){l[m]=1;break}}return a!==d&&d.dispose(),b!==e&&e.dispose(),[2,sj(l,e.shape,"bool")]}})})}});function zc(a,b){Array.isArray(a)||(a=[a]),a.forEach(function(a){null!=a&&p3("complex64"!==a.dtype,function(){return b+" does not support complex64 tensors."})})}function zd(a,b,c,d){if("linear"===c)return a.linear(b);if("relu"===c)return a.relu(b);if("elu"===c)return a.elu(b);if("relu6"===c)return a.relu6(b);if("prelu"===c)return a.prelu(b,d);throw Error("Activation "+c+" has not been implemented for the CPU backend.")}var ze=function(a){function b(){var b=a.call(this)||this;return b.blockSize=48,b.firstUse=!0,b.data=new tx(b,q4),b}return pR(b,a),b.prototype.write=function(a,b,c){this.firstUse&&(this.firstUse=!1,pV.get("IS_NODE")&&r0("\n============================\nHi there \uD83D\uDC4B. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var d={};return this.data.set(d,{values:a,dtype:c}),d},b.prototype.move=function(a,b,c,d){this.data.set(a,{values:b,dtype:d})},b.prototype.numDataIds=function(){return this.data.numDataIds()},b.prototype.read=function(a){return pS(this,void 0,void 0,function(){return pT(this,function(b){return[2,this.readSync(a)]})})},b.prototype.readSync=function(a){var b=this.data.get(a),c=b.dtype,d=b.complexTensors;return"complex64"===c?tS(this.readSync(d.real.dataId),this.readSync(d.imag.dataId)):this.data.get(a).values},b.prototype.bufferSync=function(a){var b=this.readSync(a.dataId),c=b;if("string"===a.dtype)try{c=b.map(function(a){return qD(a)})}catch(a){throw Error("Failed to decode encoded string bytes into utf-8")}return sO(a.shape,a.dtype,c)},b.prototype.makeOutput=function(a,b,c){var d=this.write(a,b,c);return q4.makeTensorFromDataId(d,b,c,this)},b.prototype.disposeData=function(a){if(this.data.has(a)){var b=this.data.get(a).complexTensors;null!=b&&(b.real.dispose(),b.imag.dispose()),this.data.delete(a)}},b.prototype.time=function(a){return pS(this,void 0,void 0,function(){var b;return pT(this,function(c){return b=qA(),a(),[2,{kernelMs:qA()-b}]})})},b.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},b.prototype.complex=function(a,b){var c=this.makeOutput(null,a.shape,"complex64");return this.data.get(c.dataId).complexTensors={real:q4.keep(a.clone()),imag:q4.keep(b.clone())},c},b.prototype.real=function(a){return this.data.get(a.dataId).complexTensors.real.clone()},b.prototype.imag=function(a){return this.data.get(a.dataId).complexTensors.imag.clone()},b.prototype.slice=function(a,b,c){if(zc(a,"slice"),ts(a.shape,b,c)){var d=tt(b,a.strides),e=p7(c);return sj(this.readSync(a.dataId).subarray(d,d+e),c,a.dtype)}for(var f=sO(c,a.dtype),g=this.bufferSync(a),h=0;h<f.size;++h){var i=f.indexToLoc(h).map(function(a,c){return a+b[c]});f.values[h]=g.get.apply(g,i)}return f.toTensor()},b.prototype.stridedSlice=function(a,b,c,d){zc(a,"stridedSlice");var e=tp(b,c,d);if(e.some(function(a){return 0===a}))return sj([],e);for(var f=sO(e,a.dtype),g=this.bufferSync(a),h=0;h<f.size;h++){for(var i=f.indexToLoc(h),j=Array(i.length),k=0;k<j.length;k++)j[k]=i[k]*d[k]+b[k];f.set.apply(f,[g.get.apply(g,j)].concat(i))}return f.toTensor()},b.prototype.diag=function(a){for(var b=this.readSync(a.dataId),c=sO([a.size,a.size],a.dtype),d=c.values,e=0;e<b.length;e++)d[e*a.size+e]=b[e];return c.toTensor()},b.prototype.unstack=function(a,b){for(var c=a.shape[b],d=Array(a.rank-1),e=0,f=0;f<a.rank;f++)f!==b&&(d[e++]=a.shape[f]);var g=Array(a.rank).fill(0),h=a.shape.slice();h[b]=1;var i=Array(c);for(f=0;f<i.length;f++)g[b]=f,i[f]=this.slice(a,g,h).reshape(d);return i},b.prototype.reverse=function(a,b){zc(a,"reverse");for(var c=sO(a.shape,a.dtype),d=this.bufferSync(a),e=0;e<c.size;e++)!function(e){var f=c.indexToLoc(e),g=f.slice();b.forEach(function(b){return g[b]=a.shape[b]-1-g[b]}),c.set.apply(c,[d.get.apply(d,g)].concat(f))}(e);return c.toTensor()},b.prototype.concat=function(a,b){var c=this;if("complex64"===a[0].dtype){var d=a.map(function(a){return sh(a)}),e=a.map(function(a){return si(a)});return sg(this.concat(d,b),this.concat(e,b))}var f=a.map(function(a){var c=p7(a.shape.slice(b));return a.as2D(-1,c)}),g=se(f.map(function(a){return a.shape}),1),h=sO(g,a[0].dtype).values;if(1===f[0].shape[0]){var i=0;f.forEach(function(a){h.set(c.readSync(a.dataId),i),i+=a.size})}else{var j=0;f.forEach(function(a){for(var b=c.readSync(a.dataId),d=0,e=0;e<a.shape[0];++e)for(var f=e*g[1]+j,i=0;i<a.shape[1];++i)h[f+i]=b[d++];j+=a.shape[1]})}return sj(h,se(a.map(function(a){return a.shape}),b),a[0].dtype)},b.prototype.neg=function(a){return zc(a,"neg"),this.multiply(sl(-1),a)},b.prototype.add=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(a,b,c,d){return{real:a+c,imag:b+d}}):this.broadcastedBinaryOp(a,b,qY(a.dtype,b.dtype),function(a,b){return a+b})},b.prototype.addN=function(a){var b=this;zc(a,"addN");for(var c=a.map(function(a){return b.readSync(a.dataId)}),d=sO(a[0].shape,a[0].dtype),e=d.values,f=0;f<a.length;f++)for(var g=c[f],h=0;h<e.length;h++)e[h]+=g[h];return d.toTensor()},b.prototype.softmax=function(a,b){var c=qf([b],a.shape),d=this.max(a,c),e=r8(d.shape,c),f=this.subtract(a,d.reshape(e)),g=this.exp(f),h=this.sum(g,c).reshape(e);return this.realDivide(g,h)},b.prototype.subtract=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(a,b,c,d){return{real:a-c,imag:b-d}}):this.broadcastedBinaryOp(a,b,qY(a.dtype,b.dtype),function(a,b){return a-b})},b.prototype.pow=function(a,b){return zc([a,b],"pow"),this.broadcastedBinaryOp(a,b,a.dtype,function(a,b){return Math.pow(a,b)})},b.prototype.batchMatMul=function(a,b,c,d){zc([a,b],"matMul");for(var e=c?a.shape[1]:a.shape[2],f=c?a.shape[2]:a.shape[1],g=d?b.shape[1]:b.shape[2],h=a.shape[0],i=this.readSync(a.dataId),j=this.readSync(b.dataId),k=c?[a.strides[0],1,a.strides[1]]:[a.strides[0],a.strides[1],1],l=k[0],m=k[1],n=k[2],o=d?[1,b.strides[1],b.strides[0]]:[b.strides[1],1,b.strides[0]],p=o[0],q=o[1],r=o[2],s=f*g,t=sO([h,f,g],a.dtype),u=t.values,v=this.blockSize,w=0;w<h;w++)for(var x=0;x<f;x+=v)for(var y=0;y<g;y+=v)for(var z=0;z<e;z+=v)for(var A=Math.min(x+v,f),B=Math.min(y+v,g),C=Math.min(z+v,e),D=x;D<A;D++)for(var E=y;E<B;E++){for(var F=0,G=z;G<C;G++)F+=i[w*l+D*m+G*n]*j[G*p+E*q+w*r];u[w*s+(D*g+E)]+=F}return t.toTensor()},b.prototype.fusedBatchMatMul=function(a){var b=a.a,c=a.b,d=a.transposeA,e=a.transposeB,f=a.bias,g=a.activation,h=a.preluActivationWeights,i=this.batchMatMul(b,c,d,e);return f&&(i=this.add(i,f)),g&&(i=zd(this,i,g,h)),i},b.prototype.multiply=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(a,b,c,d){return{real:a*c-b*d,imag:a*d+b*c}}):this.broadcastedBinaryOp(a,b,qY(a.dtype,b.dtype),function(a,b){return a*b})},b.prototype.realDivide=function(a,b){return zc([a,b],"realDivide"),this.broadcastedBinaryOp(a,b,"float32",function(a,b){return a/b})},b.prototype.floorDiv=function(a,b){return zc([a,b],"floorDiv"),this.broadcastedBinaryOp(a,b,"int32",function(a,b){return Math.floor(a/b)})},b.prototype.sum=function(a,b){zc(a,"sum"),r9("sum",b,a.rank);for(var c=r7(a.shape,b),d=c[0],e=c[1],f=sr(d,qY(a.dtype,"int32")),g=p7(e),h=this.readSync(f.dataId),i=this.readSync(a.dataId),j=0;j<h.length;++j){for(var k=j*g,l=0,m=0;m<g;++m)l+=i[k+m];h[j]=l}return f},b.prototype.prod=function(a,b){zc(a,"sum");for(var c=r7(a.shape,b),d=c[0],e=c[1],f=sr(d,qY(a.dtype,"int32")),g=p7(e),h=this.readSync(f.dataId),i=this.readSync(a.dataId),j=0;j<h.length;++j){for(var k=j*g,l=1,m=0;m<g;++m)l*=i[k+m];h[j]=l}return f},b.prototype.unsortedSegmentSum=function(a,b,c){zc(a,"unsortedSegmentSum");for(var d=[],e=a.rank-b.rank,f=0;f<e;++f)b=b.expandDims(f+1);for(f=0;f<c;++f){var g=xt(sl(f,"int32"),b).asType("float32").mul(a).sum(0);d.push(g)}return s9(d)},b.prototype.argMin=function(a,b){zc(a,"argMin");var c=[b];r9("argMin",c,a.rank);for(var d=r7(a.shape,c),e=d[0],f=d[1],g=sr(e,"int32"),h=p7(f),i=this.readSync(g.dataId),j=this.readSync(a.dataId),k=0;k<i.length;++k){for(var l=k*h,m=j[l],n=0,o=0;o<h;++o){var p=j[l+o];p<m&&(m=p,n=o)}i[k]=n}return g},b.prototype.argMax=function(a,b){zc(a,"argMax");var c=[b];r9("argMax",c,a.rank);for(var d=r7(a.shape,c),e=d[0],f=d[1],g=sr(e,"int32"),h=p7(f),i=this.readSync(g.dataId),j=this.readSync(a.dataId),k=0;k<i.length;++k){for(var l=k*h,m=j[l],n=0,o=0;o<h;++o){var p=j[l+o];p>m&&(m=p,n=o)}i[k]=n}return g},b.prototype.cumsum=function(a,b,c,d){if(zc(a,"cumsum"),b!==a.rank-1)throw Error("backend.cumsum in CPU expects an inner-most axis="+(a.rank-1)+" but got axis="+b);for(var e=qY(a.dtype,"int32"),f=sr(a.shape,e),g=this.readSync(f.dataId),h=this.readSync(a.dataId),i=a.shape[a.rank-1],j=d?function(a,b){return a+i-b-1}:function(a,b){return a+b},k=0;k<h.length;k+=i)for(var l=0;l<i;l++){var m=j(k,l);if(0===l)g[m]=c?0:h[m];else{var n=j(k,l-1);g[m]=c?h[n]+g[n]:h[m]+g[n]}}return f},b.prototype.equal=function(a,b){return zc([a,b],"equal"),this.broadcastedBinaryOp(a,b,"bool",function(a,b){return+(a===b)})},b.prototype.notEqual=function(a,b){return zc([a,b],"notEqual"),this.broadcastedBinaryOp(a,b,"bool",function(a,b){return+(a!==b)})},b.prototype.less=function(a,b){return zc([a,b],"less"),this.broadcastedBinaryOp(a,b,"bool",function(a,b){return+(a<b)})},b.prototype.lessEqual=function(a,b){return zc([a,b],"lessEqual"),this.broadcastedBinaryOp(a,b,"bool",function(a,b){return+(a<=b)})},b.prototype.greater=function(a,b){return zc([a,b],"greater"),this.broadcastedBinaryOp(a,b,"bool",function(a,b){return+(a>b)})},b.prototype.greaterEqual=function(a,b){return zc([a,b],"greaterEqual"),this.broadcastedBinaryOp(a,b,"bool",function(a,b){return+(a>=b)})},b.prototype.logicalNot=function(a){zc(a,"logicalNot");for(var b=this.readSync(a.dataId),c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=+!b[d];return this.makeOutput(c,a.shape,"bool")},b.prototype.logicalAnd=function(a,b){return zc([a,b],"logicalAnd"),this.broadcastedBinaryOp(a,b,"bool",function(a,b){return a&&b})},b.prototype.logicalOr=function(a,b){return zc([a,b],"logicalOr"),this.broadcastedBinaryOp(a,b,"bool",function(a,b){return a||b})},b.prototype.select=function(a,b,c){zc([a,b,c],"select");for(var d=this.readSync(a.dataId),e=this.readSync(b.dataId),f=this.readSync(c.dataId),g=sr(b.shape,qY(b.dtype,c.dtype)),h=this.readSync(g.dataId),i=0,j=0===a.rank||a.rank>1||1===b.rank?1:p7(b.shape.slice(1)),k=0;k<d.length;k++)for(var l=0;l<j;l++)1===d[k]?h[i++]=e[k]:h[i++]=f[k];return g},b.prototype.where=function(a){zc([a],"where");var b=this.readSync(a.dataId);return t0(a.shape,b)},b.prototype.topk=function(a,b,c){return zc(a,"topk"),t_(this.readSync(a.dataId),a.shape,a.dtype,b)},b.prototype.min=function(a,b){zc(a,"min"),r9("min",b,a.rank);for(var c=r7(a.shape,b),d=c[0],e=c[1],f=sr(d,a.dtype),g=p7(e),h=this.readSync(f.dataId),i=this.readSync(a.dataId),j=0;j<h.length;++j){for(var k=j*g,l=i[k],m=0;m<g;++m){var n=i[k+m];n<l&&(l=n)}h[j]=l}return f},b.prototype.minimum=function(a,b){return zc([a,b],"minimum"),this.broadcastedBinaryOp(a,b,a.dtype,function(a,b){return Math.min(a,b)})},b.prototype.mod=function(a,b){return zc([a,b],"mod"),this.broadcastedBinaryOp(a,b,a.dtype,function(a,b){var c=a%b;return a<0&&b<0||a>=0&&b>=0?c:(c+b)%b})},b.prototype.max=function(a,b){zc(a,"max"),r9("max",b,a.rank);for(var c=r7(a.shape,b),d=c[0],e=c[1],f=sr(d,a.dtype),g=p7(e),h=this.readSync(f.dataId),i=this.readSync(a.dataId),j=0;j<h.length;++j){for(var k=j*g,l=i[k],m=0;m<g;++m){var n=i[k+m];n>l&&(l=n)}h[j]=l}return f},b.prototype.maximum=function(a,b){return zc([a,b],"maximum"),this.broadcastedBinaryOp(a,b,a.dtype,function(a,b){return Math.max(a,b)})},b.prototype.all=function(a,b){zc(a,"all"),r9("all",b,a.rank);for(var c=r7(a.shape,b),d=c[0],e=c[1],f=sr(d,a.dtype),g=p7(e),h=this.readSync(f.dataId),i=this.readSync(a.dataId),j=0;j<h.length;++j){for(var k=j*g,l=i[k],m=0;m<g;++m){var n=i[k+m];l=l&&n}h[j]=l}return f},b.prototype.any=function(a,b){zc(a,"any"),r9("any",b,a.rank);for(var c=r7(a.shape,b),d=c[0],e=c[1],f=sr(d,a.dtype),g=p7(e),h=this.readSync(f.dataId),i=this.readSync(a.dataId),j=0;j<h.length;++j){for(var k=j*g,l=i[k],m=0;m<g;++m){var n=i[k+m];l=l||n}h[j]=l}return f},b.prototype.squaredDifference=function(a,b){return zc([a,b],"squaredDifference"),this.broadcastedBinaryOp(a,b,a.dtype,function(a,b){var c=a-b;return c*c})},b.prototype.ceil=function(a){zc(a,"ceil");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d)c[d]=Math.ceil(b[d]);return this.makeOutput(c,a.shape,"float32")},b.prototype.floor=function(a){zc(a,"floor");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d)c[d]=Math.floor(b[d]);return this.makeOutput(c,a.shape,"float32")},b.prototype.sign=function(a){zc(a,"x");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d)b[d]<0?c[d]=-1:b[d]>0?c[d]=1:c[d]=0;return this.makeOutput(c,a.shape,"float32")},b.prototype.isNaN=function(a){zc(a,"x");for(var b=this.readSync(a.dataId),c=new Uint8Array(b.length),d=0;d<b.length;++d)Number.isNaN(b[d])&&(c[d]=1);return this.makeOutput(c,a.shape,"bool")},b.prototype.isInf=function(a){zc(a,"x");for(var b=this.readSync(a.dataId),c=new Uint8Array(b.length),d=0;d<b.length;++d)Math.abs(b[d])===1/0&&(c[d]=1);return this.makeOutput(c,a.shape,"bool")},b.prototype.isFinite=function(a){zc(a,"x");for(var b=this.readSync(a.dataId),c=new Uint8Array(b.length),d=0;d<b.length;++d)Number.isFinite(b[d])&&(c[d]=1);return this.makeOutput(c,a.shape,"bool")},b.prototype.round=function(a){zc(a,"round");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d){var e=Math.floor(b[d]);b[d]-e<.5?c[d]=Math.floor(b[d]):b[d]-e>.5?c[d]=Math.ceil(b[d]):c[d]=e%2==0?e:e+1}return this.makeOutput(c,a.shape,"float32")},b.prototype.exp=function(a){zc(a,"exp");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d)c[d]=Math.exp(b[d]);return this.makeOutput(c,a.shape,"float32")},b.prototype.expm1=function(a){zc(a,"expm1");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d)c[d]=Math.expm1(b[d]);return this.makeOutput(c,a.shape,"float32")},b.prototype.log=function(a){zc(a,"log");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d){var e=b[d];c[d]=Math.log(e)}return this.makeOutput(c,a.shape,"float32")},b.prototype.log1p=function(a){zc(a,"log1p");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d){var e=b[d];c[d]=Math.log1p(e)}return this.makeOutput(c,a.shape,"float32")},b.prototype.sqrt=function(a){zc(a,"sqrt");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d){var e=b[d];c[d]=Math.sqrt(e)}return this.makeOutput(c,a.shape,"float32")},b.prototype.rsqrt=function(a){zc(a,"rsqrt");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d){var e=b[d];c[d]=1/Math.sqrt(e)}return this.makeOutput(c,a.shape,"float32")},b.prototype.reciprocal=function(a){zc(a,"reciprocal");for(var b=this.readSync(a.dataId),c=new Float32Array(b.length),d=0;d<b.length;++d)c[d]=1/b[d];return this.makeOutput(c,a.shape,"float32")},b.prototype.linear=function(a){return a},b.prototype.relu=function(a){zc(a,"relu");for(var b=sr(a.shape,a.dtype),c=this.readSync(b.dataId),d=this.readSync(a.dataId),e=0;e<d.length;++e)c[e]=Math.max(0,d[e]);return b},b.prototype.relu6=function(a){zc(a,"relu");for(var b=sr(a.shape,a.dtype),c=this.readSync(b.dataId),d=this.readSync(a.dataId),e=0;e<d.length;++e)c[e]=Math.min(Math.max(0,d[e]),6);return b},b.prototype.prelu=function(a,b){return zc([a,b],"prelu"),this.broadcastedBinaryOp(a,b,a.dtype,function(a,b){return a<0?b*a:a})},b.prototype.elu=function(a){zc(a,"elu");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d){var e=c[d];b[d]=e>=0?e:Math.exp(e)-1}return this.makeOutput(b,a.shape,"float32")},b.prototype.eluDer=function(a,b){zc([a,b],"eluDer");for(var c=new Float32Array(b.size),d=this.readSync(b.dataId),e=this.readSync(a.dataId),f=0;f<d.length;++f){var g=d[f];c[f]=g>=1?e[f]:e[f]*(g+1)}return this.makeOutput(c,b.shape,"float32")},b.prototype.selu=function(a){zc(a,"selu");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d){var e=c[d];b[d]=e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)}return this.makeOutput(b,a.shape,"float32")},b.prototype.clip=function(a,b,c){zc(a,"clip");for(var d=new Float32Array(a.size),e=this.readSync(a.dataId),f=0;f<e.length;++f){var g=e[f];d[f]=g>c?c:g<b?b:g}return this.makeOutput(d,a.shape,"float32")},b.prototype.abs=function(a){for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.abs(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.complexAbs=function(a){for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<a.size;++d){var e=c[2*d],f=c[2*d+1];b[d]=Math.hypot(e,f)}return this.makeOutput(b,a.shape,"float32")},b.prototype.int=function(a){zc(a,"int");for(var b=new Int32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=c[d];return this.makeOutput(b,a.shape,"int32")},b.prototype.sigmoid=function(a){zc(a,"sigmoid");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=1/(1+Math.exp(-c[d]));return this.makeOutput(b,a.shape,"float32")},b.prototype.softplus=function(a){zc(a,"softplus");for(var b=Math.log(11920928955078125e-23)+2,c=new Float32Array(a.size),d=this.readSync(a.dataId),e=0;e<d.length;++e){var f=d[e]>-b,g=d[e]<b,h=Math.exp(d[e]),i=void 0;i=g?h:f?d[e]:Math.log(1+h),c[e]=i}return this.makeOutput(c,a.shape,"float32")},b.prototype.sin=function(a){zc(a,"sin");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.sin(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.cos=function(a){zc(a,"cos");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.cos(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.tan=function(a){zc(a,"tan");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.tan(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.asin=function(a){zc(a,"asin");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.asin(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.acos=function(a){zc(a,"acos");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.acos(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.atan=function(a){zc(a,"atan");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.atan(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.atan2=function(a,b){return zc([a,b],"atan2"),this.broadcastedBinaryOp(a,b,a.dtype,function(a,b){return Math.atan2(a,b)})},b.prototype.sinh=function(a){zc(a,"sinh");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.sinh(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.cosh=function(a){zc(a,"cosh");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.cosh(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.tanh=function(a){zc(a,"tanh");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=qa(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.asinh=function(a){zc(a,"asinh");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.asinh(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.acosh=function(a){zc(a,"acosh");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.acosh(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.atanh=function(a){zc(a,"atanh");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d)b[d]=Math.atanh(c[d]);return this.makeOutput(b,a.shape,"float32")},b.prototype.erf=function(a){zc(a,"erf");for(var b=new Float32Array(a.size),c=this.readSync(a.dataId),d=0;d<c.length;++d){var e=Math.sign(c[d]),f=Math.abs(c[d]),g=1/(1+.3275911*f);b[d]=e*(1-((((1.061405429*g-1.453152027)*g+1.421413741)*g-.284496736)*g+.254829592)*g*Math.exp(-f*f))}return this.makeOutput(b,a.shape,"float32")},b.prototype.step=function(a,b){void 0===b&&(b=0),zc(a,"step");for(var c=new Float32Array(a.size),d=this.readSync(a.dataId),e=0;e<d.length;++e){var f=d[e];isNaN(f)?c[e]=NaN:c[e]=f>0?1:b}return this.makeOutput(c,a.shape,"float32")},b.prototype.fusedConv2d=function(a){var b=a.input,c=a.filter,d=a.convInfo,e=a.bias,f=a.activation,g=a.preluActivationWeights,h=this.conv2d(b,c,d);return e&&(h=this.add(h,e)),f&&(h=zd(this,h,f,g)),h},b.prototype.conv2d=function(a,b,c){zc([a,b],"conv2d");for(var d=c.filterHeight,e=c.filterWidth,f=c.dilationHeight,g=c.dilationWidth,h=c.padInfo.left,i=c.padInfo.top,j="channelsLast"===c.dataFormat,k=sO(c.outShape,a.dtype),l=a.strides[0],m=j?a.strides[1]:a.strides[2],n=j?a.strides[2]:1,o=j?1:a.strides[1],p=k.strides[0],q=j?k.strides[1]:k.strides[2],r=j?k.strides[2]:1,s=j?1:k.strides[1],t=this.readSync(a.dataId),u=this.readSync(b.dataId),v=k.values,w=0;w<c.batchSize;++w)for(var x=w*l,y=w*p,z=0;z<c.outHeight;++z)for(var A=y+z*q,B=z*c.strideHeight-i,C=0;C<d;C++){var D=B+C*f;if(!(D<0||D>=c.inHeight))for(var E=C*b.strides[0],F=x+D*m,G=0;G<c.outWidth;++G)for(var H=A+G*r,I=G*c.strideWidth-h,J=0;J<e;J++){var K=I+J*g;if(!(K<0||K>=c.inWidth))for(var L=F+K*n,M=E+J*b.strides[1],N=0;N<c.inChannels;++N){for(var O=t[L+N*o],P=0;P<c.outChannels;++P)v[H+P*s]+=O*u[M+P];M+=c.outChannels}}}return k.toTensor()},b.prototype.conv3d=function(a,b,c){for(var d=c.filterDepth,e=c.filterHeight,f=c.filterWidth,g=c.dilationDepth,h=c.dilationHeight,i=c.dilationWidth,j=c.padInfo.front,k=c.padInfo.left,l=c.padInfo.top,m=sO(c.outShape,a.dtype),n=this.readSync(a.dataId),o=this.readSync(b.dataId),p=m.values,q=0;q<c.batchSize;++q)for(var r=q*a.strides[0],s=q*m.strides[0],t=0;t<c.outDepth;++t)for(var u=s+t*m.strides[1],v=t*c.strideDepth-j,w=0;w<d;w++){var x=v+w*g;if(!(x<0||x>=c.inDepth))for(var y=w*b.strides[0],z=r+x*a.strides[1],A=0;A<c.outHeight;++A)for(var B=u+A*m.strides[2],C=A*c.strideHeight-l,D=0;D<e;D++){var E=C+D*h;if(!(E<0||E>=c.inHeight))for(var F=y+D*b.strides[1],G=z+E*a.strides[2],H=0;H<c.outWidth;++H)for(var I=B+H*c.outChannels,J=H*c.strideWidth-k,K=0;K<f;K++){var L=J+K*i;if(!(L<0||L>=c.inWidth))for(var M=F+K*b.strides[2],N=G+L*c.inChannels,O=M,P=0;P<c.inChannels;++P){for(var Q=n[N+P],R=0;R<c.outChannels;++R)p[I+R]+=Q*o[O+R];O+=c.outChannels}}}}return m.toTensor()},b.prototype.conv2dDerInput=function(a,b,c){zc([a,b],"conv2dDerInput");for(var d=sO(c.inShape,"float32"),e=d.values,f=this.readSync(a.dataId),g=this.readSync(b.dataId),h=b.strides,i=h[0],j=h[1],k=h[2],l=c.batchSize,m=c.filterHeight,n=c.filterWidth,o=c.inChannels,p=c.inHeight,q=c.inWidth,r=c.outChannels,s=c.outHeight,t=c.outWidth,u=c.strideHeight,v=c.strideWidth,w=c.dataFormat,x=m-1-c.padInfo.top,y=n-1-c.padInfo.left,z="channelsLast"===w,A=d.strides[0],B=z?d.strides[1]:d.strides[2],C=z?d.strides[2]:1,D=z?1:d.strides[1],E=a.strides[0],F=z?a.strides[1]:a.strides[2],G=z?a.strides[2]:1,H=z?1:a.strides[1],I=0;I<l;++I)for(var J=0;J<o;++J)for(var K=0;K<p;++K)for(var L=K-x,M=Math.max(0,Math.ceil(L/u)),N=Math.min(s,(m+L)/u),O=0;O<q;++O){for(var P=O-y,Q=Math.max(0,Math.ceil(P/v)),R=Math.min(t,(n+P)/v),S=0,T=M;T<N;++T)for(var U=T*u-L,V=Q;V<R;++V)for(var W=E*I+F*T+G*V,X=i*(m-1-U)+j*(n-1-(V*v-P))+k*J,Y=0;Y<r;++Y)S+=f[W+H*Y]*g[X+Y];e[A*I+B*K+C*O+D*J]=S}return d.toTensor()},b.prototype.conv3dDerInput=function(a,b,c){for(var d=sO(c.inShape,"float32"),e=d.values,f=d.strides,g=f[0],h=f[1],i=f[2],j=f[3],k=this.readSync(a.dataId),l=a.strides,m=l[0],n=l[1],o=l[2],p=l[3],q=this.readSync(b.dataId),r=b.strides,s=r[0],t=r[1],u=r[2],v=r[3],w=c.batchSize,x=c.filterDepth,y=c.filterHeight,z=c.filterWidth,A=c.inChannels,B=c.inDepth,C=c.inHeight,D=c.inWidth,E=c.outChannels,F=c.outDepth,G=c.outHeight,H=c.outWidth,I=c.strideDepth,J=c.strideHeight,K=c.strideWidth,L=x-1-c.padInfo.front,M=y-1-c.padInfo.top,N=z-1-c.padInfo.left,O=0;O<w;++O)for(var P=0;P<A;++P)for(var Q=0;Q<B;++Q)for(var R=Q-L,S=Math.max(0,Math.ceil(R/I)),T=Math.min(F,(x+R)/I),U=0;U<C;++U)for(var V=U-M,W=Math.max(0,Math.ceil(V/J)),X=Math.min(G,(y+V)/J),Y=0;Y<D;++Y){for(var Z=Y-N,$=Math.max(0,Math.ceil(Z/K)),_=Math.min(H,(z+Z)/K),aa=0,ab=S;ab<T;++ab)for(var ac=ab*I-R,ad=W;ad<X;++ad)for(var ae=ad*J-V,af=$;af<_;++af)for(var ag=m*O+n*ab+o*ad+p*af,ah=s*(x-1-ac)+t*(y-1-ae)+u*(z-1-(af*K-Z))+v*P,ai=0;ai<E;++ai)aa+=k[ag+ai]*q[ah+ai];e[g*O+h*Q+i*U+j*Y+P]=aa}return d.toTensor()},b.prototype.conv2dDerFilter=function(a,b,c){zc([a,b],"conv2dDerFilter");for(var d=c.strideHeight,e=c.strideWidth,f=c.filterHeight,g=c.filterWidth,h="channelsLast"===c.dataFormat,i=sO(c.filterShape,"float32"),j=c.padInfo.left,k=c.padInfo.top,l=this.bufferSync(a),m=this.bufferSync(b),n=0;n<f;++n)for(var o=Math.max(0,Math.ceil((k-n)/d)),p=Math.min(c.outHeight,(c.inHeight+k-n)/d),q=0;q<g;++q)for(var r=Math.max(0,Math.ceil((j-q)/e)),s=Math.min(c.outWidth,(c.inWidth+j-q)/e),t=0;t<c.inChannels;++t)for(var u=0;u<c.outChannels;++u){for(var v=0,w=0;w<c.batchSize;++w)for(var x=o;x<p;++x)for(var y=n+x*d-k,z=r;z<s;++z){var A=q+z*e-j;v+=h?l.get(w,y,A,t)*m.get(w,x,z,u):l.get(w,t,y,A)*m.get(w,u,x,z)}i.set(v,n,q,t,u)}return i.toTensor()},b.prototype.conv3dDerFilter=function(a,b,c){for(var d=c.strideDepth,e=c.strideHeight,f=c.strideWidth,g=c.filterDepth,h=c.filterHeight,i=c.filterWidth,j=sO(c.filterShape,"float32"),k=j.values,l=j.strides,m=l[0],n=l[1],o=l[2],p=l[3],q=this.readSync(b.dataId),r=b.strides,s=r[0],t=r[1],u=r[2],v=r[3],w=this.readSync(a.dataId),x=a.strides,y=x[0],z=x[1],A=x[2],B=x[3],C=c.padInfo.front,D=c.padInfo.left,E=c.padInfo.top,F=0;F<g;++F)for(var G=Math.max(0,Math.ceil((C-F)/d)),H=Math.min(c.outDepth,(c.inDepth+C-F)/d),I=F*m,J=0;J<h;++J)for(var K=Math.max(0,Math.ceil((E-J)/e)),L=Math.min(c.outHeight,(c.inHeight+E-J)/e),M=J*n+I,N=0;N<i;++N)for(var O=Math.max(0,Math.ceil((D-N)/f)),P=Math.min(c.outWidth,(c.inWidth+D-N)/f),Q=N*o+M,R=0;R<c.inChannels;++R)for(var S=R*p+Q,T=0;T<c.outChannels;++T){for(var U=0,V=0;V<c.batchSize;++V)for(var W=V*y,X=V*s,Y=G;Y<H;++Y)for(var Z=(F+Y*d-C)*z+W,$=Y*t+X,_=K;_<L;++_)for(var aa=(J+_*e-E)*A+Z,ab=_*u+$,ac=O;ac<P;++ac){var ad=ac*v+ab;U+=w[(N+ac*f-D)*B+aa+R]*q[ad+T]}k[S+T]=U}return j.toTensor()},b.prototype.fusedDepthwiseConv2D=function(a){var b=a.input,c=a.filter,d=a.convInfo,e=a.bias,f=a.activation,g=a.preluActivationWeights,h=this.depthwiseConv2D(b,c,d);return e&&(h=this.add(h,e)),f&&(h=zd(this,h,f,g)),h},b.prototype.depthwiseConv2D=function(a,b,c){zc([a,b],"depthwiseConv2D");for(var d=c.filterHeight,e=c.filterWidth,f=c.dilationHeight,g=c.dilationWidth,h=c.padInfo.left,i=c.padInfo.top,j=c.outChannels/c.inChannels,k=sO(c.outShape,a.dtype),l=this.readSync(a.dataId),m=this.readSync(b.dataId),n=k.values,o=0;o<c.batchSize;++o)for(var p=o*a.strides[0],q=o*k.strides[0],r=0;r<c.outHeight;++r)for(var s=q+r*k.strides[1],t=r*c.strideHeight-h,u=0;u<d;++u){var v=t+u*f;if(!(v<0||v>=c.inHeight))for(var w=u*b.strides[0],x=p+v*a.strides[1],y=0;y<c.outWidth;++y)for(var z=s+y*k.strides[2],A=y*c.strideWidth-i,B=0;B<e;++B){var C=A+B*g;if(!(C<0||C>=c.inWidth))for(var D=w+B*b.strides[1],E=x+C*c.inChannels,F=z,G=D,H=0;H<c.inChannels;++H){for(var I=l[E+H],J=0;J<j;++J)n[F+J]+=I*m[G+J];F+=j,G+=j}}}return k.toTensor()},b.prototype.depthwiseConv2DDerInput=function(a,b,c){zc([a,b],"depthwiseConv2DDerInput");for(var d=sO(c.inShape,"float32"),e=d.values,f=d.strides,g=f[0],h=f[1],i=f[2],j=this.readSync(a.dataId),k=a.strides,l=k[0],m=k[1],n=k[2],o=this.readSync(b.dataId),p=b.strides,q=p[0],r=p[1],s=p[2],t=c.batchSize,u=c.filterHeight,v=c.filterWidth,w=c.inChannels,x=c.inHeight,y=c.inWidth,z=c.outChannels,A=c.outHeight,B=c.outWidth,C=c.strideHeight,D=c.strideWidth,E=u-1-c.padInfo.top,F=v-1-c.padInfo.left,G=z/w,H=0;H<t;++H)for(var I=0;I<w;++I)for(var J=0;J<x;++J)for(var K=J-E,L=Math.max(0,Math.ceil(K/C)),M=Math.min(A,(u+K)/C),N=0;N<y;++N){for(var O=N-F,P=Math.max(0,Math.ceil(O/D)),Q=Math.min(B,(v+O)/D),R=0,S=L;S<M;++S)for(var T=S*C-K,U=P;U<Q;++U)for(var V=l*H+m*S+n*U,W=q*(u-1-T)+r*(v-1-(U*D-O))+s*I,X=0;X<G;++X)R+=j[V+(I*G+X)]*o[W+X];e[g*H+h*J+i*N+I]=R}return d.toTensor()},b.prototype.depthwiseConv2DDerFilter=function(a,b,c){zc([a,b],"depthwiseConv2DDerFilter");for(var d=c.strideHeight,e=c.strideWidth,f=c.filterHeight,g=c.filterWidth,h=sO(c.filterShape,"float32"),i=c.padInfo.left,j=c.padInfo.top,k=c.outChannels/c.inChannels,l=this.bufferSync(a),m=this.bufferSync(b),n=0;n<f;++n)for(var o=Math.max(0,Math.ceil((j-n)/d)),p=Math.min(c.outHeight,(c.inHeight+j-n)/d),q=0;q<g;++q)for(var r=Math.max(0,Math.ceil((i-q)/e)),s=Math.min(c.outWidth,(c.inWidth+i-q)/e),t=0;t<c.outChannels;++t){for(var u=Math.trunc(t/k),v=t%k,w=0,x=0;x<c.batchSize;++x)for(var y=o;y<p;++y)for(var z=n+y*d-j,A=r;A<s;++A){var B=q+A*e-i;w+=l.get(x,z,B,u)*m.get(x,y,A,t)}h.set(w,n,q,u,v)}return h.toTensor()},b.prototype.tile=function(a,b){return zc(a,"tile"),t$(this.bufferSync(a),b)},b.prototype.pad=function(a,b,c){zc(a,"pad");var d=b.map(function(b,c){return b[0]+a.shape[c]+b[1]}),e=b.map(function(a){return a[0]}),f=this.bufferSync(a),g=sO(d,a.dtype);0!==c&&g.values.fill(c);for(var h=0;h<a.size;h++){var i=f.indexToLoc(h),j=i.map(function(a,b){return a+e[b]});g.set.apply(g,[f.get.apply(f,i)].concat(j))}return g.toTensor()},b.prototype.transpose=function(a,b){zc(a,"transpose");for(var c=Array(a.rank),d=0;d<c.length;d++)c[d]=a.shape[b[d]];var e=this.readSync(a.dataId),f=sO(c,a.dtype),g=this.bufferSync(a);for(d=0;d<a.size;++d){for(var h=g.indexToLoc(d),i=Array(h.length),j=0;j<i.length;j++)i[j]=h[b[j]];var k=f.locToIndex(i);f.values[k]=e[d]}return f.toTensor()},b.prototype.gather=function(a,b,c){zc([a,b],"gather");var d=a.shape.slice(),e=this.readSync(b.dataId);d[c]=e.length;for(var f=sO(d,a.dtype),g=this.bufferSync(a),h=0;h<f.size;++h){var i=f.indexToLoc(h),j=i.slice();j[c]=e[i[c]];var k=g.locToIndex(j);f.values[h]=g.values[k]}return f.toTensor()},b.prototype.batchToSpaceND=function(a,b,c){zc([a],"batchToSpaceND");var d=b.reduce(function(a,b){return a*b}),e=td(a.shape,b,d),f=te(e.length,b.length),g=tf(a.shape,b,d),h=tg(c,b.length),i=th(g,c,b.length);return a.reshape(e).transpose(f).reshape(g).slice(h,i)},b.prototype.spaceToBatchND=function(a,b,c){zc([a],"spaceToBatchND");var d=b.reduce(function(a,b){return a*b}),e=[[0,0]];e.push.apply(e,c);for(var f=1+b.length;f<a.shape.length;++f)e.push([0,0]);var g=a.pad(e),h=td(g.shape,b,d,!1),i=te(h.length,b.length,!1),j=tf(g.shape,b,d,!1);return g.reshape(h).transpose(i).reshape(j)},b.prototype.pool=function(a,b,c){zc(a,"pool");for(var d=b.strideHeight,e=b.strideWidth,f=b.dilationHeight,g=b.dilationWidth,h=b.effectiveFilterHeight,i=b.effectiveFilterWidth,j=b.padInfo.top,k=b.padInfo.left,l="max"===c?-1/0:1/0,m=this.readSync(a.dataId),n=sO(b.outShape,a.dtype),o=n.values,p=b.outShape[1]*b.outShape[2]*b.outShape[3],q=b.outShape[2]*b.outShape[3],r=b.outShape[3],s=0;s<b.batchSize;++s)for(var t=s*p,u=s*a.strides[0],v=0;v<b.inChannels;++v)for(var w=0;w<b.outHeight;++w)for(var x=w*d-j,y=Math.max(0,x),z=Math.min(b.inHeight,h+x),A=t+w*q,B=0;B<b.outWidth;++B){for(var C=B*e-k,D=Math.max(0,C),E=Math.min(b.inWidth,i+C),F=l,G=0,H=0,I=y;I<z;I+=f){for(var J=u+I*a.strides[1],K=D;K<E;K+=g){var L=m[J+K*a.strides[2]+v];"max"===c&&L>F?F=L:"avg"===c&&(G+=L,H++)}if(isNaN(F))break}o[A+B*r+v]="avg"===c?G/H:F}return n.toTensor()},b.prototype.maxPool=function(a,b){return this.pool(a,b,"max")},b.prototype.maxPoolPositions=function(a,b){for(var c=sO(b.outShape,"int32"),d=b.strideHeight,e=b.strideWidth,f=b.dilationHeight,g=b.dilationWidth,h=b.effectiveFilterHeight,i=b.effectiveFilterWidth,j=b.padInfo.top,k=b.padInfo.left,l=this.bufferSync(a),m=0;m<b.batchSize;++m)for(var n=0;n<b.inChannels;++n)for(var o=0;o<b.outHeight;++o){for(var p=o*d-j,q=p;q<0;)q+=f;for(var r=Math.min(b.inHeight,h+p),s=0;s<b.outWidth;++s){for(var t=s*e-k,u=t;u<0;)u+=g;for(var v=Math.min(b.inWidth,i+t),w=-1/0,x=-1,y=q;y<r;y+=f)for(var z=y-p,A=u;A<v;A+=g){var B=A-t,C=l.get(m,y,A,n);C>w&&(w=C,x=z*i+B)}c.set(x,m,o,s,n)}}return c.toTensor()},b.prototype.maxPoolBackprop=function(a,b,c,d){zc([b,c],"maxPoolBackprop");for(var e=this.maxPoolPositions(b,d),f=d.strideHeight,g=d.strideWidth,h=d.dilationHeight,i=d.dilationWidth,j=d.effectiveFilterHeight,k=d.effectiveFilterWidth,l=k-1-d.padInfo.left,m=j-1-d.padInfo.top,n=sO(b.shape,"float32"),o=this.bufferSync(e),p=this.bufferSync(a),q=0;q<d.batchSize;++q)for(var r=0;r<d.inChannels;++r)for(var s=0;s<d.inHeight;++s)for(var t=0;t<d.inWidth;++t){for(var u=s-m,v=t-l,w=0,x=0;x<j;x+=h){var y=(u+x)/f;if(!(y<0||y>=d.outHeight||Math.floor(y)!==y))for(var z=0;z<k;z+=i){var A=(v+z)/g;if(!(A<0||A>=d.outWidth||Math.floor(A)!==A)){var B=+(j*k-1-o.get(q,y,A,r)===x*k+z);0!==B&&(w+=p.get(q,y,A,r)*B)}}}n.set(w,q,s,t,r)}return n.toTensor()},b.prototype.avgPoolBackprop=function(a,b,c){zc([a,b],"avgPoolBackprop");for(var d=c.strideHeight,e=c.strideWidth,f=c.filterHeight,g=c.filterWidth,h=c.dilationHeight,i=c.dilationWidth,j=c.effectiveFilterHeight,k=c.effectiveFilterWidth,l=k-1-c.padInfo.left,m=j-1-c.padInfo.top,n=sO(b.shape,"float32"),o=1/(f*g),p=this.bufferSync(a),q=0;q<c.batchSize;++q)for(var r=0;r<c.inChannels;++r)for(var s=0;s<c.inHeight;++s)for(var t=0;t<c.inWidth;++t){for(var u=s-m,v=t-l,w=0,x=0;x<j;x+=h){var y=(u+x)/d;if(!(y<0||y>=c.outHeight||Math.floor(y)!==y))for(var z=0;z<k;z+=i){var A=(v+z)/e;A<0||A>=c.outWidth||Math.floor(A)!==A||(w+=p.get(q,y,A,r))}}n.set(w*o,q,s,t,r)}return n.toTensor()},b.prototype.pool3d=function(a,b,c){zc(a,"pool3d");for(var d=b.strideDepth,e=b.strideHeight,f=b.strideWidth,g=b.dilationDepth,h=b.dilationHeight,i=b.dilationWidth,j=b.effectiveFilterDepth,k=b.effectiveFilterHeight,l=b.effectiveFilterWidth,m=b.padInfo.front,n=b.padInfo.top,o=b.padInfo.left,p="max"===c?-1/0:1/0,q=this.readSync(a.dataId),r=sO(b.outShape,a.dtype),s=r.values,t=b.outShape[1]*b.outShape[2]*b.outShape[3]*b.outShape[4],u=b.outShape[2]*b.outShape[3]*b.outShape[4],v=b.outShape[3]*b.outShape[4],w=b.outShape[4],x=0;x<b.batchSize;++x)for(var y=x*t,z=x*a.strides[0],A=0;A<b.inChannels;++A)for(var B=0;B<b.outDepth;++B){for(var C=B*d-m,D=C;D<0;)D+=g;for(var E=Math.min(b.inDepth,j+C),F=y+B*u,G=0;G<b.outHeight;++G){for(var H=G*e-n,I=H;I<0;)I+=h;for(var J=Math.min(b.inHeight,k+H),K=F+G*v,L=0;L<b.outWidth;++L){for(var M=L*f-o,N=M;N<0;)N+=i;for(var O=Math.min(b.inWidth,l+M),P=K+L*w,Q=p,R=0,S=0,T=D;T<E;T+=g){for(var U=z+T*a.strides[1],V=I;V<J;V+=h){for(var W=U+V*a.strides[2],X=N;X<O;X+=i){var Y=q[W+X*a.strides[3]+A];if("max"===c&&Y>Q?Q=Y:"avg"===c&&(R+=Y,S++),isNaN(Q))break}if(isNaN(Q))break}if(isNaN(Q))break}s[P+A]="avg"===c?R/S:Q}}}return r.toTensor()},b.prototype.avgPool3d=function(a,b){return zc(a,"avgPool3d"),this.pool3d(a,b,"avg").toFloat()},b.prototype.avgPool3dBackprop=function(a,b,c){zc([a,b],"avgPool3dBackprop");for(var d=c.strideDepth,e=c.strideHeight,f=c.strideWidth,g=c.filterDepth,h=c.filterHeight,i=c.filterWidth,j=c.dilationDepth,k=c.dilationHeight,l=c.dilationWidth,m=c.effectiveFilterDepth,n=c.effectiveFilterHeight,o=c.effectiveFilterWidth,p=m-1-c.padInfo.front,q=o-1-c.padInfo.left,r=n-1-c.padInfo.top,s=sO(b.shape,"float32"),t=1/(g*h*i),u=this.bufferSync(a),v=0;v<c.batchSize;++v)for(var w=0;w<c.inChannels;++w)for(var x=0;x<c.inDepth;++x)for(var y=0;y<c.inHeight;++y)for(var z=0;z<c.inWidth;++z){for(var A=x-p,B=y-r,C=z-q,D=0,E=0;E<m;E+=j){var F=(A+E)/d;if(!(F<0||F>=c.outDepth||Math.floor(F)!==F))for(var G=0;G<n;G+=k){var H=(B+G)/e;if(!(H<0||H>=c.outHeight||Math.floor(H)!==H))for(var I=0;I<o;I+=l){var J=(C+I)/f;J<0||J>=c.outWidth||Math.floor(J)!==J||(D+=u.get(v,F,H,J,w))}}}s.set(D*t,v,x,y,z,w)}return s.toTensor()},b.prototype.maxPool3d=function(a,b){return zc(a,"maxPool3d"),this.pool3d(a,b,"max").toFloat()},b.prototype.maxPool3dPositions=function(a,b){for(var c=sO(b.outShape,"int32"),d=b.strideDepth,e=b.strideHeight,f=b.strideWidth,g=b.dilationDepth,h=b.dilationHeight,i=b.dilationWidth,j=b.effectiveFilterDepth,k=b.effectiveFilterHeight,l=b.effectiveFilterWidth,m=b.padInfo.front,n=b.padInfo.top,o=b.padInfo.left,p=this.bufferSync(a),q=0;q<b.batchSize;++q)for(var r=0;r<b.inChannels;++r)for(var s=0;s<b.outDepth;++s){for(var t=s*d-m,u=t;u<0;)u+=g;for(var v=Math.min(b.inDepth,j+t),w=0;w<b.outHeight;++w){for(var x=w*e-n,y=x;y<0;)y+=h;for(var z=Math.min(b.inHeight,k+x),A=0;A<b.outWidth;++A){for(var B=A*f-o,C=B;C<0;)C+=i;for(var D=Math.min(b.inWidth,l+B),E=-1/0,F=-1,G=u;G<v;G+=g)for(var H=G-t,I=y;I<z;I+=h)for(var J=I-x,K=C;K<D;K+=i){var L=K-B,M=p.get(q,G,I,K,r);M>=E&&(E=M,F=H*k*l+J*k+L)}c.set(F,q,s,w,A,r)}}}return c.toTensor()},b.prototype.maxPool3dBackprop=function(a,b,c,d){zc([b,c],"maxPool3dBackprop");for(var e=this.maxPool3dPositions(b,d),f=d.strideDepth,g=d.strideHeight,h=d.strideWidth,i=d.dilationDepth,j=d.dilationHeight,k=d.dilationWidth,l=d.effectiveFilterDepth,m=d.effectiveFilterHeight,n=d.effectiveFilterWidth,o=l-1-d.padInfo.front,p=n-1-d.padInfo.left,q=m-1-d.padInfo.top,r=sO(b.shape,"float32"),s=this.bufferSync(e),t=this.bufferSync(a),u=0;u<d.batchSize;++u)for(var v=0;v<d.inChannels;++v)for(var w=0;w<d.inDepth;++w)for(var x=0;x<d.inHeight;++x)for(var y=0;y<d.inWidth;++y){for(var z=w-o,A=x-q,B=y-p,C=0,D=0;D<l;D+=i){var E=(z+D)/f;if(!(E<0||E>=d.outDepth||Math.floor(E)!==E))for(var F=0;F<m;F+=j){var G=(A+F)/g;if(!(G<0||G>=d.outHeight||Math.floor(G)!==G))for(var H=0;H<n;H+=k){var I=(B+H)/h;if(!(I<0||I>=d.outWidth||Math.floor(I)!==I)){var J=+(l*m*n-1-s.get(u,E,G,I,v)===D*m*n+F*n+H);0!==J&&(C+=t.get(u,E,G,I,v)*J)}}}}r.set(C,u,w,x,y,v)}return r.toTensor()},b.prototype.cast=function(a,b){return tP(a,b,this)},b.prototype.reshape=function(a,b){return tQ(a,b)},b.prototype.avgPool=function(a,b){return zc(a,"avgPool"),this.pool(a,b,"avg").toFloat()},b.prototype.resizeBilinear=function(a,b,c,d){zc(a,"resizeBilinear");for(var e=a.shape,f=e[0],g=e[1],h=e[2],i=e[3],j=this.readSync(a.dataId),k=new Float32Array(p7([f,b,c,i])),l=[d&&b>1?g-1:g,d&&c>1?h-1:h],m=[d&&b>1?b-1:b,d&&c>1?c-1:c],n=0,o=l[0]/m[0],p=l[1]/m[1],q=0;q<f;q++)for(var r=0;r<b;r++)for(var s=o*r,t=Math.floor(s),u=s-t,v=Math.min(g-1,Math.ceil(s)),w=q*a.strides[0]+t*a.strides[1],x=q*a.strides[0]+v*a.strides[1],y=0;y<c;y++)for(var z=p*y,A=Math.floor(z),B=z-A,C=Math.min(h-1,Math.ceil(z)),D=w+A*a.strides[2],E=x+A*a.strides[2],F=w+C*a.strides[2],G=x+C*a.strides[2],H=0;H<i;H++){var I=j[D+H],J=j[E+H],K=I+(j[F+H]-I)*B,L=K+(J+(j[G+H]-J)*B-K)*u;k[n++]=L}return sj(k,[f,b,c,i])},b.prototype.resizeBilinearBackprop=function(a,b,c){zc([a,b],"resizeBilinearBackprop");for(var d=b.shape,e=d[0],f=d[1],g=d[2],h=d[3],i=a.shape,j=i[1],k=i[2],l=new Float32Array(e*f*g*h),m=[c&&j>1?f-1:f,c&&k>1?g-1:g],n=[c&&j>1?j-1:j,c&&k>1?k-1:k],o=m[0]/n[0],p=m[1]/n[1],q=this.readSync(a.dataId),r=0,s=0;s<e;s++)for(var t=s*b.strides[0],u=0;u<j;u++)for(var v=u*o,w=Math.floor(v),x=Math.min(Math.ceil(v),f-1),y=t+w*b.strides[1],z=t+x*b.strides[1],A=v-w,B=1-A,C=0;C<k;C++)for(var D=C*p,E=Math.floor(D),F=Math.min(Math.ceil(D),g-1),G=D-E,H=1-G,I=y+E*b.strides[2],J=y+F*b.strides[2],K=z+E*b.strides[2],L=z+F*b.strides[2],M=B*H,N=B*G,O=A*H,P=A*G,Q=0;Q<h;Q++){var R=q[r++];l[I+Q]+=R*M,l[J+Q]+=R*N,l[K+Q]+=R*O,l[L+Q]+=R*P}return sp(l,[e,g,f,h],b.dtype)},b.prototype.resizeNearestNeighbor=function(a,b,c,d){zc(a,"resizeNearestNeighbor");for(var e=a.shape,f=e[0],g=e[1],h=e[2],i=e[3],j=this.readSync(a.dataId),k=new Float32Array(f*b*c*i),l=[d&&b>1?g-1:g,d&&c>1?h-1:h],m=[d&&b>1?b-1:b,d&&c>1?c-1:c],n=l[0]/m[0],o=l[1]/m[1],p=0,q=0;q<f;q++)for(var r=q*a.strides[0],s=0;s<b;s++)for(var t=n*s,u=r+Math.min(g-1,d?Math.round(t):Math.floor(t))*a.strides[1],v=0;v<c;v++)for(var w=o*v,x=u+Math.min(h-1,d?Math.round(w):Math.floor(w))*a.strides[2],y=0;y<i;y++){var z=j[x+y];k[p++]=z}return sj(k,[f,b,c,i],a.dtype)},b.prototype.resizeNearestNeighborBackprop=function(a,b,c){zc([a,b],"resizeNearestNeighborBackprop");for(var d=b.shape,e=d[0],f=d[1],g=d[2],h=d[3],i=a.shape,j=i[1],k=i[2],l=new Float32Array(e*f*g*h),m=this.readSync(a.dataId),n=[c&&j>1?f-1:f,c&&k>1?g-1:g],o=[c&&j>1?j-1:j,c&&k>1?k-1:k],p=n[0]/o[0],q=n[1]/o[1],r=1/p,s=1/q,t=2*Math.ceil(r)+2,u=2*Math.ceil(s)+2,v=0;v<e;v++)for(var w=v*b.strides[0],x=0;x<f;x++)for(var y=w+x*b.strides[1],z=Math.floor(x*r),A=Math.floor(z-t/2),B=0;B<g;B++)for(var C=y+B*b.strides[2],D=Math.floor(B*s),E=Math.floor(D-u/2),F=0;F<h;F++){for(var G=0,H=0;H<t;H++){var I=H+A;if(!(I<0||I>=j)){var J=w+I*a.strides[1],K=I*p;if(x===Math.min(f-1,c?Math.round(K):Math.floor(K)))for(var L=0;L<u;L++){var M=L+E;if(!(M<0||M>=k)){var N=J+M*a.strides[2],O=M*q;B===Math.min(g-1,c?Math.round(O):Math.floor(O))&&(G+=m[N+F])}}}}l[C+F]=G}return sp(l,b.shape,b.dtype)},b.prototype.batchNormalization=function(a,b,c,d,e,f){zc([a,b,c,e,f],"batchNorm");for(var g=this.readSync(a.dataId),h=this.readSync(b.dataId),i=this.readSync(c.dataId),j=e?this.readSync(e.dataId):new Float32Array([1]),k=f?this.readSync(f.dataId):new Float32Array([0]),l=new Float32Array(g.length),m=k.length,n=j.length,o=i.length,p=h.length,q=0,r=0,s=0,t=0,u=0;u<g.length;++u)l[u]=k[q++]+(g[u]-h[r++])*j[s++]/Math.sqrt(i[t++]+d),q>=m&&(q=0),r>=p&&(r=0),s>=n&&(s=0),t>=o&&(t=0);return sp(l,a.shape)},b.prototype.localResponseNormalization4D=function(a,b,c,d,e){zc(a,"localResponseNormalization4D");for(var f=a.shape[3],g=f-1,h=this.readSync(a.dataId),i=a.size,j=new Float32Array(i),k=0;k<i;k++){var l=function(a){for(var c=a%f,d=a-c+Math.max(0,c-b),e=a-c+Math.min(c+b,g),i=0;d<=e;d++){var j=h[d];i+=j*j}return i}(k),m=h[k]*Math.pow(c+d*l,-e);j[k]=m}return sp(j,a.shape)},b.prototype.LRNGrad=function(a,b,c,d,e,f,g){zc(a,"LRNGrad");for(var h=a.shape[3],i=this.readSync(a.dataId),j=this.readSync(b.dataId),k=this.readSync(c.dataId),l=new Float32Array(a.size),m=a.size,n=0;n<m;n++){for(var o=n%h,p=n-o+Math.max(0,o-d),q=n-o+Math.min(h,o+d+1),r=0,s=p;s<q;s++)r+=Math.pow(j[s],2);for(r=f*r+e,s=p;s<q;s++){var t=-2*f*g*j[s]*k[n]/r;n===s&&(t+=Math.pow(r,-g)),t*=i[n],l[s]+=t}}return sp(l,a.shape)},b.prototype.multinomial=function(a,b,c,d){zc(a,"multinomial");for(var e=b?a:tv(a),f=e.shape[0],g=e.shape[1],h=sr([f,c],"int32"),i=this.readSync(h.dataId),j=this.readSync(e.dataId),k=0;k<f;++k){var l=k*g,m=new Float32Array(g-1);m[0]=j[l];for(var n=1;n<m.length;++n)m[n]=m[n-1]+j[l+n];for(var o=sK(d.toString()),p=k*c,q=0;q<c;++q){var r=o();i[p+q]=m.length;for(var s=0;s<m.length;s++)if(r<m[s]){i[p+q]=s;break}}}return h},b.prototype.oneHot=function(a,b,c,d){zc(a,"oneHot");var e=new Float32Array(a.size*b);e.fill(d);for(var f=this.readSync(a.dataId),g=0;g<a.size;++g)f[g]>=0&&f[g]<b&&(e[g*b+f[g]]=c);return sn(e,[a.size,b],"int32")},b.prototype.nonMaxSuppression=function(a,b,c,d,e){return zc(a,"nonMaxSuppression"),tV(this.readSync(a.dataId),this.readSync(b.dataId),c,d,e)},b.prototype.fft=function(a){return this.fftBatch(a,!1)},b.prototype.ifft=function(a){return this.fftBatch(a,!0)},b.prototype.fftBatch=function(a,b){for(var c=a.shape[0],d=a.shape[1],e=sO(a.shape,"float32"),f=sO(a.shape,"float32"),g=sh(a).as2D(c,d),h=si(a).as2D(c,d),i=0;i<c;i++)for(var j=g.slice([i,0],[1,d]),k=h.slice([i,0],[1,d]),l=sg(j,k),m=this.readSync(this.fftImpl(l,b).dataId),n=0;n<d;n++){var o=tT(m,n);e.values[i*d+n]=o.real,f.values[i*d+n]=o.imag}return sg(e.toTensor(),f.toTensor()).as2D(c,d)},b.prototype.fftImpl=function(a,b){var c=a.as1D(),d=c.size;if(this.isExponentOf2(d)){var e=this.fftRadix2(c,d,b).as2D(a.shape[0],a.shape[1]);return b&&(e=sg(sh(e).div(sl(d)),si(e).div(sl(d)))),e}var f=this.readSync(a.dataId),g=function(a){for(var b=new Float32Array(a.length/2),c=new Float32Array(a.length/2),d=0;d<a.length;d+=2)b[d/2]=a[d],c[d/2]=a[d+1];return{real:b,imag:c}}(this.fourierTransformByMatmul(f,d,b));return sg(g.real,g.imag).as2D(a.shape[0],a.shape[1])},b.prototype.isExponentOf2=function(a){return 0==(a&a-1)},b.prototype.fftRadix2=function(a,b,c){if(1===b)return a;var d=this.readSync(a.dataId),e=b/2,f=function(a){for(var b=Math.ceil(a.length/4),c=new Float32Array(b),d=new Float32Array(b),e=0;e<a.length;e+=4)c[Math.floor(e/4)]=a[e],d[Math.floor(e/4)]=a[e+1];return{real:c,imag:d}}(d),g=sg(f.real,f.imag).as1D(),h=function(a){for(var b=Math.floor(a.length/4),c=new Float32Array(b),d=new Float32Array(b),e=2;e<a.length;e+=4)c[Math.floor(e/4)]=a[e],d[Math.floor(e/4)]=a[e+1];return{real:c,imag:d}}(d),i=sg(h.real,h.imag).as1D();g=this.fftRadix2(g,e,c),i=this.fftRadix2(i,e,c);var j=function(a,b){for(var c=new Float32Array(a/2),d=new Float32Array(a/2),e=0;e<Math.ceil(a/2);e++){var f=(b?2:-2)*Math.PI*(e/a);c[e]=Math.cos(f),d[e]=Math.sin(f)}return{real:c,imag:d}}(b,c),k=sg(j.real,j.imag).mul(i),l=g.add(k),m=g.sub(k);return sg(sh(l).concat(sh(m)),si(l).concat(si(m))).as1D()},b.prototype.fourierTransformByMatmul=function(a,b,c){for(var d=new Float32Array(2*b),e=0;e<b;e++){for(var f,g,h,i=0,j=0,k=0;k<b;k++){var l=function(a,b,c){var d=(c?2:-2)*Math.PI*(a/b);return{real:Math.cos(d),imag:Math.sin(d)}}(e*k,b,c),m=tT(a,k);i+=m.real*l.real-m.imag*l.imag,j+=m.real*l.imag+m.imag*l.real}c&&(i/=b,j/=b),f=i,g=j,d[2*(h=e)]=f,d[2*h+1]=g}return d},b.prototype.depthToSpace=function(a,b,c){p3("NHWC"===c,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+c}),p3(b>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+b});for(var d=a.shape[0],e=a.shape[1],f=a.shape[2],g=a.shape[3],h=e*b,i=f*b,j=g/(b*b),k=this.readSync(a.dataId),l=new Float32Array(d*h*i*j),m=0,n=0;n<d;++n)for(var o=0;o<h;++o)for(var p=Math.floor(o/b),q=o%b,r=0;r<i;++r)for(var s=Math.floor(r/b),t=(q*b+r%b)*j,u=0;u<j;++u){var v=u+t+g*(s+f*(p+e*n));l[m++]=k[v]}return sp(l,[d,h,i,j])},b.prototype.broadcastedBinaryOp=function(a,b,c,d){var e=tC(a.shape,b.shape),f=sO(e,c),g=this.readSync(a.dataId),h=this.readSync(b.dataId),i=tA(a.shape,e),j=tA(b.shape,e),k=f.values;if(i.length+j.length===0)for(var l=0;l<k.length;++l)k[l]=d(g[l%g.length],h[l%h.length]);else{var m=this.bufferSync(a),n=this.bufferSync(b);for(l=0;l<k.length;++l)!function(c){var e=f.indexToLoc(c),l=e.slice(-a.rank);i.forEach(function(a){return l[a]=0});var o=m.locToIndex(l),p=e.slice(-b.rank);j.forEach(function(a){return p[a]=0});var q=n.locToIndex(p);k[c]=d(g[o],h[q])}(l)}return f.toTensor()},b.prototype.broadcastedBinaryComplexOp=function(a,b,c){var d=tC(a.shape,b.shape),e=sO(d,"float32"),f=sO(d,"float32"),g=this.readSync(a.dataId),h=this.readSync(b.dataId),i=tA(a.shape,d),j=tA(b.shape,d),k=e.values,l=f.values;if(i.length+j.length===0)for(var m=0;m<k.length;m++){var n=m%g.length,o=m%h.length,p=c(g[2*n],g[2*n+1],h[2*o],h[2*o+1]);k[m]=p.real,l[m]=p.imag}else{var q=this.bufferSync(this.data.get(a.dataId).complexTensors.real),r=this.bufferSync(this.data.get(b.dataId).complexTensors.real);for(m=0;m<k.length;m++)!function(d){var f=e.indexToLoc(d),m=f.slice(-a.rank);i.forEach(function(a){return m[a]=0});var n=q.locToIndex(m),o=f.slice(-b.rank);j.forEach(function(a){return o[a]=0});var p=r.locToIndex(o),s=c(g[2*n],g[2*n+1],h[2*p],h[2*p+1]);k[d]=s.real,l[d]=s.imag}(m)}return this.complex(e.toTensor(),f.toTensor())},b.prototype.split=function(a,b,c){return tZ(a,b,c)},b.prototype.dispose=function(){},b.prototype.floatPrecision=function(){return 32},b.prototype.epsilon=function(){return 1e-7},b.prototype.cropAndResize=function(a,b,c,d,e,f){for(var g=a.shape,h=g[0],i=g[1],j=g[2],k=g[3],l=b.shape[0],m=d[0],n=d[1],o=sO([l,m,n,k],"float32"),p=this.readSync(b.dataId),q=this.readSync(c.dataId),r=this.readSync(a.dataId),s=a.strides,t=o.strides,u=0;u<l;u++){var v=4*u,w=p[v],x=p[v+1],y=p[v+2],z=p[v+3],A=q[u];if(!(A>=h))for(var B=m>1?(y-w)*(i-1)/(m-1):0,C=n>1?(z-x)*(j-1)/(n-1):0,D=0;D<m;D++){var E,F=m>1?w*(i-1)+D*B:.5*(w+y)*(i-1);if(F<0||F>i-1)for(var G=0;G<n;G++)for(var H=0;H<k;H++){var I=H+G*t[2]+D*t[1]+u*t[0];o.values[I]=f}else if("bilinear"===e){var J=Math.floor(F),K=Math.ceil(F),L=F-J;for(G=0;G<n;G++)if((E=n>1?x*(j-1)+G*C:.5*(x+z)*(j-1))<0||E>j-1)for(H=0;H<k;H++)I=H+G*t[2]+D*t[1]+u*t[0],o.values[I]=f;else{var M=Math.floor(E),N=Math.ceil(E),O=E-M;for(H=0;H<k;H++){var P=r[I=H+M*s[2]+J*s[1]+A*s[0]],Q=r[I=H+N*s[2]+J*s[1]+A*s[0]],R=r[I=H+M*s[2]+K*s[1]+A*s[0]],S=P+(Q-P)*O,T=R+(r[I=H+N*s[2]+K*s[1]+A*s[0]]-R)*O;I=H+G*t[2]+D*t[1]+u*t[0],o.values[I]=S+(T-S)*L}}}else for(G=0;G<n;++G)if((E=n>1?x*(j-1)+G*C:.5*(x+z)*(j-1))<0||E>j-1)for(H=0;H<k;H++)I=H+G*t[2]+D*t[1]+u*t[0],o.values[I]=f;else{var U=Math.round(E),V=Math.round(F);for(H=0;H<k;H++){var W=H+U*s[2]+V*s[1]+A*s[0],X=H+G*t[2]+D*t[1]+u*t[0];o.values[X]=r[W]}}}}return o.toTensor()},b.prototype.sparseToDense=function(a,b,c,d){var e=tm(0,a,c),f=e.sliceRank,g=e.numUpdates,h=e.sliceSize,i=e.strides,j=e.outputSize;return this.scatter(a,b,c,j,h,g,f,i,d,!1)},b.prototype.gatherND=function(a,b){var c=b.shape,d=c[c.length-1],e=ti(a,b),f=e[0],g=e[1],h=e[2],i=e[3];if(0===g)return sj([],f,a.dtype);for(var j=new qL([g,h],a.dtype),k=this.readSync(b.dataId),l=this.readSync(a.dataId),m=0;m<g;m++){for(var n=[],o=0,p=0;p<d;p++){var q=k[m*d+p];o+=q*i[p],n.push(q)}if(o<0||o>=a.size/h)throw Error("Invalid indices: "+n+" does not index into "+a.shape);for(var r=0;r<h;r++)j.values[m*h+r]=l[o*h+r]}return j.toTensor().reshape(f)},b.prototype.scatterND=function(a,b,c){var d=tm(0,a,c),e=d.sliceRank,f=d.numUpdates,g=d.sliceSize,h=d.strides,i=d.outputSize,j=sl(0);return this.scatter(a,b,c,i,g,f,e,h,j,!0)},b.prototype.fill=function(a,b,c){var d=qi(c=c||qs(b),p7(a));return d.fill(b),q4.makeTensor(d,a,c,this)},b.prototype.onesLike=function(a){if("string"===a.dtype)throw Error("onesLike is not supported for string tensors");return this.fill(a.shape,1,a.dtype)},b.prototype.zerosLike=function(a){var b=qi(a.dtype,p7(a.shape));return this.makeOutput(b,a.shape,a.dtype)},b.prototype.linspace=function(a,b,c){return tR(a,b,c)},b.prototype.scatter=function(a,b,c,d,e,f,g,h,i,j){var k=this.readSync(a.dataId),l=this.readSync(b.dataId);if(0===d)return sj([],c,b.dtype);var m=new qL([d/e,e],b.dtype);m.values.fill(this.readSync(i.dataId)[0]);for(var n=0;n<f;n++){for(var o=[],p=0,q=0;q<g;q++){var r=k[n*g+q];o.push(r),p+=r*h[q]}if(p<0||p>=d/e)throw Error("Invalid indices: "+o+" does not index into "+c);for(var s=0;s<e;s++)j?m.values[p*e+s]+=l[n*e+s]:m.values[p*e+s]=0===b.rank?l[0]:l[n*e+s]}return m.toTensor().reshape(c)},b}(ty);q4.registerBackend("cpu",function(){return new ze},1);for(var zf=0,zg=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(a){var b=a.inputs,c=a.backend,d=a.attrs,e=b.boxes,f=b.scores,g=d.maxOutputSize,h=d.iouThreshold,i=d.scoreThreshold,j=d.softNmsSigma;zc(e,"NonMaxSuppressionWithScore");var k=tW(c.data.get(e.dataId).values,c.data.get(f.dataId).values,g,h,i,j);return[k.selectedIndices,k.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(a){var b=a.inputs,c=a.backend,d=b.x;zc(d,"square");for(var e=c.data.get(d.dataId).values,f=new Float32Array(e.length),g=0;g<e.length;++g){var h=e[g];f[g]=h*h}return{dataId:c.write(f,d.shape,d.dtype),shape:d.shape,dtype:d.dtype}}},{kernelName:wg,backendName:"cpu",kernelFunc:function(a){var b=a.inputs,c=a.backend,d=b.a,e=b.b;zc([d,e],wg);var f=c.data.get(d.dataId).values,g=c.data.get(e.dataId).values,h=function(a,b,c,d,e,f){var g=tC(a,b),h=g.length,i=qv(g),j=qh(e,p7(g)),k=a.length,l=b.length,m=qv(a),n=qv(b),o=tA(a,g),p=tA(b,g);if(o.length+p.length===0)for(var q=0;q<j.length;++q)j[q]=f(c[q%c.length],d[q%d.length]);else for(q=0;q<j.length;++q)!function(a){var b=qF(a,h,i),e=b.slice(-k);o.forEach(function(a){return e[a]=0});var g=qE(e,k,m),q=b.slice(-l);p.forEach(function(a){return q[a]=0});var r=qE(q,l,n);j[a]=f(c[g],d[r])}(q);return[j,g]}(d.shape,e.shape,f,g,d.dtype,function(a,b){var c=a-b;return c*c}),i=h[0],j=h[1];return{dataId:c.write(i,j,d.dtype),shape:j,dtype:d.dtype}}}];zf<zg.length;zf++)p$(zg[zf]);for(var zh,zi,zj=function(a){this.variableNames=["A"];var b=t6(),c=a[0],d=a[1];this.outputShape=a,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+c+".0);\n\n        vec4 values = "+b.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},zk=function(a){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var b=t6(),c=a[0],d=a[1];this.outputShape=a,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+d+".0, "+c+".0);\n            vec4 values = "+b.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+b.output+" = result;\n      }\n    "},zl=0,zm=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(a){var b=a.inputs,c=a.backend,d=a.attrs,e=b.pixels,f=d.numChannels,g="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement,h="undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement,i=g?[e.videoWidth,e.videoHeight]:[e.width,e.height],j=i[0],k=i[1],l=[k,j],m=[k,j,f];(h||g)&&(null==zi&&(zi=document.createElement("canvas").getContext("2d")),zi.canvas.width=j,zi.canvas.height=k,zi.drawImage(e,0,0,j,k),e=zi.canvas);var n=c.makeTensorInfo(l,"int32");c.texData.get(n.dataId).usage=q8.PIXELS,c.gpgpu.uploadPixelDataToTexture(c.getTexture(n.dataId),e);var o=pV.getBool("WEBGL_PACK")?new zk(m):new zj(m),p=c.runWebGLProgram(o,[n],"int32");return c.disposeData(n.dataId),p}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(a){var b=a.inputs,c=a.backend,d=a.attrs;r0("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=b.boxes,f=b.scores,g=d.maxOutputSize,h=d.iouThreshold,i=d.scoreThreshold,j=d.softNmsSigma,k=tW(c.readSync(e.dataId),c.readSync(f.dataId),g,h,i,j);return[k.selectedIndices,k.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(a){var b=a.inputs,c=a.backend,d=b.x,e=new vP(d.shape,"return x * x;");return c.runWebGLProgram(e,[d],d.dtype)}},{kernelName:wg,backendName:"webgl",kernelFunc:function(a){var b=a.inputs,c=a.backend,d=b.a,e=b.b,f=pV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ur("return (a - b) * (a - b);",d.shape,e.shape):new up("return (a - b) * (a - b);",d.shape,e.shape);return c.compileAndRun(f,[d,e])}}];zl<zm.length;zl++)p$(zm[zl]);for(var zn=0,zo=[{kernelName:"Square",gradFunc:function(a,b){var c=b[0];return{x:function(){return a.mul(c.toFloat().mul(2))}}}},{kernelName:wg,gradFunc:function(a,b){var c=b[0],d=b[1],e=sl(2);return{a:function(){return xm(a,xm(e,xr(c,d)))},b:function(){return xm(a,xm(e,xr(d,c)))}}}}];zn<zo.length;zn++)!function(a){var b=a.kernelName;pX.has(b)&&console.warn("Overriding the gradient for '"+b+"'"),pX.set(b,a)}(zo[zn]);var zp=function(){function a(){}return a.prototype.fetch=function(a,b){return fetch(a,b)},a.prototype.now=function(){return performance.now()},a.prototype.encode=function(a,b){if("utf-8"!==b&&"utf8"!==b)throw Error("Browser's encoder only supports utf-8, but got "+b);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(a)},a.prototype.decode=function(a,b){return new TextDecoder(b).decode(a)},a}();pV.get("IS_BROWSER")&&pV.setPlatform("browser",new zp);var zq,zr=function(){function a(){this.util=c(8354),this.textEncoder=new this.util.TextEncoder}return a.prototype.fetch=function(a,b){return null!=pV.global.fetch?pV.global.fetch(a,b):(null==zq&&(zq=c(4472)),zq(a,b))},a.prototype.now=function(){var a=process.hrtime();return 1e3*a[0]+a[1]/1e6},a.prototype.encode=function(a,b){if("utf-8"!==b&&"utf8"!==b)throw Error("Node built-in encoder only supports utf-8, but got "+b);return this.textEncoder.encode(a)},a.prototype.decode=function(a,b){return 0===a.length?"":new this.util.TextDecoder(b).decode(a)},a}();pV.get("IS_NODE")&&pV.setPlatform("node",new zr);var zs={float32:4,int32:4,uint16:2,uint8:1,bool:1};function zt(a,b){for(var c={},d=0,e=0;e<b.length;e++)!function(b){var e=b.name,f=b.dtype,g=b.shape,h=p7(g),i=void 0;if("quantization"in b){var j=b.quantization;if("uint8"!==j.dtype&&"uint16"!==j.dtype)throw Error("Weight "+b.name+" has unknown quantization dtype "+j.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var k=zs[j.dtype],l=a.slice(d,d+h*k),m="uint8"===j.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===f)i=Float32Array.from(m,function(a){return a*j.scale+j.min});else{if("int32"!==f)throw Error("Unsupported dtype in weight '"+e+"': "+f);i=Int32Array.from(m,function(a){return Math.round(a*j.scale+j.min)})}d+=h*k}else if("string"===f){var n=p7(b.shape);i=[];for(var o=0;o<n;o++){var p=new Uint32Array(a.slice(d,d+4))[0];d+=4;var q=new Uint8Array(a.slice(d,d+p));i.push(q),d+=p}}else{var r=zs[f];if(l=a.slice(d,d+h*r),"float32"===f)i=new Float32Array(l);else if("int32"===f)i=new Int32Array(l);else{if("bool"!==f)throw Error("Unsupported dtype in weight '"+e+"': "+f);i=new Uint8Array(l)}d+=h*r}c[e]=sj(i,g,f)}(b[e]);return c}var zu="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function zv(a){return zu?Buffer.byteLength(a):new Blob([a]).size}function zw(a){var b=0;a.forEach(function(a){b+=a.byteLength});var c=new Uint8Array(b),d=0;return a.forEach(function(a){c.set(new Uint8Array(a),d),d+=a.byteLength}),c.buffer}function zx(a){for(a=a.trim();a.endsWith("/");)a=a.slice(0,a.length-1);var b=a.split("/");return b[b.length-1]}function zy(a){if(a.modelTopology instanceof ArrayBuffer)throw Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==a.modelTopology?0:zv(JSON.stringify(a.modelTopology)),weightSpecsBytes:null==a.weightSpecs?0:zv(JSON.stringify(a.weightSpecs)),weightDataBytes:null==a.weightData?0:a.weightData.byteLength}}var zz=function(){function a(){this.saveRouters=[],this.loadRouters=[]}return a.getInstance=function(){return null==a.instance&&(a.instance=new a),a.instance},a.registerSaveRouter=function(b){a.getInstance().saveRouters.push(b)},a.registerLoadRouter=function(b){a.getInstance().loadRouters.push(b)},a.getSaveHandlers=function(b){return a.getHandlers(b,"save")},a.getLoadHandlers=function(b,c){return a.getHandlers(b,"load",c)},a.getHandlers=function(b,c,d){var e=[];return("load"===c?a.getInstance().loadRouters:a.getInstance().saveRouters).forEach(function(a){var c=a(b,d);null!==c&&e.push(c)}),e},a}(),zA=function(){function a(){this.managers={}}return a.getInstance=function(){return null==a.instance&&(a.instance=new a),a.instance},a.registerManager=function(b,c){p3(null!=b,function(){return"scheme must not be undefined or null."}),b.endsWith("://")&&(b=b.slice(0,b.indexOf("://"))),p3(b.length>0,function(){return"scheme must not be an empty string."});var d=a.getInstance();p3(null==d.managers[b],function(){return"A model store manager is already registered for scheme '"+b+"'."}),d.managers[b]=c},a.getManager=function(a){var b=this.getInstance().managers[a];if(null==b)throw Error("Cannot find model manager for scheme '"+a+"'");return b},a.getSchemes=function(){return Object.keys(this.getInstance().managers)},a}();function zB(a){if(-1===a.indexOf("://"))throw Error("The url string provided does not contain a scheme. Supported schemes are: "+zA.getSchemes().join(","));return{scheme:a.split("://")[0],path:a.split("://")[1]}}function zC(a,b,c){return void 0===c&&(c=!1),pS(this,void 0,void 0,function(){var d,e,f,g,h,i,j,k,l;return pT(this,function(m){switch(m.label){case 0:return p3(a!==b,function(){return"Old path and new path are the same: '"+a+"'"}),p3((d=zz.getLoadHandlers(a)).length>0,function(){return"Copying failed because no load handler is found for source URL "+a+"."}),p3(d.length<2,function(){return"Copying failed because more than one ("+d.length+") load handlers for source URL "+a+"."}),e=d[0],p3((f=zz.getSaveHandlers(b)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+b+"."}),p3(f.length<2,function(){return"Copying failed because more than one ("+d.length+") save handlers for destination URL "+b+"."}),g=f[0],h=zB(a).scheme,i=zB(a).path,j=h===zB(a).scheme,[4,e.load()];case 1:return k=m.sent(),c&&j?[4,zA.getManager(h).removeModel(i)]:[3,3];case 2:m.sent(),m.label=3;case 3:return[4,g.save(k)];case 4:return l=m.sent(),!c||j?[3,6]:[4,zA.getManager(h).removeModel(i)];case 5:m.sent(),m.label=6;case 6:return[2,l.modelArtifactsInfo]}})})}var zD="models_store",zE="model_info_store";function zF(){if(!pV.getBool("IS_BROWSER"))throw Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var a=window||self,b=a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB||a.shimIndexedDB;if(null==b)throw Error("The current browser does not appear to support IndexedDB.");return b}function zG(a){var b=a.result;b.createObjectStore(zD,{keyPath:"modelPath"}),b.createObjectStore(zE,{keyPath:"modelPath"})}var zH=function(){function a(a){if(this.indexedDB=zF(),null==a||!a)throw Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=a}return a.prototype.save=function(a){return pS(this,void 0,void 0,function(){return pT(this,function(b){if(a.modelTopology instanceof ArrayBuffer)throw Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,a)]})})},a.prototype.load=function(){return pS(this,void 0,void 0,function(){return pT(this,function(a){return[2,this.databaseAction(this.modelPath)]})})},a.prototype.databaseAction=function(a,b){var c=this;return new Promise(function(a,d){var e=c.indexedDB.open("tensorflowjs",1);e.onupgradeneeded=function(){return zG(e)},e.onsuccess=function(){var f=e.result;if(null==b){var g=f.transaction(zD,"readonly"),h=g.objectStore(zD).get(c.modelPath);h.onsuccess=function(){if(null==h.result)return f.close(),d(Error("Cannot find model with path '"+c.modelPath+"' in IndexedDB."));a(h.result.modelArtifacts)},h.onerror=function(a){return f.close(),d(h.error)},g.oncomplete=function(){return f.close()}}else{var i,j=zy(b),k=f.transaction(zE,"readwrite"),l=k.objectStore(zE),m=l.put({modelPath:c.modelPath,modelArtifactsInfo:j});m.onsuccess=function(){var e=(i=f.transaction(zD,"readwrite")).objectStore(zD).put({modelPath:c.modelPath,modelArtifacts:b,modelArtifactsInfo:j});e.onsuccess=function(){return a({modelArtifactsInfo:j})},e.onerror=function(a){var b=(l=k.objectStore(zE)).delete(c.modelPath);b.onsuccess=function(){return f.close(),d(e.error)},b.onerror=function(a){return f.close(),d(e.error)}}},m.onerror=function(a){return f.close(),d(m.error)},k.oncomplete=function(){null==i?f.close():i.oncomplete=function(){return f.close()}}}},e.onerror=function(a){return d(e.error)}})},a.URL_SCHEME="indexeddb://",a}(),zI=function(a){var b;return pV.getBool("IS_BROWSER")&&!Array.isArray(a)&&a.startsWith(zH.URL_SCHEME)?(b=a.slice(zH.URL_SCHEME.length),new zH(b)):null};zz.registerSaveRouter(zI),zz.registerLoadRouter(zI);var zJ=function(){function a(){this.indexedDB=zF()}return a.prototype.listModels=function(){return pS(this,void 0,void 0,function(){var a=this;return pT(this,function(b){return[2,new Promise(function(b,c){var d=a.indexedDB.open("tensorflowjs",1);d.onupgradeneeded=function(){return zG(d)},d.onsuccess=function(){var a=d.result,e=a.transaction(zE,"readonly"),f=e.objectStore(zE).getAll();f.onsuccess=function(){for(var a={},c=0,d=f.result;c<d.length;c++){var e=d[c];a[e.modelPath]=e.modelArtifactsInfo}b(a)},f.onerror=function(b){return a.close(),c(f.error)},e.oncomplete=function(){return a.close()}},d.onerror=function(a){return c(d.error)}})]})})},a.prototype.removeModel=function(a){return pS(this,void 0,void 0,function(){var b=this;return pT(this,function(c){var d;return a=(d=a).startsWith(zH.URL_SCHEME)?d.slice(zH.URL_SCHEME.length):d,[2,new Promise(function(c,d){var e=b.indexedDB.open("tensorflowjs",1);e.onupgradeneeded=function(){return zG(e)},e.onsuccess=function(){var b,f=e.result,g=f.transaction(zE,"readwrite"),h=g.objectStore(zE),i=h.get(a);i.onsuccess=function(){if(null==i.result)return f.close(),d(Error("Cannot find model with path '"+a+"' in IndexedDB."));var e=h.delete(a),g=function(){var e=(b=f.transaction(zD,"readwrite")).objectStore(zD).delete(a);e.onsuccess=function(){return c(i.result.modelArtifactsInfo)},e.onerror=function(a){return d(i.error)}};e.onsuccess=g,e.onerror=function(a){return g(),f.close(),d(i.error)}},i.onerror=function(a){return f.close(),d(i.error)},g.oncomplete=function(){null==b?f.close():b.oncomplete=function(){return f.close()}}},e.onerror=function(a){return d(e.error)}})]})})},a}();if(pV.getBool("IS_BROWSER"))try{zA.registerManager(zH.URL_SCHEME,new zJ)}catch(a){}var zK="tensorflowjs_models",zL="info";function zM(a){return{info:[zK,a,zL].join("/"),topology:[zK,a,"model_topology"].join("/"),weightSpecs:[zK,a,"weight_specs"].join("/"),weightData:[zK,a,"weight_data"].join("/"),modelMetadata:[zK,a,"model_metadata"].join("/")}}var zN=function(){function a(a){if(!pV.getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==a||!a)throw Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=a,this.keys=zM(this.modelPath)}return a.prototype.save=function(a){return pS(this,void 0,void 0,function(){var b,c,d;return pT(this,function(e){if(a.modelTopology instanceof ArrayBuffer)throw Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");b=JSON.stringify(a.modelTopology),c=JSON.stringify(a.weightSpecs),d=zy(a);try{return this.LS.setItem(this.keys.info,JSON.stringify(d)),this.LS.setItem(this.keys.topology,b),this.LS.setItem(this.keys.weightSpecs,c),this.LS.setItem(this.keys.weightData,function(a){if(zu)return Buffer.from(a).toString("base64");for(var b=new Uint8Array(a),c="",d=0,e=b.length;d<e;d++)c+=String.fromCharCode(b[d]);return btoa(c)}(a.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})),[2,{modelArtifactsInfo:d}]}catch(a){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+d.modelTopologyBytes+", weightSpecsBytes="+d.weightSpecsBytes+", weightDataBytes="+d.weightDataBytes+".")}})})},a.prototype.load=function(){return pS(this,void 0,void 0,function(){var a,b,c,d,e,f,g;return pT(this,function(h){if(null==(a=JSON.parse(this.LS.getItem(this.keys.info))))throw Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==a.modelTopologyType)throw Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(b={},null==(c=JSON.parse(this.LS.getItem(this.keys.topology))))throw Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(b.modelTopology=c,null==(d=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(b.weightSpecs=d,null!=(e=this.LS.getItem(this.keys.modelMetadata))&&(b.format=(f=JSON.parse(e)).format,b.generatedBy=f.generatedBy,b.convertedBy=f.convertedBy,b.userDefinedMetadata=f.userDefinedMetadata),null==(g=this.LS.getItem(this.keys.weightData)))throw Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return b.weightData=function(a){if(zu){var b=Buffer.from(a,"base64");return b.buffer.slice(b.byteOffset,b.byteOffset+b.byteLength)}for(var c=atob(a),d=new Uint8Array(c.length),e=0;e<c.length;++e)d.set([c.charCodeAt(e)],e);return d.buffer}(g),[2,b]})})},a.URL_SCHEME="localstorage://",a}(),zO=function(a){var b;return pV.getBool("IS_BROWSER")&&!Array.isArray(a)&&a.startsWith(zN.URL_SCHEME)?(b=a.slice(zN.URL_SCHEME.length),new zN(b)):null};zz.registerSaveRouter(zO),zz.registerLoadRouter(zO);var zP=function(){function a(){p3(pV.getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),p3("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return a.prototype.listModels=function(){return pS(this,void 0,void 0,function(){var a,b,c,d,e;return pT(this,function(f){for(a={},b=zK+"/",c="/"+zL,d=0;d<this.LS.length;++d)(e=this.LS.key(d)).startsWith(b)&&e.endsWith(c)&&(a[function(a){var b=a.split("/");if(b.length<3)throw Error("Invalid key format: "+a);return b.slice(1,b.length-1).join("/")}(e)]=JSON.parse(this.LS.getItem(e)));return[2,a]})})},a.prototype.removeModel=function(a){return pS(this,void 0,void 0,function(){var b,c;return pT(this,function(d){var e;if(b=zM(a=(e=a).startsWith(zN.URL_SCHEME)?e.slice(zN.URL_SCHEME.length):e),null==this.LS.getItem(b.info))throw Error("Cannot find model at path '"+a+"'");return c=JSON.parse(this.LS.getItem(b.info)),this.LS.removeItem(b.info),this.LS.removeItem(b.topology),this.LS.removeItem(b.weightSpecs),this.LS.removeItem(b.weightData),[2,c]})})},a}();if(pV.getBool("IS_BROWSER"))try{zA.registerManager(zN.URL_SCHEME,new zP)}catch(a){}function zQ(a){return new Promise(function(a){return setTimeout(a)}).then(a)}var zR=function(){function a(b){if(!pV.getBool("IS_BROWSER"))throw Error("browserDownloads() cannot proceed because the current environment is not a browser.");b.startsWith(a.URL_SCHEME)&&(b=b.slice(a.URL_SCHEME.length)),null!=b&&0!==b.length||(b="model"),this.modelTopologyFileName=b+".json",this.weightDataFileName=b+".weights.bin"}return a.prototype.save=function(a){return pS(this,void 0,void 0,function(){var b,c,d,e,f,g;return pT(this,function(h){switch(h.label){case 0:if("undefined"==typeof document)throw Error("Browser downloads are not supported in this environment since `document` is not present");if(b=window.URL.createObjectURL(new Blob([a.weightData],{type:"application/octet-stream"})),!(a.modelTopology instanceof ArrayBuffer))return[3,1];throw Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return c=[{paths:["./"+this.weightDataFileName],weights:a.weightSpecs}],d={modelTopology:a.modelTopology,format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,weightsManifest:c},e=window.URL.createObjectURL(new Blob([JSON.stringify(d)],{type:"application/json"})),(f=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,f.href=e,[4,zQ(function(){return f.dispatchEvent(new MouseEvent("click"))})];case 2:return h.sent(),null==a.weightData?[3,4]:((g=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,g.href=b,[4,zQ(function(){return g.dispatchEvent(new MouseEvent("click"))})]);case 3:h.sent(),h.label=4;case 4:return[2,{modelArtifactsInfo:zy(a)}]}})})},a.URL_SCHEME="downloads://",a}(),zS=function(){function a(a){if(null==a||a.length<1)throw Error("When calling browserFiles, at least 1 file is required, but received "+a);this.files=a}return a.prototype.load=function(){return pS(this,void 0,void 0,function(){var a,b,c=this;return pT(this,function(d){return a=this.files[0],b=this.files.slice(1),[2,new Promise(function(d,e){var f=new FileReader;f.onload=function(f){var g=JSON.parse(f.target.result),h=g.modelTopology;if(null!=h){0===b.length&&d({modelTopology:h});var i=g.weightsManifest;if(null!=i){try{j=c.checkManifestAndWeightFiles(i,b)}catch(a){return void e(a)}var j,k=[],l=[],m=[];i.forEach(function(a){a.paths.forEach(function(a){l.push(a),m.push(null)}),k.push.apply(k,a.weights)}),i.forEach(function(a){a.paths.forEach(function(a){var b=new FileReader;b.onload=function(b){var c=b.target.result;m[l.indexOf(a)]=c,-1===m.indexOf(null)&&d({modelTopology:h,weightSpecs:k,weightData:zw(m),format:g.format,generatedBy:g.generatedBy,convertedBy:g.convertedBy,userDefinedMetadata:g.userDefinedMetadata})},b.onerror=function(b){return e("Failed to weights data from file of path '"+a+"'.")},b.readAsArrayBuffer(j[a])})})}else e(Error("weightManifest field is missing from file "+a.name))}else e(Error("modelTopology field is missing from file "+a.name))},f.onerror=function(b){return e("Failed to read model topology and weights manifest JSON from file '"+a.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},f.readAsText(a)})]})})},a.prototype.checkManifestAndWeightFiles=function(a,b){for(var c=[],d=b.map(function(a){return zx(a.name)}),e={},f=0;f<a.length;f++)a[f].paths.forEach(function(a){var f=zx(a);if(-1!==c.indexOf(f))throw Error("Duplicate file basename found in weights manifest: '"+f+"'");if(c.push(f),-1===d.indexOf(f))throw Error("Weight file with basename '"+f+"' is not provided.");e[a]=b[d.indexOf(f)]});if(c.length!==b.length)throw Error("Mismatch in the number of files in weights manifest ("+c.length+") and the number of weight files provided ("+b.length+").");return e},a}();function zT(a,b,c,d){p3(null!=a&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"}),e=c=null==c?0:c,f=d=null==d?1:d,p3(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),p3(f>=0&&f<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+f}),p3(f>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+f});var e,f,g=0;return Promise.all(a.map(function(e){return e.then(function(e){return b(c+ ++g/a.length*(d-c)),e}),e}))}function zU(a,b){return pS(this,void 0,void 0,function(){var c,d,e,f,g,h,i,j,k;return pT(this,function(l){switch(l.label){case 0:return null==b&&(b={}),c=null==b.fetchFunc?pV.platform.fetch:b.fetchFunc,d=a.map(function(a){return c(a,b.requestInit,{isBinary:!0})}),e=0,f=.5,null!=b.onProgress?[3,2]:[4,Promise.all(d)];case 1:return g=l.sent(),[3,4];case 2:return[4,zT(d,b.onProgress,e,f)];case 3:g=l.sent(),l.label=4;case 4:return h=g.map(function(a){return a.arrayBuffer()}),i=.5,j=1,null!=b.onProgress?[3,6]:[4,Promise.all(h)];case 5:return k=l.sent(),[3,8];case 6:return[4,zT(h,b.onProgress,i,j)];case 7:k=l.sent(),l.label=8;case 8:return[2,k]}})})}function zV(a){var b=this;return function(c,d,e){return void 0===d&&(d=""),pS(b,void 0,void 0,function(){var b,f,g,h,i,j,k,l,m;return pT(this,function(n){switch(n.label){case 0:if(b=c.map(function(){return!1}),f={},g=null!=e?e.map(function(){return!1}):[],h=[],c.forEach(function(a,c){var d=0;a.weights.forEach(function(a){var i=zs["quantization"in a?a.quantization.dtype:a.dtype]*p7(a.shape),j=function(){b[c]=!0,null==f[c]&&(f[c]=[]),f[c].push({manifestEntry:a,groupOffset:d,sizeBytes:i})};null!=e?e.forEach(function(b,c){b===a.name&&(j(),g[c]=!0)}):j(),h.push(a.name),d+=i})}),!g.every(function(a){return a}))throw Error("Could not find weights in manifest with names: "+e.filter(function(a,b){return!g[b]}).join(", ")+". \nManifest JSON has weights with names: "+h.join(", ")+".");return i=b.reduce(function(a,b,c){return b&&a.push(c),a},[]),j=[],i.forEach(function(a){c[a].paths.forEach(function(a){var b=d+(d.endsWith("/")?"":"/")+a;j.push(b)})}),[4,a(j)];case 1:return k=n.sent(),l={},m=0,i.forEach(function(a){for(var b=c[a].paths.length,d=0,e=0;e<b;e++)d+=k[m+e].byteLength;for(var g=new ArrayBuffer(d),h=new Uint8Array(g),i=0,j=0;j<b;j++){var n=new Uint8Array(k[m+j]);h.set(n,i),i+=n.byteLength}f[a].forEach(function(a){var b=zt(g.slice(a.groupOffset,a.groupOffset+a.sizeBytes),[a.manifestEntry]);for(var c in b)l[c]=b[c]}),m+=b}),[2,l]}})})}}zz.registerSaveRouter(function(a){var b;return pV.getBool("IS_BROWSER")&&!Array.isArray(a)&&a.startsWith(zR.URL_SCHEME)?(void 0===(b=a.slice(zR.URL_SCHEME.length))&&(b="model"),new zR(b)):null});var zW=function(){function a(a,b){if(this.DEFAULT_METHOD="POST",null==b&&(b={}),this.weightPathPrefix=b.weightPathPrefix,this.onProgress=b.onProgress,null!=b.fetchFunc?(p3("function"==typeof b.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=b.fetchFunc):this.fetch=pV.platform.fetch,p3(null!=a&&a.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(a)&&p3(2===a.length,function(){return"URL paths for http must have a length of 2, (actual length is "+a.length+")."}),this.path=a,null!=b.requestInit&&null!=b.requestInit.body)throw Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=b.requestInit||{}}return a.prototype.save=function(a){return pS(this,void 0,void 0,function(){var b,c,d,e;return pT(this,function(f){switch(f.label){case 0:if(a.modelTopology instanceof ArrayBuffer)throw Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(b=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,c=[{paths:["./model.weights.bin"],weights:a.weightSpecs}],d={modelTopology:a.modelTopology,format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata,weightsManifest:c},b.body.append("model.json",new Blob([JSON.stringify(d)],{type:"application/json"}),"model.json"),null!=a.weightData&&b.body.append("model.weights.bin",new Blob([a.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,b)];case 1:if((e=f.sent()).ok)return[2,{modelArtifactsInfo:zy(a),responses:[e]}];throw Error("BrowserHTTPRequest.save() failed due to HTTP response status "+e.status+".")}})})},a.prototype.load=function(){return pS(this,void 0,void 0,function(){var a,b,c,d,e,f,g,h,i,j,k,l;return pT(this,function(m){switch(m.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(a=m.sent()).ok)throw Error("Request to "+this.path+" failed with status code "+a.status+". Please verify this URL points to the model JSON of the model to load.");m.label=2;case 2:return m.trys.push([2,4,,5]),[4,a.json()];case 3:return b=m.sent(),[3,5];case 4:throw m.sent(),c="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?c+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":c+=" Please make sure the server is serving valid JSON for this request.",Error(c);case 5:if(d=b.modelTopology,e=b.weightsManifest,f=b.generatedBy,g=b.convertedBy,h=b.format,i=b.userDefinedMetadata,null==d&&null==e)throw Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==e?[3,7]:[4,this.loadWeights(e)];case 6:j=(l=m.sent())[0],k=l[1],m.label=7;case 7:return[2,{modelTopology:d,weightSpecs:j,weightData:k,userDefinedMetadata:i,generatedBy:f,convertedBy:g,format:h}]}})})},a.prototype.loadWeights=function(a){return pS(this,void 0,void 0,function(){var b,c,d,e,f,g,h,i,j,k;return pT(this,function(l){switch(l.label){case 0:var m,n,o;for(n=(m=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),o=m.lastIndexOf("?"),c=(b=[m.substring(0,n)+"/",o>n?m.substring(o):""])[0],d=b[1],e=this.weightPathPrefix||c,f=[],g=0,h=a;g<h.length;g++)i=h[g],f.push.apply(f,i.weights);return j=[],a.forEach(function(a){a.paths.forEach(function(a){j.push(e+a+d)})}),[4,zU(j,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return k=l.sent(),[2,[f,zw(k)]]}})})},a.URL_SCHEME_REGEX=/^https?:\/\//,a}();function zX(a){return null!=a.match(zW.URL_SCHEME_REGEX)}var zY=function(a,b){return"undefined"==typeof fetch?null:(Array.isArray(a)?a.every(function(a){return zX(a)}):zX(a))?zZ(a,{onProgress:b}):null};function zZ(a,b){return new zW(a,b)}zz.registerSaveRouter(zY),zz.registerLoadRouter(zY);var z$=function(){function a(a){this.modelArtifacts=a}return a.prototype.load=function(){return pS(this,void 0,void 0,function(){return pT(this,function(a){return[2,this.modelArtifacts]})})},a}(),z_=function(){function a(a){this.saveHandler=a}return a.prototype.save=function(a){return pS(this,void 0,void 0,function(){return pT(this,function(b){return[2,this.saveHandler(a)]})})},a}(),z0=Object.freeze({browserFiles:function(a){return new zS(a)},browserHTTPRequest:function(a,b){return zZ(a,b)},concatenateArrayBuffers:zw,decodeWeights:zt,encodeWeights:function(a,b){return pS(this,void 0,void 0,function(){var c,d,e,f,g,h=this;return pT(this,function(i){switch(i.label){case 0:for(c=[],d=[],e=Array.isArray(a)?a.map(function(a){return a.name}):Object.keys(a),f=function(f){var g=e[f],i=Array.isArray(a)?a[f].tensor:a[g];if("float32"!==i.dtype&&"int32"!==i.dtype&&"bool"!==i.dtype&&"string"!==i.dtype)throw Error("Unsupported dtype in weight '"+g+"': "+i.dtype);var j={name:g,shape:i.shape,dtype:i.dtype};if("string"===i.dtype){var k=new Promise(function(a){return pS(h,void 0,void 0,function(){var b,c,d,e,f,g;return pT(this,function(h){switch(h.label){case 0:return[4,i.bytes()];case 1:for(c=new Uint8Array((b=h.sent()).reduce(function(a,b){return a+b.length},0)+4*b.length),d=0,e=0;e<b.length;e++)g=new Uint8Array(new Uint32Array([(f=b[e]).length]).buffer),c.set(g,d),d+=4,c.set(f,d),d+=f.length;return a(c),[2]}})})});d.push(k)}else d.push(i.data());null!=b&&(j.group=b),c.push(j)},g=0;g<e.length;++g)f(g);return[4,Promise.all(d)];case 1:return[2,{data:function(a){if(null===a)throw Error("Invalid input value: "+JSON.stringify(a));var b=0,c=[];a.forEach(function(a){if(b+=a.byteLength,c.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw Error("Unsupported TypedArray subtype: "+a.constructor.name)});var d=new Uint8Array(b),e=0;return c.forEach(function(a){d.set(new Uint8Array(a.buffer),e),e+=a.byteLength}),d.buffer}(i.sent()),specs:c}]}})})},fromMemory:function(a,b,c,d){return 1==arguments.length?null!=a.modelTopology||null!=a.weightSpecs?new z$(a):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new z$({modelTopology:a})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new z$({modelTopology:a,weightSpecs:b,weightData:c,trainingConfig:d}))},getLoadHandlers:function(a,b){return zz.getLoadHandlers(a,b)},getModelArtifactsInfoForJSON:zy,getSaveHandlers:function(a){return zz.getSaveHandlers(a)},http:zZ,isHTTPScheme:zX,loadWeights:function(a,b,c,d){return void 0===b&&(b=""),pS(this,void 0,void 0,function(){return pT(this,function(e){return[2,zV(function(a){return zU(a,{requestInit:d})})(a,b,c)]})})},registerLoadRouter:function(a){return zz.registerLoadRouter(a)},registerSaveRouter:function(a){return zz.registerSaveRouter(a)},weightsLoaderFactory:zV,withSaveHandler:function(a){return new z_(a)},copyModel:function(a,b){return pS(this,void 0,void 0,function(){return pT(this,function(c){return[2,zC(a,b,!1)]})})},listModels:function(){return pS(this,void 0,void 0,function(){var a,b,c,d,e,f,g;return pT(this,function(h){switch(h.label){case 0:a=zA.getSchemes(),b={},c=0,d=a,h.label=1;case 1:return c<d.length?(e=d[c],[4,zA.getManager(e).listModels()]):[3,4];case 2:for(g in f=h.sent())b[e+"://"+g]=f[g];h.label=3;case 3:return c++,[3,1];case 4:return[2,b]}})})},moveModel:function(a,b){return pS(this,void 0,void 0,function(){return pT(this,function(c){return[2,zC(a,b,!0)]})})},removeModel:function(a){return pS(this,void 0,void 0,function(){var b;return pT(this,function(c){return b=zB(a),[2,zA.getManager(b.scheme).removeModel(b.path)]})})}});Object.freeze({confusionMatrix:sf({confusionMatrix_:function(a,b,c){var d=r3(a,"labels","confusionMatrix"),e=r3(b,"predictions","confusionMatrix");p3(null==c||c>0&&Number.isInteger(c),function(){return"If provided, numClasses must be a positive integer, but got "+c}),p3(1===d.rank,function(){return"Expected the rank of labels to be 1, but got "+d.rank}),p3(1===e.rank,function(){return"Expected the rank of predictions to be 1, but got "+e.rank}),p3(d.shape[0]===e.shape[0],function(){return"Mismatch in the number of examples: "+d.shape[0]+" vs. "+e.shape[0]+". Labels and predictions should have the same number of elements."}),p3(c>0&&Number.isInteger(c),function(){return"numClasses is required to be a positive integer, but got "+c});var f=sY(d.asType("int32"),c),g=sY(e.asType("int32"),c);return f.transpose().matMul(g).asType("int32")}})});var z1=Object.freeze({toPixels:function(a,b){return pS(this,void 0,void 0,function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;return pT(this,function(z){switch(z.label){case 0:if(c=r3(a,"img","toPixels"),a instanceof qP||(c=c.toInt()),2!==c.rank&&3!==c.rank)throw Error("toPixels only supports rank 2 or 3 tensors, got rank "+c.rank+".");if(e=(d=c.shape.slice(0,2))[0],f=d[1],(g=2===c.rank?1:c.shape[2])>4||2===g)throw Error("toPixels only supports depth of size 1, 3 or 4 but got "+g);return[4,c.data()];case 1:return h=z.sent(),i=c.min(),j=c.max(),[4,Promise.all([i.data(),j.data()])];case 2:if(l=(k=z.sent())[0],m=k[1],n=l[0],o=m[0],i.dispose(),j.dispose(),"float32"===c.dtype){if(n<0||o>1)throw Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+n+" - "+o+"].")}else{if("int32"!==c.dtype)throw Error("Unsupported type for toPixels: "+c.dtype+". Please use float32 or int32 tensors.");if(n<0||o>255)throw Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+n+" - "+o+"].")}for(p="float32"===c.dtype?255:1,q=new Uint8ClampedArray(f*e*4),r=0;r<e*f;++r)s=void 0,t=void 0,u=void 0,v=void 0,1===g?(s=h[r]*p,t=h[r]*p,u=h[r]*p,v=255):3===g?(s=h[3*r]*p,t=h[3*r+1]*p,u=h[3*r+2]*p,v=255):4===g&&(s=h[4*r]*p,t=h[4*r+1]*p,u=h[4*r+2]*p,v=h[4*r+3]*p),q[(w=4*r)+0]=Math.round(s),q[w+1]=Math.round(t),q[w+2]=Math.round(u),q[w+3]=Math.round(v);return null!=b&&(b.width=f,b.height=e,x=b.getContext("2d"),y=new ImageData(q,f,e),x.putImageData(y,0,0)),c!==a&&c.dispose(),[2,q]}})})},fromPixels:sf({fromPixels_:function(a,b){if(void 0===b&&(b=3),b>4)throw Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==a)throw Error("pixels passed to tf.browser.fromPixels() can not be null");var c=!1,d=!1,f=!1,g=!1,h=!1;if(a.data instanceof Uint8Array)c=!0;else if("undefined"!=typeof ImageData&&a instanceof ImageData)d=!0;else if("undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement)f=!0;else if("undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement)g=!0;else{if(null==a.getContext)throw Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+a.constructor.name);h=!0}if(f&&f&&a.readyState<2)throw Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=pY("FromPixels",q4.backendName))return q4.runKernel("FromPixels",{pixels:a},{numChannels:b});var i,j,k=f?[a.videoWidth,a.videoHeight]:[a.width,a.height],l=k[0],m=k[1];if(h?i=a.getContext("2d").getImageData(0,0,l,m).data:d||c?i=a.data:(g||f)&&(null==e&&(e=document.createElement("canvas").getContext("2d")),e.canvas.width=l,e.canvas.height=m,e.drawImage(a,0,0,l,m),i=e.getImageData(0,0,l,m).data),4===b)j=new Int32Array(i);else{var n=l*m;j=new Int32Array(n*b);for(var o=0;o<n;o++)for(var p=0;p<b;++p)j[o*b+p]=i[4*o+p]}return so(j,[m,l,b],"int32")}})}),z2=function(){function a(){}return a.prototype.getClassName=function(){return this.constructor.className},a.fromConfig=function(a,b){return new a(b)},a}(),z3=function(){function a(){this.classNameMap={}}return a.getMap=function(){return null==a.instance&&(a.instance=new a),a.instance},a.register=function(b){a.getMap().classNameMap[b.className]=[b,b.fromConfig]},a}();function z4(a){p3(null!=a.className,function(){return"Class being registered does not have the static className property defined."}),p3("string"==typeof a.className,function(){return"className is required to be a string, but got type "+typeof a.className}),p3(a.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),z3.register(a)}function z5(){return 32===q4.backend.floatPrecision()?.001:.1}function z6(a,b,c){var d=!0;if((qm(a)||qm(b))&&(d=!1),qm(a)&&qm(b)&&(d=!0),d){var e=a.constructor.name,f=b.constructor.name;if(e!==f)throw Error("Arrays are of different type. Actual: "+e+". Expected: "+f)}if(Array.isArray(a)&&Array.isArray(b)){var g=r1(a),h=r1(b);if(!p8(g,h))throw Error("Arrays have different shapes. Actual: ["+g+"]. Expected: ["+h+"]")}var i=qm(a)?a:p6(a),j=qm(b)?b:p6(b);if(i.length!==j.length)throw Error("Arrays have different lengths actual: "+i.length+" vs expected: "+j.length+".\nActual:   "+i+".\nExpected: "+j+".");for(var k=0;k<j.length;++k){var l=i[k],m=j[k];if(!c(l,m))throw Error("Arrays differ: actual["+k+"] = "+l+", expected["+k+"] = "+m+".\nActual:   "+i+".\nExpected: "+j+".")}}function z7(a,b,c){return!isFinite(a)&&!isFinite(b)||!(isNaN(a)||isNaN(b)||Math.abs(a-b)>c)}Object.freeze({Serializable:z2,SerializationMap:z3,registerClass:z4}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(a,b,c){return null==c&&(c=z5()),z6(a,b,function(a,b){return z7(a,b,c)})},testEpsilon:z5,expectPromiseToFail:function(a,b){a().then(function(){return b.fail()},function(){return b()})},expectArraysEqual:function(a,b){var c="string"==typeof b||"number"==typeof b||"boolean"==typeof b?[b]:b;return qp(a)||qp(a[0])||qp(b)||qp(b[0])?z6(a,c,function(a,b){return a==b}):z6(a,b,function(a,b){return z7(a,b,0)})},expectNumbersClose:function(a,b,c){if(null==c&&(c=z5()),!z7(a,b,c))throw Error("Numbers differ: actual === "+a+", expected === "+b)},expectValuesInRange:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d]<b||a[d]>c)throw Error("Value out of range:"+a[d]+" low: "+b+", high: "+c)},expectArrayBuffersEqual:function(a,b){expect(new Float32Array(a)).toEqual(new Float32Array(b))}}),Object.freeze({gpgpu_util:vc,webgl_util:rX,forceHalfFloat:function(){pV.set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:we,setWebGLContext:rc,GPGPUContext:vd});var z8=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return pR(b,a),b.prototype.minimize=function(a,b,c){void 0===b&&(b=!1);var d=this.computeGradients(a,c),e=d.value,f=d.grads;if(null!=c){var g=c.map(function(a){return{name:a.name,tensor:f[a.name]}});this.applyGradients(g)}else this.applyGradients(f);return r_(f),b?e:(e.dispose(),null)},Object.defineProperty(b.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),b.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},b.prototype.computeGradients=function(a,b){return function(a,b){p3(qt(a),function(){return"The f passed in variableGrads(f) must be a function"}),p3(null==b||Array.isArray(b)&&b.every(function(a){return a instanceof qW}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var c=null!=b;if(!c)for(var d in b=[],q4.registeredVariables)b.push(q4.registeredVariables[d]);var e=c?b.filter(function(a){return!a.trainable}):null,f=b.length;p3((b=b.filter(function(a){return a.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+f+" variables is trainable."});var g=q4.gradients(a,b,null,!0),h=g.value,i=g.grads;p3(i.some(function(a){return null!=a}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),p3(0===h.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+h.rank+" tensor"});var j={};return b.forEach(function(a,b){null!=i[b]&&(j[a.name]=i[b])}),null!=e&&e.forEach(function(a){return j[a.name]=null}),{value:h,grads:j}}(a,b)},b.prototype.dispose=function(){null!=this.iterations_&&r_(this.iterations_)},b.prototype.saveIterations=function(){return pS(this,void 0,void 0,function(){return pT(this,function(a){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:sl(this.iterations_,"int32")}]})})},b.prototype.getWeights=function(){return pS(this,void 0,void 0,function(){return pT(this,function(a){throw Error("getWeights() is not implemented for this optimizer yet.")})})},b.prototype.setWeights=function(a){return pS(this,void 0,void 0,function(){return pT(this,function(a){throw Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},b.prototype.extractIterations=function(a){return pS(this,void 0,void 0,function(){var b;return pT(this,function(c){switch(c.label){case 0:return b=this,[4,a[0].tensor.data()];case 1:return b.iterations_=c.sent()[0],[2,a.slice(1)]}})})},b}(z2);Object.defineProperty(z8,Symbol.hasInstance,{value:function(a){return null!=a.minimize&&null!=a.computeGradients&&null!=a.applyGradients}});var z9=function(a){function b(b,c,d){void 0===d&&(d=null);var e=a.call(this)||this;return e.learningRate=b,e.rho=c,e.epsilon=d,e.accumulatedGrads=[],e.accumulatedUpdates=[],null==d&&(e.epsilon=q4.backend.epsilon()),e}return pR(b,a),b.prototype.applyGradients=function(a){var b=this;(Array.isArray(a)?a.map(function(a){return a.name}):Object.keys(a)).forEach(function(c,d){var e=q4.registeredVariables[c];null==b.accumulatedGrads[d]&&(b.accumulatedGrads[d]={originalName:c+"/accum_grad",variable:r$(function(){return sv(e).variable(!1)})}),null==b.accumulatedUpdates[d]&&(b.accumulatedUpdates[d]={originalName:c+"/accum_var",variable:r$(function(){return sv(e).variable(!1)})});var f=Array.isArray(a)?a[d].tensor:a[c];if(null!=f){var g=b.accumulatedGrads[d].variable,h=b.accumulatedUpdates[d].variable;r$(function(){var a=g.mul(b.rho).add(f.square().mul(1-b.rho)),c=h.add(b.epsilon).sqrt().div(g.add(b.epsilon).sqrt()).mul(f),d=h.mul(b.rho).add(c.square().mul(1-b.rho));g.assign(a),h.assign(d);var i=c.mul(-b.learningRate).add(e);e.assign(i)})}}),this.incrementIterations()},b.prototype.dispose=function(){null!=this.accumulatedUpdates&&(r_(this.accumulatedGrads.map(function(a){return a.variable})),r_(this.accumulatedUpdates.map(function(a){return a.variable})))},b.prototype.getWeights=function(){return pS(this,void 0,void 0,function(){var a;return pT(this,function(b){switch(b.label){case 0:return a=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[b.sent()].concat(a.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},b.prototype.setWeights=function(a){return pS(this,void 0,void 0,function(){var b;return pT(this,function(c){switch(c.label){case 0:return[4,this.extractIterations(a)];case 1:return b=(a=c.sent()).length/2,this.accumulatedGrads=a.slice(0,b).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=a.slice(b,2*b).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},b.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},b.fromConfig=function(a,b){return new a(b.learningRate,b.rho,b.epsilon)},b.className="Adadelta",b}(z8);z4(z9);var Aa=function(a){function b(b,c){void 0===c&&(c=.1);var d=a.call(this)||this;return d.learningRate=b,d.initialAccumulatorValue=c,d.accumulatedGrads=[],d}return pR(b,a),b.prototype.applyGradients=function(a){var b=this;(Array.isArray(a)?a.map(function(a){return a.name}):Object.keys(a)).forEach(function(c,d){var e=q4.registeredVariables[c];null==b.accumulatedGrads[d]&&(b.accumulatedGrads[d]={originalName:c+"/accumulator",variable:r$(function(){return ss(e.shape,b.initialAccumulatorValue).variable(!1)})});var f=Array.isArray(a)?a[d].tensor:a[c];if(null!=f){var g=b.accumulatedGrads[d].variable;r$(function(){var a=g.add(f.square());g.assign(a);var c=f.div(a.add(q4.backend.epsilon()).sqrt()).mul(-b.learningRate).add(e);e.assign(c)})}}),this.incrementIterations()},b.prototype.dispose=function(){null!=this.accumulatedGrads&&r_(this.accumulatedGrads.map(function(a){return a.variable}))},b.prototype.getWeights=function(){return pS(this,void 0,void 0,function(){return pT(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()].concat(this.accumulatedGrads.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},b.prototype.setWeights=function(a){return pS(this,void 0,void 0,function(){return pT(this,function(b){switch(b.label){case 0:return[4,this.extractIterations(a)];case 1:return a=b.sent(),this.accumulatedGrads=a.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},b.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},b.fromConfig=function(a,b){return new a(b.learningRate,b.initialAccumulatorValue)},b.className="Adagrad",b}(z8);z4(Aa);var Ab=function(a){function b(b,c,d,e){void 0===e&&(e=null);var f=a.call(this)||this;return f.learningRate=b,f.beta1=c,f.beta2=d,f.epsilon=e,f.accumulatedFirstMoment=[],f.accumulatedSecondMoment=[],r$(function(){f.accBeta1=sl(c).variable(),f.accBeta2=sl(d).variable()}),null==e&&(f.epsilon=q4.backend.epsilon()),f}return pR(b,a),b.prototype.applyGradients=function(a){var b=this,c=Array.isArray(a)?a.map(function(a){return a.name}):Object.keys(a);r$(function(){var d=xr(1,b.accBeta1),e=xr(1,b.accBeta2);c.forEach(function(c,f){var g=q4.registeredVariables[c];null==b.accumulatedFirstMoment[f]&&(b.accumulatedFirstMoment[f]={originalName:c+"/m",variable:r$(function(){return sv(g).variable(!1)})}),null==b.accumulatedSecondMoment[f]&&(b.accumulatedSecondMoment[f]={originalName:c+"/v",variable:r$(function(){return sv(g).variable(!1)})});var h=Array.isArray(a)?a[f].tensor:a[c];if(null!=h){var i=b.accumulatedFirstMoment[f].variable,j=b.accumulatedSecondMoment[f].variable,k=i.mul(b.beta1).add(h.mul(1-b.beta1)),l=j.mul(b.beta2).add(h.square().mul(1-b.beta2)),m=k.div(d),n=l.div(e);i.assign(k),j.assign(l);var o=m.div(n.sqrt().add(b.epsilon)).mul(-b.learningRate).add(g);g.assign(o)}}),b.accBeta1.assign(b.accBeta1.mul(b.beta1)),b.accBeta2.assign(b.accBeta2.mul(b.beta2))}),this.incrementIterations()},b.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&r_(this.accumulatedFirstMoment.map(function(a){return a.variable})),null!=this.accumulatedSecondMoment&&r_(this.accumulatedSecondMoment.map(function(a){return a.variable}))},b.prototype.getWeights=function(){return pS(this,void 0,void 0,function(){var a;return pT(this,function(b){switch(b.label){case 0:return a=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[b.sent()].concat(a.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},b.prototype.setWeights=function(a){return pS(this,void 0,void 0,function(){var b,c=this;return pT(this,function(d){switch(d.label){case 0:return[4,this.extractIterations(a)];case 1:return a=d.sent(),r$(function(){c.accBeta1.assign(xo(c.beta1,c.iterations_+1)),c.accBeta2.assign(xo(c.beta2,c.iterations_+1))}),b=a.length/2,this.accumulatedFirstMoment=a.slice(0,b).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=a.slice(b,2*b).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},b.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},b.fromConfig=function(a,b){return new a(b.learningRate,b.beta1,b.beta2,b.epsilon)},b.className="Adam",b}(z8);z4(Ab);var Ac=function(a){function b(b,c,d,e,f){void 0===e&&(e=null),void 0===f&&(f=0);var g=a.call(this)||this;return g.learningRate=b,g.beta1=c,g.beta2=d,g.epsilon=e,g.decay=f,g.accumulatedFirstMoment=[],g.accumulatedWeightedInfNorm=[],r$(function(){g.iteration=sl(0).variable(),g.accBeta1=sl(c).variable()}),null==e&&(g.epsilon=q4.backend.epsilon()),g}return pR(b,a),b.prototype.applyGradients=function(a){var b=this,c=Array.isArray(a)?a.map(function(a){return a.name}):Object.keys(a);r$(function(){var d=xr(1,b.accBeta1),e=xc(-b.learningRate,b.iteration.mul(b.decay).add(1));c.forEach(function(c,f){var g=q4.registeredVariables[c];null==b.accumulatedFirstMoment[f]&&(b.accumulatedFirstMoment[f]={originalName:c+"/m",variable:sv(g).variable(!1)}),null==b.accumulatedWeightedInfNorm[f]&&(b.accumulatedWeightedInfNorm[f]={originalName:c+"/v",variable:sv(g).variable(!1)});var h=Array.isArray(a)?a[f].tensor:a[c];if(null!=h){var i=b.accumulatedFirstMoment[f].variable,j=b.accumulatedWeightedInfNorm[f].variable,k=i.mul(b.beta1).add(h.mul(1-b.beta1)),l=j.mul(b.beta2),m=h.abs(),n=l.maximum(m);i.assign(k),j.assign(n);var o=e.div(d).mul(k.div(n.add(b.epsilon))).add(g);g.assign(o)}}),b.iteration.assign(b.iteration.add(1)),b.accBeta1.assign(b.accBeta1.mul(b.beta1))}),this.incrementIterations()},b.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&r_(this.accumulatedFirstMoment.map(function(a){return a.variable})),null!=this.accumulatedWeightedInfNorm&&r_(this.accumulatedWeightedInfNorm.map(function(a){return a.variable}))},b.prototype.getWeights=function(){return pS(this,void 0,void 0,function(){return pT(this,function(a){throw Error("getWeights() is not implemented for Adamax yet.")})})},b.prototype.setWeights=function(a){return pS(this,void 0,void 0,function(){return pT(this,function(a){throw Error("setWeights() is not implemented for Adamax yet.")})})},b.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},b.fromConfig=function(a,b){return new a(b.learningRate,b.beta1,b.beta2,b.epsilon,b.decay)},b.className="Adamax",b}(z8);z4(Ac);var Ad=function(a){function b(b){var c=a.call(this)||this;return c.learningRate=b,c.setLearningRate(b),c}return pR(b,a),b.prototype.applyGradients=function(a){var b=this;(Array.isArray(a)?a.map(function(a){return a.name}):Object.keys(a)).forEach(function(c,d){var e=Array.isArray(a)?a[d].tensor:a[c];if(null!=e){var f=q4.registeredVariables[c];r$(function(){var a=b.c.mul(e).add(f);f.assign(a)})}}),this.incrementIterations()},b.prototype.setLearningRate=function(a){var b;this.learningRate=a,null!=this.c&&this.c.dispose(),this.c=(b=sl(-a),q4.keep(b))},b.prototype.dispose=function(){this.c.dispose()},b.prototype.getWeights=function(){return pS(this,void 0,void 0,function(){return pT(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()]]}})})},b.prototype.setWeights=function(a){return pS(this,void 0,void 0,function(){return pT(this,function(b){switch(b.label){case 0:return[4,this.extractIterations(a)];case 1:if(0!==(a=b.sent()).length)throw Error("SGD optimizer does not have settable weights.");return[2]}})})},b.prototype.getConfig=function(){return{learningRate:this.learningRate}},b.fromConfig=function(a,b){return new a(b.learningRate)},b.className="SGD",b}(z8);z4(Ad);var Ae=function(a){function b(b,c,d){void 0===d&&(d=!1);var e=a.call(this,b)||this;return e.learningRate=b,e.momentum=c,e.useNesterov=d,e.accumulations=[],e.m=sl(e.momentum),e}return pR(b,a),b.prototype.applyGradients=function(a){var b=this;(Array.isArray(a)?a.map(function(a){return a.name}):Object.keys(a)).forEach(function(c,d){var e=q4.registeredVariables[c];null==b.accumulations[d]&&(b.accumulations[d]={originalName:c+"/momentum",variable:r$(function(){return sv(e).variable(!1)})});var f=b.accumulations[d].variable,g=Array.isArray(a)?a[d].tensor:a[c];null!=g&&r$(function(){var a,c=b.m.mul(f).add(g);a=b.useNesterov?b.c.mul(g.add(c.mul(b.m))).add(e):b.c.mul(c).add(e),f.assign(c),e.assign(a)})}),this.incrementIterations()},b.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&r_(this.accumulations.map(function(a){return a.variable}))},b.prototype.setMomentum=function(a){this.momentum=a},b.prototype.getWeights=function(){return pS(this,void 0,void 0,function(){return pT(this,function(a){switch(a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[a.sent()].concat(this.accumulations.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},b.prototype.setWeights=function(a){return pS(this,void 0,void 0,function(){return pT(this,function(b){switch(b.label){case 0:return[4,this.extractIterations(a)];case 1:return a=b.sent(),this.accumulations=a.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},b.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},b.fromConfig=function(a,b){return new a(b.learningRate,b.momentum,b.useNesterov)},b.className="Momentum",b}(Ad);z4(Ae);var Af=function(a){function b(b,c,d,e,f){void 0===c&&(c=.9),void 0===d&&(d=0),void 0===e&&(e=null),void 0===f&&(f=!1);var g=a.call(this)||this;if(g.learningRate=b,g.decay=c,g.momentum=d,g.epsilon=e,g.accumulatedMeanSquares=[],g.accumulatedMoments=[],g.accumulatedMeanGrads=[],g.centered=f,null==e&&(g.epsilon=q4.backend.epsilon()),null==b)throw Error("learningRate for RMSPropOptimizer must be defined.");return g}return pR(b,a),b.prototype.applyGradients=function(a){var b=this;(Array.isArray(a)?a.map(function(a){return a.name}):Object.keys(a)).forEach(function(c,d){var e=q4.registeredVariables[c];null==b.accumulatedMeanSquares[d]&&(b.accumulatedMeanSquares[d]={originalName:c+"/rms",variable:r$(function(){return sv(e).variable(!1)})}),null==b.accumulatedMoments[d]&&(b.accumulatedMoments[d]={originalName:c+"/momentum",variable:r$(function(){return sv(e).variable(!1)})}),null==b.accumulatedMeanGrads[d]&&b.centered&&(b.accumulatedMeanGrads[d]={originalName:c+"/mg",variable:r$(function(){return sv(e).variable(!1)})});var f=Array.isArray(a)?a[d].tensor:a[c];if(null!=f){var g=b.accumulatedMeanSquares[d].variable,h=b.accumulatedMoments[d].variable;r$(function(){var a=g.mul(b.decay).add(f.square().mul(1-b.decay));if(b.centered){var c=b.accumulatedMeanGrads[d].variable,i=c.mul(b.decay).add(f.mul(1-b.decay)),j=h.mul(b.momentum).add(f.mul(b.learningRate).div(a.sub(i.square().add(b.epsilon)).sqrt()));g.assign(a),c.assign(i),h.assign(j);var k=e.sub(j);e.assign(k)}else{var l=g.mul(b.decay).add(f.square().mul(1-b.decay));j=h.mul(b.momentum).add(f.mul(b.learningRate).div(l.add(b.epsilon).sqrt())),g.assign(l),h.assign(j),k=e.sub(j),e.assign(k)}})}}),this.incrementIterations()},b.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&r_(this.accumulatedMeanSquares.map(function(a){return a.variable})),null!=this.accumulatedMeanGrads&&this.centered&&r_(this.accumulatedMeanGrads.map(function(a){return a.variable})),null!=this.accumulatedMoments&&r_(this.accumulatedMoments.map(function(a){return a.variable}))},b.prototype.getWeights=function(){return pS(this,void 0,void 0,function(){var a;return pT(this,function(b){switch(b.label){case 0:return a=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&a.push.apply(a,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[b.sent()].concat(a.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},b.prototype.setWeights=function(a){return pS(this,void 0,void 0,function(){var b;return pT(this,function(c){switch(c.label){case 0:return[4,this.extractIterations(a)];case 1:return a=c.sent(),b=this.centered?a.length/3:a.length/2,this.accumulatedMeanSquares=a.slice(0,b).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=a.slice(b,2*b).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=a.slice(2*b,3*b).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},b.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},b.fromConfig=function(a,b){return new a(b.learningRate,b.decay,b.momentum,b.epsilon,b.centered)},b.className="RMSProp",b}(z8);z4(Af);var Ag=function(){function a(){}return a.sgd=function(a){return new Ad(a)},a.momentum=function(a,b,c){return void 0===c&&(c=!1),new Ae(a,b,c)},a.rmsprop=function(a,b,c,d,e){return void 0===b&&(b=.9),void 0===c&&(c=0),void 0===d&&(d=null),void 0===e&&(e=!1),new Af(a,b,c,d,e)},a.adam=function(a,b,c,d){return void 0===a&&(a=.001),void 0===b&&(b=.9),void 0===c&&(c=.999),void 0===d&&(d=null),new Ab(a,b,c,d)},a.adadelta=function(a,b,c){return void 0===a&&(a=.001),void 0===b&&(b=.95),void 0===c&&(c=null),new z9(a,b,c)},a.adamax=function(a,b,c,d,e){return void 0===a&&(a=.002),void 0===b&&(b=.9),void 0===c&&(c=.999),void 0===d&&(d=null),void 0===e&&(e=0),new Ac(a,b,c,d,e)},a.adagrad=function(a,b){return void 0===b&&(b=.1),new Aa(a,b)},a}();Ag.sgd,Ag.momentum,Ag.adadelta,Ag.adagrad,Ag.rmsprop,Ag.adamax,Ag.adam,"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,qP.prototype.squaredDifference=function(a){return wh(this,a)},qN=zb;var Ah=function(a,b){return(Ah=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,b)};function Ai(a,b){function c(){this.constructor=a}Ah(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}var Aj=function(){return(Aj=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function Ak(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function Al(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function Am(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}var An=function(){function a(a,b){if(!At(a)||!At(b))throw Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:a,height:b}));this._width=a,this._height=b}return Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),a.prototype.reverse=function(){return new a(1/this.width,1/this.height)},a}();function Ao(a,b){return a instanceof qP&&a.shape.length===b}function Ap(a){return Ao(a,4)}function Aq(a){return a&&a.width&&a.height}function Ar(a){return a.reduce(function(a,b){return a.add(b)},new Av(0,0)).div(new Av(a.length,a.length))}function As(a,b,c){return Array(a).fill(0).map(function(a,d){return b+d*c})}function At(a){return!!a&&a!==1/0&&a!==-1/0&&!isNaN(a)||0===a}function Au(a){return At(a)&&0<=a&&a<=1}var Av=function(){function a(a,b){this._x=a,this._y=b}return Object.defineProperty(a.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.sub=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.mul=function(b){return new a(this.x*b.x,this.y*b.y)},a.prototype.div=function(b){return new a(this.x/b.x,this.y/b.y)},a.prototype.abs=function(){return new a(Math.abs(this.x),Math.abs(this.y))},a.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},a.prototype.floor=function(){return new a(Math.floor(this.x),Math.floor(this.y))},a}(),Aw=function(){function a(b,c){void 0===c&&(c=!0);var d=b||{},e=[d.left,d.top,d.right,d.bottom].every(At),f=[d.x,d.y,d.width,d.height].every(At);if(!f&&!e)throw Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(d));var g=f?[d.x,d.y,d.width,d.height]:[d.left,d.top,d.right-d.left,d.bottom-d.top],h=g[0],i=g[1],j=g[2],k=g[3];a.assertIsValidBox({x:h,y:i,width:j,height:k},"Box.constructor",c),this._x=h,this._y=i,this._width=j,this._height=k}return a.isRect=function(a){return!!a&&[a.x,a.y,a.width,a.height].every(At)},a.assertIsValidBox=function(b,c,d){if(void 0===d&&(d=!1),!a.isRect(b))throw Error(c+" - invalid box: "+JSON.stringify(b)+", expected object with properties x, y, width, height");if(!d&&(b.width<0||b.height<0))throw Error(c+" - width ("+b.width+") and height ("+b.height+") must be positive numbers")},Object.defineProperty(a.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"topLeft",{get:function(){return new Av(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"topRight",{get:function(){return new Av(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bottomLeft",{get:function(){return new Av(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bottomRight",{get:function(){return new Av(this.right,this.bottom)},enumerable:!0,configurable:!0}),a.prototype.round=function(){var b=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)});return new a({x:b[0],y:b[1],width:b[2],height:b[3]})},a.prototype.floor=function(){var b=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)});return new a({x:b[0],y:b[1],width:b[2],height:b[3]})},a.prototype.toSquare=function(){var b=this.x,c=this.y,d=this.width,e=this.height,f=Math.abs(d-e);return d<e&&(b-=f/2,d+=f),e<d&&(c-=f/2,e+=f),new a({x:b,y:c,width:d,height:e})},a.prototype.rescale=function(b){var c=Aq(b)?b.width:b,d=Aq(b)?b.height:b;return new a({x:this.x*c,y:this.y*d,width:this.width*c,height:this.height*d})},a.prototype.pad=function(b,c){var d=[this.x-b/2,this.y-c/2,this.width+b,this.height+c];return new a({x:d[0],y:d[1],width:d[2],height:d[3]})},a.prototype.clipAtImageBorders=function(b,c){var d=this.x,e=this.y,f=this.right,g=this.bottom,h=Math.max(d,0),i=Math.max(e,0),j=Math.min(f-h,b-h),k=Math.min(g-i,c-i);return new a({x:h,y:i,width:j,height:k}).floor()},a.prototype.shift=function(b,c){var d=this.width,e=this.height;return new a({x:this.x+b,y:this.y+c,width:d,height:e})},a.prototype.padAtBorders=function(a,b){var c=this.width+1,d=this.height+1,e=c,f=d,g=this.left,h=this.top,i=this.right,j=this.bottom;return i>b&&(e=-i+b+c,i=b),j>a&&(f=-j+a+d,j=a),g<1&&(f=2-g,g=1),h<1&&(f=2-h,h=1),{dy:1,edy:f,dx:1,edx:e,y:h,ey:j,x:g,ex:i,w:c,h:d}},a.prototype.calibrate=function(b){return new a({left:this.left+b.left*this.width,top:this.top+b.top*this.height,right:this.right+b.right*this.width,bottom:this.bottom+b.bottom*this.height}).toSquare().round()},a}(),Ax=function(a){function b(b,c,d,e,f){return void 0===f&&(f=!1),a.call(this,{left:b,top:c,right:d,bottom:e},f)||this}return Ai(b,a),b}(Aw),Ay=function(){function a(a,b,c,d,e){this._imageDims=new An(e.width,e.height),this._score=a,this._classScore=b,this._className=c,this._box=new Aw(d).rescale(this._imageDims)}return Object.defineProperty(a.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"relativeBox",{get:function(){return new Aw(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),a.prototype.forSize=function(b,c){return new a(this.score,this.classScore,this.className,this.relativeBox,{width:b,height:c})},a}(),Az=function(a){function b(b,c,d){return a.call(this,b,b,"",c,d)||this}return Ai(b,a),b.prototype.forSize=function(c,d){var e=a.prototype.forSize.call(this,c,d);return new b(e.score,e.relativeBox,e.imageDims)},b}(Ay);function AA(a,b,c,d){void 0===d&&(d=!0);for(var e=b.map(function(a,b){return{score:a,boxIndex:b}}).sort(function(a,b){return a.score-b.score}).map(function(a){return a.boxIndex}),f=[];e.length>0;)!function(){var b=e.pop();f.push(b);for(var g=e,h=[],i=0;i<g.length;i++){var j=g[i],k=a[b],l=a[j];h.push(function(a,b,c){void 0===c&&(c=!0);var d=Math.max(0,Math.min(a.right,b.right)-Math.max(a.left,b.left))*Math.max(0,Math.min(a.bottom,b.bottom)-Math.max(a.top,b.top));return c?d/(a.area+b.area-d):d/Math.min(a.area,b.area)}(k,l,d))}e=e.filter(function(a,b){return h[b]<=c})}();return f}function AB(a,b){return r$(function(){var c=b[0],d=b[1],e=b[2],f=sw([ss(Am(a.shape.slice(0,3),[1]),c),ss(Am(a.shape.slice(0,3),[1]),d),ss(Am(a.shape.slice(0,3),[1]),e)],3);return xr(a,f)})}function AC(a){return 1/(1+Math.exp(-a))}var AD=function(a){function b(b,c,d,e,f){return void 0===f&&(f=!1),a.call(this,{x:b,y:c,width:d,height:e},f)||this}return Ai(b,a),b}(Aw),AE=function(){function a(a,b,c){void 0===c&&(c=new Av(0,0));var d=b.width,e=b.height;this._imgDims=new An(d,e),this._shift=c,this._positions=a.map(function(a){return a.mul(new Av(d,e)).add(c)})}return Object.defineProperty(a.prototype,"shift",{get:function(){return new Av(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"relativePositions",{get:function(){var a=this;return this._positions.map(function(b){return b.sub(a._shift).div(new Av(a.imageWidth,a.imageHeight))})},enumerable:!0,configurable:!0}),a.prototype.forSize=function(a,b){return new this.constructor(this.relativePositions,{width:a,height:b})},a.prototype.shiftBy=function(a,b){return new this.constructor(this.relativePositions,this._imgDims,new Av(a,b))},a.prototype.shiftByPoint=function(a){return this.shiftBy(a.x,a.y)},a.prototype.align=function(a,b){if(void 0===b&&(b={}),a){var c=a instanceof Az?a.box.floor():new Aw(a);return this.shiftBy(c.x,c.y).align(null,b)}var d=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},b),e=d.useDlibAlignment,f=d.minBoxPadding;return e?this.alignDlib():this.alignMinBbox(f)},a.prototype.alignDlib=function(){var a=this.getRefPointsForAlignment(),b=a[0],c=a[1],d=a[2],e=function(a){return d.sub(a).magnitude()},f=Math.floor((e(b)+e(c))/2/.45),g=Ar(a),h=Math.floor(Math.max(0,g.x-.5*f)),i=Math.floor(Math.max(0,g.y-.43*f));return new AD(h,i,Math.min(f,this.imageWidth+h),Math.min(f,this.imageHeight+i))},a.prototype.alignMinBbox=function(a){var b,c,d,e=(c=(b=this.positions).map(function(a){return a.x}),d=b.map(function(a){return a.y}),new Ax(c.reduce(function(a,b){return b<a?b:a},1/0),d.reduce(function(a,b){return b<a?b:a},1/0),c.reduce(function(a,b){return a<b?b:a},0),d.reduce(function(a,b){return a<b?b:a},0)));return e.pad(e.width*a,e.height*a)},a.prototype.getRefPointsForAlignment=function(){throw Error("getRefPointsForAlignment not implemented by base class")},a}(),AF=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.getRefPointsForAlignment=function(){var a=this.positions;return[a[0],a[1],Ar([a[3],a[4]])]},b}(AE),AG=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.getJawOutline=function(){return this.positions.slice(0,17)},b.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},b.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},b.prototype.getNose=function(){return this.positions.slice(27,36)},b.prototype.getLeftEye=function(){return this.positions.slice(36,42)},b.prototype.getRightEye=function(){return this.positions.slice(42,48)},b.prototype.getMouth=function(){return this.positions.slice(48,68)},b.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Ar)},b}(AE),AH=function(){function a(a,b){this._label=a,this._distance=b}return Object.defineProperty(a.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),a.prototype.toString=function(a){var b,c,d;return void 0===a&&(a=!0),""+this.label+(a?" ("+(b=this.distance,void 0===c&&(c=2),Math.floor(b*(d=Math.pow(10,c)))/d)+")":"")},a}(),AI=function(a){function b(b,c){var d=a.call(this,b)||this;return d._label=c,d}return Ai(b,a),b.assertIsValidLabeledBox=function(a,b){if(Aw.assertIsValidBox(a,b),!At(a.label))throw Error(b+" - expected property label ("+a.label+") to be a number")},Object.defineProperty(b.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),b}(Aw),AJ=function(){function a(a,b){if("string"!=typeof a)throw Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(b)||b.some(function(a){return!(a instanceof Float32Array)}))throw Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=a,this._descriptors=b}return Object.defineProperty(a.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),a.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(a){return Array.from(a)})}},a.fromJSON=function(b){var c=b.descriptors.map(function(a){return new Float32Array(a)});return new a(b.label,c)},a}();function AK(a,b){return Object.assign({},a,{detection:b})}!function(a){function b(b,c,d,e){var f=a.call(this,b,c)||this;return f._score=d,f._classScore=e,f}Ai(b,a),b.assertIsValidPredictedBox=function(a,b){if(AI.assertIsValidLabeledBox(a,b),!Au(a.score)||!Au(a.classScore))throw Error(b+" - expected properties score ("+a.score+") and ("+a.classScore+") to be a number between [0, 1]")},Object.defineProperty(b.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(AI);function AL(){return"object"==typeof global&&"undefined"!=typeof process&&!!process.version}var AM={getEnv:function(){if(!f)throw Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return f},isNodejs:AL};function AN(a){return AM.isNodejs()||"string"!=typeof a?a:document.getElementById(a)}function AO(a){var b=AM.getEnv(),c=b.Canvas;if(a instanceof b.CanvasRenderingContext2D)return a;var d=AN(a);if(!(d instanceof c))throw Error("resolveContext2d - expected canvas to be of instance of Canvas");var e=d.getContext("2d");if(!e)throw Error("resolveContext2d - canvas 2d context is null");return e}(function(){var a,b,d,e;"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D&&(f={Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:window.fetch||function(){throw Error("fetch - missing fetch implementation for browser environment")},readFile:function(){throw Error("readFile - filesystem not available for browser environment")}}),AL()&&(a=global.Canvas||global.HTMLCanvasElement,b=global.Image||global.HTMLImageElement,d=global.fetch||function(){throw Error("fetch - missing fetch implementation for nodejs environment")},e=function(a){var b="";if(!a)try{a=c(9021)}catch(a){b=a.toString()}return{readFile:a?function(b){return new Promise(function(c,d){a.readFile(b,function(a,b){return a?d(a):c(b)})})}:function(){throw Error("readFile - failed to require fs in nodejs environment with error: "+b)}}}(),f=Aj({Canvas:a||function(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){},Image:b||function(){},ImageData:global.ImageData||function(){},Video:global.HTMLVideoElement||function(){},createCanvasElement:function(){if(a)return new a;throw Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(b)return new b;throw Error("createImageElement - missing Image implementation for nodejs environment")},fetch:d},e))})(),function(a){a.TOP_LEFT="TOP_LEFT",a.TOP_RIGHT="TOP_RIGHT",a.BOTTOM_LEFT="BOTTOM_LEFT",a.BOTTOM_RIGHT="BOTTOM_RIGHT"}(g||(g={}));var AP=function(a){void 0===a&&(a={});var b=a.anchorPosition,c=a.backgroundColor,d=a.fontColor,e=a.fontSize,f=a.fontStyle,h=a.padding;this.anchorPosition=b||g.TOP_LEFT,this.backgroundColor=c||"rgba(0, 0, 0, 0.5)",this.fontColor=d||"rgba(255, 255, 255, 1)",this.fontSize=e||14,this.fontStyle=f||"Georgia",this.padding=h||4},AQ=function(){function a(b,c,d){void 0===d&&(d={}),this.text="string"==typeof b?[b]:b instanceof a?b.text:b,this.anchor=c,this.options=new AP(d)}return a.prototype.measureWidth=function(a){var b=this.options.padding;return this.text.map(function(b){return a.measureText(b).width}).reduce(function(a,b){return a<b?b:a},0)+2*b},a.prototype.measureHeight=function(){var a=this.options,b=a.fontSize,c=a.padding;return this.text.length*b+2*c},a.prototype.getUpperLeft=function(a,b){var c=this.options.anchorPosition,d=c===g.BOTTOM_RIGHT||c===g.TOP_RIGHT,e=c===g.BOTTOM_LEFT||c===g.BOTTOM_RIGHT,f=this.measureWidth(a),h=this.measureHeight(),i=d?this.anchor.x-f:this.anchor.x,j=e?this.anchor.y-h:this.anchor.y;return b?{x:Math.max(Math.min(i,b.width-f),0),y:Math.max(Math.min(j,b.height-h),0)}:{x:i,y:j}},a.prototype.draw=function(a){var b=AN(a),c=AO(b),d=this.options,e=d.backgroundColor,f=d.fontColor,g=d.fontSize,h=d.fontStyle,i=d.padding;c.font=g+"px "+h;var j=this.measureWidth(c),k=this.measureHeight();c.fillStyle=e;var l=this.getUpperLeft(c,b);c.fillRect(l.x,l.y,j,k),c.fillStyle=f,this.text.forEach(function(a,b){var d=i+l.x,e=i+l.y+(b+1)*g;c.fillText(a,d,e)})},a}(),AR=function(a){void 0===a&&(a={});var b=a.boxColor,c=a.lineWidth,d=a.label,e=a.drawLabelOptions;this.boxColor=b||"rgba(0, 0, 255, 1)",this.lineWidth=c||2,this.label=d;var f={anchorPosition:g.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new AP(Object.assign({},f,e))};function AS(a){var b=AM.getEnv(),c=b.Image,d=b.Video;return a instanceof c&&a.complete||a instanceof d&&a.readyState>=3}function AT(a){var b=AM.getEnv(),c=b.Image,d=b.Video;return a instanceof c?new An(a.naturalWidth,a.naturalHeight):a instanceof d?new An(a.videoWidth,a.videoHeight):new An(a.width,a.height)}function AU(a){var b=a.width,c=a.height,d=(0,AM.getEnv().createCanvasElement)();return d.width=b,d.height=c,d}function AV(a,b){var c=AM.getEnv().ImageData;if(!(a instanceof c)&&!AS(a))throw Error("createCanvasFromMedia - media has not finished loading yet");var d=b||AT(a),e=d.width,f=d.height,g=AU({width:e,height:f});return a instanceof c?AO(g).putImageData(a,0,0):AO(g).drawImage(a,0,0,e,f),g}function AW(a){var b=AM.getEnv(),c=b.Image,d=b.Canvas,e=b.Video;return a instanceof c||a instanceof d||a instanceof e}(function(a,b){void 0===b&&(b={}),this.box=new Aw(a),this.options=new AR(b)}).prototype.draw=function(a){var b=AO(a),c=this.options,d=c.boxColor,e=c.lineWidth,f=this.box,g=f.x,h=f.y,i=f.width,j=f.height;b.strokeStyle=d,b.lineWidth=e,b.strokeRect(g,h,i,j);var k=this.options.label;k&&new AQ([k],{x:g-e/2,y:h},this.options.drawLabelOptions).draw(a)};var AX=function(){function a(a,b){var c=this;if(void 0===b&&(b=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(a))throw Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+a);this._treatAsBatchInput=b,this._batchSize=a.length,a.forEach(function(a,b){if(Ao(a,3)){c._imageTensors[b]=a,c._inputDimensions[b]=a.shape;return}if(Ap(a)){var d=a.shape[0];if(1!==d)throw Error("NetInput - tf.Tensor4D with batchSize "+d+" passed, but not supported in input array");c._imageTensors[b]=a,c._inputDimensions[b]=a.shape.slice(1);return}var e=a instanceof AM.getEnv().Canvas?a:AV(a);c._canvases[b]=e,c._inputDimensions[b]=[e.height,e.width,3]})}return Object.defineProperty(a.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"reshapedInputDimensions",{get:function(){var a=this;return As(this.batchSize,0,1).map(function(b,c){return a.getReshapedInputDimensions(c)})},enumerable:!0,configurable:!0}),a.prototype.getInput=function(a){return this.canvases[a]||this.imageTensors[a]},a.prototype.getInputDimensions=function(a){return this._inputDimensions[a]},a.prototype.getInputHeight=function(a){return this._inputDimensions[a][0]},a.prototype.getInputWidth=function(a){return this._inputDimensions[a][1]},a.prototype.getReshapedInputDimensions=function(a){var b,c,d,e,f;if("number"!=typeof this.inputSize)throw Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return b={width:this.getInputWidth(a),height:this.getInputHeight(a)},c=this.inputSize,d=b.width,f=c/Math.max(e=b.height,d),new An(Math.round(d*f),Math.round(e*f))},a.prototype.toBatchTensor=function(a,b){var c=this;return void 0===b&&(b=!0),this._inputSize=a,r$(function(){return s9(As(c.batchSize,0,1).map(function(d){var e=c.getInput(d);if(e instanceof qP){var f,g,h=Ap(e)?e:e.expandDims();return f=h,void 0===(g=b)&&(g=!1),((h=r$(function(){var a=f.shape.slice(1),b=a[0],c=a[1];if(b===c)return f;var d=Math.abs(b-c),e=b>c?2:1,h=function(a){var b=f.shape.slice();return b[e]=a,ss(b,0)},i=h(Math.round(d*(g?.5:1))),j=d-i.shape[e];return sw([g&&j?h(j):null,f,i].filter(function(a){return!!a}).map(function(a){return a.toFloat()}),e)})).shape[1]!==a||h.shape[2]!==a)&&(h=y6.resizeBilinear(h,[a,a])),h.as3D(a,a,3)}if(e instanceof AM.getEnv().Canvas)return z1.fromPixels(function(a,b,c){void 0===c&&(c=!1);var d=AM.getEnv(),e=d.Image,f=d.Canvas;if(!(a instanceof e||a instanceof f))throw Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var g=AT(a),h=b/Math.max(g.height,g.width),i=h*g.width,j=h*g.height,k=AU({width:b,height:b}),l=a instanceof f?a:AV(a),m=Math.abs(i-j)/2,n=c&&i<j?m:0,o=c&&j<i?m:0;return AO(k).drawImage(l,n,o,i,j),k}(e,a,b));throw Error("toBatchTensor - at batchIdx "+d+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+e)}).map(function(a){return a.toFloat()})).as4D(c.batchSize,a,a,3)})},a}();function AY(a){return Ak(this,void 0,void 0,function(){var b,c,d;return Al(this,function(e){switch(e.label){case 0:if(a instanceof AX)return[2,a];if(!(b=Array.isArray(a)?a:[a]).length)throw Error("toNetInput - empty array passed as input");return c=function(b){return Array.isArray(a)?" at input index "+b+":":""},(d=b.map(AN)).forEach(function(a,d){if(!AW(a)&&!Ao(a,3)&&!Ap(a)){if("string"==typeof b[d])throw Error("toNetInput -"+c(d)+" string passed, but could not resolve HTMLElement for element id "+b[d]);throw Error("toNetInput -"+c(d)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(Ap(a)){var e=a.shape[0];if(1!==e)throw Error("toNetInput -"+c(d)+" tf.Tensor4D with batchSize "+e+" passed, but not supported in input array")}}),[4,Promise.all(d.map(function(a){return AW(a)&&new Promise(function(b,c){if(a instanceof AM.getEnv().Canvas||AS(a))return b();function d(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",d),a.currentTarget.removeEventListener("error",e),b(a))}function e(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",d),a.currentTarget.removeEventListener("error",e),c(a))}a.addEventListener("load",d),a.addEventListener("error",e)})}))];case 1:return e.sent(),[2,new AX(d,Array.isArray(a))]}})})}function AZ(a,b){return Ak(this,void 0,void 0,function(){var c,d,e,f,g,h;return Al(this,function(i){switch(i.label){case 0:if(c=AM.getEnv().Canvas,d=a,a instanceof c)return[3,5];return[4,AY(a)];case 1:if((e=i.sent()).batchSize>1)throw Error("extractFaces - batchSize > 1 not supported");if(!((f=e.getInput(0))instanceof c))return[3,2];return g=f,[3,4];case 2:return[4,function(a,b){return Ak(this,void 0,void 0,function(){var b,c,d,e,f,g;return Al(this,function(h){switch(h.label){case 0:return b=AM.getEnv().createCanvasElement(),d=(c=a.shape.slice(+!!Ap(a)))[0],e=c[1],f=c[2],g=r$(function(){return a.as3D(d,e,f).toInt()}),[4,z1.toPixels(g,b)];case 1:return h.sent(),g.dispose(),[2,b]}})})}(f)];case 3:g=i.sent(),i.label=4;case 4:d=g,i.label=5;case 5:return h=AO(d),[2,b.map(function(a){return a instanceof Az?a.forSize(d.width,d.height).box.floor():a}).map(function(a){return a.clipAtImageBorders(d.width,d.height)}).map(function(a){var b=a.x,c=a.y,d=a.width,e=a.height,f=AU({width:d,height:e});return AO(f).putImageData(h.getImageData(b,c,d,e),0,0),f})]}})})}function A$(a,b){return Ak(this,void 0,void 0,function(){return Al(this,function(c){if(!Ao(a,3)&&!Ap(a))throw Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Ap(a)&&a.shape[0]>1)throw Error("extractFaceTensors - batchSize > 1 not supported");return[2,r$(function(){var c=a.shape.slice(+!!Ap(a)),d=c[0],e=c[1],f=c[2];return b.map(function(a){return a instanceof Az?a.forSize(e,d).box:a}).map(function(a){return a.clipAtImageBorders(e,d)}).map(function(b){var c=b.x,g=b.y,h=b.width,i=b.height;return yd(a.as3D(d,e,f),[g,c,0],[i,h,f])})})]})})}function A_(a,b){var c=b+"-weights_manifest.json";if(!a)return{modelBaseUri:"",manifestUri:c};if("/"===a)return{modelBaseUri:"/",manifestUri:"/"+c};var d=a.startsWith("http://")?"http://":a.startsWith("https://")?"https://":"",e=(a=a.replace(d,"")).split("/").filter(function(a){return a}),f=a.endsWith(".json")?e[e.length-1]:c,g=d+(a.endsWith(".json")?e.slice(0,e.length-1):e).join("/");return{modelBaseUri:g=a.startsWith("/")?"/"+g:g,manifestUri:"/"===g?"/"+f:g+"/"+f}}var A0=function(){function a(a){this._name=a,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(a.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),a.prototype.getParamFromPath=function(a){var b=this.traversePropertyPath(a);return b.obj[b.objProp]},a.prototype.reassignParamFromPath=function(a,b){var c=this.traversePropertyPath(a),d=c.obj,e=c.objProp;d[e].dispose(),d[e]=b},a.prototype.getParamList=function(){var a=this;return this._paramMappings.map(function(b){var c=b.paramPath;return{path:c,tensor:a.getParamFromPath(c)}})},a.prototype.getTrainableParams=function(){return this.getParamList().filter(function(a){return a.tensor instanceof qW})},a.prototype.getFrozenParams=function(){return this.getParamList().filter(function(a){return!(a.tensor instanceof qW)})},a.prototype.variable=function(){var a=this;this.getFrozenParams().forEach(function(b){var c=b.path,d=b.tensor;a.reassignParamFromPath(c,d.variable())})},a.prototype.freeze=function(){var a=this;this.getTrainableParams().forEach(function(b){var c=b.path,d=b.tensor,e=sj(d.dataSync());d.dispose(),a.reassignParamFromPath(c,e)})},a.prototype.dispose=function(a){void 0===a&&(a=!0),this.getParamList().forEach(function(b){if(a&&b.tensor.isDisposed)throw Error("param tensor has already been disposed for path "+b.path);b.tensor.dispose()}),this._params=void 0},a.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(a){return Array.from(a.tensor.dataSync())}).reduce(function(a,b){return a.concat(b)}))},a.prototype.load=function(a){return Ak(this,void 0,void 0,function(){return Al(this,function(b){switch(b.label){case 0:if(a instanceof Float32Array)return this.extractWeights(a),[2];return[4,this.loadFromUri(a)];case 1:return b.sent(),[2]}})})},a.prototype.loadFromUri=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:if(a&&"string"!=typeof a)throw Error(this._name+".loadFromUri - expected model uri");return[4,function(a,b){return Ak(this,void 0,void 0,function(){var c,d,e,f;return Al(this,function(g){switch(g.label){case 0:return d=(c=A_(a,b)).manifestUri,e=c.modelBaseUri,[4,function(a){return Ak(this,void 0,void 0,function(){return Al(this,function(b){switch(b.label){case 0:return[4,function(a,b){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return[4,(0,AM.getEnv().fetch)(a,void 0)];case 1:if(!((b=c.sent()).status<400))throw Error("failed to fetch: ("+b.status+") "+b.statusText+", from url: "+b.url);return[2,b]}})})}(a)];case 1:return[2,b.sent().json()]}})})}(d)];case 1:return f=g.sent(),[2,z0.loadWeights(f,e)]}})})}(a,this.getDefaultModelName())];case 1:return b=c.sent(),this.loadFromWeightMap(b),[2]}})})},a.prototype.loadFromDisk=function(a){return Ak(this,void 0,void 0,function(){var b,c,d,e,f,g,h,i,j,k;return Al(this,function(l){switch(l.label){case 0:if(a&&"string"!=typeof a)throw Error(this._name+".loadFromDisk - expected model file path");return b=AM.getEnv().readFile,d=(c=A_(a,this.getDefaultModelName())).manifestUri,e=c.modelBaseUri,f=function(a){return Promise.all(a.map(function(a){return b(a).then(function(a){return a.buffer})}))},g=z0.weightsLoaderFactory(f),j=(i=JSON).parse,[4,b(d)];case 1:return h=j.apply(i,[l.sent().toString()]),[4,g(h,e)];case 2:return k=l.sent(),this.loadFromWeightMap(k),[2]}})})},a.prototype.loadFromWeightMap=function(a){var b=this.extractParamsFromWeigthMap(a),c=b.paramMappings,d=b.params;this._paramMappings=c,this._params=d},a.prototype.extractWeights=function(a){var b=this.extractParams(a),c=b.paramMappings,d=b.params;this._paramMappings=c,this._params=d},a.prototype.traversePropertyPath=function(a){if(!this.params)throw Error("traversePropertyPath - model has no loaded params");var b=a.split("/").reduce(function(b,c){if(!b.nextObj.hasOwnProperty(c))throw Error("traversePropertyPath - object does not have property "+c+", for path "+a);return{obj:b.nextObj,objProp:c,nextObj:b.nextObj[c]}},{nextObj:this.params}),c=b.obj,d=b.objProp;if(!c||!d||!(c[d]instanceof qP))throw Error("traversePropertyPath - parameter is not a tensor, for path "+a);return{obj:c,objProp:d}},a}();function A1(a,b,c){return r$(function(){var d=xU(a,b.depthwise_filter,b.pointwise_filter,c,"same");return w8(d,b.bias)})}function A2(a,b,c){return void 0===c&&(c=!1),r$(function(){var d=yu(c?w8(xN(a,b.conv0.filters,[2,2],"same"),b.conv0.bias):A1(a,b.conv0,[2,2])),e=A1(d,b.conv1,[1,1]),f=A1(yu(w8(d,e)),b.conv2,[1,1]);return yu(w8(d,w8(e,f)))})}function A3(a,b,c,d){return void 0===c&&(c=!1),void 0===d&&(d=!0),r$(function(){var e=yu(c?w8(xN(a,b.conv0.filters,d?[2,2]:[1,1],"same"),b.conv0.bias):A1(a,b.conv0,d?[2,2]:[1,1])),f=A1(e,b.conv1,[1,1]),g=A1(yu(w8(e,f)),b.conv2,[1,1]),h=A1(yu(w8(e,w8(f,g))),b.conv3,[1,1]);return yu(w8(e,w8(f,w8(g,h))))})}function A4(a,b,c,d){return void 0===c&&(c="same"),void 0===d&&(d=!1),r$(function(){var e=w8(xN(a,b.filters,[1,1],c),b.bias);return d?yu(e):e})}function A5(a,b){Object.keys(a).forEach(function(c){b.some(function(a){return a.originalPath===c})||a[c].dispose()})}function A6(a,b){return function(c,d,e,f){var g=sp(a(c*d*e*e),[e,e,c,d]),h=sm(a(d));return b.push({paramPath:f+"/filters"},{paramPath:f+"/bias"}),{filters:g,bias:h}}}function A7(a,b){return function(c,d,e){var f=sn(a(c*d),[c,d]),g=sm(a(d));return b.push({paramPath:e+"/weights"},{paramPath:e+"/bias"}),{weights:f,bias:g}}}var A8=function(a,b,c){this.depthwise_filter=a,this.pointwise_filter=b,this.bias=c};function A9(a,b){return function(c,d,e){var f=sp(a(9*c),[3,3,c,1]),g=sp(a(c*d),[1,1,c,d]),h=sm(a(d));return b.push({paramPath:e+"/depthwise_filter"},{paramPath:e+"/pointwise_filter"},{paramPath:e+"/bias"}),new A8(f,g,h)}}function Ba(a){return function(b){return new A8(a(b+"/depthwise_filter",4),a(b+"/pointwise_filter",4),a(b+"/bias",1))}}function Bb(a,b){return function(c,d,e){var f=a[c];if(!Ao(f,d))throw Error("expected weightMap["+c+"] to be a Tensor"+d+"D, instead have "+f);return b.push({originalPath:c,paramPath:e||c}),f}}function Bc(a){var b=a;return{extractWeights:function(a){var c=b.slice(0,a);return b=b.slice(a),c},getRemainingWeights:function(){return b}}}function Bd(a,b){var c=A6(a,b),d=A9(a,b);function e(a,b,e,f){return void 0===f&&(f=!1),{conv0:f?c(a,b,3,e+"/conv0"):d(a,b,e+"/conv0"),conv1:d(b,b,e+"/conv1"),conv2:d(b,b,e+"/conv2")}}return{extractDenseBlock3Params:e,extractDenseBlock4Params:function(a,b,c,f){void 0===f&&(f=!1);var g=e(a,b,c,f);return{conv0:g.conv0,conv1:g.conv1,conv2:g.conv2,conv3:d(b,b,c+"/conv3")}}}}function Be(a){return function(b){return{filters:a(b+"/filters",4),bias:a(b+"/bias",1)}}}function Bf(a,b){var c=Bb(a,b),d=Be(c),e=Ba(c);return{extractDenseBlock3Params:function(a,b){return void 0===b&&(b=!1),{conv0:b?d(a+"/conv0"):e(a+"/conv0"),conv1:e(a+"/conv1"),conv2:e(a+"/conv2")}},extractDenseBlock4Params:function(a,b){return void 0===b&&(b=!1),{conv0:b?d(a+"/conv0"):e(a+"/conv0"),conv1:e(a+"/conv1"),conv2:e(a+"/conv2"),conv3:e(a+"/conv3")}}}}var Bg=function(a){function b(){return a.call(this,"FaceFeatureExtractor")||this}return Ai(b,a),b.prototype.forwardInput=function(a){var b=this.params;if(!b)throw Error("FaceFeatureExtractor - load model before inference");return r$(function(){var c=A3(AB(a.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(sl(255)),b.dense0,!0);return c=A3(c,b.dense1),c=A3(c,b.dense2),c=x6(c=A3(c,b.dense3),[7,7],[2,2],"valid")})},b.prototype.forward=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=this.forwardInput,[4,AY(a)];case 1:return[2,b.apply(this,[c.sent()])]}})})},b.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},b.prototype.extractParamsFromWeigthMap=function(a){var b,c,d;return d={dense0:(c=Bf(a,b=[]).extractDenseBlock4Params)("dense0",!0),dense1:c("dense1"),dense2:c("dense2"),dense3:c("dense3")},A5(a,b),{params:d,paramMappings:b}},b.prototype.extractParams=function(a){return function(a){var b=[],c=Bc(a),d=c.extractWeights,e=c.getRemainingWeights,f=Bd(d,b).extractDenseBlock4Params,g=f(3,32,"dense0",!0),h=f(32,64,"dense1"),i=f(64,128,"dense2"),j=f(128,256,"dense3");if(0!==e().length)throw Error("weights remaing after extract: "+e().length);return{paramMappings:b,params:{dense0:g,dense1:h,dense2:i,dense3:j}}}(a)},b}(A0);function Bh(a,b){return r$(function(){return w8(xX(a,b.weights),b.bias)})}function Bi(a){var b={},c={};return Object.keys(a).forEach(function(d){(d.startsWith("fc")?c:b)[d]=a[d]}),{featureExtractorMap:b,classifierMap:c}}var Bj=function(a){function b(b,c){var d=a.call(this,b)||this;return d._faceFeatureExtractor=c,d}return Ai(b,a),Object.defineProperty(b.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),b.prototype.runNet=function(a){var b=this,c=this.params;if(!c)throw Error(this._name+" - load model before inference");return r$(function(){var d=a instanceof AX?b.faceFeatureExtractor.forwardInput(a):a;return Bh(d.as2D(d.shape[0],-1),c.fc)})},b.prototype.dispose=function(b){void 0===b&&(b=!0),this.faceFeatureExtractor.dispose(b),a.prototype.dispose.call(this,b)},b.prototype.loadClassifierParams=function(a){var b=this.extractClassifierParams(a),c=b.params,d=b.paramMappings;this._params=c,this._paramMappings=d},b.prototype.extractClassifierParams=function(a){return function(a,b,c){var d=[],e=Bc(a),f=e.extractWeights,g=e.getRemainingWeights,h=A7(f,d)(b,c,"fc");if(0!==g().length)throw Error("weights remaing after extract: "+g().length);return{paramMappings:d,params:{fc:h}}}(a,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},b.prototype.extractParamsFromWeigthMap=function(a){var b,c,d,e=Bi(a),f=e.featureExtractorMap,g=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(f),d={fc:{weights:(c=Bb(g,b=[]))("fc/weights",2),bias:c("fc/bias",1)}},A5(g,b),{params:d,paramMappings:b}},b.prototype.extractParams=function(a){var b=this.getClassifierChannelsIn(),c=this.getClassifierChannelsOut(),d=c*b+c,e=a.slice(0,a.length-d),f=a.slice(a.length-d);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(f)},b}(A0),Bk=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Bl=function(){function a(a){var b=this;if(7!==a.length)throw Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+a.length);Bk.forEach(function(c,d){b[c]=a[d]})}return a.prototype.asSortedArray=function(){var a=this;return Bk.map(function(b){return{expression:b,probability:a[b]}}).sort(function(a,b){return b.probability-a.probability})},a}(),Bm=function(a){function b(b){return void 0===b&&(b=new Bg),a.call(this,"FaceExpressionNet",b)||this}return Ai(b,a),b.prototype.forwardInput=function(a){var b=this;return r$(function(){return tv(b.runNet(a))})},b.prototype.forward=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=this.forwardInput,[4,AY(a)];case 1:return[2,b.apply(this,[c.sent()])]}})})},b.prototype.predictExpressions=function(a){return Ak(this,void 0,void 0,function(){var b,c,d,e,f=this;return Al(this,function(g){switch(g.label){case 0:return[4,AY(a)];case 1:return b=g.sent(),[4,this.forwardInput(b)];case 2:return[4,Promise.all(tc(c=g.sent()).map(function(a){return Ak(f,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return[4,a.data()];case 1:return b=c.sent(),a.dispose(),[2,b]}})})}))];case 3:return d=g.sent(),c.dispose(),e=d.map(function(a){return new Bl(a)}),[2,b.isBatchInput?e:e[0]]}})})},b.prototype.getDefaultModelName=function(){return"face_expression_model"},b.prototype.getClassifierChannelsIn=function(){return 256},b.prototype.getClassifierChannelsOut=function(){return 7},b}(Bj);function Bn(a,b){return Object.assign({},a,{expressions:b})}function Bo(a,b){var c=a.detection.box,d=b.shiftBy(c.x,c.y),e=d.align(),f=a.detection.imageDims,g=new Az(a.detection.score,e.rescale(f.reverse()),f);return Object.assign({},a,{landmarks:d,unshiftedLandmarks:b,alignedRect:g})}function Bp(a,b,c){if(void 0===c&&(c=!1),a.beginPath(),b.slice(1).forEach(function(c,d){var e=c.x,f=c.y,g=b[d];a.moveTo(g.x,g.y),a.lineTo(e,f)}),c){var d=b[b.length-1],e=b[0];if(!d||!e)return;a.moveTo(d.x,d.y),a.lineTo(e.x,e.y)}a.stroke()}var Bq=function(a){void 0===a&&(a={});var b=a.drawLines,c=a.drawPoints,d=a.lineWidth,e=a.lineColor,f=a.pointSize,g=a.pointColor;this.drawLines=void 0===b||b,this.drawPoints=void 0===c||c,this.lineWidth=d||1,this.pointSize=f||2,this.lineColor=e||"rgba(0, 255, 255, 1)",this.pointColor=g||"rgba(255, 0, 255, 1)"};function Br(a,b,c){return w8(xN(a,b.filters,c,"same"),b.bias)}function Bs(a,b,c){void 0===c&&(c=!0);var d=c?yu(a):a;return d=A1(d,b.separable_conv0,[1,1]),d=w8(d=x5(d=A1(yu(d),b.separable_conv1,[1,1]),[3,3],[2,2],"same"),Br(a,b.expansion_conv,[2,2]))}(function(a,b){void 0===b&&(b={}),this.faceLandmarks=a,this.options=new Bq(b)}).prototype.draw=function(a){var b=AO(a),c=this.options,d=c.drawLines,e=c.drawPoints,f=c.lineWidth,g=c.lineColor,h=c.pointSize,i=c.pointColor;d&&this.faceLandmarks instanceof AG&&(b.strokeStyle=g,b.lineWidth=f,Bp(b,this.faceLandmarks.getJawOutline()),Bp(b,this.faceLandmarks.getLeftEyeBrow()),Bp(b,this.faceLandmarks.getRightEyeBrow()),Bp(b,this.faceLandmarks.getNose()),Bp(b,this.faceLandmarks.getLeftEye(),!0),Bp(b,this.faceLandmarks.getRightEye(),!0),Bp(b,this.faceLandmarks.getMouth(),!0)),e&&(b.strokeStyle=i,b.fillStyle=i,this.faceLandmarks.positions.forEach(function(a){b.beginPath(),b.arc(a.x,a.y,h,0,2*Math.PI),b.fill()}))};var Bt=function(a){function b(b){var c=a.call(this,"TinyXception")||this;return c._numMainBlocks=b,c}return Ai(b,a),b.prototype.forwardInput=function(a){var b=this,c=this.params;if(!c)throw Error("TinyXception - load model before inference");return r$(function(){var d=yu(Br(AB(a.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(sl(256)),c.entry_flow.conv_in,[2,2]));return d=Bs(d,c.entry_flow.reduction_block_0,!1),d=Bs(d,c.entry_flow.reduction_block_1),As(b._numMainBlocks,0,1).forEach(function(a){var b,e,f;b=d,e=c.middle_flow["main_block_"+a],f=A1(yu(b),e.separable_conv0,[1,1]),f=A1(yu(f),e.separable_conv1,[1,1]),d=f=w8(f=A1(yu(f),e.separable_conv2,[1,1]),b)}),d=yu(A1(d=Bs(d,c.exit_flow.reduction_block),c.exit_flow.separable_conv,[1,1]))})},b.prototype.forward=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=this.forwardInput,[4,AY(a)];case 1:return[2,b.apply(this,[c.sent()])]}})})},b.prototype.getDefaultModelName=function(){return"tiny_xception_model"},b.prototype.extractParamsFromWeigthMap=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return b=a,c=this._numMainBlocks,i=(h={extractConvParams:e=Be(d=Bb(b,g=[])),extractSeparableConvParams:f=Ba(d),extractReductionBlockParams:function(a){return{separable_conv0:f(a+"/separable_conv0"),separable_conv1:f(a+"/separable_conv1"),expansion_conv:e(a+"/expansion_conv")}},extractMainBlockParams:function(a){return{separable_conv0:f(a+"/separable_conv0"),separable_conv1:f(a+"/separable_conv1"),separable_conv2:f(a+"/separable_conv2")}}}).extractConvParams,j=h.extractSeparableConvParams,k=h.extractReductionBlockParams,l=h.extractMainBlockParams,m=i("entry_flow/conv_in"),n=k("entry_flow/reduction_block_0"),o=k("entry_flow/reduction_block_1"),p={},As(c,0,1).forEach(function(a){p["main_block_"+a]=l("middle_flow/main_block_"+a)}),q=k("exit_flow/reduction_block"),r=j("exit_flow/separable_conv"),A5(b,g),{params:{entry_flow:{conv_in:m,reduction_block_0:n,reduction_block_1:o},middle_flow:p,exit_flow:{reduction_block:q,separable_conv:r}},paramMappings:g}},b.prototype.extractParams=function(a){return function(a,b){var c,d,e=[],f=Bc(a),g=f.extractWeights,h=f.getRemainingWeights,i={extractConvParams:c=A6(g,e),extractSeparableConvParams:d=A9(g,e),extractReductionBlockParams:function(a,b,e){return{separable_conv0:d(a,b,e+"/separable_conv0"),separable_conv1:d(b,b,e+"/separable_conv1"),expansion_conv:c(a,b,1,e+"/expansion_conv")}},extractMainBlockParams:function(a,b){return{separable_conv0:d(a,a,b+"/separable_conv0"),separable_conv1:d(a,a,b+"/separable_conv1"),separable_conv2:d(a,a,b+"/separable_conv2")}}},j=i.extractConvParams,k=i.extractSeparableConvParams,l=i.extractReductionBlockParams,m=i.extractMainBlockParams,n=j(3,32,3,"entry_flow/conv_in"),o=l(32,64,"entry_flow/reduction_block_0"),p=l(64,128,"entry_flow/reduction_block_1"),q={};As(b,0,1).forEach(function(a){q["main_block_"+a]=m(128,"middle_flow/main_block_"+a)});var r=l(128,256,"exit_flow/reduction_block"),s=k(256,512,"exit_flow/separable_conv");if(0!==h().length)throw Error("weights remaing after extract: "+h().length);return{paramMappings:e,params:{entry_flow:{conv_in:n,reduction_block_0:o,reduction_block_1:p},middle_flow:q,exit_flow:{reduction_block:r,separable_conv:s}}}}(a,this._numMainBlocks)},b}(A0);!function(a){a.FEMALE="female",a.MALE="male"}(h||(h={}));var Bu=function(a){function b(b){void 0===b&&(b=new Bt(2));var c=a.call(this,"AgeGenderNet")||this;return c._faceFeatureExtractor=b,c}return Ai(b,a),Object.defineProperty(b.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),b.prototype.runNet=function(a){var b=this,c=this.params;if(!c)throw Error(this._name+" - load model before inference");return r$(function(){var d=a instanceof AX?b.faceFeatureExtractor.forwardInput(a):a,e=x6(d,[7,7],[2,2],"valid").as2D(d.shape[0],-1);return{age:Bh(e,c.fc.age).as1D(),gender:Bh(e,c.fc.gender)}})},b.prototype.forwardInput=function(a){var b=this;return r$(function(){var c=b.runNet(a);return{age:c.age,gender:tv(c.gender)}})},b.prototype.forward=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=this.forwardInput,[4,AY(a)];case 1:return[2,b.apply(this,[c.sent()])]}})})},b.prototype.predictAgeAndGender=function(a){return Ak(this,void 0,void 0,function(){var b,c,d,e,f,g=this;return Al(this,function(i){switch(i.label){case 0:return[4,AY(a)];case 1:return b=i.sent(),[4,this.forwardInput(b)];case 2:return d=tc((c=i.sent()).age),e=tc(c.gender),[4,Promise.all(d.map(function(a,b){return{ageTensor:a,genderTensor:e[b]}}).map(function(a){var b=a.ageTensor,c=a.genderTensor;return Ak(g,void 0,void 0,function(){var a,d,e,f,g;return Al(this,function(i){switch(i.label){case 0:return[4,b.data()];case 1:return a=i.sent()[0],[4,c.data()];case 2:return f=(e=(d=i.sent()[0])>.5)?h.MALE:h.FEMALE,g=e?d:1-d,b.dispose(),c.dispose(),[2,{age:a,gender:f,genderProbability:g}]}})})}))];case 3:return f=i.sent(),c.age.dispose(),c.gender.dispose(),[2,b.isBatchInput?f:f[0]]}})})},b.prototype.getDefaultModelName=function(){return"age_gender_model"},b.prototype.dispose=function(b){void 0===b&&(b=!0),this.faceFeatureExtractor.dispose(b),a.prototype.dispose.call(this,b)},b.prototype.loadClassifierParams=function(a){var b=this.extractClassifierParams(a),c=b.params,d=b.paramMappings;this._params=c,this._paramMappings=d},b.prototype.extractClassifierParams=function(a){return function(a){var b=[],c=Bc(a),d=c.extractWeights,e=c.getRemainingWeights,f=A7(d,b),g=f(512,1,"fc/age"),h=f(512,2,"fc/gender");if(0!==e().length)throw Error("weights remaing after extract: "+e().length);return{paramMappings:b,params:{fc:{age:g,gender:h}}}}(a)},b.prototype.extractParamsFromWeigthMap=function(a){var b=Bi(a),c=b.featureExtractorMap,d=b.classifierMap;this.faceFeatureExtractor.loadFromWeightMap(c);var e=[],f=Bb(d,e);function g(a){return{weights:f(a+"/weights",2),bias:f(a+"/bias",1)}}var h={fc:{age:g("fc/age"),gender:g("fc/gender")}};return A5(d,e),{params:h,paramMappings:e}},b.prototype.extractParams=function(a){var b=a.slice(0,a.length-1539),c=a.slice(a.length-1539);return this.faceFeatureExtractor.extractWeights(b),this.extractClassifierParams(c)},b}(A0),Bv=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.postProcess=function(a,b,c){var d=c.map(function(a){var c=a.width,d=a.height,e=b/Math.max(d,c);return{width:c*e,height:d*e}}),e=d.length;return r$(function(){var c=function(a,b){return s9([ss([68],a),ss([68],b)],1).as2D(1,136).as1D()},f=function(a,b){var c=d[a],e=c.width,f=c.height;return b(e,f)?Math.abs(e-f)/2:0};return a.mul(ss([e,136],b)).sub(s9(Array.from(Array(e),function(a,b){return c(f(b,function(a,b){return a<b}),f(b,function(a,b){return b<a}))}))).div(s9(Array.from(Array(e),function(a,b){return c(d[b].width,d[b].height)})))})},b.prototype.forwardInput=function(a){var b=this;return r$(function(){var c=b.runNet(a);return b.postProcess(c,a.inputSize,a.inputDimensions.map(function(a){return{height:a[0],width:a[1]}}))})},b.prototype.forward=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=this.forwardInput,[4,AY(a)];case 1:return[2,b.apply(this,[c.sent()])]}})})},b.prototype.detectLandmarks=function(a){return Ak(this,void 0,void 0,function(){var b,c,d,e=this;return Al(this,function(f){switch(f.label){case 0:return[4,AY(a)];case 1:return b=f.sent(),[4,Promise.all((c=r$(function(){return tc(e.forwardInput(b))})).map(function(a,c){return Ak(e,void 0,void 0,function(){var d,e,f,g,h;return Al(this,function(i){switch(i.label){case 0:return f=(e=Array).from,[4,a.data()];case 1:return g=(d=f.apply(e,[i.sent()])).filter(function(a,b){return b%2==0}),h=d.filter(function(a,b){return b%2!=0}),[2,new AG(Array(68).fill(0).map(function(a,b){return new Av(g[b],h[b])}),{height:b.getInputHeight(c),width:b.getInputWidth(c)})]}})})}))];case 2:return d=f.sent(),c.forEach(function(a){return a.dispose()}),[2,b.isBatchInput?d:d[0]]}})})},b.prototype.getClassifierChannelsOut=function(){return 136},b}(Bj),Bw=function(a){function b(b){return void 0===b&&(b=new Bg),a.call(this,"FaceLandmark68Net",b)||this}return Ai(b,a),b.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},b.prototype.getClassifierChannelsIn=function(){return 256},b}(Bv),Bx=function(a){function b(){return a.call(this,"TinyFaceFeatureExtractor")||this}return Ai(b,a),b.prototype.forwardInput=function(a){var b=this.params;if(!b)throw Error("TinyFaceFeatureExtractor - load model before inference");return r$(function(){var c=A2(AB(a.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(sl(255)),b.dense0,!0);return c=A2(c,b.dense1),c=x6(c=A2(c,b.dense2),[14,14],[2,2],"valid")})},b.prototype.forward=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=this.forwardInput,[4,AY(a)];case 1:return[2,b.apply(this,[c.sent()])]}})})},b.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},b.prototype.extractParamsFromWeigthMap=function(a){var b,c,d;return d={dense0:(c=Bf(a,b=[]).extractDenseBlock3Params)("dense0",!0),dense1:c("dense1"),dense2:c("dense2")},A5(a,b),{params:d,paramMappings:b}},b.prototype.extractParams=function(a){return function(a){var b=[],c=Bc(a),d=c.extractWeights,e=c.getRemainingWeights,f=Bd(d,b).extractDenseBlock3Params,g=f(3,32,"dense0",!0),h=f(32,64,"dense1"),i=f(64,128,"dense2");if(0!==e().length)throw Error("weights remaing after extract: "+e().length);return{paramMappings:b,params:{dense0:g,dense1:h,dense2:i}}}(a)},b}(A0),By=function(a){function b(b){return void 0===b&&(b=new Bx),a.call(this,"FaceLandmark68TinyNet",b)||this}return Ai(b,a),b.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},b.prototype.getClassifierChannelsIn=function(){return 128},b}(Bv);function Bz(a,b,c,d,e){void 0===e&&(e="same");var f,g=b.conv,h=g.filters,i=g.bias,j=xN(a,h,c,e);return j=w8(j,i),j=w8(xm(j,(f=b.scale).weights),f.biases),d?yu(j):j}function BA(a,b){return Bz(a,b,[1,1],!1)}function BB(a,b){return Bz(a,b,[2,2],!0,"valid")}function BC(a,b){var c=Bz(a,b.conv1,[1,1],!0);return yu(c=w8(c=BA(c,b.conv2),a))}function BD(a,b){var c=BB(a,b.conv1);c=BA(c,b.conv2);var d=x6(a,2,2,"valid"),e=sr(d.shape),f=d.shape[3]!==c.shape[3];if(d.shape[1]!==c.shape[1]||d.shape[2]!==c.shape[2]){var g=Am(c.shape);g[1]=1;var h=Am((c=sw([c,sr(g)],1)).shape);h[2]=1,c=sw([c,sr(h)],2)}return yu(c=w8(d=f?sw([d,e],3):d,c))}!function(a){Ai(function(){return null!==a&&a.apply(this,arguments)||this},a)}(Bw);var BE=function(a){function b(){return a.call(this,"FaceRecognitionNet")||this}return Ai(b,a),b.prototype.forwardInput=function(a){var b=this.params;if(!b)throw Error("FaceRecognitionNet - load model before inference");return r$(function(){var c=BB(AB(a.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(sl(256)),b.conv32_down);return c=BC(c=x5(c,3,2,"valid"),b.conv32_1),c=BC(c,b.conv32_2),c=BD(c=BC(c,b.conv32_3),b.conv64_down),c=BC(c,b.conv64_1),c=BC(c,b.conv64_2),c=BD(c=BC(c,b.conv64_3),b.conv128_down),c=BC(c,b.conv128_1),c=BD(c=BC(c,b.conv128_2),b.conv256_down),c=BC(c,b.conv256_1),xX((c=BD(c=BC(c,b.conv256_2),b.conv256_down_out)).mean([1,2]),b.fc)})},b.prototype.forward=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=this.forwardInput,[4,AY(a)];case 1:return[2,b.apply(this,[c.sent()])]}})})},b.prototype.computeFaceDescriptor=function(a){return Ak(this,void 0,void 0,function(){var b,c,d,e=this;return Al(this,function(f){switch(f.label){case 0:return[4,AY(a)];case 1:return b=f.sent(),[4,Promise.all((c=r$(function(){return tc(e.forwardInput(b))})).map(function(a){return a.data()}))];case 2:return d=f.sent(),c.forEach(function(a){return a.dispose()}),[2,b.isBatchInput?d:d[0]]}})})},b.prototype.getDefaultModelName=function(){return"face_recognition_model"},b.prototype.extractParamsFromWeigthMap=function(a){return function(a){var b=[],c=function(a,b){var c=Bb(a,b);function d(a){return{conv:{filters:c(a+"/conv/filters",4),bias:c(a+"/conv/bias",1)},scale:{weights:c(a+"/scale/weights",1),biases:c(a+"/scale/biases",1)}}}return{extractConvLayerParams:d,extractResidualLayerParams:function(a){return{conv1:d(a+"/conv1"),conv2:d(a+"/conv2")}}}}(a,b),d=c.extractConvLayerParams,e=c.extractResidualLayerParams,f=d("conv32_down"),g=e("conv32_1"),h=e("conv32_2"),i=e("conv32_3"),j=e("conv64_down"),k=e("conv64_1"),l=e("conv64_2"),m=e("conv64_3"),n=e("conv128_down"),o=e("conv128_1"),p=e("conv128_2"),q=e("conv256_down"),r=e("conv256_1"),s=e("conv256_2"),t=e("conv256_down_out"),u=a.fc;if(b.push({originalPath:"fc",paramPath:"fc"}),!Ao(u,2))throw Error("expected weightMap[fc] to be a Tensor2D, instead have "+u);return A5(a,b),{params:{conv32_down:f,conv32_1:g,conv32_2:h,conv32_3:i,conv64_down:j,conv64_1:k,conv64_2:l,conv64_3:m,conv128_down:n,conv128_1:o,conv128_2:p,conv256_down:q,conv256_1:r,conv256_2:s,conv256_down_out:t,fc:u},paramMappings:b}}(a)},b.prototype.extractParams=function(a){return function(a){var b=Bc(a),c=b.extractWeights,d=b.getRemainingWeights,e=[],f=function(a,b){function c(c,d,e,f){var g,h,i,j,k,l;return{conv:(g=f+"/conv",h=function(b,c,d){var e=a(b),f=e.length/(c*d*d);if(f%1!=0)throw Error("depth has to be an integer: "+f+", weights.length: "+e.length+", numFilters: "+c+", filterSize: "+d);return r$(function(){return yx(sp(e,[c,f,d,d]),[2,3,1,0])})}(c,d,e),i=sm(a(d)),b.push({paramPath:g+"/filters"},{paramPath:g+"/bias"}),{filters:h,bias:i}),scale:(j=f+"/scale",k=sm(a(d)),l=sm(a(d)),b.push({paramPath:j+"/weights"},{paramPath:j+"/biases"}),{weights:k,biases:l})}}return{extractConvLayerParams:c,extractResidualLayerParams:function(a,b,d,e,f){return void 0===f&&(f=!1),{conv1:c((f?.5:1)*a,b,d,e+"/conv1"),conv2:c(a,b,d,e+"/conv2")}}}}(c,e),g=f.extractConvLayerParams,h=f.extractResidualLayerParams,i=g(4704,32,7,"conv32_down"),j=h(9216,32,3,"conv32_1"),k=h(9216,32,3,"conv32_2"),l=h(9216,32,3,"conv32_3"),m=h(36864,64,3,"conv64_down",!0),n=h(36864,64,3,"conv64_1"),o=h(36864,64,3,"conv64_2"),p=h(36864,64,3,"conv64_3"),q=h(147456,128,3,"conv128_down",!0),r=h(147456,128,3,"conv128_1"),s=h(147456,128,3,"conv128_2"),t=h(589824,256,3,"conv256_down",!0),u=h(589824,256,3,"conv256_1"),v=h(589824,256,3,"conv256_2"),w=h(589824,256,3,"conv256_down_out"),x=r$(function(){return yx(sn(c(32768),[128,256]),[1,0])});if(e.push({paramPath:"fc"}),0!==d().length)throw Error("weights remaing after extract: "+d().length);return{params:{conv32_down:i,conv32_1:j,conv32_2:k,conv32_3:l,conv64_down:m,conv64_1:n,conv64_2:o,conv64_3:p,conv128_down:q,conv128_1:r,conv128_2:s,conv256_down:t,conv256_1:u,conv256_2:v,conv256_down_out:w,fc:x},paramMappings:e}}(a)},b}(A0);function BF(a,b,c){return Object.assign({},a,{gender:b,genderProbability:c})}var BG=function(){function a(a){var b=void 0===a?{}:a,c=b.minFaceSize,d=b.scaleFactor,e=b.maxNumScales,f=b.scoreThresholds,g=b.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=c||20,this._scaleFactor=d||.709,this._maxNumScales=e||10,this._scoreThresholds=f||[.6,.7,.7],this._scaleSteps=g,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(a){return"number"!=typeof a}))throw Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(a){return"number"!=typeof a})))throw Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(a.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),a}();function BH(a,b,c){return r$(function(){var d=xN(a,b.filters,c,"same");return wq(d=w8(d,b.batch_norm_offset),0,6)})}function BI(a,b){return r$(function(){var c=a.shape[0];return{boxPredictionEncoding:s6(A4(a,b.box_encoding_predictor),[c,-1,1,4]),classPrediction:s6(A4(a,b.class_predictor),[c,-1,3])}})}var BJ=function(){function a(a){var b=void 0===a?{}:a,c=b.minConfidence,d=b.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=c||.5,this._maxResults=d||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(a.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),a}(),BK=function(a){function b(){return a.call(this,"SsdMobilenetv1")||this}return Ai(b,a),b.prototype.forwardInput=function(a){var b=this.params;if(!b)throw Error("SsdMobilenetv1 - load model before inference");return r$(function(){var c,d,e,f,g,h,i=(c=xr(xm(a.toBatchTensor(512,!1).toFloat(),sl(.007843137718737125)),sl(1)),d=b.mobilenetv1,r$(function(){var a=null,b=BH(c,d.conv_0,[2,2]);if([d.conv_1,d.conv_2,d.conv_3,d.conv_4,d.conv_5,d.conv_6,d.conv_7,d.conv_8,d.conv_9,d.conv_10,d.conv_11,d.conv_12,d.conv_13].forEach(function(c,d){var e,f,g=d+1,h=[2,4,6,12].some(function(a){return a===g})?[2,2]:[1,1];e=b,f=c.depthwise_conv,b=BH(b=r$(function(){var a=xR(e,f.filters,h,"same");return wq(a=w$(a,f.batch_norm_mean,f.batch_norm_variance,f.batch_norm_offset,f.batch_norm_scale,.0010000000474974513),0,6)}),c.pointwise_conv,[1,1]),11===g&&(a=b)}),null===a)throw Error("mobileNetV1 - output of conv layer 11 is null");return{out:b,conv11:a}})),j=(e=i.out,f=i.conv11,g=b.prediction_layer,r$(function(){var a=BH(e,g.conv_0,[1,1]),b=BH(a,g.conv_1,[2,2]),c=BH(b,g.conv_2,[1,1]),d=BH(c,g.conv_3,[2,2]),h=BH(d,g.conv_4,[1,1]),i=BH(h,g.conv_5,[2,2]),j=BH(i,g.conv_6,[1,1]),k=BH(j,g.conv_7,[2,2]),l=BI(f,g.box_predictor_0),m=BI(e,g.box_predictor_1),n=BI(b,g.box_predictor_2),o=BI(d,g.box_predictor_3),p=BI(i,g.box_predictor_4),q=BI(k,g.box_predictor_5);return{boxPredictions:sw([l.boxPredictionEncoding,m.boxPredictionEncoding,n.boxPredictionEncoding,o.boxPredictionEncoding,p.boxPredictionEncoding,q.boxPredictionEncoding],1),classPredictions:sw([l.classPrediction,m.classPrediction,n.classPrediction,o.classPrediction,p.classPrediction,q.classPrediction],1)}})),k=j.boxPredictions,l=j.classPredictions;return h=b.output_layer,r$(function(){var a,b,c,d,e,f,g,i,j,m,n,o,p,q=k.shape[0],r=(a=s6(ta(h.extra_dim,[q,1,1]),[-1,4]),b=s6(k,[-1,4]),g=(f=(d=[xr((c=tc(yx(a,[1,0])))[2],c[0]),xr(c[3],c[1])],e=[w8(c[0],xc(d[0],sl(2))),w8(c[1],xc(d[1],sl(2)))],{sizes:d,centers:e})).sizes,i=f.centers,m=xc(xm(wu(xc((j=tc(yx(b,[1,0])))[2],sl(5))),g[0]),sl(2)),n=w8(xm(xc(j[0],sl(10)),g[0]),i[0]),o=xc(xm(wu(xc(j[3],sl(5))),g[1]),sl(2)),p=w8(xm(xc(j[1],sl(10)),g[1]),i[1]),yx(s9([xr(n,m),xr(p,o),w8(n,m),w8(p,o)]),[1,0]));r=s6(r,[q,r.shape[0]/q,4]);var s=wE(ya(l,[0,0,1],[-1,-1,-1])),t=ya(s,[0,0,0],[-1,-1,1]);return t=s6(t,[q,t.shape[1]]),{boxes:tc(r),scores:tc(t)}})})},b.prototype.forward=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=this.forwardInput,[4,AY(a)];case 1:return[2,b.apply(this,[c.sent()])]}})})},b.prototype.locateFaces=function(a,b){return void 0===b&&(b={}),Ak(this,void 0,void 0,function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return Al(this,function(w){switch(w.label){case 0:return d=(c=new BJ(b)).maxResults,e=c.minConfidence,[4,AY(a)];case 1:for(f=w.sent(),h=(g=this.forwardInput(f)).boxes,i=g.scores,j=h[0],k=i[0],l=1;l<h.length;l++)h[l].dispose(),i[l].dispose();return o=(n=Array).from,[4,k.data()];case 2:var x,y,z,A,B,C;return m=o.apply(n,[w.sent()]),x=j,y=d,z=e,A=Math.min(y,x.shape[0]),B=m.map(function(a,b){return{score:a,boxIndex:b}}).filter(function(a){return a.score>z}).sort(function(a,b){return b.score-a.score}),C=[],B.forEach(function(a){if(!(C.length>=A)){for(var b=a.score,c=C.length-1;c>=0;--c){var d=function(a,b,c){var d=a.arraySync(),e=Math.min(d[b][0],d[b][2]),f=Math.min(d[b][1],d[b][3]),g=Math.max(d[b][0],d[b][2]),h=Math.max(d[b][1],d[b][3]),i=Math.min(d[c][0],d[c][2]),j=Math.min(d[c][1],d[c][3]),k=Math.max(d[c][0],d[c][2]),l=Math.max(d[c][1],d[c][3]),m=(g-e)*(h-f),n=(k-i)*(l-j);if(m<=0||n<=0)return 0;var o=Math.max(Math.min(g,k)-Math.max(e,i),0)*Math.max(Math.min(h,l)-Math.max(f,j),0);return o/(m+n-o)}(x,a.boxIndex,C[c]);if(0!==d&&(a.score*=d<=.5,a.score<=z))break}b===a.score&&C.push(a.boxIndex)}}),p=C,q=f.getReshapedInputDimensions(0),s=(r=f.inputSize)/q.width,t=r/q.height,u=j.arraySync(),v=p.map(function(a){var b=[Math.max(0,u[a][0]),Math.min(1,u[a][2])].map(function(a){return a*t}),c=b[0],d=b[1],e=[Math.max(0,u[a][1]),Math.min(1,u[a][3])].map(function(a){return a*s}),g=e[0],h=e[1];return new Az(m[a],new AD(g,c,h-g,d-c),{height:f.getInputHeight(0),width:f.getInputWidth(0)})}),j.dispose(),k.dispose(),[2,v]}})})},b.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},b.prototype.extractParamsFromWeigthMap=function(a){return function(a){var b=[],c=function(a,b){var c=Bb(a,b);function d(a,b,d){return{filters:c(a+"/Conv2d_"+b+"_pointwise/weights",4,d+"/filters"),batch_norm_offset:c(a+"/Conv2d_"+b+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset")}}function e(a){var b="mobilenetv1/conv_"+a,e="MobilenetV1/Conv2d_"+a+"_depthwise",f=b+"/depthwise_conv";return{depthwise_conv:{filters:c(e+"/depthwise_weights",4,f+"/filters"),batch_norm_scale:c(e+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),batch_norm_offset:c(e+"/BatchNorm/beta",1,f+"/batch_norm_offset"),batch_norm_mean:c(e+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),batch_norm_variance:c(e+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance")},pointwise_conv:d("MobilenetV1",a,b+"/pointwise_conv")}}function f(a,b){return{filters:c(a+"/weights",4,b+"/filters"),bias:c(a+"/biases",1,b+"/bias")}}function g(a){return{box_encoding_predictor:f("Prediction/BoxPredictor_"+a+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+a+"/box_encoding_predictor"),class_predictor:f("Prediction/BoxPredictor_"+a+"/ClassPredictor","prediction_layer/box_predictor_"+a+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:d("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:e(1),conv_2:e(2),conv_3:e(3),conv_4:e(4),conv_5:e(5),conv_6:e(6),conv_7:e(7),conv_8:e(8),conv_9:e(9),conv_10:e(10),conv_11:e(11),conv_12:e(12),conv_13:e(13)}},extractPredictionLayerParams:function(){return{conv_0:d("Prediction",0,"prediction_layer/conv_0"),conv_1:d("Prediction",1,"prediction_layer/conv_1"),conv_2:d("Prediction",2,"prediction_layer/conv_2"),conv_3:d("Prediction",3,"prediction_layer/conv_3"),conv_4:d("Prediction",4,"prediction_layer/conv_4"),conv_5:d("Prediction",5,"prediction_layer/conv_5"),conv_6:d("Prediction",6,"prediction_layer/conv_6"),conv_7:d("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:g(0),box_predictor_1:g(1),box_predictor_2:g(2),box_predictor_3:g(3),box_predictor_4:g(4),box_predictor_5:g(5)}}}}(a,b),d=c.extractMobilenetV1Params,e=c.extractPredictionLayerParams,f=a["Output/extra_dim"];if(b.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Ao(f,3))throw Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+f);var g={mobilenetv1:d(),prediction_layer:e(),output_layer:{extra_dim:f}};return A5(a,b),{params:g,paramMappings:b}}(a)},b.prototype.extractParams=function(a){return function(a){var b=[],c=Bc(a),d=c.extractWeights,e=c.getRemainingWeights,f=function(a,b){function c(c,d,e,f,g){var h=sp(a(c*d*e*e),[e,e,c,d]),i=sm(a(d));return b.push({paramPath:f+"/filters"},{paramPath:f+"/"+(g?"batch_norm_offset":"bias")}),{filters:h,bias:i}}function d(a,b,d,e){var f=c(a,b,d,e,!0);return{filters:f.filters,batch_norm_offset:f.bias}}function e(c,e,f){var g,h,i,j,k,l;return{depthwise_conv:(g=f+"/depthwise_conv",h=sp(a(9*c),[3,3,c,1]),i=sm(a(c)),j=sm(a(c)),k=sm(a(c)),l=sm(a(c)),b.push({paramPath:g+"/filters"},{paramPath:g+"/batch_norm_scale"},{paramPath:g+"/batch_norm_offset"},{paramPath:g+"/batch_norm_mean"},{paramPath:g+"/batch_norm_variance"}),{filters:h,batch_norm_scale:i,batch_norm_offset:j,batch_norm_mean:k,batch_norm_variance:l}),pointwise_conv:d(c,e,1,f+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:d(3,32,3,"mobilenetv1/conv_0"),conv_1:e(32,64,"mobilenetv1/conv_1"),conv_2:e(64,128,"mobilenetv1/conv_2"),conv_3:e(128,128,"mobilenetv1/conv_3"),conv_4:e(128,256,"mobilenetv1/conv_4"),conv_5:e(256,256,"mobilenetv1/conv_5"),conv_6:e(256,512,"mobilenetv1/conv_6"),conv_7:e(512,512,"mobilenetv1/conv_7"),conv_8:e(512,512,"mobilenetv1/conv_8"),conv_9:e(512,512,"mobilenetv1/conv_9"),conv_10:e(512,512,"mobilenetv1/conv_10"),conv_11:e(512,512,"mobilenetv1/conv_11"),conv_12:e(512,1024,"mobilenetv1/conv_12"),conv_13:e(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:d(1024,256,1,"prediction_layer/conv_0"),conv_1:d(256,512,3,"prediction_layer/conv_1"),conv_2:d(512,128,1,"prediction_layer/conv_2"),conv_3:d(128,256,3,"prediction_layer/conv_3"),conv_4:d(256,128,1,"prediction_layer/conv_4"),conv_5:d(128,256,3,"prediction_layer/conv_5"),conv_6:d(256,64,1,"prediction_layer/conv_6"),conv_7:d(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:c(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:c(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:c(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:c(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:c(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:c(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:c(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:c(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:c(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:c(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:c(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:c(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(d,b),g=f.extractMobilenetV1Params,h=f.extractPredictionLayerParams,i=g(),j=h(),k=so(d(20472),[1,5118,4]);if(b.push({paramPath:"output_layer/extra_dim"}),0!==e().length)throw Error("weights remaing after extract: "+e().length);return{params:{mobilenetv1:i,prediction_layer:j,output_layer:{extra_dim:k}},paramMappings:b}}(a)},b}(A0);!function(a){Ai(function(){return null!==a&&a.apply(this,arguments)||this},a)}(BK);var BL=[new Av(.738768,.874946),new Av(2.42204,2.65704),new Av(4.30971,7.04493),new Av(10.246,4.59428),new Av(12.6868,11.8741)],BM=[new Av(1.603231,2.094468),new Av(6.041143,7.080126),new Av(2.882459,3.518061),new Av(4.266906,5.178857),new Av(9.041765,10.66308)],BN=[117.001,114.697,97.404],BO=function(a){return"number"==typeof a};function BP(a){return r$(function(){var b=xm(a,sl(.10000000149011612));return w8(yu(xr(a,b)),b)})}function BQ(a,b){return r$(function(){var c=sZ(a,[[0,0],[1,1],[1,1],[0,0]]);return BP(c=w8(c=xm(c=xr(c=xN(c,b.conv.filters,[1,1],"valid"),b.bn.sub),b.bn.truediv),b.conv.bias))})}function BR(a,b){return r$(function(){var c=sZ(a,[[0,0],[1,1],[1,1],[0,0]]);return BP(c=w8(c=xU(c,b.depthwise_filter,b.pointwise_filter,[1,1],"valid"),b.bias))})}!function(a){a[a.XS=224]="XS",a[a.SM=320]="SM",a[a.MD=416]="MD",a[a.LG=608]="LG"}(i||(i={}));var BS=function(){function a(a){var b=void 0===a?{}:a,c=b.inputSize,d=b.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=c||416,this._scoreThreshold=d||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(a.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),a}(),BT=function(a){function b(b){var c=a.call(this,"TinyYolov2")||this;if(!b)throw Error("invalid config: "+b);if("boolean"!=typeof b.withSeparableConvs)throw Error("config.withSeparableConvs has to be a boolean, have: "+b.withSeparableConvs);if(!BO(b.iouThreshold)||b.iouThreshold<0||b.iouThreshold>1)throw Error("config.iouThreshold has to be a number between [0, 1], have: "+b.iouThreshold);if(!Array.isArray(b.classes)||!b.classes.length||!b.classes.every(function(a){return"string"==typeof a}))throw Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(b.classes));if(!Array.isArray(b.anchors)||!b.anchors.length||!b.anchors.map(function(a){return a||{}}).every(function(a){return BO(a.x)&&BO(a.y)}))throw Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(b.anchors));if(b.meanRgb&&(!Array.isArray(b.meanRgb)||3!==b.meanRgb.length||!b.meanRgb.every(BO)))throw Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(b.meanRgb));return c._config=b,c}return Ai(b,a),Object.defineProperty(b.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),b.prototype.runTinyYolov2=function(a,b){var c=BQ(a,b.conv0);return c=BQ(c=x5(c,[2,2],[2,2],"same"),b.conv1),c=BQ(c=x5(c,[2,2],[2,2],"same"),b.conv2),c=BQ(c=x5(c,[2,2],[2,2],"same"),b.conv3),c=BQ(c=x5(c,[2,2],[2,2],"same"),b.conv4),c=BQ(c=x5(c,[2,2],[2,2],"same"),b.conv5),c=BQ(c=x5(c,[2,2],[1,1],"same"),b.conv6),A4(c=BQ(c,b.conv7),b.conv8,"valid",!1)},b.prototype.runMobilenet=function(a,b){var c=this.config.isFirstLayerConv2d?BP(A4(a,b.conv0,"valid",!1)):BR(a,b.conv0);return c=BR(c=x5(c,[2,2],[2,2],"same"),b.conv1),c=BR(c=x5(c,[2,2],[2,2],"same"),b.conv2),c=BR(c=x5(c,[2,2],[2,2],"same"),b.conv3),c=BR(c=x5(c,[2,2],[2,2],"same"),b.conv4),c=BR(c=x5(c,[2,2],[2,2],"same"),b.conv5),c=x5(c,[2,2],[1,1],"same"),c=b.conv6?BR(c,b.conv6):c,A4(c=b.conv7?BR(c,b.conv7):c,b.conv8,"valid",!1)},b.prototype.forwardInput=function(a,b){var c=this,d=this.params;if(!d)throw Error("TinyYolov2 - load model before inference");return r$(function(){var e=a.toBatchTensor(b,!1).toFloat();return e=(e=c.config.meanRgb?AB(e,c.config.meanRgb):e).div(sl(256)),c.config.withSeparableConvs?c.runMobilenet(e,d):c.runTinyYolov2(e,d)})},b.prototype.forward=function(a,b){return Ak(this,void 0,void 0,function(){var c;return Al(this,function(d){switch(d.label){case 0:return c=this.forwardInput,[4,AY(a)];case 1:return[4,c.apply(this,[d.sent(),b])];case 2:return[2,d.sent()]}})})},b.prototype.detect=function(a,b){return void 0===b&&(b={}),Ak(this,void 0,void 0,function(){var c,d,e,f,g,h,i,j,k,l,m,n,o=this;return Al(this,function(p){switch(p.label){case 0:return d=(c=new BS(b)).inputSize,e=c.scoreThreshold,[4,AY(a)];case 1:return f=p.sent(),[4,this.forwardInput(f,d)];case 2:return g=p.sent(),h=r$(function(){return tc(g)[0].expandDims()}),i={width:f.getInputWidth(0),height:f.getInputHeight(0)},[4,this.extractBoxes(h,f.getReshapedInputDimensions(0),e)];case 3:return j=p.sent(),g.dispose(),h.dispose(),k=j.map(function(a){return a.box}),l=j.map(function(a){return a.score}),m=j.map(function(a){return a.classScore}),n=j.map(function(a){return o.config.classes[a.label]}),[2,AA(k.map(function(a){return a.rescale(d)}),l,this.config.iouThreshold,!0).map(function(a){return new Ay(l[a],m[a],n[a],k[a],i)})]}})})},b.prototype.getDefaultModelName=function(){return""},b.prototype.extractParamsFromWeigthMap=function(a){return function(a,b){var c,d=[],e=function(a,b){var c=Bb(a,b);function d(a){return{filters:c(a+"/filters",4),bias:c(a+"/bias",1)}}return{extractConvParams:d,extractConvWithBatchNormParams:function(a){var b;return{conv:d(a+"/conv"),bn:{sub:c((b=a+"/bn")+"/sub",1),truediv:c(b+"/truediv",1)}}},extractSeparableConvParams:Ba(c)}}(a,d),f=e.extractConvParams,g=e.extractConvWithBatchNormParams,h=e.extractSeparableConvParams;if(b.withSeparableConvs){var i=b.filterSizes&&b.filterSizes.length||9;c={conv0:b.isFirstLayerConv2d?f("conv0"):h("conv0"),conv1:h("conv1"),conv2:h("conv2"),conv3:h("conv3"),conv4:h("conv4"),conv5:h("conv5"),conv6:i>7?h("conv6"):void 0,conv7:i>8?h("conv7"):void 0,conv8:f("conv8")}}else c={conv0:g("conv0"),conv1:g("conv1"),conv2:g("conv2"),conv3:g("conv3"),conv4:g("conv4"),conv5:g("conv5"),conv6:g("conv6"),conv7:g("conv7"),conv8:f("conv8")};return A5(a,d),{params:c,paramMappings:d}}(a,this.config)},b.prototype.extractParams=function(a){var c=this.config.filterSizes||b.DEFAULT_FILTER_SIZES,d=c?c.length:void 0;if(7!==d&&8!==d&&9!==d)throw Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+d+" filterSizes in config");return function(a,b,c,d){var e,f,g=Bc(a),h=g.extractWeights,i=g.getRemainingWeights,j=[],k={extractConvParams:e=A6(h,j),extractConvWithBatchNormParams:function(a,b,c){var d,f,g;return{conv:e(a,b,3,c+"/conv"),bn:(d=c+"/bn",f=sm(h(b)),g=sm(h(b)),j.push({paramPath:d+"/sub"},{paramPath:d+"/truediv"}),{sub:f,truediv:g})}},extractSeparableConvParams:A9(h,j)},l=k.extractConvParams,m=k.extractConvWithBatchNormParams,n=k.extractSeparableConvParams;if(b.withSeparableConvs){var o=d[0],p=d[1],q=d[2],r=d[3],s=d[4],t=d[5],u=d[6],v=d[7],w=d[8],x=b.isFirstLayerConv2d?l(o,p,3,"conv0"):n(o,p,"conv0"),y=n(p,q,"conv1"),z=n(q,r,"conv2"),A=n(r,s,"conv3"),B=n(s,t,"conv4"),C=n(t,u,"conv5"),D=v?n(u,v,"conv6"):void 0,E=w?n(v,w,"conv7"):void 0,F=l(w||v||u,5*c,1,"conv8");f={conv0:x,conv1:y,conv2:z,conv3:A,conv4:B,conv5:C,conv6:D,conv7:E,conv8:F}}else{var o=d[0],p=d[1],q=d[2],r=d[3],s=d[4],t=d[5],u=d[6],v=d[7],w=d[8],x=m(o,p,"conv0"),y=m(p,q,"conv1"),z=m(q,r,"conv2"),A=m(r,s,"conv3"),B=m(s,t,"conv4"),C=m(t,u,"conv5"),D=m(u,v,"conv6"),E=m(v,w,"conv7"),F=l(w,5*c,1,"conv8");f={conv0:x,conv1:y,conv2:z,conv3:A,conv4:B,conv5:C,conv6:D,conv7:E,conv8:F}}if(0!==i().length)throw Error("weights remaing after extract: "+i().length);return{params:f,paramMappings:j}}(a,this.config,this.boxEncodingSize,c)},b.prototype.extractBoxes=function(a,b,c){return Ak(this,void 0,void 0,function(){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=this;return Al(this,function(H){switch(H.label){case 0:return g=(f=Math.max(d=b.width,e=b.height))/d,h=f/e,i=a.shape[1],j=this.config.anchors.length,l=(k=r$(function(){var b=a.reshape([i,i,j,G.boxEncodingSize]);return[b.slice([0,0,0,0],[i,i,j,4]),b.slice([0,0,0,4],[i,i,j,1]),G.withClassScores?tv(b.slice([0,0,0,5],[i,i,j,G.config.classes.length]),3):sl(0)]}))[0],m=k[1],n=k[2],o=[],[4,m.array()];case 1:return p=H.sent(),[4,l.array()];case 2:q=H.sent(),r=0,H.label=3;case 3:if(!(r<i))return[3,12];s=0,H.label=4;case 4:if(!(s<i))return[3,11];t=0,H.label=5;case 5:if(!(t<j))return[3,10];if(u=AC(p[r][s][t][0]),!(!c||u>c))return[3,9];if(v=(s+AC(q[r][s][t][0]))/i*g,w=(r+AC(q[r][s][t][1]))/i*h,x=Math.exp(q[r][s][t][2])*this.config.anchors[t].x/i*g,y=Math.exp(q[r][s][t][3])*this.config.anchors[t].y/i*h,z=v-x/2,A=w-y/2,B={row:r,col:s,anchor:t},!this.withClassScores)return[3,7];return[4,this.extractPredictedClass(n,B)];case 6:return F=H.sent(),[3,8];case 7:F={classScore:1,label:0},H.label=8;case 8:D=(C=F).classScore,E=C.label,o.push(Aj({box:new Ax(z,A,z+x,A+y),score:u,classScore:u*D,label:E},B)),H.label=9;case 9:return t++,[3,5];case 10:return s++,[3,4];case 11:return r++,[3,3];case 12:return l.dispose(),m.dispose(),n.dispose(),[2,o]}})})},b.prototype.extractPredictedClass=function(a,b){return Ak(this,void 0,void 0,function(){var c,d,e,f;return Al(this,function(g){switch(g.label){case 0:return c=b.row,d=b.col,e=b.anchor,[4,a.array()];case 1:return f=g.sent(),[2,Array(this.config.classes.length).fill(0).map(function(a,b){return f[c][d][e][b]}).map(function(a,b){return{classScore:a,label:b}}).reduce(function(a,b){return a.classScore>b.classScore?a:b})]}})})},b.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],b}(A0),BU=function(a){function b(b){void 0===b&&(b=!0);var c=Object.assign({},{withSeparableConvs:b,iouThreshold:.4,classes:["face"]},b?{anchors:BM,meanRgb:BN}:{anchors:BL,withClassScores:!0});return a.call(this,c)||this}return Ai(b,a),Object.defineProperty(b.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),b.prototype.locateFaces=function(a,b){return Ak(this,void 0,void 0,function(){return Al(this,function(c){switch(c.label){case 0:return[4,this.detect(a,b)];case 1:return[2,c.sent().map(function(a){return new Az(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},b.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},b.prototype.extractParamsFromWeigthMap=function(b){return a.prototype.extractParamsFromWeigthMap.call(this,b)},b}(BT),BV=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b._name="TinyFaceDetectorOptions",b}return Ai(b,a),b}(BS),BW=function(){function a(){}return a.prototype.then=function(a){return Ak(this,void 0,void 0,function(){var b;return Al(this,function(c){switch(c.label){case 0:return b=a,[4,this.run()];case 1:return[2,b.apply(void 0,[c.sent()])]}})})},a.prototype.run=function(){return Ak(this,void 0,void 0,function(){return Al(this,function(a){throw Error("ComposableTask - run is not implemented")})})},a}();function BX(a,b){return Object.assign({},a,{descriptor:b})}function BY(a,b,c,d,e){return void 0===e&&(e=function(a){return a.alignedRect}),Ak(this,void 0,void 0,function(){var f,g,h,i,j;return Al(this,function(k){switch(k.label){case 0:if(f=a.map(function(a){var b;return(b=a).detection instanceof Az&&b.landmarks instanceof AE&&b.unshiftedLandmarks instanceof AE&&b.alignedRect instanceof Az?e(a):a.detection}),h=d)return[3,5];if(!(b instanceof qP))return[3,2];return[4,A$(b,f)];case 1:return i=k.sent(),[3,4];case 2:return[4,AZ(b,f)];case 3:i=k.sent(),k.label=4;case 4:h=i,k.label=5;case 5:return[4,c(g=h)];case 6:return j=k.sent(),g.forEach(function(a){return a instanceof qP&&a.dispose()}),[2,j]}})})}function BZ(a,b,c,d,e){return Ak(this,void 0,void 0,function(){var f=this;return Al(this,function(g){return[2,BY([a],b,function(a){return Ak(f,void 0,void 0,function(){return Al(this,function(b){return[2,c(a[0])]})})},d,e)]})})}function B$(a,b){return{height:Math.floor(b[0]*a),width:Math.floor(b[1]*a)}}var B_=function(a){function b(b,c,d,e){return a.call(this,{left:b,top:c,right:d,bottom:e},!0)||this}return Ai(b,a),b}(Aw);function B0(a){return r$(function(){return xm(xr(a,sl(127.5)),sl(.0078125))})}function B1(a,b){return r$(function(){return w8(yu(a),xm(b,wA(yu(wA(a)))))})}function B2(a,b,c){return void 0===c&&(c=!1),r$(function(){var d=A4(a,b.conv1,"valid");return d=A4(d=x5(d=B1(d,b.prelu1_alpha),c?[2,2]:[3,3],[2,2],"same"),b.conv2,"valid"),d=B1(d,b.prelu2_alpha),d=B1(d=A4(d=c?d:x5(d,[3,3],[2,2],"valid"),b.conv3,"valid"),b.prelu3_alpha)})}function B3(a,b,c){var d=c.width,e=c.height;return Ak(this,void 0,void 0,function(){var c,f,g,h=this;return Al(this,function(i){switch(i.label){case 0:return c=AO(a),[4,Promise.all(b.map(function(b){return Ak(h,void 0,void 0,function(){var d,e,f,g,h,i,j,k;return Al(this,function(l){return e=(d=b.padAtBorders(a.height,a.width)).y,f=d.ey,g=d.x,h=d.ex,i=g-1,j=e-1,k=c.getImageData(i,j,h-i,f-j),[2,AM.isNodejs()?AV(k):createImageBitmap(k)]})})}))];case 1:return f=i.sent(),g=[],f.forEach(function(a){var b=AO(AU({width:d,height:e}));b.drawImage(a,0,0,d,e);for(var c=b.getImageData(0,0,d,e).data,f=[],h=0;h<c.length;h+=4)f.push(c[h+2]),f.push(c[h+1]),f.push(c[h]);g.push(f)}),[2,g.map(function(a){return r$(function(){return B0(yx(sp(a,[1,d,e,3]),[0,2,1,3]).toFloat())})})]}})})}var B4=function(a){function b(){return a.call(this,"Mtcnn")||this}return Ai(b,a),b.prototype.load=function(b){return Ak(this,void 0,void 0,function(){return Al(this,function(c){return console.warn("mtcnn is deprecated and will be removed soon"),[2,a.prototype.load.call(this,b)]})})},b.prototype.loadFromDisk=function(b){return Ak(this,void 0,void 0,function(){return Al(this,function(c){return console.warn("mtcnn is deprecated and will be removed soon"),[2,a.prototype.loadFromDisk.call(this,b)]})})},b.prototype.forwardInput=function(a,b){return void 0===b&&(b={}),Ak(this,void 0,void 0,function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return Al(this,function(w){switch(w.label){case 0:if(!(c=this.params))throw Error("Mtcnn - load model before inference");if(!(d=a.canvases[0]))throw Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return e={},f=Date.now(),g=r$(function(){var a;return a=sV(z1.fromPixels(d)).toFloat(),r$(function(){return s9(tc(a,3).reverse(),3)})}),h=function(a){return g.dispose(),e.total=Date.now()-f,a},j=(i=g.shape.slice(1))[0],k=i[1],m=(l=new BG(b)).minFaceSize,n=l.scaleFactor,o=l.maxNumScales,p=l.scoreThresholds,q=(l.scaleSteps||function(a,b,c){for(var d=c[0],e=c[1],f=12/a,g=[],h=Math.min(d,e)*f,i=0;h>=12;)g.push(f*Math.pow(b,i)),h*=b,i+=1;return g}(m,n,[j,k])).filter(function(a){var b=B$(a,[j,k]);return Math.min(b.width,b.height)>12}).slice(0,o),e.scales=q,e.pyramid=q.map(function(a){return B$(a,[j,k])}),r=Date.now(),[4,function(a,b,c,d,e){e.stage1=[];var f=b.map(function(b){return r$(function(){var c={scale:b},e=r$(function(){var c=B$(b,a.shape.slice(1)),d=c.height,e=c.width;return yx(B0(y6.resizeBilinear(a,[d,e])),[0,2,1,3])}),f=Date.now(),g=r$(function(){var a=B2(e,d,!0),b=A4(a,d.conv4_1,"valid"),c=sV(yl(b,3),3);return{prob:tv(xr(b,c),3),regions:A4(a,d.conv4_2,"valid")}}),h=g.prob,i=g.regions;return c.pnet=Date.now()-f,{scoresTensor:tc(tc(h,3)[1])[0],regionsTensor:tc(i)[0],scale:b,statsForScale:c}})}).map(function(a){var b=a.scoresTensor,d=a.regionsTensor,f=a.scale,g=a.statsForScale,h=function(a,b,c,d){for(var e=[],f=a.arraySync(),g=0;g<a.shape[0];g++)for(var h=0;h<a.shape[1];h++)f[g][h]>=d&&e.push(new Av(h,g));return e.map(function(a){var d=new Ax(Math.round((2*a.y+1)/c),Math.round((2*a.x+1)/c),Math.round((2*a.y+12)/c),Math.round((2*a.x+12)/c)),e=f[a.y][a.x],g=b.arraySync();return{cell:d,score:e,region:new B_(g[a.y][a.x][0],g[a.y][a.x][1],g[a.y][a.x][2],g[a.y][a.x][3])}})}(b,d,f,c);if(b.dispose(),d.dispose(),!h.length)return e.stage1.push(g),[];var i=Date.now(),j=AA(h.map(function(a){return a.cell}),h.map(function(a){return a.score}),.5);return g.nms=Date.now()-i,g.numBoxes=j.length,e.stage1.push(g),j.map(function(a){return h[a]})}).reduce(function(a,b){return a.concat(b)},[]),g=[],h=[];if(f.length>0){var i=Date.now(),j=AA(f.map(function(a){return a.cell}),f.map(function(a){return a.score}),.7);e.stage1_nms=Date.now()-i,h=j.map(function(a){return f[a].score}),g=j.map(function(a){return f[a]}).map(function(a){var b=a.cell,c=a.region;return new Ax(b.left+c.left*b.width,b.top+c.top*b.height,b.right+c.right*b.width,b.bottom+c.bottom*b.height).toSquare().round()})}return{boxes:g,scores:h}}(g,q,p[0],c.pnet,e)];case 1:if(s=w.sent(),e.total_stage1=Date.now()-r,!s.boxes.length)return[2,h({results:[],stats:e})];return e.stage2_numInputBoxes=s.boxes.length,r=Date.now(),[4,function(a,b,c,d,e){return Ak(this,void 0,void 0,function(){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;return Al(this,function(t){switch(t.label){case 0:return f=Date.now(),[4,B3(a,b,{width:24,height:24})];case 1:return g=t.sent(),e.stage2_extractImagePatches=Date.now()-f,f=Date.now(),h=g.map(function(a){var b=r$(function(){var b=B2(a,d),c=B1(Bh(s6(b,[b.shape[0],d.fc1.weights.shape[0]]),d.fc1),d.prelu4_alpha),e=Bh(c,d.fc2_1),f=sV(yl(e,1),1),g=tv(xr(e,f),1),h=Bh(c,d.fc2_2);return{scores:tc(g,1)[1],regions:h}});return a.dispose(),b}),e.stage2_rnet=Date.now()-f,i=h.length>1?sw(h.map(function(a){return a.scores})):h[0].scores,l=(k=Array).from,[4,i.data()];case 2:return j=l.apply(k,[t.sent()]),i.dispose(),n=(m=j.map(function(a,b){return{score:a,idx:b}}).filter(function(a){return a.score>c}).map(function(a){return a.idx})).map(function(a){return b[a]}),o=m.map(function(a){return j[a]}),p=[],q=[],n.length>0&&(f=Date.now(),r=AA(n,o,.7),e.stage2_nms=Date.now()-f,s=r.map(function(a){var b=h[m[a]].regions.arraySync();return new B_(b[0][0],b[0][1],b[0][2],b[0][3])}),q=r.map(function(a){return o[a]}),p=r.map(function(a,b){return n[a].calibrate(s[b])})),h.forEach(function(a){a.regions.dispose(),a.scores.dispose()}),[2,{boxes:p,scores:q}]}})})}(d,s.boxes,p[1],c.rnet,e)];case 2:if(t=w.sent(),e.total_stage2=Date.now()-r,!t.boxes.length)return[2,h({results:[],stats:e})];return e.stage3_numInputBoxes=t.boxes.length,r=Date.now(),[4,function(a,b,c,d,e){return Ak(this,void 0,void 0,function(){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return Al(this,function(u){switch(u.label){case 0:return f=Date.now(),[4,B3(a,b,{width:48,height:48})];case 1:return g=u.sent(),e.stage3_extractImagePatches=Date.now()-f,f=Date.now(),h=g.map(function(a){var b=r$(function(){var b=B2(a,d),c=Bh(s6(b=B1(b=A4(b=x5(b,[2,2],[2,2],"same"),d.conv4,"valid"),d.prelu4_alpha),[b.shape[0],d.fc1.weights.shape[0]]),d.fc1),e=B1(c,d.prelu5_alpha),f=Bh(e,d.fc2_1),g=sV(yl(f,1),1),h=tv(xr(f,g),1),i=Bh(e,d.fc2_2),j=Bh(e,d.fc2_3);return{scores:tc(h,1)[1],regions:i,points:j}});return a.dispose(),b}),e.stage3_onet=Date.now()-f,i=h.length>1?sw(h.map(function(a){return a.scores})):h[0].scores,l=(k=Array).from,[4,i.data()];case 2:return j=l.apply(k,[u.sent()]),i.dispose(),n=(m=j.map(function(a,b){return{score:a,idx:b}}).filter(function(a){return a.score>c}).map(function(a){return a.idx})).map(function(a){var b=h[a].regions.arraySync();return new B_(b[0][0],b[0][1],b[0][2],b[0][3])}),o=m.map(function(a,c){return b[a].calibrate(n[c])}),p=m.map(function(a){return j[a]}),q=[],r=[],s=[],o.length>0&&(f=Date.now(),t=AA(o,p,.7,!1),e.stage3_nms=Date.now()-f,q=t.map(function(a){return o[a]}),r=t.map(function(a){return p[a]}),s=t.map(function(a,b){return[,,,,,].fill(0).map(function(c,d){var e=h[a].points.arraySync();return new Av(e[0][d]*(q[b].width+1)+q[b].left,e[0][d+5]*(q[b].height+1)+q[b].top)})})),h.forEach(function(a){a.regions.dispose(),a.scores.dispose(),a.points.dispose()}),[2,{boxes:q,scores:r,points:s}]}})})}(d,t.boxes,p[2],c.onet,e)];case 3:return u=w.sent(),e.total_stage3=Date.now()-r,v=u.boxes.map(function(a,b){return Bo(AK({},new Az(u.scores[b],new AD(a.left/k,a.top/j,a.width/k,a.height/j),{height:j,width:k})),new AF(u.points[b].map(function(b){return b.sub(new Av(a.left,a.top)).div(new Av(a.width,a.height))}),{width:a.width,height:a.height}))}),[2,h({results:v,stats:e})]}})})},b.prototype.forward=function(a,b){return void 0===b&&(b={}),Ak(this,void 0,void 0,function(){var c;return Al(this,function(d){switch(d.label){case 0:return c=this.forwardInput,[4,AY(a)];case 1:return[4,c.apply(this,[d.sent(),b])];case 2:return[2,d.sent().results]}})})},b.prototype.forwardWithStats=function(a,b){return void 0===b&&(b={}),Ak(this,void 0,void 0,function(){var c;return Al(this,function(d){switch(d.label){case 0:return c=this.forwardInput,[4,AY(a)];case 1:return[2,c.apply(this,[d.sent(),b])]}})})},b.prototype.getDefaultModelName=function(){return"mtcnn_model"},b.prototype.extractParamsFromWeigthMap=function(a){var b,c,d,e,f,g,h,i;return d=(c=function(a,b){var c=Bb(a,b);function d(a){return{filters:c(a+"/weights",4,a+"/filters"),bias:c(a+"/bias",1)}}function e(a){return{weights:c(a+"/weights",2),bias:c(a+"/bias",1)}}function f(a){return{conv1:d(a+"/conv1"),prelu1_alpha:c(a+"/prelu1_alpha",1),conv2:d(a+"/conv2"),prelu2_alpha:c(a+"/prelu2_alpha",1),conv3:d(a+"/conv3"),prelu3_alpha:c(a+"/prelu3_alpha",1)}}return{extractPNetParams:function(){var a=f("pnet"),b=d("pnet/conv4_1"),c=d("pnet/conv4_2");return Aj(Aj({},a),{conv4_1:b,conv4_2:c})},extractRNetParams:function(){var a=f("rnet"),b=e("rnet/fc1"),d=c("rnet/prelu4_alpha",1),g=e("rnet/fc2_1"),h=e("rnet/fc2_2");return Aj(Aj({},a),{fc1:b,prelu4_alpha:d,fc2_1:g,fc2_2:h})},extractONetParams:function(){var a=f("onet"),b=d("onet/conv4"),g=c("onet/prelu4_alpha",1),h=e("onet/fc1"),i=c("onet/prelu5_alpha",1),j=e("onet/fc2_1"),k=e("onet/fc2_2"),l=e("onet/fc2_3");return Aj(Aj({},a),{conv4:b,prelu4_alpha:g,fc1:h,prelu5_alpha:i,fc2_1:j,fc2_2:k,fc2_3:l})}}}(a,b=[])).extractPNetParams,e=c.extractRNetParams,f=c.extractONetParams,g=d(),h=e(),i=f(),A5(a,b),{params:{pnet:g,rnet:h,onet:i},paramMappings:b}},b.prototype.extractParams=function(a){return function(a){var b=Bc(a),c=b.extractWeights,d=b.getRemainingWeights,e=[],f=function(a,b){var c=A6(a,b),d=A7(a,b);function e(c,d){var e=sm(a(c));return b.push({paramPath:d}),e}function f(a,b,d){return void 0===d&&(d=!1),{conv1:c(a[0],a[1],3,b+"/conv1"),prelu1_alpha:e(a[1],b+"/prelu1_alpha"),conv2:c(a[1],a[2],3,b+"/conv2"),prelu2_alpha:e(a[2],b+"/prelu2_alpha"),conv3:c(a[2],a[3],d?2:3,b+"/conv3"),prelu3_alpha:e(a[3],b+"/prelu3_alpha")}}return{extractPNetParams:function(){var a=f([3,10,16,32],"pnet"),b=c(32,2,1,"pnet/conv4_1"),d=c(32,4,1,"pnet/conv4_2");return Aj(Aj({},a),{conv4_1:b,conv4_2:d})},extractRNetParams:function(){var a=f([3,28,48,64],"rnet",!0),b=d(576,128,"rnet/fc1"),c=e(128,"rnet/prelu4_alpha"),g=d(128,2,"rnet/fc2_1"),h=d(128,4,"rnet/fc2_2");return Aj(Aj({},a),{fc1:b,prelu4_alpha:c,fc2_1:g,fc2_2:h})},extractONetParams:function(){var a=f([3,32,64,64],"onet"),b=c(64,128,2,"onet/conv4"),g=e(128,"onet/prelu4_alpha"),h=d(1152,256,"onet/fc1"),i=e(256,"onet/prelu5_alpha"),j=d(256,2,"onet/fc2_1"),k=d(256,4,"onet/fc2_2"),l=d(256,10,"onet/fc2_3");return Aj(Aj({},a),{conv4:b,prelu4_alpha:g,fc1:h,prelu5_alpha:i,fc2_1:j,fc2_2:k,fc2_3:l})}}}(c,e),g=f.extractPNetParams,h=f.extractRNetParams,i=f.extractONetParams,j=g(),k=h(),l=i();if(0!==d().length)throw Error("weights remaing after extract: "+d().length);return{params:{pnet:j,rnet:k,onet:l},paramMappings:e}}(a)},b}(A0),B5=[new Av(1.603231,2.094468),new Av(6.041143,7.080126),new Av(2.882459,3.518061),new Av(4.266906,5.178857),new Av(9.041765,10.66308)],B6=[117.001,114.697,97.404],B7=function(a){function b(){return a.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:B5,meanRgb:B6,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return Ai(b,a),Object.defineProperty(b.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),b.prototype.locateFaces=function(a,b){return Ak(this,void 0,void 0,function(){return Al(this,function(c){switch(c.label){case 0:return[4,this.detect(a,b)];case 1:return[2,c.sent().map(function(a){return new Az(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},b.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},b.prototype.extractParamsFromWeigthMap=function(b){return a.prototype.extractParamsFromWeigthMap.call(this,b)},b}(BT),B8={ssdMobilenetv1:new BK,tinyFaceDetector:new B7,tinyYolov2:new BU,mtcnn:new B4,faceLandmark68Net:new Bw,faceLandmark68TinyNet:new By,faceRecognitionNet:new BE,faceExpressionNet:new Bm,ageGenderNet:new Bu};function B9(a,b){return Object.assign({},a,{age:b})}var Ca=function(a){function b(b,c,d){var e=a.call(this)||this;return e.parentTask=b,e.input=c,e.extractedFaces=d,e}return Ai(b,a),b}(BW),Cb=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b,c=this;return Al(this,function(d){switch(d.label){case 0:return[4,this.parentTask];case 1:return[4,BY(a=d.sent(),this.input,function(a){return Ak(c,void 0,void 0,function(){return Al(this,function(b){switch(b.label){case 0:return[4,Promise.all(a.map(function(a){return B8.faceExpressionNet.predictExpressions(a)}))];case 1:return[2,b.sent()]}})})},this.extractedFaces)];case 2:return b=d.sent(),[2,a.map(function(a,c){return Bn(a,b[c])})]}})})},b.prototype.withAgeAndGender=function(){return new Cg(this,this.input)},b}(Ca),Cc=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b;return Al(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:if(!(a=c.sent()))return[2];return[4,BZ(a,this.input,function(a){return B8.faceExpressionNet.predictExpressions(a)},this.extractedFaces)];case 2:return b=c.sent(),[2,Bn(a,b)]}})})},b.prototype.withAgeAndGender=function(){return new Ch(this,this.input)},b}(Ca),Cd=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.withAgeAndGender=function(){return new Ci(this,this.input)},b.prototype.withFaceDescriptors=function(){return new Cl(this,this.input)},b}(Cb),Ce=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.withAgeAndGender=function(){return new Cj(this,this.input)},b.prototype.withFaceDescriptor=function(){return new Cm(this,this.input)},b}(Cc),Cf=function(a){function b(b,c,d){var e=a.call(this)||this;return e.parentTask=b,e.input=c,e.extractedFaces=d,e}return Ai(b,a),b}(BW),Cg=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b,c=this;return Al(this,function(d){switch(d.label){case 0:return[4,this.parentTask];case 1:return[4,BY(a=d.sent(),this.input,function(a){return Ak(c,void 0,void 0,function(){return Al(this,function(b){switch(b.label){case 0:return[4,Promise.all(a.map(function(a){return B8.ageGenderNet.predictAgeAndGender(a)}))];case 1:return[2,b.sent()]}})})},this.extractedFaces)];case 2:return b=d.sent(),[2,a.map(function(a,c){var d=b[c],e=d.age;return B9(BF(a,d.gender,d.genderProbability),e)})]}})})},b.prototype.withFaceExpressions=function(){return new Cb(this,this.input)},b}(Cf),Ch=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b,c,d,e;return Al(this,function(f){switch(f.label){case 0:return[4,this.parentTask];case 1:if(!(a=f.sent()))return[2];return[4,BZ(a,this.input,function(a){return B8.ageGenderNet.predictAgeAndGender(a)},this.extractedFaces)];case 2:return c=(b=f.sent()).age,d=b.gender,e=b.genderProbability,[2,B9(BF(a,d,e),c)]}})})},b.prototype.withFaceExpressions=function(){return new Cc(this,this.input)},b}(Cf),Ci=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.withFaceExpressions=function(){return new Cd(this,this.input)},b.prototype.withFaceDescriptors=function(){return new Cl(this,this.input)},b}(Cg),Cj=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.withFaceExpressions=function(){return new Ce(this,this.input)},b.prototype.withFaceDescriptor=function(){return new Cm(this,this.input)},b}(Ch),Ck=function(a){function b(b,c){var d=a.call(this)||this;return d.parentTask=b,d.input=c,d}return Ai(b,a),b}(BW),Cl=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a;return Al(this,function(b){switch(b.label){case 0:return[4,this.parentTask];case 1:return[4,BY(a=b.sent(),this.input,function(a){return Promise.all(a.map(function(a){return B8.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,b.sent().map(function(b,c){return BX(a[c],b)})]}})})},b.prototype.withFaceExpressions=function(){return new Cd(this,this.input)},b.prototype.withAgeAndGender=function(){return new Ci(this,this.input)},b}(Ck),Cm=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b;return Al(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:if(!(a=c.sent()))return[2];return[4,BZ(a,this.input,function(a){return B8.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return b=c.sent(),[2,BX(a,b)]}})})},b.prototype.withFaceExpressions=function(){return new Ce(this,this.input)},b.prototype.withAgeAndGender=function(){return new Cj(this,this.input)},b}(Ck),Cn=function(a){function b(b,c,d){var e=a.call(this)||this;return e.parentTask=b,e.input=c,e.useTinyLandmarkNet=d,e}return Ai(b,a),Object.defineProperty(b.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?B8.faceLandmark68TinyNet:B8.faceLandmark68Net},enumerable:!0,configurable:!0}),b}(BW),Co=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b,c,d,e,f=this;return Al(this,function(g){switch(g.label){case 0:return[4,this.parentTask];case 1:if(b=(a=g.sent()).map(function(a){return a.detection}),!(this.input instanceof qP))return[3,3];return[4,A$(this.input,b)];case 2:return d=g.sent(),[3,5];case 3:return[4,AZ(this.input,b)];case 4:d=g.sent(),g.label=5;case 5:return[4,Promise.all((c=d).map(function(a){return f.landmarkNet.detectLandmarks(a)}))];case 6:return e=g.sent(),c.forEach(function(a){return a instanceof qP&&a.dispose()}),[2,a.map(function(a,b){return Bo(a,e[b])})]}})})},b.prototype.withFaceExpressions=function(){return new Cd(this,this.input)},b.prototype.withAgeAndGender=function(){return new Ci(this,this.input)},b.prototype.withFaceDescriptors=function(){return new Cl(this,this.input)},b}(Cn),Cp=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b,c,d,e;return Al(this,function(f){switch(f.label){case 0:return[4,this.parentTask];case 1:if(!(a=f.sent()))return[2];if(b=a.detection,!(this.input instanceof qP))return[3,3];return[4,A$(this.input,[b])];case 2:return d=f.sent(),[3,5];case 3:return[4,AZ(this.input,[b])];case 4:d=f.sent(),f.label=5;case 5:return c=d,[4,this.landmarkNet.detectLandmarks(c[0])];case 6:return e=f.sent(),c.forEach(function(a){return a instanceof qP&&a.dispose()}),[2,Bo(a,e)]}})})},b.prototype.withFaceExpressions=function(){return new Ce(this,this.input)},b.prototype.withAgeAndGender=function(){return new Cj(this,this.input)},b.prototype.withFaceDescriptor=function(){return new Cm(this,this.input)},b}(Cn),Cq=function(a){function b(b,c){void 0===c&&(c=new BJ);var d=a.call(this)||this;return d.input=b,d.options=c,d}return Ai(b,a),b}(BW),Cr=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b,c,d;return Al(this,function(e){switch(e.label){case 0:if(a=this,b=a.input,!((c=a.options)instanceof BG))return[3,2];return[4,B8.mtcnn.forward(b,c)];case 1:return[2,e.sent().map(function(a){return a.detection})];case 2:if(!(d=c instanceof BV?function(a){return B8.tinyFaceDetector.locateFaces(a,c)}:c instanceof BJ?function(a){return B8.ssdMobilenetv1.locateFaces(a,c)}:c instanceof BS?function(a){return B8.tinyYolov2.locateFaces(a,c)}:null))throw Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,d(b)]}})})},b.prototype.runAndExtendWithFaceDetections=function(){var a=this;return new Promise(function(b){return Ak(a,void 0,void 0,function(){return Al(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return[2,b(a.sent().map(function(a){return AK({},a)}))]}})})})},b.prototype.withFaceLandmarks=function(a){return void 0===a&&(a=!1),new Co(this.runAndExtendWithFaceDetections(),this.input,a)},b.prototype.withFaceExpressions=function(){return new Cb(this.runAndExtendWithFaceDetections(),this.input)},b.prototype.withAgeAndGender=function(){return new Cg(this.runAndExtendWithFaceDetections(),this.input)},b}(Cq),Cs=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return Ai(b,a),b.prototype.run=function(){return Ak(this,void 0,void 0,function(){var a,b;return Al(this,function(c){switch(c.label){case 0:return[4,new Cr(this.input,this.options)];case 1:return b=(a=c.sent())[0],a.forEach(function(a){a.score>b.score&&(b=a)}),[2,b]}})})},b.prototype.runAndExtendWithFaceDetection=function(){var a=this;return new Promise(function(b){return Ak(a,void 0,void 0,function(){var a;return Al(this,function(c){switch(c.label){case 0:return[4,this.run()];case 1:return[2,b((a=c.sent())?AK({},a):void 0)]}})})})},b.prototype.withFaceLandmarks=function(a){return void 0===a&&(a=!1),new Cp(this.runAndExtendWithFaceDetection(),this.input,a)},b.prototype.withFaceExpressions=function(){return new Cc(this.runAndExtendWithFaceDetection(),this.input)},b.prototype.withAgeAndGender=function(){return new Ch(this.runAndExtendWithFaceDetection(),this.input)},b}(Cq);!function(){function a(a,b){void 0===b&&(b=.6),this._distanceThreshold=b;var c=Array.isArray(a)?a:[a];if(!c.length)throw Error("FaceRecognizer.constructor - expected atleast one input");var d=1,e=function(){return"person "+d++};this._labeledDescriptors=c.map(function(a){if(a instanceof AJ)return a;if(a instanceof Float32Array)return new AJ(e(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new AJ(e(),[a.descriptor]);throw Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(a.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),a.prototype.computeMeanDistance=function(a,b){return b.map(function(b){if(b.length!==a.length)throw Error("euclideanDistance: arr1.length !== arr2.length");var c=Array.from(b),d=Array.from(a);return Math.sqrt(c.map(function(a,b){return a-d[b]}).reduce(function(a,b){return a+Math.pow(b,2)},0))}).reduce(function(a,b){return a+b},0)/(b.length||1)},a.prototype.matchDescriptor=function(a){var b=this;return this.labeledDescriptors.map(function(c){var d=c.descriptors;return new AH(c.label,b.computeMeanDistance(a,d))}).reduce(function(a,b){return a.distance<b.distance?a:b})},a.prototype.findBestMatch=function(a){var b=this.matchDescriptor(a);return b.distance<this.distanceThreshold?b:new AH("unknown",b.distance)},a.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(a){return a.toJSON()})}},a.fromJSON=function(b){return new a(b.labeledDescriptors.map(function(a){return AJ.fromJSON(a)}),b.distanceThreshold)}}();class Ct{constructor(a){this.readings=[],this._sessionId=null,this.persistTimeout=null,this.lastPersistTime=0,this.lastAggregateTime=0,this.windowMs=a?.windowMs??3e4,this.maxSamples=a?.maxSamples??60}get sessionId(){return this._sessionId}set sessionId(a){this._sessionId=a}addReading(a){let b={...a,timestamp:Date.now()};this.readings.push(b),this.pruneOldReadings(),this.schedulePersistence()}schedulePersistence(){if(!this._sessionId)return;let a=Date.now()-this.lastPersistTime;this.persistTimeout||(a>=5e3?this.persistToStorage():this.persistTimeout=setTimeout(()=>{this.persistTimeout=null,this.persistToStorage()},5e3-a))}pruneOldReadings(){let a=Date.now()-this.windowMs;this.readings=this.readings.filter(b=>b.timestamp>a),this.readings.length>this.maxSamples&&(this.readings=this.readings.slice(-this.maxSamples))}getAggregate(){if(this.pruneOldReadings(),0===this.readings.length)return null;let a=Date.now(),b=this.average(this.readings.map(a=>a.valence)),c=this.average(this.readings.map(a=>a.arousal)),d=this.average(this.readings.map(a=>a.confidence)),e=this.findDominantEmotion(),f=this.calculateStability(),g=this.calculateTrend(),h=this.calculateEmpathyBoost(b,f),i=this.generatePromptContext(e,b,c,f,g),j=a-this.readings[0].timestamp;return{avgValence:b,avgArousal:c,avgConfidence:d,dominantEmotion:e,stability:f,trend:g,sampleCount:this.readings.length,windowMs:this.windowMs,oldestSampleAge:j,promptContext:i,suggestedEmpathyBoost:h}}getLatest(){return 0===this.readings.length?null:this.readings[this.readings.length-1]}clear(){this.readings=[]}persistToStorage(){return this._sessionId,!1}loadFromStorage(a){return!1}cleanupOldEntries(){}clearPersistedData(){return this._sessionId,!1}get count(){return this.pruneOldReadings(),this.readings.length}average(a){return 0===a.length?0:a.reduce((a,b)=>a+b,0)/a.length}findDominantEmotion(){let a={};for(let b of this.readings)a[b.currentEmotion]=(a[b.currentEmotion]||0)+1;let b="neutral",c=0;for(let[d,e]of Object.entries(a))e>c&&(c=e,b=d);return b}calculateStability(){if(this.readings.length<2)return 1;let a=this.readings.map(a=>a.valence),b=this.average(a);return Math.max(0,Math.min(1,1-Math.sqrt(a.reduce((a,c)=>a+Math.pow(c-b,2),0)/a.length)))}calculateTrend(){if(this.readings.length<4)return"stable";let a=Math.floor(this.readings.length/2),b=this.readings.slice(0,a),c=this.readings.slice(a),d=this.average(b.map(a=>a.valence)),e=this.average(c.map(a=>a.valence))-d;return e>.15?"improving":e<-.15?"declining":"stable"}calculateEmpathyBoost(a,b){return a>=0?0:Math.round(Math.min(20,15*Math.abs(a)*(1+(1-b)*.5)))}generatePromptContext(a,b,c,d,e){let f=[];return f.push(`The user appears ${a} with a ${b>.3?"positive":b<-.3?"negative":"neutral"} emotional state.`),f.push(`They seem ${c>.7?"highly activated":c<.3?"calm":"moderately engaged"}.`),d<.4?f.push("Their emotional state has been fluctuating."):d>.8&&f.push("Their emotional state has been consistent."),"improving"===e?f.push("Their mood appears to be improving."):"declining"===e&&f.push("Their mood appears to be declining - consider responding with extra care."),f.join(" ")}setWindowMs(a){this.windowMs=a,this.pruneOldReadings()}setMaxSamples(a){this.maxSamples=a,this.pruneOldReadings()}}new Ct;var Cu=c(3540),Cv=c.n(Cu);let Cw=fO("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);fO("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),fO("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),fO("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),fO("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),fO("git-branch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]),fO("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);(function(){let a=[],b=[42,137,256];for(let c=0;c<3;c++){let d=function(a){return function(){return(a=0x41c64e6d*a+12345&0x7fffffff)/0x7fffffff}}(b[c]),e=[],f=0;for(let a=0;a<1536;a++){let a=Math.sqrt(-2*Math.log(d()||1e-4))*Math.cos(2*Math.PI*d());e.push(a),f+=a*a}let g=Math.sqrt(f);for(let a=0;a<1536;a++)e[a]/=g;a.push(e)};})(),Cv()(async()=>{},{loadableGenerated:{modules:["plugins/memory-explorer/MemoryExplorerPanel.tsx -> ./Memory3DScene"]},ssr:!1,loading:()=>(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-emblem-bg",children:(0,l.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,l.jsx)(Cw,{className:"w-8 h-8 text-emblem-primary animate-spin"}),(0,l.jsx)("span",{className:"text-emblem-muted text-sm",children:"Loading 3D..."})]})})}),c(9630),async()=>{console.log("[MemoryExplorer] Deactivated")};fO("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);fO("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);let Cx=[{id:"stance",label:"Stance",icon:fP},{id:"config",label:"Config",icon:fQ},{id:"timeline",label:"Timeline",icon:fR},{id:"evolution",label:"Evolution",icon:fS},{id:"sessions",label:"Sessions",icon:fT},{id:"memories",label:"Memories",icon:fU}];function Cy(){let[a,b]=(0,m.useState)(),[c,d]=(0,m.useState)(null),[e,f]=(0,m.useState)(null),[g,h]=(0,m.useState)(null),[i,j]=(0,m.useState)([]),[k,n]=(0,m.useState)([]),[o,p]=(0,m.useState)("stance"),[q,r]=(0,m.useState)(null),[s,t]=(0,m.useState)([]),[u,v]=(0,m.useState)(!1),w=(0,m.useMemo)(()=>{let a=Cx.map(a=>({id:a.id,label:a.label,icon:a.icon,isPlugin:!1})),b=s.map(a=>({id:a.id,label:a.label,icon:a.icon,isPlugin:!0,panel:a}));return[...a.slice(0,2),...b,...a.slice(2)]},[s]),[x,y]=(0,m.useState)(!0),[z,A]=(0,m.useState)(320),B=(0,m.useRef)(!1),C=function(a=768){let[b,c]=(0,m.useState)(!1);return b}(),[D,F]=(0,m.useState)(!1),[G,H]=(0,m.useState)(!1),I=(0,m.useCallback)(()=>{B.current=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]),J=(0,m.useCallback)(()=>{let a=!x;y(a),ps({sidebarOpen:a})},[x]),K=(0,m.useCallback)(a=>{p(a),ps({activePanel:a}),C&&(F(!1),H(!0))},[C]),L=(0,m.useCallback)(()=>{H(!1)},[]),M=(0,m.useCallback)(async a=>{try{let[b,c]=await Promise.all([jp(a),jq(a)]);j(b.entries),n(c.snapshots)}catch(a){console.error("Failed to refresh timeline data:",a)}},[]),N=async a=>{b(a);try{let b=await jj(a);d(b.stance),f(b.config),await M(a)}catch(a){console.error("Failed to get state:",a)}},O=b=>{d(b.stanceAfter),a&&M(a)},P=async b=>{if(a)try{let c=await jk(a,b);f(c.config)}catch(a){console.error("Failed to update config:",a)}},Q=async()=>{try{var a,c;let e=await ji();b(e.sessionId),d(e.stance),f(e.config),j([]),n([]),a=e.sessionId,c=pm.LAST_SESSION_ID,r(null),C&&H(!1)}catch(a){console.error("Failed to create session:",a)}},R=async a=>{await N(a),p("stance"),C&&H(!1)};(0,m.useCallback)(a=>{let b=pw.getPlugin(a);return b?.capabilities??null},[]);let S=()=>{let b=s.find(a=>a.id===o);if(b){let f=b.component,g=pw.getPlugin(pw.getAllPlugins().find(a=>a.plugin.panel?.id===b.id)?.plugin.manifest.id??"");if(!g?.capabilities)return(0,l.jsx)("div",{className:"text-emblem-muted p-4",children:"Plugin not ready"});let h={sessionId:a,stance:c,config:e,emotionContext:q,capabilities:g.capabilities,onStanceUpdate:a=>d(a),onConfigUpdate:P,onEmotionUpdate:a=>{r(a),pw.emitEmotionDetected(a)}};return(0,l.jsx)(f,{...h})}return(0,l.jsxs)(l.Fragment,{children:["stance"===o&&(0,l.jsx)(pC,{stance:c}),"config"===o&&(0,l.jsx)(pD,{config:e,onUpdate:P}),"timeline"===o&&(0,l.jsx)(pG,{entries:i}),"evolution"===o&&(0,l.jsx)(pJ,{snapshots:k,currentStance:c||void 0}),"sessions"===o&&(0,l.jsx)(pM,{currentSessionId:a,onSelectSession:R,onNewSession:Q}),"memories"===o&&(0,l.jsx)(pP,{sessionId:a})]})};return g?(0,l.jsx)("main",{className:"h-screen max-h-screen flex flex-col overflow-hidden",children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 p-12 text-center min-h-screen",children:[(0,l.jsx)("h2",{className:"text-emblem-danger text-xl font-display font-semibold",children:"Connection Error"}),(0,l.jsx)("p",{className:"text-emblem-text",children:g}),(0,l.jsx)("p",{className:"text-sm text-emblem-muted",children:"Make sure the METAMORPH server is running on port 3001"}),(0,l.jsx)(kS,{onClick:()=>window.location.reload(),children:"Retry"})]})}):C?(0,l.jsxs)("main",{className:"h-screen max-h-screen flex flex-col overflow-hidden relative",children:[(0,l.jsx)("div",{className:"absolute top-0 left-0 right-0 z-40 flex justify-center",children:(0,l.jsxs)("button",{onClick:()=>F(!D),className:"flex items-center gap-1 px-4 py-1.5 bg-emblem-surface-2/90 backdrop-blur-lg rounded-b-xl border border-t-0 border-white/10 transition-colors",children:[(0,l.jsx)(fV,{className:kA("w-4 h-4 text-emblem-muted transition-transform",D&&"rotate-180")}),(0,l.jsx)("span",{className:"text-xs text-emblem-muted",children:"Menu"})]})}),(0,l.jsx)(E,{children:D&&(0,l.jsx)(fJ.div,{initial:{y:"-100%"},animate:{y:0},exit:{y:"-100%"},transition:{type:"spring",damping:25,stiffness:300},className:"absolute top-0 left-0 right-0 z-30 bg-emblem-surface/95 backdrop-blur-lg border-b border-white/10 pt-10 pb-4 px-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[w.map(({id:a,label:b,icon:c})=>(0,l.jsxs)("button",{onClick:()=>K(a),className:kA("flex flex-col items-center gap-1 p-3 rounded-lg transition-all",o===a?"bg-emblem-secondary/20 text-emblem-secondary":"text-emblem-muted hover:bg-white/5"),children:[(0,l.jsx)(c,{className:"w-5 h-5"}),(0,l.jsx)("span",{className:"text-[10px]",children:b})]},a)),(0,l.jsxs)("button",{onClick:Q,className:"flex flex-col items-center gap-1 p-3 rounded-lg transition-all text-emblem-primary hover:bg-emblem-primary/10",children:[(0,l.jsx)(fW,{className:"w-5 h-5"}),(0,l.jsx)("span",{className:"text-[10px]",children:"New"})]})]})})}),(0,l.jsx)(E,{children:G&&(0,l.jsxs)(fJ.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"absolute inset-0 z-50 bg-emblem-bg flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10",children:[(0,l.jsx)("h2",{className:"text-lg font-display font-semibold text-emblem-secondary capitalize",children:o}),(0,l.jsx)("button",{onClick:L,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:(0,l.jsx)(fX,{className:"w-5 h-5 text-emblem-muted"})})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-styled",children:S()})]})}),(0,l.jsx)("div",{className:"flex-1 min-h-0 max-h-full flex flex-col pt-8",children:(0,l.jsx)(py,{sessionId:a,onSessionChange:N,onResponse:O,onPanelChange:K,onNewSession:Q,stance:c,config:e,emotionContext:q})})]}):(0,l.jsxs)("main",{className:"h-screen max-h-screen flex flex-col overflow-hidden",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between px-6 py-4 border-b border-white/5",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("button",{onClick:J,className:"p-2 rounded-lg bg-emblem-surface-2 hover:bg-emblem-surface border border-white/10 transition-colors","aria-label":x?"Close sidebar":"Open sidebar",children:x?(0,l.jsx)(fX,{className:"w-5 h-5"}):(0,l.jsx)(fY,{className:"w-5 h-5"})}),(0,l.jsxs)("div",{className:"flex items-baseline gap-4",children:[(0,l.jsx)("h1",{className:"text-2xl font-display font-bold gradient-text",children:"METAMORPH"}),(0,l.jsx)("span",{className:"text-sm text-emblem-muted",children:"Transformation-Maximizing AI"})]})]}),(0,l.jsx)(kS,{variant:"outline",onClick:Q,children:"+ New Chat"})]}),(0,l.jsxs)("div",{className:"flex-1 flex h-[calc(100vh-73px)] max-h-[calc(100vh-73px)] overflow-hidden",children:[(0,l.jsxs)("aside",{className:kA("flex flex-col gap-4 min-h-0 max-h-full bg-emblem-surface/50 border-r border-white/5 transition-all duration-300 ease-in-out overflow-hidden",x?"p-4":"w-0 p-0"),style:{width:x?z:0},children:[(0,l.jsx)(oE,{delayDuration:200,children:(0,l.jsx)("div",{className:"flex border-b border-white/10",children:w.map(({id:a,label:b,icon:c})=>(0,l.jsxs)(oI,{children:[(0,l.jsx)(oK,{asChild:!0,children:(0,l.jsxs)("button",{className:kA("flex-1 py-2.5 flex items-center justify-center transition-all relative","cursor-pointer",o===a?"text-emblem-secondary":"text-emblem-muted hover:text-emblem-text hover:bg-white/5"),onClick:()=>K(a),children:[(0,l.jsx)(c,{className:"w-4 h-4"}),o===a&&(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-emblem-secondary"})]})}),(0,l.jsx)(oY,{side:"bottom",sideOffset:8,children:b})]},a))})}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-styled",children:S()})]}),x&&(0,l.jsx)("div",{className:"w-3 bg-emblem-surface-2/50 hover:bg-emblem-primary/30 cursor-col-resize flex-shrink-0 transition-all group flex items-center justify-center border-x border-white/5",onMouseDown:I,children:(0,l.jsx)(fZ,{className:"w-4 h-6 text-emblem-muted/50 group-hover:text-emblem-primary transition-colors"})}),(0,l.jsx)("div",{className:"flex-1 min-h-0 max-h-full flex flex-col p-4",children:(0,l.jsx)(py,{sessionId:a,onSessionChange:N,onResponse:O,onPanelChange:K,onNewSession:Q,stance:c,config:e,emotionContext:q})})]})]})}},7910:a=>{"use strict";a.exports=require("stream")},8226:(a,b,c)=>{Promise.resolve().then(c.bind(c,8997))},8354:a=>{"use strict";a.exports=require("util")},8613:a=>{"use strict";var b=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,c=/\n/g,d=/^\s*/,e=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,f=/^:\s*/,g=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,h=/^[;\s]*/,i=/^\s+|\s+$/g;function j(a){return a?a.replace(i,""):""}a.exports=function(a,i){if("string"!=typeof a)throw TypeError("First argument must be a string");if(!a)return[];i=i||{};var k=1,l=1;function m(a){var b=a.match(c);b&&(k+=b.length);var d=a.lastIndexOf("\n");l=~d?a.length-d:l+a.length}function n(){var a={line:k,column:l};return function(b){return b.position=new o(a),q(d),b}}function o(a){this.start=a,this.end={line:k,column:l},this.source=i.source}function p(b){var c=Error(i.source+":"+k+":"+l+": "+b);if(c.reason=b,c.filename=i.source,c.line=k,c.column=l,c.source=a,i.silent);else throw c}function q(b){var c=b.exec(a);if(c){var d=c[0];return m(d),a=a.slice(d.length),c}}function r(a){var b;for(a=a||[];b=s();)!1!==b&&a.push(b);return a}function s(){var b=n();if("/"==a.charAt(0)&&"*"==a.charAt(1)){for(var c=2;""!=a.charAt(c)&&("*"!=a.charAt(c)||"/"!=a.charAt(c+1));)++c;if(c+=2,""===a.charAt(c-1))return p("End of comment missing");var d=a.slice(2,c-2);return l+=2,m(d),a=a.slice(c),l+=2,b({type:"comment",comment:d})}}o.prototype.content=a,q(d);var t,u=[];for(r(u);t=function(){var a=n(),c=q(e);if(c){if(s(),!q(f))return p("property missing ':'");var d=q(g),i=a({type:"declaration",property:j(c[0].replace(b,"")),value:d?j(d[0].replace(b,"")):""});return q(h),i}}();)!1!==t&&(u.push(t),r(u));return u}},8633:a=>{"use strict";var b=Object.prototype.hasOwnProperty,c=Object.prototype.toString,d=Object.defineProperty,e=Object.getOwnPropertyDescriptor,f=function(a){return"function"==typeof Array.isArray?Array.isArray(a):"[object Array]"===c.call(a)},g=function(a){if(!a||"[object Object]"!==c.call(a))return!1;var d,e=b.call(a,"constructor"),f=a.constructor&&a.constructor.prototype&&b.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!e&&!f)return!1;for(d in a);return void 0===d||b.call(a,d)},h=function(a,b){d&&"__proto__"===b.name?d(a,b.name,{enumerable:!0,configurable:!0,value:b.newValue,writable:!0}):a[b.name]=b.newValue},i=function(a,c){if("__proto__"===c){if(!b.call(a,c))return;else if(e)return e(a,c).value}return a[c]};a.exports=function a(){var b,c,d,e,j,k,l=arguments[0],m=1,n=arguments.length,o=!1;for("boolean"==typeof l&&(o=l,l=arguments[1]||{},m=2),(null==l||"object"!=typeof l&&"function"!=typeof l)&&(l={});m<n;++m)if(b=arguments[m],null!=b)for(c in b)d=i(l,c),l!==(e=i(b,c))&&(o&&e&&(g(e)||(j=f(e)))?(j?(j=!1,k=d&&f(d)?d:[]):k=d&&g(d)?d:{},h(l,{name:c,newValue:a(o,k,e)})):void 0!==e&&h(l,{name:c,newValue:e}));return l}},8997:(a,b,c)=>{"use strict";function d(){return null}c.d(b,{ServiceWorkerRegistration:()=>d}),c(8301)},9021:a=>{"use strict";a.exports=require("fs")},9121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9297:(a,b,c)=>{Promise.resolve().then(c.bind(c,7742))},9551:a=>{"use strict";a.exports=require("url")},9630:(a,b,c)=>{"use strict";c(1124),c(8301)},9862:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,1170,23)),Promise.resolve().then(c.t.bind(c,3597,23)),Promise.resolve().then(c.t.bind(c,6893,23)),Promise.resolve().then(c.t.bind(c,9748,23)),Promise.resolve().then(c.t.bind(c,6060,23)),Promise.resolve().then(c.t.bind(c,7184,23)),Promise.resolve().then(c.t.bind(c,9576,23)),Promise.resolve().then(c.t.bind(c,3041,23)),Promise.resolve().then(c.t.bind(c,1384,23))},9902:a=>{"use strict";a.exports=require("path")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[586,898],()=>b(b.s=104));module.exports=c})();